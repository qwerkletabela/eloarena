# Code snapshot (2025-11-25T19:45:26Z)

## Git

```
commit 981c6b2eaf25259b1d4f74aeebef6222fc4c0b6f
Author:     Micha≈Ç <qwerkle.tabela@gmail.com>
AuthorDate: Tue Nov 25 20:45:14 2025 +0100
Commit:     Micha≈Ç <qwerkle.tabela@gmail.com>
CommitDate: Tue Nov 25 20:45:14 2025 +0100

    Merge branch 'main' of https://github.com/qwerkletabela/eloarena
```

## Tree

```
total 328
drwxr-xr-x 9 runner runner   4096 Nov 25 19:45 .
drwxr-xr-x 3 runner runner   4096 Nov 25 19:45 ..
drwxr-xr-x 7 runner runner   4096 Nov 25 19:45 .git
drwxr-xr-x 3 runner runner   4096 Nov 25 19:45 .github
-rw-r--r-- 1 runner runner    480 Nov 25 19:45 .gitignore
-rw-r--r-- 1 runner runner   1450 Nov 25 19:45 README.md
drwxr-xr-x 8 runner runner   4096 Nov 25 19:45 app
-rw-r--r-- 1 runner runner    368 Nov 25 19:45 code-snapshot.md
drwxr-xr-x 2 runner runner   4096 Nov 25 19:45 components
-rw-r--r-- 1 runner runner  11194 Nov 25 19:45 db.txt
-rw-r--r-- 1 runner runner    465 Nov 25 19:45 eslint.config.mjs
drwxr-xr-x 3 runner runner   4096 Nov 25 19:45 lib
-rw-r--r-- 1 runner runner    156 Nov 25 19:45 next.config.ts
-rw-r--r-- 1 runner runner 249796 Nov 25 19:45 package-lock.json
-rw-r--r-- 1 runner runner    746 Nov 25 19:45 package.json
-rw-r--r-- 1 runner runner     82 Nov 25 19:45 postcss.config.js
drwxr-xr-x 2 runner runner   4096 Nov 25 19:45 public
drwxr-xr-x 2 runner runner   4096 Nov 25 19:45 snapshots
-rw-r--r-- 1 runner runner    246 Nov 25 19:45 tailwind.config.js
-rw-r--r-- 1 runner runner    666 Nov 25 19:45 tsconfig.json

app/
app/api/resolve-email/route.ts
app/admin/miejsca/page.tsx
app/admin/turniej/page.tsx
app/admin/users/page.tsx
app/admin/page.tsx
app/globals.css
app/turniej/new/page.tsx
app/turniej/create/route.ts
app/turniej/page.tsx
app/auth/signout/route.ts
app/auth/login/route.ts
app/auth/signin/page.tsx
app/auth/signup/page.tsx
app/profile/update/route.ts
app/profile/page.tsx
app/layout.tsx
app/onboarding/username-form.tsx
app/onboarding/page.tsx
app/favicon.ico
app/page.tsx

components/
components/MiejsceForm.tsx
components/MapPicker.tsx
components/LoadGoogleMaps.tsx
components/DeleteTurniej.tsx
components/SheetPicker.tsx
components/Navbar.tsx
components/AutoHide.tsx

lib/
lib/supabase/server-mutable.ts
lib/supabase/server.ts
lib/supabase/admin.ts
lib/supabase/client.ts
```

## Files

### app/admin/gracz/add/route.ts

```
// app/admin/gracz/add/route.ts
import { NextRequest, NextResponse } from 'next/server'
import { createSupabaseServerMutable } from '@/lib/supabase/server-mutable'

export async function POST(req: NextRequest) {
  const origin = req.nextUrl.origin
  const supabase = await createSupabaseServerMutable()

  const { data: { user } } = await supabase.auth.getUser()
  const { data: isAdmin } = await supabase.rpc('is_admin')
  if (!user || !isAdmin) {
    return NextResponse.redirect(new URL('/', origin), { status: 303 })
  }

  const fd = await req.formData()
  const imie = String(fd.get('imie') || '').trim()
  const nazwisko = String(fd.get('nazwisko') || '').trim()
  const back = String(fd.get('back') || '/admin') // gdzie wracamy po akcji

  if (!imie || !nazwisko) {
    return NextResponse.redirect(new URL(`${back}?e=add_invalid`, origin), { status: 303 })
  }

  const { error } = await supabase
    .from('gracz')
    .upsert({ imie, nazwisko }, { onConflict: 'fullname_norm' })

  const url = new URL(back, origin)
  if (error) url.searchParams.set('e', 'add_failed')
  else url.searchParams.set('ok', '1')
  return NextResponse.redirect(url, { status: 303 })
}
```

### app/admin/miejsca/[id]/edit/page.tsx

```
// app/admin/miejsca/[id]/edit/page.tsx
import { redirect } from 'next/navigation'
import { createSupabaseServer } from '@/lib/supabase/server'
import MiejsceForm from '@/components/MiejsceForm'

export const dynamic = 'force-dynamic'
export const revalidate = 0

interface EditMiejscePageProps {
  params: Promise<{
    id: string
  }>
}

export default async function EditMiejscePage(props: EditMiejscePageProps) {
  const params = await props.params
  const supabase = await createSupabaseServer()

  // Sprawd≈∫ autoryzacjƒô
  const { data: { user } } = await supabase.auth.getUser()
  if (!user) redirect('/auth/signin')

  const { data: isAdmin } = await supabase.rpc('is_admin')
  if (!isAdmin) redirect('/')

  // Sprawd≈∫ czy params.id istnieje
  if (!params.id) {
    console.error('Brak ID w parametrach')
    redirect('/admin/miejsca')
  }

  // Pobierz istniejƒÖce miejsce
  const { data: miejsce, error } = await supabase
    .from('miejsce_turnieju')
    .select('*')
    .eq('id', params.id)
    .single()

  if (error || !miejsce) {
    console.error('Error fetching miejsce:', error)
    redirect('/admin/miejsca')
  }

  return (
    <main className="flex min-h-[calc(100vh-4rem)] items-center justify-center px-4 py-8">
      <div className="w-full max-w-3xl">
        <MiejsceForm mode="edit" initial={miejsce} />
      </div>
    </main>
  )
}```

### app/admin/miejsca/new/page.tsx

```
// app/admin/miejsca/new/page.tsx
import { redirect } from 'next/navigation'
import { createSupabaseServer } from '@/lib/supabase/server'
import MiejsceForm from '@/components/MiejsceForm'

export const dynamic = 'force-dynamic'
export const revalidate = 0

export default async function NewMiejscePage() {
  const supabase = await createSupabaseServer()

  const { data: { user } } = await supabase.auth.getUser()
  if (!user) redirect('/auth/signin')

  const { data: isAdmin } = await supabase.rpc('is_admin')
  if (!isAdmin) redirect('/')

  return (
    <main className="flex min-h-[calc(100vh-4rem)] items-center justify-center px-4 py-8">
      <div className="w-full max-w-3xl">
        <MiejsceForm mode="new" initial={null} />
      </div>
    </main>
  )
}
```

### app/admin/miejsca/page.tsx

```
// app/admin/miejsca/page.tsx
import Link from 'next/link'
import { redirect } from 'next/navigation'
import { createSupabaseServer } from '@/lib/supabase/server'

export const dynamic = 'force-dynamic'
export const revalidate = 0

type Row = {
  id: string
  nazwa: string
  miasto: string
  wojewodztwo: string | null
  adres: string | null
  latitude: number
  longitude: number
  created_at: string | null
}

export default async function AdminMiejscaList() {
  const supabase = await createSupabaseServer()

  // wymagane logowanie
  const {
    data: { user },
  } = await supabase.auth.getUser()
  if (!user) redirect('/auth/signin')

  // wymagany admin (tak jak w innych stronach panelu)
  const { data: isAdmin } = await supabase.rpc('is_admin')
  if (!isAdmin) redirect('/')

  // pobierz miejsca
  const { data: rows, error } = await supabase
    .from('miejsce_turnieju')
    .select(
      'id, nazwa, miasto, wojewodztwo, adres, latitude, longitude, created_at'
    )
    .order('miasto', { ascending: true })
    .order('nazwa', { ascending: true })

  if (error) {
    return (
      <main className="flex min-h-[calc(100vh-4rem)] items-center justify-center px-4 py-8">
        <div className="w-full max-w-6xl rounded-2xl bg-slate-800/95 border border-slate-700 shadow-[0_14px_40px_rgba(0,0,0,0.8)] p-6">
          <h1 className="text-2xl font-semibold text-sky-50 mb-4">
            Miejsca turniej√≥w - Panel admina
          </h1>
          <div className="rounded-md border border-red-400/50 bg-red-500/10 px-4 py-3 text-red-200">
            Nie uda≈Ço siƒô pobraƒá danych miejsc.
          </div>
        </div>
      </main>
    )
  }

  return (
    <main className="flex min-h-[calc(100vh-4rem)] items-center justify-center px-4 py-8">
      <div className="w-full max-w-6xl rounded-2xl bg-slate-800/95 border border-slate-700 shadow-[0_14px_40px_rgba(0,0,0,0.8)] p-6 space-y-6">
        <div className="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
          <div>
            <h1 className="text-2xl font-semibold text-sky-50">
              Miejsca turniej√≥w
            </h1>
            <p className="mt-1 text-sm text-slate-400">
              Lista wszystkich zdefiniowanych lokalizacji, kt√≥re mo≈ºesz podpiƒÖƒá
              pod turnieje.
            </p>
          </div>
          <Link
            href="/admin/miejsca/new"
            className="rounded-full bg-sky-600 hover:bg-sky-500 px-6 py-2 text-sm font-semibold text-white transition flex items-center gap-2"
          >
            <svg
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              strokeWidth="2"
            >
              <path d="M12 5v14M5 12h14" />
            </svg>
            Dodaj miejsce
          </Link>
        </div>

        <div className="overflow-x-auto rounded-lg border border-slate-600">
          <table className="min-w-full text-sm">
            <thead className="bg-slate-700/50">
              <tr>
                <th className="px-4 py-3 text-left text-sky-100 font-medium text-xs uppercase tracking-wider">
                  Miasto
                </th>
                <th className="px-4 py-3 text-left text-sky-100 font-medium text-xs uppercase tracking-wider">
                  Nazwa miejsca
                </th>
                <th className="px-4 py-3 text-left text-sky-100 font-medium text-xs uppercase tracking-wider">
                  Wojew√≥dztwo
                </th>
                <th className="px-4 py-3 text-left text-sky-100 font-medium text-xs uppercase tracking-wider">
                  Adres
                </th>
                <th className="px-4 py-3 text-left text-sky-100 font-medium text-xs uppercase tracking-wider">
                  Wsp√≥≈Çrzƒôdne
                </th>
                <th className="px-4 py-3 text-left text-sky-100 font-medium text-xs uppercase tracking-wider">
                  Utworzono
                </th>
                <th className="px-4 py-3 text-right text-sky-100 font-medium text-xs uppercase tracking-wider">
                  Akcje
                </th>
              </tr>
            </thead>
            <tbody className="divide-y divide-slate-600">
              {rows?.map((raw) => {
                const r = raw as Row
                return (
                  <tr
                    key={r.id}
                    className="hover:bg-slate-700/30 transition"
                  >
                    <td className="px-4 py-3 text-sky-100">
                      {r.miasto || '‚Äî'}
                    </td>
                    <td className="px-4 py-3">
                      <Link
                        href={`/admin/miejsca/${r.id}/edit`}
                        className="text-sky-100 hover:text-sky-200 font-medium hover:underline"
                      >
                        {r.nazwa}
                      </Link>
                    </td>
                    <td className="px-4 py-3 text-slate-200 text-xs">
                      {r.wojewodztwo || '‚Äî'}
                    </td>
                    <td className="px-4 py-3 text-slate-200 text-xs max-w-xs truncate">
                      {r.adres || '‚Äî'}
                    </td>
                    <td className="px-4 py-3 text-slate-200 text-xs">
                      {r.latitude?.toFixed(4)}, {r.longitude?.toFixed(4)}
                    </td>
                    <td className="px-4 py-3 text-slate-200 text-xs">
                      {r.created_at
                        ? new Date(r.created_at).toLocaleDateString('pl-PL')
                        : '‚Äî'}
                    </td>
                    <td className="px-4 py-3 text-right">
                      <Link
                        href={`/admin/miejsca/${r.id}/edit`}
                        className="inline-flex items-center gap-1 rounded bg-sky-600 hover:bg-sky-500 px-3 py-1 text-xs font-medium text-white transition"
                      >
                        <svg
                          width="12"
                          height="12"
                          viewBox="0 0 24 24"
                          fill="none"
                          stroke="currentColor"
                          strokeWidth="2"
                        >
                          <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" />
                          <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z" />
                        </svg>
                        Edytuj
                      </Link>
                      {/* Tutaj w przysz≈Ço≈õci mo≈ºesz dodaƒá DeleteMiejsce tak jak DeleteTurniej */}
                    </td>
                  </tr>
                )
              })}

              {!rows?.length && (
                <tr>
                  <td
                    className="px-4 py-8 text-center text-slate-400 text-sm"
                    colSpan={7}
                  >
                    <div className="flex flex-col items-center gap-2">
                      <svg
                        width="48"
                        height="48"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        strokeWidth="1"
                        className="text-slate-600"
                      >
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
                        <polyline points="14,2 14,8 20,8" />
                        <line x1="16" y1="13" x2="8" y2="13" />
                        <line x1="16" y1="17" x2="8" y2="17" />
                        <polyline points="10,9 9,9 8,9" />
                      </svg>
                      <p>Brak zdefiniowanych miejsc turniej√≥w</p>
                      <Link
                        href="/admin/miejsca/new"
                        className="text-sky-400 hover:text-sky-300 text-sm underline"
                      >
                        Dodaj pierwsze miejsce
                      </Link>
                    </div>
                  </td>
                </tr>
              )}
            </tbody>
          </table>
        </div>

        {rows && rows.length > 0 && (
          <div className="text-sm text-slate-400 text-center">
            Znaleziono {rows.length} miejsc
            {rows.length === 1
              ? 'e'
              : rows.length > 1 && rows.length < 5
              ? 'a'
              : ''}
          </div>
        )}
      </div>
    </main>
  )
}
```

### app/admin/page.tsx

```
import Link from 'next/link'
import { redirect } from 'next/navigation'
import { createSupabaseServer } from '@/lib/supabase/server'

export const dynamic = 'force-dynamic'
export const revalidate = 0

export default async function AdminPage() {
  const supabase = await createSupabaseServer()

  // kto jest zalogowany?
  const { data: { user } } = await supabase.auth.getUser()
  if (!user) {
    redirect('/auth/signin')
  }

  // sprawdzenie roli admin
  const { data: isAdmin } = await supabase.rpc('is_admin')
  if (!isAdmin) {
    redirect('/')
  }

  // proste statystyki (bez pobierania ca≈Çych rekord√≥w)
  const [turnieje, gracze, uzytkownicy] = await Promise.all([
    supabase.from('turniej').select('id', { count: 'exact', head: true }),
    supabase.from('gracz').select('id', { count: 'exact', head: true }),
    supabase.from('profiles').select('id', { count: 'exact', head: true }),
  ])

  const cntTurnieje = turnieje.count ?? 0
  const cntGracze = gracze.count ?? 0
  const cntUsers = uzytkownicy.count ?? 0

  return (
    
    <div className="min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900">
      <main className="flex min-h-[calc(100vh-4rem)] items-center justify-center px-4 py-8">
        <div className="w-full max-w-4xl rounded-2xl bg-slate-800/95 border border-slate-700 shadow-[0_14px_40px_rgba(0,0,0,0.8)] p-6 space-y-6">
          <header className="flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between">
            <div>
              <h1 className="text-2xl font-semibold text-sky-50">Panel administratora</h1>
              <p className="text-sm text-sky-200/80">
                ZarzƒÖdzanie u≈ºytkownikami, turniejami i danymi.
              </p>
            </div>
            <div className="rounded-full border border-slate-600 bg-slate-900/80 px-4 py-1.5 text-xs text-sky-200">
              <span className="opacity-70">Zalogowano jako:</span>{' '}
              <span className="font-medium">{user.email ?? '‚Äî'}</span>{' '}
              <span className="ml-2 rounded-full bg-red-600/80 px-2 py-0.5 text-[10px] font-semibold uppercase tracking-wide text-white">
                admin
              </span>
            </div>
          </header>

          {/* statystyki */}
          <section className="grid gap-3 sm:grid-cols-3">
            <div className="rounded-xl border border-slate-700 bg-slate-900/70 px-4 py-3">
              <div className="text-xs uppercase tracking-wide text-slate-400">Turnieje</div>
              <div className="mt-1 text-2xl font-semibold text-sky-100">{cntTurnieje}</div>
            </div>
            <div className="rounded-xl border border-slate-700 bg-slate-900/70 px-4 py-3">
              <div className="text-xs uppercase tracking-wide text-slate-400">Gracze</div>
              <div className="mt-1 text-2xl font-semibold text-sky-100">{cntGracze}</div>
            </div>
            <div className="rounded-xl border border-slate-700 bg-slate-900/70 px-4 py-3">
              <div className="text-xs uppercase tracking-wide text-slate-400">U≈ºytkownicy</div>
              <div className="mt-1 text-2xl font-semibold text-sky-100">{cntUsers}</div>
            </div>
          </section>

          {/* kafelki na akcje */}
          <section className="grid gap-4 sm:grid-cols-2">
            <Link
              href="/admin/users"
              className="group rounded-xl border border-slate-700 bg-slate-900/80 p-4 transition hover:border-sky-400/70 hover:bg-slate-900"
            >
              <div className="mb-2 flex items-center justify-between">
                <h2 className="text-sm font-semibold text-sky-100">
                  ZarzƒÖdzaj u≈ºytkownikami
                </h2>
                <span className="text-xs text-sky-300 group-hover:translate-x-0.5 transition-transform">
                  ‚Üí {/* strza≈Çka */}
                </span>
              </div>
              <p className="text-xs text-slate-300">
                PodglƒÖd kont, zmiana r√≥l (user/admin).
              </p>
            </Link>

            <Link
              href="/admin/turniej"
              className="group rounded-xl border border-slate-700 bg-slate-900/80 p-4 transition hover:border-sky-400/70 hover:bg-slate-900"
            >
              <div className="mb-2 flex items-center justify-between">
                <h2 className="text-sm font-semibold text-sky-100">
                  ZarzƒÖdzaj turniejami
                </h2>
                <span className="text-xs text-sky-300 group-hover:translate-x-0.5 transition-transform">
                  ‚Üí
                </span>
              </div>
              <p className="text-xs text-slate-300">
                Lista turniej√≥w, edycja danych, import z arkusza, mapa, usuwanie.
              </p>
            </Link>

            <Link
              href="/turniej/new"
              className="group rounded-xl border border-sky-700 bg-sky-900/70 p-4 transition hover:border-sky-400 hover:bg-sky-900"
            >
              <div className="mb-2 flex items-center justify-between">
                <h2 className="text-sm font-semibold text-sky-50">
                  Dodaj nowy turniej
                </h2>
                <span className="text-xs text-sky-100 group-hover:translate-x-0.5 transition-transform">
                  +
                </span>
              </div>
              <p className="text-xs text-sky-100/80">
                Utw√≥rz nowy turniej, ustaw datƒô, godziny, limit graczy, arkusz i lokalizacjƒô.
              </p>
            </Link>

            <Link
              href="/admin/miejsca/"
              className="group rounded-xl border border-slate-700 bg-slate-900/80 p-4 transition hover:border-sky-400/70 hover:bg-slate-900"
            >
              <div className="mb-2 flex items-center justify-between">
                <h2 className="text-sm font-semibold text-sky-100">
                  ZarzƒÖdzaj miejscem turnieju.
                </h2>
                <span className="text-xs text-sky-300 group-hover:translate-x-0.5 transition-transform">
                  ‚Üí
                </span>
              </div>
              <p className="text-xs text-slate-300">
                PrzeglƒÖd i zarzƒÖdzanie tabelƒÖ miejscem turnieju.
              </p>
            </Link>
          </section>
        </div>
      </main>
    {/* DODANE: Zamkniƒôcie kontenera z t≈Çem */}
    </div>
  )
}```

### app/admin/turniej/[id]/delete/route.ts

```
// app/admin/turniej/[id]/delete/route.ts
import { NextRequest, NextResponse } from 'next/server'
import { createSupabaseServerMutable } from '@/lib/supabase/server-mutable'

const UUID_RE = /^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i

export async function POST(req: NextRequest, ctx: { params: Promise<{ id: string }> }) {
  const origin = req.nextUrl.origin
  const { id } = await ctx.params
  
  if (!id || !UUID_RE.test(id)) {
    return NextResponse.redirect(new URL('/admin/turniej?e=invalid_id', origin), { status: 303 })
  }

  const supabase = await createSupabaseServerMutable()
  const { data: { user } } = await supabase.auth.getUser()
  if (!user) return NextResponse.redirect(new URL('/auth/signin', origin), { status: 303 })
  
  const { data: isAdmin } = await supabase.rpc('is_admin')
  if (!isAdmin) return NextResponse.redirect(new URL('/', origin), { status: 303 })

  const { error } = await supabase
    .from('turniej')
    .delete()
    .eq('id', id)

  if (error) {
    console.error('Delete turniej error', error)
    return NextResponse.redirect(new URL('/admin/turniej?e=delete_failed', origin), { status: 303 })
  }

  return NextResponse.redirect(new URL('/admin/turniej?ok=1', origin), { status: 303 })
}```

### app/admin/turniej/[id]/edit/page.tsx

```
import { redirect } from 'next/navigation'
import { createSupabaseServer } from '@/lib/supabase/server'
import AutoHide from '@/components/AutoHide' // Zaimportuj komponent AutoHide

export const dynamic = 'force-dynamic'
export const revalidate = 0

interface EditTurniejPageProps {
  params: Promise<{
    id: string
  }>
  searchParams?: Promise<{ [key: string]: string | string[] | undefined }>
}

export default async function EditTurniejPage(props: EditTurniejPageProps) {
  const params = await props.params
  const searchParams = await props.searchParams
  const supabase = await createSupabaseServer()

  // Sprawd≈∫ autoryzacjƒô
  const { data: { user } } = await supabase.auth.getUser()
  if (!user) redirect('/auth/signin')

  const { data: isAdmin } = await supabase.rpc('is_admin')
  if (!isAdmin) redirect('/')

  // Pobierz istniejƒÖce miejsca turnieju
  const { data: miejsca } = await supabase
    .from('miejsce_turnieju')
    .select('id, nazwa, miasto, wojewodztwo, adres, latitude, longitude')
    .order('nazwa', { ascending: true })

  // Pobierz turniej do edycji
  const { data: turniej } = await supabase
    .from('turniej')
    .select('*')
    .eq('id', params.id)
    .single()

  if (!turniej) {
    redirect('/admin?error=turniej_not_found')
  }

  // Obs≈Çuga komunikat√≥w
  const errorMessages: Record<string, string> = {
    invalid_input: 'Wype≈Çnij wszystkie wymagane pola',
    miejsce_required: 'Wybierz miejsce turnieju',
    sheet_col_invalid: 'Kolumna nazwisk musi byƒá pojedynczƒÖ literƒÖ (A-Z)',
    number_invalid: 'Wprowad≈∫ poprawnƒÖ liczbƒô',
    url_invalid: 'Wprowad≈∫ poprawny URL',
    save_failed: 'Zapis nie powi√≥d≈Ç siƒô. Spr√≥buj ponownie.',
    place_not_found: 'Wybrane miejsce nie istnieje',
  }

  const error = searchParams?.e as string
  const success = searchParams?.ok as string

  return (
    <main className="flex min-h-[calc(100vh-4rem)] items-center justify-center px-4 py-8 bg-slate-900">
      <div className="w-full max-w-2xl rounded-2xl bg-slate-800/95 border border-slate-700 shadow-[0_14px_40px_rgba(0,0,0,0.8)] p-6 space-y-6">
        <h1 className="text-2xl font-semibold text-sky-50">Edytuj turniej</h1>

        {/* Komunikaty */}
        {error && (
          <div className="rounded-lg border-2 border-red-500 bg-red-500/20 px-4 py-4 text-base font-medium text-red-100">
            ‚ùå {errorMessages[error] || 'WystƒÖpi≈Ç nieznany b≈ÇƒÖd'}
          </div>
        )}
        
        {success && (
          <AutoHide ms={5000}>
            <div className="rounded-lg border-2 border-green-500 bg-green-500/20 px-4 py-4 text-base font-medium text-green-100 animate-pulse">
              ‚úÖ Turniej zosta≈Ç zaktualizowany pomy≈õlnie!
            </div>
          </AutoHide>
        )}

        <form action={`/admin/turniej/${params.id}/update`} method="post" className="space-y-5">
          {/* Nazwa turnieju */}
          <div>
            <label className="block text-sm font-medium text-sky-100">Nazwa turnieju *</label>
            <input 
              name="nazwa" 
              required 
              defaultValue={turniej.nazwa}
              className="mt-1 w-full rounded border border-slate-600 bg-slate-900/80 px-3 py-2 text-sky-100 placeholder:text-slate-500 focus:border-sky-500 focus:ring-1 focus:ring-sky-500" 
              placeholder="np. ELO Arena Open" 
            />
          </div>

          {/* Data i godziny */}
          <div className="grid grid-cols-1 gap-4 sm:grid-cols-3">
            <div>
              <label className="block text-sm font-medium text-sky-100">Data turnieju *</label>
              <input 
                type="date" 
                name="data_turnieju" 
                required 
                defaultValue={turniej.data_turnieju || ''}
                className="mt-1 w-full rounded border border-slate-600 bg-slate-900/80 px-3 py-2 text-sky-100 focus:border-sky-500 focus:ring-1 focus:ring-sky-500" 
              />
            </div>
            <div>
              <label className="block text-sm font-medium text-sky-100">Godzina startu *</label>
              <input 
                type="time" 
                name="godzina_turnieju" 
                required 
                defaultValue={turniej.godzina_turnieju || ''}
                className="mt-1 w-full rounded border border-slate-600 bg-slate-900/80 px-3 py-2 text-sky-100 focus:border-sky-500 focus:ring-1 focus:ring-sky-500" 
              />
            </div>
            <div>
              <label className="block text-sm font-medium text-sky-100">Godzina zako≈Ñczenia</label>
              <input 
                type="time" 
                name="zakonczenie_turnieju" 
                defaultValue={turniej.zakonczenie_turnieju || ''}
                className="mt-1 w-full rounded border border-slate-600 bg-slate-900/80 px-3 py-2 text-sky-100 focus:border-sky-500 focus:ring-1 focus:ring-sky-500" 
              />
            </div>
          </div>

          {/* Miejsce turnieju */}
          <div>
            <label className="block text-sm font-medium text-sky-100">Miejsce turnieju *</label>
            <select 
              name="miejsce_id" 
              required
              defaultValue={turniej.miejsce_id || ''}
              className="mt-1 w-full rounded border border-slate-600 bg-slate-900/80 px-3 py-2 text-sky-100 focus:border-sky-500 focus:ring-1 focus:ring-sky-500"
            >
              <option value="">‚Äî wybierz miejsce turnieju ‚Äî</option>
              {miejsca?.map((miejsce) => (
                <option key={miejsce.id} value={miejsce.id}>
                  {miejsce.nazwa} - {miejsce.miasto}
                  {miejsce.wojewodztwo && `, ${miejsce.wojewodztwo}`}
                </option>
              ))}
            </select>
            <div className="mt-2 flex justify-between items-center">
              <p className="text-xs text-slate-400">
                Je≈õli nie ma odpowiedniego miejsca, dodaj je najpierw w panelu administracyjnym.
              </p>
              <a 
                href="/admin/miejsca/new" 
                className="text-xs text-sky-400 hover:text-sky-300 hover:underline"
                target="_blank"
                rel="noopener noreferrer"
              >
                Dodaj nowe miejsce ‚Üí
              </a>
            </div>
          </div>

          {/* Arkusz Google */}
          <div>
            <label className="block text-sm font-medium text-sky-100">Link do arkusza Google (opcjonalnie)</label>
            <input 
              name="gsheet_url" 
              defaultValue={turniej.gsheet_url || ''}
              className="mt-1 w-full rounded border border-slate-600 bg-slate-900/80 px-3 py-2 text-sky-100 placeholder:text-slate-500 focus:border-sky-500 focus:ring-1 focus:ring-sky-500" 
              placeholder="https://docs.google.com/spreadsheets/d/..." 
            />
          </div>

          {/* ID arkusza Google */}
          <div>
            <label className="block text-sm font-medium text-sky-100">ID arkusza Google (opcjonalnie)</label>
            <input 
              name="gsheet_id" 
              defaultValue={turniej.gsheet_id || ''}
              className="mt-1 w-full rounded border border-slate-600 bg-slate-900/80 px-3 py-2 text-sky-100 placeholder:text-slate-500 focus:border-sky-500 focus:ring-1 focus:ring-sky-500" 
              placeholder="np. 1BxiMVs0XRA5nFMdKvBdBZjgmUUqptlbs74OgvE2upms" 
            />
          </div>

          {/* Szczeg√≥≈Çy arkusza */}
          <div className="grid grid-cols-1 gap-4 sm:grid-cols-3">
            <div>
              <label className="block text-sm font-medium text-sky-100">Nazwa karty (opcjonalnie)</label>
              <input 
                name="arkusz_nazwa" 
                defaultValue={turniej.arkusz_nazwa || ''}
                className="mt-1 w-full rounded border border-slate-600 bg-slate-900/80 px-3 py-2 text-sky-100 placeholder:text-slate-500 focus:border-sky-500 focus:ring-1 focus:ring-sky-500" 
                placeholder="np. Lista" 
              />
            </div>
            <div>
              <label className="block text-sm font-medium text-sky-100">Kolumna nazwisk</label>
              <input 
                name="kolumna_nazwisk" 
                defaultValue={turniej.kolumna_nazwisk || ''}
                className="mt-1 w-full rounded border border-slate-600 bg-slate-900/80 px-3 py-2 text-sky-100 placeholder:text-slate-500 focus:border-sky-500 focus:ring-1 focus:ring-sky-500" 
                placeholder="np. B" 
                maxLength={2} 
              />
            </div>
            <div>
              <label className="block text-sm font-medium text-sky-100">Pierwszy wiersz z nazwiskiem</label>
              <input 
                type="number" 
                name="pierwszy_wiersz_z_nazwiskiem" 
                min={1} 
                defaultValue={turniej.pierwszy_wiersz_z_nazwiskiem || 2}
                className="mt-1 w-full rounded border border-slate-600 bg-slate-900/80 px-3 py-2 text-sky-100 focus:border-sky-500 focus:ring-1 focus:ring-sky-500" 
              />
            </div>
          </div>

          {/* Limit graczy */}
          <div className="grid grid-cols-1 gap-4 sm:grid-cols-2">
            <div>
              <label className="block text-sm font-medium text-sky-100">Limit graczy (opcjonalnie)</label>
              <input 
                type="number" 
                name="limit_graczy" 
                min={1} 
                defaultValue={turniej.limit_graczy || ''}
                className="mt-1 w-full rounded border border-slate-600 bg-slate-900/80 px-3 py-2 text-sky-100 focus:border-sky-500 focus:ring-1 focus:ring-sky-500" 
              />
            </div>
          </div>

          {/* Przyciski akcji */}
          <div className="flex gap-2 pt-4">
            <button 
              className="rounded-full bg-sky-600 hover:bg-sky-500 px-6 py-2 text-sm font-semibold text-white transition focus:outline-none focus:ring-2 focus:ring-sky-500 focus:ring-offset-2 focus:ring-offset-slate-800" 
              type="submit"
            >
              Zapisz zmiany
            </button>
            <a 
              href="/admin" 
              className="rounded-full border border-slate-600 bg-slate-700 hover:bg-slate-600 px-6 py-2 text-sm font-semibold text-sky-100 transition"
            >
              Anuluj
            </a>
          </div>
        </form>
      </div>
    </main>
  )
}```

### app/admin/turniej/[id]/import/preview/route.ts

```
import { NextRequest, NextResponse } from 'next/server'
import { createSupabaseServer } from '@/lib/supabase/server'

// pomocnicze funkcje (te same co w imporcie)
function buildCsvUrl(sheetUrl: string, sheetName?: string | null) {
  const m = sheetUrl.match(/spreadsheets\/d\/([a-zA-Z0-9-_]+)/)
  const id = m?.[1]; if (!id) return null
  if (sheetName && !/^\d+$/.test(sheetName)) {
    return `https://docs.google.com/spreadsheets/d/${id}/gviz/tq?tqx=out:csv&sheet=${encodeURIComponent(sheetName)}`
  }
  const gidMatch = sheetUrl.match(/[?&]gid=(\d+)/)
  const gid = gidMatch?.[1]
  if (gid) return `https://docs.google.com/spreadsheets/d/${id}/export?format=csv&gid=${gid}`
  return `https://docs.google.com/spreadsheets/d/${id}/export?format=csv`
}

function colLetterToIndex(letter: string) {
  const l = letter.trim().toUpperCase()
  if (!/^[A-Z]+$/.test(l)) return null
  let idx = 0
  for (let i = 0; i < l.length; i++) idx = idx * 26 + (l.charCodeAt(i) - 64)
  return idx - 1
}

function parseCsv(text: string): string[][] {
  const firstLine = text.split(/\r?\n/)[0] ?? ''
  const sep = (firstLine.match(/;/g)?.length ?? 0) > (firstLine.match(/,/g)?.length ?? 0) ? ';' : ','
  const rows: string[][] = []
  let i = 0, field = '', row: string[] = [], inQuotes = false
  while (i < text.length) {
    const ch = text[i]
    if (inQuotes) {
      if (ch === '"') { if (text[i + 1] === '"') { field += '"'; i += 2; continue } inQuotes = false; i++; continue }
      field += ch; i++; continue
    } else {
      if (ch === '"') { inQuotes = true; i++; continue }
      if (ch === sep) { row.push(field); field = ''; i++; continue }
      if (ch === '\n') { row.push(field); rows.push(row); row = []; field = ''; i++; continue }
      if (ch === '\r') { i++; continue }
      field += ch; i++
    }
  }
  row.push(field); rows.push(row)
  return rows
}

export async function GET(req: NextRequest, ctx: { params: Promise<{ id: string }> }) {
  const { id } = await ctx.params
  const supabase = await createSupabaseServer()

  // auth + admin
  const { data: { user } } = await supabase.auth.getUser()
  const { data: isAdmin } = await supabase.rpc('is_admin')
  if (!user || !isAdmin) {
    return new NextResponse('Unauthorized', { status: 401 })
  }

  // turniej
  const { data: t, error } = await supabase
    .from('turniej')
    .select('nazwa, gsheet_url, arkusz_nazwa, kolumna_nazwisk, pierwszy_wiersz_z_nazwiskiem')
    .eq('id', id)
    .maybeSingle()
  if (error || !t) return new NextResponse('Turniej nie znaleziony', { status: 404 })

  if (!t.gsheet_url || !t.kolumna_nazwisk || !t.pierwszy_wiersz_z_nazwiskiem) {
    return new NextResponse('Brak konfiguracji arkusza (url/kolumna/pierwszy wiersz)', { status: 400 })
  }

  const csvUrl = buildCsvUrl(t.gsheet_url, t.arkusz_nazwa)
  if (!csvUrl) return new NextResponse('Z≈Çy link do arkusza', { status: 400 })

  let csv = ''
  try {
    const r = await fetch(csvUrl, { headers: { 'cache-control': 'no-cache' } })
    if (!r.ok) return new NextResponse(`Nie mo≈ºna pobraƒá CSV (${r.status})`, { status: 400 })
    csv = await r.text()
  } catch {
    return new NextResponse('B≈ÇƒÖd pobierania CSV', { status: 400 })
  }

  const colIdx = colLetterToIndex(t.kolumna_nazwisk)
  if (colIdx == null) return new NextResponse('Nieprawid≈Çowa kolumna', { status: 400 })

  const rows = parseCsv(csv)
  const startAt = Math.max(1, t.pierwszy_wiersz_z_nazwiskiem || 1)
  const names = rows.slice(startAt - 1).map(r => (r[colIdx] || '').trim()).filter(Boolean)

  // prosty HTML ‚Äì lista tylko z podanej kolumny
  const html = `<!doctype html>
<html lang="pl">
<meta charset="utf-8" />
<title>PodglƒÖd: ${t.nazwa ?? 'Turniej'}</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<style>
  body { font-family: ui-sans-serif, system-ui, sans-serif; padding: 16px; }
  h1 { font-size: 18px; margin: 0 0 12px; }
  ol { padding-left: 20px; }
  li { padding: 4px 0; border-bottom: 1px solid #eee; }
  .meta { color:#6b7280; font-size:12px; margin: 6px 0 12px; }
</style>
<h1>PodglƒÖd kolumny nazwisk</h1>
<div class="meta">
≈πr√≥d≈Ço: ${t.gsheet_url ? `<a href="${t.gsheet_url}" target="_blank" rel="noreferrer">Arkusz</a>` : '‚Äî'}
 ‚Ä¢ kolumna: <b>${t.kolumna_nazwisk}</b>
 ‚Ä¢ od wiersza: <b>${startAt}</b>
</div>
<ol>
  ${names.map(n => `<li>${n.replace(/</g, '&lt;')}</li>`).join('\n')}
</ol>
</html>`
  return new NextResponse(html, { status: 200, headers: { 'content-type': 'text/html; charset=utf-8' } })
}
```

### app/admin/turniej/[id]/import/route.ts

```
// app/admin/turniej/[id]/import/route.ts
import { NextRequest, NextResponse } from 'next/server'
import { createSupabaseServerMutable } from '@/lib/supabase/server-mutable'

type TurniejRow = {
  id: string
  nazwa: string | null
  gsheet_url: string | null
  arkusz_nazwa: string | null
  kolumna_nazwisk: string | null
  pierwszy_wiersz_z_nazwiskiem: number | null
}

/** Buduje URL CSV z gsheet_url i (opcjonalnie) nazwƒÖ karty. */
function buildCsvUrl(sheetUrl: string, sheetName?: string | null) {
  const m = sheetUrl.match(/spreadsheets\/d\/([a-zA-Z0-9-_]+)/)
  const id = m?.[1]
  if (!id) return null

  // Je≈õli jest nazwa karty ‚Äì u≈ºyj gviz CSV
  if (sheetName && !/^\d+$/.test(sheetName)) {
    return `https://docs.google.com/spreadsheets/d/${id}/gviz/tq?tqx=out:csv&sheet=${encodeURIComponent(sheetName)}`
  }

  // Je≈õli w URL jest gid ‚Äì u≈ºyj go
  const gidMatch = sheetUrl.match(/[?&]gid=(\d+)/)
  const gid = gidMatch?.[1]
  if (gid) return `https://docs.google.com/spreadsheets/d/${id}/export?format=csv&gid=${gid}`

  // Domy≈õlnie: pierwsza karta
  return `https://docs.google.com/spreadsheets/d/${id}/export?format=csv`
}

/** Zamienia literƒô kolumny (np. "B") na indeks 0-based. */
function colLetterToIndex(letter: string) {
  const l = letter.trim().toUpperCase()
  if (!/^[A-Z]+$/.test(l)) return null
  let idx = 0
  for (let i = 0; i < l.length; i++) {
    idx = idx * 26 + (l.charCodeAt(i) - 64)
  }
  return idx - 1
}

/** Prosty parser CSV: wspiera cudzys≈Çowy i separator , lub ; */
function parseCsv(text: string): string[][] {
  const firstLine = text.split(/\r?\n/)[0] ?? ''
  const sep = (firstLine.match(/;/g)?.length ?? 0) > (firstLine.match(/,/g)?.length ?? 0) ? ';' : ','
  const rows: string[][] = []
  let i = 0, field = '', row: string[] = [], inQuotes = false
  while (i < text.length) {
    const ch = text[i]
    if (inQuotes) {
      if (ch === '"') {
        if (text[i + 1] === '"') { field += '"'; i += 2; continue }
        inQuotes = false; i++; continue
      } else { field += ch; i++; continue }
    } else {
      if (ch === '"') { inQuotes = true; i++; continue }
      if (ch === sep) { row.push(field); field = ''; i++; continue }
      if (ch === '\n') { row.push(field); rows.push(row); row = []; field = ''; i++; continue }
      if (ch === '\r') { i++; continue }
      field += ch; i++
    }
  }
  row.push(field); rows.push(row)
  return rows
}

/** Rozbija ‚ÄûImiƒô Nazwisko‚Äù na { imie, nazwisko }. Ostatnie s≈Çowo = nazwisko. */
function splitFullName(full: string) {
  const clean = full.replace(/\s+/g, ' ').trim()
  if (!clean) return null
  const parts = clean.split(' ')
  const nazwisko = parts.pop()!
  const imie = parts.join(' ')
  if (!imie || !nazwisko) return null
  return { imie, nazwisko }
}

export async function POST(req: NextRequest, ctx: { params: Promise<{ id: string }> }) {
  const { id } = await ctx.params
  const origin = req.nextUrl.origin
  const supabase = await createSupabaseServerMutable()

  // auth + admin
  const { data: { user } } = await supabase.auth.getUser()
  if (!user) return NextResponse.redirect(new URL('/auth/signin', origin), { status: 303 })
  const { data: isAdmin } = await supabase.rpc('is_admin')
  if (!isAdmin) return NextResponse.redirect(new URL('/', origin), { status: 303 })

  // pobierz konfiguracjƒô turnieju
  const { data: t, error: terr } = await supabase
    .from('turniej')
    .select('id, nazwa, gsheet_url, arkusz_nazwa, kolumna_nazwisk, pierwszy_wiersz_z_nazwiskiem')
    .eq('id', id)
    .single<TurniejRow>()

  if (terr || !t) {
    console.error('[import] no_tournament', terr)
    return NextResponse.redirect(new URL(`/admin/turniej/${id}/edit?e=no_tournament`, origin), { status: 303 })
  }
  if (!t.gsheet_url || !t.kolumna_nazwisk || !t.pierwszy_wiersz_z_nazwiskiem) {
    return NextResponse.redirect(new URL(`/admin/turniej/${id}/edit?e=missing_sheet_cfg`, origin), { status: 303 })
  }

  const csvUrl = buildCsvUrl(t.gsheet_url, t.arkusz_nazwa)
  if (!csvUrl) {
    return NextResponse.redirect(new URL(`/admin/turniej/${id}/edit?e=bad_sheet_url`, origin), { status: 303 })
  }

  // pobierz CSV
  let csvText = ''
  try {
    const resp = await fetch(csvUrl, { headers: { 'cache-control': 'no-cache' } })
    if (!resp.ok) {
      console.error('[import] fetch_failed', resp.status, await resp.text().catch(() => ''))
      return NextResponse.redirect(new URL(`/admin/turniej/${id}/edit?e=fetch_failed&s=${resp.status}`, origin), { status: 303 })
    }
    csvText = await resp.text()
  } catch (e) {
    console.error('[import] fetch_error', e)
    return NextResponse.redirect(new URL(`/admin/turniej/${id}/edit?e=fetch_failed`, origin), { status: 303 })
  }

  // CSV -> rows -> wyb√≥r kolumny
  const rows = parseCsv(csvText)
  const colIdx = colLetterToIndex(t.kolumna_nazwisk!)
  if (colIdx == null) {
    return NextResponse.redirect(new URL(`/admin/turniej/${id}/edit?e=col_invalid`, origin), { status: 303 })
  }

  const startAt = Math.max(1, t.pierwszy_wiersz_z_nazwiskiem || 1) // 1-based
  const picked = rows.slice(startAt - 1).map(r => (r[colIdx] || '').trim()).filter(Boolean)
  if (!picked.length) {
    console.warn('[import] empty_after_parse', { startAt, colIdx, totalRows: rows.length })
    return NextResponse.redirect(new URL(`/admin/turniej/${id}/edit?e=empty_after_parse`, origin), { status: 303 })
  }

  // przygotuj payload graczy
  const grPayload: { imie: string; nazwisko: string }[] = []
  for (const full of picked) {
    const s = splitFullName(full)
    if (!s) continue
    grPayload.push({ imie: s.imie, nazwisko: s.nazwisko })
  }
  if (!grPayload.length) {
    return NextResponse.redirect(new URL(`/admin/turniej/${id}/edit?e=empty_after_parse`, origin), { status: 303 })
  }

  // upsert graczy po kolumnie unikatowej (fullname_norm)
  const { data: inserted, error: gerr } = await supabase
    .from('gracz')
    .upsert(grPayload, { onConflict: 'fullname_norm' }) // <- poprawka
    .select('id')

  if (gerr) {
    console.error('[import] gracz_upsert_failed', gerr)
    return NextResponse.redirect(new URL(`/admin/turniej/${id}/edit?e=gracz_upsert_failed`, origin), { status: 303 })
  }

  // zbuduj payload do wyniki (unikat: turniej_id, gracz_id)
  const ids = new Set<string>()
  inserted?.forEach(r => ids.add(r.id))

  const wynikiPayload = Array.from(ids).map(gracz_id => ({ turniej_id: id, gracz_id }))
  if (wynikiPayload.length) {
    const { error: werr } = await supabase
      .from('wyniki')
      .upsert(wynikiPayload, { onConflict: 'turniej_id,gracz_id' })
    if (werr) {
      console.error('[import] wyniki_upsert_failed', werr)
      return NextResponse.redirect(new URL(`/admin/turniej/${id}/edit?e=wyniki_upsert_failed`, origin), { status: 303 })
    }
  }

  return NextResponse.redirect(new URL(`/admin/turniej/${id}/edit?ok=1`, origin), { status: 303 })
}
```

### app/admin/turniej/[id]/update/route.ts

```
import { NextRequest, NextResponse } from 'next/server'
import { createSupabaseServerMutable } from '@/lib/supabase/server-mutable'

const urlRe = /^https?:\/\/\S+$/i
const sheetColRe = /^[A-Za-z]$/
const UUID_RE = /^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i

export async function POST(
  req: NextRequest,
  context: { params: Promise<{ id: string }> }
) {
  try {
    console.log('üîÑ UPDATE ROUTE CALLED - START')
    
    const params = await context.params
    const origin = req.nextUrl.origin
    const { id } = params
    
    console.log('üìù Tournament ID from params:', id)
    
    if (!id || !UUID_RE.test(id)) {
      console.log('‚ùå Invalid tournament ID')
      // ZMIENIONE: przekierowanie do /admin/turniej/[id]/edit
      return NextResponse.redirect(new URL(`/admin/turniej/${id}/edit?e=invalid_id`, origin), { status: 303 })
    }

    const supabase = await createSupabaseServerMutable()
    
    // Sprawd≈∫ autoryzacjƒô
    const { data: { user } } = await supabase.auth.getUser()
    console.log('üë§ User:', user?.email)
    
    if (!user) {
      console.log('‚ùå No user')
      return NextResponse.redirect(new URL('/auth/signin', origin), { status: 303 })
    }

    const { data: isAdmin } = await supabase.rpc('is_admin')
    console.log('üîê Is admin:', isAdmin)
    
    if (!isAdmin) {
      console.log('‚ùå Not admin')
      return NextResponse.redirect(new URL('/', origin), { status: 303 })
    }

    const fd = await req.formData()
    const formKeys = Array.from(fd.keys())
    console.log('üìã Form data keys:', formKeys)
    
    // Pobierz wszystkie pola
    const nazwa = String(fd.get('nazwa') || '').trim()
    const data_turnieju = String(fd.get('data_turnieju') || '').trim()
    const godzina_turnieju = String(fd.get('godzina_turnieju') || '').trim()
    const zakonczenie_turnieju = String(fd.get('zakonczenie_turnieju') || '').trim() || null
    const gsheet_url = (String(fd.get('gsheet_url') || '').trim()) || null
    const gsheet_id = (String(fd.get('gsheet_id') || '').trim()) || null
    const arkusz_nazwa = (String(fd.get('arkusz_nazwa') || '').trim()) || null
    const kolumna_nazwisk_raw = String(fd.get('kolumna_nazwisk') || '').trim()
    const kolumna_nazwisk = kolumna_nazwisk_raw ? kolumna_nazwisk_raw.toUpperCase() : null
    const pierwszy_wiersz_raw = fd.get('pierwszy_wiersz_z_nazwiskiem')
    const pierwszy_wiersz_z_nazwiskiem = pierwszy_wiersz_raw ? Number(pierwszy_wiersz_raw) : null
    const limit_graczy_raw = fd.get('limit_graczy')
    const limit_graczy = limit_graczy_raw !== null && String(limit_graczy_raw) !== '' ? Number(limit_graczy_raw) : null
    
    const miejsce_id = String(fd.get('miejsce_id') || '').trim() || null
    
    console.log('üèüÔ∏è  Place field:', { miejsce_id })
    console.log('üìä Basic fields:', { nazwa, data_turnieju, godzina_turnieju })

    // Walidacja podstawowych p√≥l
    if (!nazwa || !data_turnieju || !godzina_turnieju) {
      console.log('‚ùå Missing required fields')
      // ZMIENIONE: przekierowanie do /admin/turniej/[id]/edit
      return NextResponse.redirect(new URL(`/admin/turniej/${id}/edit?e=invalid_input`, origin), { status: 303 })
    }

    // Walidacja miejsca
    if (!miejsce_id) {
      console.log('‚ùå No place ID provided')
      // ZMIENIONE: przekierowanie do /admin/turniej/[id]/edit
      return NextResponse.redirect(new URL(`/admin/turniej/${id}/edit?e=miejsce_required`, origin), { status: 303 })
    }

    // Sprawd≈∫ czy miejsce istnieje w bazie
    const { data: miejsce, error: miejsceError } = await supabase
      .from('miejsce_turnieju')
      .select('id, latitude, longitude')
      .eq('id', miejsce_id)
      .single()

    if (miejsceError || !miejsce) {
      console.log('‚ùå Place not found:', miejsce_id)
      // ZMIENIONE: przekierowanie do /admin/turniej/[id]/edit
      return NextResponse.redirect(new URL(`/admin/turniej/${id}/edit?e=place_not_found`, origin), { status: 303 })
    }

    console.log('‚úÖ Place exists:', miejsce_id, 'with coords:', { lat: miejsce.latitude, lng: miejsce.longitude })

    // Przygotowanie danych
    const updates: Record<string, any> = {
      nazwa, 
      data_turnieju, 
      godzina_turnieju,
      zakonczenie_turnieju,
      gsheet_url, 
      gsheet_id, 
      arkusz_nazwa,
      kolumna_nazwisk, 
      pierwszy_wiersz_z_nazwiskiem,
      limit_graczy,
      miejsce_id,
      lat: miejsce.latitude,
      lng: miejsce.longitude,
    }

    console.log('üíæ Final updates:', updates)

    // Aktualizacja
    const { data, error } = await supabase
      .from('turniej')
      .update(updates)
      .eq('id', id)
      .select()

    if (error) {
      console.error('‚ùå Database error:', error)
      // ZMIENIONE: przekierowanie do /admin/turniej/[id]/edit
      return NextResponse.redirect(new URL(`/admin/turniej/${id}/edit?e=save_failed`, origin), { status: 303 })
    }

    console.log('‚úÖ Full update successful:', data)
    // ZMIENIONE: przekierowanie do /admin/turniej/[id]/edit
    return NextResponse.redirect(new URL(`/admin/turniej/${id}/edit?ok=1`, origin), { status: 303 })

  } catch (error) {
    console.error('üí• Unexpected error in route:', error)
    const params = await context.params
    // ZMIENIONE: przekierowanie do /admin/turniej/[id]/edit
    return NextResponse.redirect(new URL(`/admin/turniej/${params.id}/edit?e=server_error`, req.nextUrl.origin), { status: 303 })
  }
}```

### app/admin/turniej/page.tsx

```
// app/admin/turniej/page.tsx
import { redirect } from 'next/navigation'
import Link from 'next/link'
import { createSupabaseServer } from '@/lib/supabase/server'
import DeleteTurniej from '@/components/DeleteTurniej'

export const dynamic = 'force-dynamic'
export const revalidate = 0

type Row = {
  id: string
  nazwa: string
  data_turnieju: string | null
  godzina_turnieju: string | null
  zakonczenie_turnieju: string | null
  limit_graczy: number | null
  created_at: string | null
}

// ≈ÇƒÖczenie daty + godziny w Date
function joinDateTime(d: string | null, t: string | null): Date | null {
  if (!d) return null
  const hhmm = (t ?? '00:00').slice(0, 5)
  return new Date(`${d}T${hhmm}`)
}

// pierwsza litera wielka
function capitalizeFirst(str: string): string {
  if (!str) return str
  return str.charAt(0).toUpperCase() + str.slice(1)
}

// data po polsku, z ≈Çadnym formatem
function formatDatePL(d: Date) {
  const formatted = d.toLocaleDateString('pl-PL', {
    weekday: 'long',
    year: '2-digit',
    month: 'numeric',
    day: 'numeric',
  })
  return capitalizeFirst(formatted)
}

// zawsze HH:MM
function formatTimeHHMM(raw: string | null) {
  if (!raw) return '00:00'
  return raw.slice(0, 5)
}

export default async function AdminTurniejList() {
  const supabase = await createSupabaseServer()

  // wymagane logowanie
  const { data: { user } } = await supabase.auth.getUser()
  if (!user) redirect('/auth/signin')

  // wymagany admin
  const { data: isAdmin } = await supabase.rpc('is_admin')
  if (!isAdmin) redirect('/')

  // lista turniej√≥w
  const { data: rows, error } = await supabase
    .from('turniej')
    .select(
      'id, nazwa, data_turnieju, godzina_turnieju, zakonczenie_turnieju, limit_graczy, created_at'
    )
    .order('created_at', { ascending: false })
    .limit(200)

  if (error) {
    return (
      <main className="flex min-h-[calc(100vh-4rem)] items-center justify-center px-4 py-8">
        <div className="w-full max-w-6xl rounded-2xl bg-slate-800/95 border border-slate-700 shadow-[0_14px_40px_rgba(0,0,0,0.8)] p-6">
          <h1 className="text-2xl font-semibold text-sky-50 mb-4">Turnieje - Panel admina</h1>
          <div className="rounded-md border border-red-400/50 bg-red-500/10 px-4 py-3 text-red-200">
            Nie uda≈Ço siƒô pobraƒá danych.
          </div>
        </div>
      </main>
    )
  }

  return (
    <main className="flex min-h-[calc(100vh-4rem)] items-center justify-center px-4 py-8">
      <div className="w-full max-w-6xl rounded-2xl bg-slate-800/95 border border-slate-700 shadow-[0_14px_40px_rgba(0,0,0,0.8)] p-6 space-y-6">
        <div className="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
          <div>
            <h1 className="text-2xl font-semibold text-sky-50">ZarzƒÖdzanie turniejami</h1>
            <p className="mt-1 text-sm text-slate-400">Lista wszystkich turniej√≥w w systemie</p>
          </div>
          <Link
            href="/turniej/new"
            className="rounded-full bg-sky-600 hover:bg-sky-500 px-6 py-2 text-sm font-semibold text-white transition flex items-center gap-2"
          >
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
              <path d="M12 5v14M5 12h14" />
            </svg>
            Dodaj turniej
          </Link>
        </div>

        <div className="overflow-x-auto rounded-lg border border-slate-600">
          <table className="min-w-full text-sm">
            <thead className="bg-slate-700/50">
              <tr>
                <th className="px-4 py-3 text-left text-sky-100 font-medium text-xs uppercase tracking-wider">
                  Nazwa turnieju
                </th>
                <th className="px-4 py-3 text-left text-sky-100 font-medium text-xs uppercase tracking-wider">
                  Data i godzina
                </th>
                <th className="px-4 py-3 text-left text-sky-100 font-medium text-xs uppercase tracking-wider">
                  Zako≈Ñczenie
                </th>
                <th className="px-4 py-3 text-left text-sky-100 font-medium text-xs uppercase tracking-wider">
                  Limit graczy
                </th>
                <th className="px-4 py-3 text-left text-sky-100 font-medium text-xs uppercase tracking-wider">
                  Utworzono
                </th>
                <th className="px-4 py-3 text-right text-sky-100 font-medium text-xs uppercase tracking-wider">
                  Akcje
                </th>
              </tr>
            </thead>
            <tbody className="divide-y divide-slate-600">
              {rows?.map((raw) => {
                const r = raw as Row
                const start = joinDateTime(r.data_turnieju, r.godzina_turnieju)

                return (
                  <tr key={r.id} className="hover:bg-slate-700/30 transition">
                    <td className="px-4 py-3">
                      <Link
                        href={`/admin/turniej/${r.id}/edit`}
                        className="text-sky-100 hover:text-sky-200 font-medium hover:underline"
                      >
                        {r.nazwa}
                      </Link>
                    </td>

                    <td className="px-4 py-3 text-sky-100">
                      {r.data_turnieju ? (
                        <div className="space-y-1">
                          <div className="text-sm">
                            {start ? formatDatePL(start) : r.data_turnieju}
                          </div>
                          {r.godzina_turnieju && (
                            <div className="text-xs text-slate-300">
                              Start: {formatTimeHHMM(r.godzina_turnieju)}
                            </div>
                          )}
                        </div>
                      ) : (
                        '‚Äî'
                      )}
                    </td>

                    <td className="px-4 py-3 text-sky-100">
                      {r.zakonczenie_turnieju ? (
                        <span className="text-sm">
                          {formatTimeHHMM(r.zakonczenie_turnieju)}
                        </span>
                      ) : (
                        <span className="text-xs text-slate-500">nieustalone</span>
                      )}
                    </td>

                    <td className="px-4 py-3 text-sky-100">
                      {r.limit_graczy ? (
                        <span className="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-slate-700 text-sky-100">
                          {r.limit_graczy} graczy
                        </span>
                      ) : (
                        '‚Äî'
                      )}
                    </td>

                    <td className="px-4 py-3 text-sky-100 text-sm">
                      {r.created_at
                        ? new Date(r.created_at).toLocaleDateString('pl-PL')
                        : '‚Äî'}
                    </td>

                    <td className="px-4 py-3 text-right space-x-2">
                      <Link
                        href={`/admin/turniej/${r.id}/edit`}
                        className="inline-flex items-center gap-1 rounded bg-sky-600 hover:bg-sky-500 px-3 py-1 text-xs font-medium text-white transition"
                      >
                        <svg
                          width="12"
                          height="12"
                          viewBox="0 0 24 24"
                          fill="none"
                          stroke="currentColor"
                          strokeWidth="2"
                        >
                          <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" />
                          <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z" />
                        </svg>
                        Edytuj
                      </Link>
                      <DeleteTurniej id={r.id} nazwa={r.nazwa} />
                    </td>
                  </tr>
                )
              })}

              {!rows?.length && (
                <tr>
                  <td
                    className="px-4 py-8 text-center text-slate-400 text-sm"
                    colSpan={6}
                  >
                    <div className="flex flex-col items-center gap-2">
                      <svg
                        width="48"
                        height="48"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        strokeWidth="1"
                        className="text-slate-600"
                      >
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
                        <polyline points="14,2 14,8 20,8" />
                        <line x1="16" y1="13" x2="8" y2="13" />
                        <line x1="16" y1="17" x2="8" y2="17" />
                        <polyline points="10,9 9,9 8,9" />
                      </svg>
                      <p>Brak turniej√≥w w systemie</p>
                      <Link
                        href="/turniej/new"
                        className="text-sky-400 hover:text-sky-300 text-sm underline"
                      >
                        Dodaj pierwszy turniej
                      </Link>
                    </div>
                  </td>
                </tr>
              )}
            </tbody>
          </table>
        </div>

        {rows && rows.length > 0 && (
          <div className="text-sm text-slate-400 text-center">
            Znaleziono {rows.length} turniej
            {rows.length === 1
              ? ''
              : rows.length > 1 && rows.length < 5
              ? 'e'
              : 'y'}
          </div>
        )}
      </div>
    </main>
  )
}
```

### app/admin/users/[id]/role/route.ts

```
// app/admin/users/[id]/role/route.ts
import { NextRequest, NextResponse } from 'next/server'
import { createSupabaseServerMutable } from '@/lib/supabase/server-mutable'

// Prosty regex do walidacji UUID v4
const UUID_RE = /^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i

export async function POST(
  req: NextRequest,
  ctx: { params: Promise<{ id: string }> }
) {
  const supabase = await createSupabaseServerMutable()
  const origin = req.nextUrl.origin

  // rozpakowanie params
  const { id: targetId } = await ctx.params

  // walidacja UUID
  if (!targetId || !UUID_RE.test(targetId)) {
    return NextResponse.redirect(new URL('/admin/users?e=invalid_id', origin), { status: 303 })
  }

  // kto wykonuje?
  const { data: { user } } = await supabase.auth.getUser()
  if (!user) {
    return NextResponse.redirect(new URL('/auth/signin', origin), { status: 303 })
  }

  // tylko admin mo≈ºe zmieniaƒá role
  const { data: isAdmin } = await supabase.rpc('is_admin')
  if (!isAdmin) {
    return NextResponse.redirect(new URL('/', origin), { status: 303 })
  }

  // rola z formularza
  const form = await req.formData()
  const roleRaw = form.get('role')
  const role = typeof roleRaw === 'string' ? roleRaw.trim() : ''

  // ‚¨áÔ∏è TYLKO TE trzy sƒÖ dozwolone
  const ALLOWED_ROLES = ['user', 'organizer', 'admin'] as const
  if (!ALLOWED_ROLES.includes(role as any)) {
    console.error('invalid role value from form:', roleRaw)
    return NextResponse.redirect(new URL('/admin/users?e=invalid_role', origin), { status: 303 })
  }

  // (opcjonalnie) admin nie mo≈ºe zabraƒá admina samemu sobie
  if (targetId === user.id && role !== 'admin') {
    return NextResponse.redirect(new URL('/admin/users?e=cannot_downgrade_self', origin), { status: 303 })
  }

  const { error } = await supabase
    .from('profiles')
    .update({ role })
    .eq('id', targetId)

  if (error) {
    console.error('role update error', error)
    return NextResponse.redirect(new URL('/admin/users?e=update_failed', origin), { status: 303 })
  }

  return NextResponse.redirect(new URL('/admin/users?ok=1', origin), { status: 303 })
}
```

### app/admin/users/page.tsx

```
// app/admin/users/page.tsx
import { redirect } from 'next/navigation'
import Link from 'next/link'
import { createSupabaseServer } from '@/lib/supabase/server'

export const dynamic = 'force-dynamic'
export const revalidate = 0

type SearchParams = Promise<Record<string, string | string[] | undefined>>

type ProfileRow = {
  id: string
  username: string | null
  email: string | null
  role: 'user' | 'organizer' | 'admin' | null
  created_at: string | null
}

export default async function AdminUsersPage({
  searchParams,
}: {
  searchParams: SearchParams
}) {
  const sp = await searchParams
  const ok = sp.ok === '1'
  const err = typeof sp.e === 'string' ? sp.e : undefined

  const supabase = await createSupabaseServer()

  // kto jest zalogowany?
  const { data: { user } } = await supabase.auth.getUser()
  if (!user) {
    redirect('/auth/signin')
  }

  // czy admin?
  const { data: isAdmin } = await supabase.rpc('is_admin')
  if (!isAdmin) {
    redirect('/')
  }

  // pobranie profili
  const { data: profiles } = await supabase
    .from('profiles')
    .select('id, username, email, role, created_at')
    .order('created_at', { ascending: false })
    .returns<ProfileRow[]>()

  return (
    <main className="flex min-h-[calc(100vh-4rem)] items-center justify-center px-4 py-8">
      {/* KARTA ‚Äì nowy brand jak layout/signup/turnieje */}
      <div className="w-full max-w-4xl rounded-2xl bg-slate-800/95 border border-slate-700 shadow-[0_14px_40px_rgba(0,0,0,0.8)] p-6 space-y-5">
        <header className="flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between">
          <div>
            <h1 className="text-2xl font-semibold text-sky-50">
              U≈ºytkownicy ‚Äì role
            </h1>
            <p className="text-sm text-sky-200/80">
              Zmieniaj role: <span className="font-semibold">user</span>,{' '}
              <span className="font-semibold">organizer</span>,{' '}
              <span className="font-semibold">admin</span>.
            </p>
          </div>
          <Link
            href="/admin"
            className="text-xs text-sky-200 hover:text-sky-100 underline-offset-2 hover:underline"
          >
            ‚Üê Powr√≥t do panelu
          </Link>
        </header>

        {/* komunikaty */}
        {ok && (
          <div className="rounded-md border border-emerald-500/70 bg-emerald-900/40 px-3 py-2 text-xs text-emerald-100">
            Zapisano zmianƒô roli.
          </div>
        )}
        {err && (
          <div className="rounded-md border border-red-500/70 bg-red-900/40 px-3 py-2 text-xs text-red-100">
            {err === 'invalid_id' && 'Nieprawid≈Çowe ID u≈ºytkownika.'}
            {err === 'invalid_role' && 'Nieprawid≈Çowa rola.'}
            {err === 'cannot_downgrade_self' && 'Nie mo≈ºesz odebraƒá sobie roli admin.'}
            {err === 'update_failed' && 'Nie uda≈Ço siƒô zaktualizowaƒá roli.'}
            {!['invalid_id','invalid_role','cannot_downgrade_self','update_failed'].includes(err) &&
              'WystƒÖpi≈Ç b≈ÇƒÖd.'}
          </div>
        )}

        {/* tabela u≈ºytkownik√≥w */}
        <div className="overflow-x-auto rounded-xl border border-slate-700 bg-slate-900/80">
          <table className="min-w-full border-collapse text-sm">
            <thead className="bg-slate-900/90">
              <tr>
                <th className="px-3 py-2 text-left text-xs font-semibold text-slate-200">ID</th>
                <th className="px-3 py-2 text-left text-xs font-semibold text-slate-200">Email</th>
                <th className="px-3 py-2 text-left text-xs font-semibold text-slate-200">Login</th>
                <th className="px-3 py-2 text-left text-xs font-semibold text-slate-200">Rola</th>
                <th className="px-3 py-2 text-left text-xs font-semibold text-slate-200">Zmie≈Ñ rolƒô</th>
              </tr>
            </thead>
            <tbody>
              {profiles?.map((p) => (
                <tr
                  key={p.id}
                  className="border-t border-slate-700/70 last:border-b last:border-slate-700/70"
                >
                  <td className="px-3 py-2 align-middle text-[11px] text-slate-300 max-w-[160px] truncate">
                    {p.id}
                  </td>
                  <td className="px-3 py-2 align-middle text-xs text-sky-100 truncate max-w-[200px]">
                    {p.email ?? '‚Äî'}
                  </td>
                  <td className="px-3 py-2 align-middle text-xs text-slate-200">
                    {p.username ?? <span className="opacity-60">brak</span>}
                  </td>
                  <td className="px-3 py-2 align-middle text-xs">
                    <span
                      className={[
                        'inline-flex rounded-full px-2 py-0.5 text-[11px] font-medium',
                        p.role === 'admin'
                          ? 'bg-red-600/80 text-white'
                          : p.role === 'organizer'
                          ? 'bg-sky-600/80 text-white'
                          : 'bg-slate-700 text-slate-100',
                      ].join(' ')}
                    >
                      {p.role ?? 'user'}
                    </span>
                  </td>
                  <td className="px-3 py-2 align-middle">
                    {/* formularz zmiany roli */}
                    <form
                      action={`/admin/users/${p.id}/role`}
                      method="post"
                      className="flex items-center gap-2"
                    >
                      <select
                        name="role"
                        defaultValue={p.role ?? 'user'}
                        className="rounded-md border border-slate-600 bg-slate-900/80 px-2 py-1 text-xs text-sky-50 focus:outline-none focus:ring-1 focus:ring-sky-400"
                      >
                        <option value="user">user</option>
                        <option value="organizer">organizer</option>
                        <option value="admin">admin</option>
                      </select>
                      <button
                        type="submit"
                        className="rounded-full bg-sky-500/90 px-3 py-1 text-[11px] font-semibold text-white shadow-sm hover:bg-sky-400 transition"
                      >
                        Zapisz
                      </button>
                    </form>
                  </td>
                </tr>
              ))}

              {!profiles?.length && (
                <tr>
                  <td
                    colSpan={5}
                    className="px-3 py-6 text-center text-xs text-slate-300"
                  >
                    Brak u≈ºytkownik√≥w.
                  </td>
                </tr>
              )}
            </tbody>
          </table>
        </div>
      </div>
    </main>
  )
}
```

### app/api/resolve-email/gsheets/list/route.ts

```
// app/api/gsheets/list/route.ts
import { NextRequest, NextResponse } from 'next/server'

function extractSheetId(url: string) {
  const m = url.match(/spreadsheets\/d\/([a-zA-Z0-9-_]+)/)
  return m?.[1] ?? null
}

export async function GET(req: NextRequest) {
  const url = req.nextUrl.searchParams.get('url') || ''
  const sheetId = extractSheetId(url)
  if (!sheetId) {
    return NextResponse.json({ error: 'invalid_url' }, { status: 400 })
  }

  // Publiczny feed z listƒÖ arkuszy (wymaga publikacji/udostƒôpnienia linkiem)
  const feed = `https://spreadsheets.google.com/feeds/worksheets/${sheetId}/public/full?alt=json`

  try {
    const r = await fetch(feed, { cache: 'no-store' })
    if (!r.ok) {
      return NextResponse.json({ error: 'fetch_failed', status: r.status }, { status: 400 })
    }
    const j = await r.json() as any
    const entries: any[] = j?.feed?.entry || []

    const sheets = entries.map((e) => {
      const name: string = e?.title?.$t ?? ''
      const linkHref: string = e?.link?.[0]?.href ?? ''
      // spr√≥buj wyciƒÖgnƒÖƒá gid z href
      const gidMatch = linkHref.match(/[?&]gid=(\d+)/)
      const gid = gidMatch?.[1] ?? null
      return { name, gid }
    }).filter(s => s.name)

    return NextResponse.json({ sheets }, { status: 200 })
  } catch (e) {
    return NextResponse.json({ error: 'exception' }, { status: 500 })
  }
}
```

### app/api/resolve-email/gsheets/sheets/route.ts

```
import { NextRequest, NextResponse } from 'next/server'

function extractSpreadsheetId(url: string) {
  // wspiera: .../spreadsheets/d/{ID}/...  (link udostƒôpniony)
  const m = url.match(/spreadsheets\/d\/([a-zA-Z0-9-_]+)/)
  return m?.[1] || null
}

export async function GET(req: NextRequest) {
  try {
    const url = req.nextUrl.searchParams.get('url') || ''
    const idFromUrl = extractSpreadsheetId(url)
    const id = idFromUrl || url.trim() // pozw√≥l te≈º wkleiƒá samo ID

    if (!id) {
      return NextResponse.json({ error: 'missing_id' }, { status: 400 })
    }
    const key = process.env.GOOGLE_SHEETS_API_KEY
    if (!key) {
      return NextResponse.json({ error: 'missing_api_key' }, { status: 500 })
    }

    // pobieramy tylko tytu≈Çy kart (bez danych)
    const api = `https://sheets.googleapis.com/v4/spreadsheets/${id}?fields=sheets(properties(title))&key=${key}`
    const res = await fetch(api, { cache: 'no-store' })
    if (!res.ok) {
      const txt = await res.text()
      return NextResponse.json({ error: 'fetch_failed', details: txt }, { status: 502 })
    }

    const json = await res.json()
    const titles: string[] =
      json?.sheets?.map((s: any) => s?.properties?.title).filter(Boolean) ?? []

    return NextResponse.json({ spreadsheetId: id, sheets: titles })
  } catch (e: any) {
    return NextResponse.json({ error: 'exception', message: e?.message }, { status: 500 })
  }
}
```

### app/api/resolve-email/route.ts

```
import { NextResponse } from 'next/server'
import { supabaseAdmin } from '@/lib/supabase/admin'

export async function POST(req: Request) {
  const { identifier } = await req.json() as { identifier: string }
  const input = identifier.trim().toLowerCase()

  // je≈õli to e-mail, nie ma co rozwiƒÖzywaƒá
  if (input.includes('@')) {
    return NextResponse.json({ email: input })
  }

  // login -> email (tylko na serwerze, przez Service Role)
  const { data, error } = await supabaseAdmin
    .from('profiles')
    .select('email')
    .eq('username', input)
    .single()

  if (error || !data?.email) {
    return NextResponse.json({ error: 'Nie znaleziono u≈ºytkownika o takim loginie.' }, { status: 404 })
  }

  return NextResponse.json({ email: data.email.toLowerCase() })
}
```

### app/auth/login/route.ts

```
// app/auth/signin/route.ts (lub odpowiednia ≈õcie≈ºka POST)
import { NextRequest, NextResponse } from 'next/server'
import { createSupabaseServerMutable } from '@/lib/supabase/server-mutable'
import { supabaseAdmin } from '@/lib/supabase/admin'

export async function POST(req: NextRequest) {
  const form = await req.formData()
  let identifier = String(form.get('identifier') || '').trim().toLowerCase()
  const password = String(form.get('password') || '')

  // Zawsze bierz origin z requestu (dzia≈Ça na localhost i na Vercel)
  const origin = req.nextUrl.origin

  // 1) username -> email (je≈õli trzeba)
  if (!identifier.includes('@')) {
    const { data, error } = await supabaseAdmin
      .from('profiles')
      .select('email')
      .eq('username', identifier)
      .single()

    if (error || !data?.email) {
      return NextResponse.redirect(new URL('/auth/signin?e=notfound', origin), { status: 303 })
    }
    identifier = data.email.toLowerCase()
  }

  // 2) Logowanie
  const supabase = await createSupabaseServerMutable()
  const { error } = await supabase.auth.signInWithPassword({
    email: identifier,
    password,
  })

  if (error) {
    return NextResponse.redirect(new URL('/auth/signin?e=invalid', origin), { status: 303 })
  }

  // 3) Sukces
  return NextResponse.redirect(new URL('/', origin), { status: 303 })
}
```

### app/auth/signin/page.tsx

```
'use client'

import { useEffect, useMemo, useState } from 'react'
import { useSearchParams } from 'next/navigation'

export default function SignIn() {
  const [identifier, setIdentifier] = useState('')
  const [password, setPassword] = useState('')
  const sp = useSearchParams()
  const err = useMemo(() => {
    const e = sp.get('e')
    if (e === 'notfound') return 'Nie znaleziono u≈ºytkownika o takim loginie.'
    if (e === 'invalid') return 'Nieprawid≈Çowy email/login lub has≈Ço.'
    return null
  }, [sp])

  // (opcjonalnie) zresetuj query po 1 renderze, ≈ºeby adres by≈Ç czysty
  useEffect(() => { history.replaceState(null, '', '/auth/signin') }, [])

  return (
    <main className="mx-auto max-w-md p-6 space-y-4">
      <h1 className="text-2xl font-semibold">Logowanie</h1>
      <form action="/auth/login" method="post" className="space-y-3">
        <input
          className="w-full rounded border px-3 py-2"
          name="identifier"
          placeholder="Email lub login"
          value={identifier}
          onChange={e=>setIdentifier(e.target.value)}
          required
        />
        <input
          className="w-full rounded border px-3 py-2"
          type="password"
          name="password"
          placeholder="Has≈Ço"
          value={password}
          onChange={e=>setPassword(e.target.value)}
          required
        />
        {err && <p className="text-sm text-red-600">{err}</p>}
        <button className="rounded bg-black px-4 py-2 text-white">Zaloguj</button>
      </form>
    </main>
  )
}
```

### app/auth/signin/submit/route.ts

```
import { NextRequest, NextResponse } from 'next/server'
import { createSupabaseServerMutable } from '@/lib/supabase/server-mutable'
import { supabaseAdmin } from '@/lib/supabase/admin'

export async function POST(req: NextRequest) {
  const origin = req.nextUrl.origin
  const form = await req.formData()
  let identifier = String(form.get('identifier') || '').trim().toLowerCase()
  const password = String(form.get('password') || '')

  if (identifier && !identifier.includes('@')) {
    const { data, error } = await supabaseAdmin
      .from('profiles')
      .select('email')
      .eq('username', identifier)
      .maybeSingle()

    if (error || !data?.email) {
      return NextResponse.redirect(new URL('/auth/signin?e=notfound', origin), { status: 303 })
    }
    identifier = data.email.toLowerCase()
  }

  const supabase = await createSupabaseServerMutable()
  const { error } = await supabase.auth.signInWithPassword({ email: identifier, password })

  if (error) {
    return NextResponse.redirect(new URL('/auth/signin?e=invalid', origin), { status: 303 })
  }

  return NextResponse.redirect(new URL('/', origin), { status: 303 })
}
```

### app/auth/signout/route.ts

```
import { NextResponse } from 'next/server'
import { createSupabaseServerMutable } from '@/lib/supabase/server-mutable'

export async function POST() {
  const supabase = await createSupabaseServerMutable(); // <-- DODAJ await
  await supabase.auth.signOut()
  return NextResponse.redirect(new URL('/', process.env.NEXT_PUBLIC_SITE_URL || 'http://localhost:3000'))
}
```

### app/auth/signup/page.tsx

```
'use client'

import { useState } from 'react'
import { supabase } from '@/lib/supabase/client'

export default function SignUp() {
  const [email, setEmail] = useState('')
  const [password, setPassword] = useState('')
  const [confirm, setConfirm] = useState('')
  const [loading, setLoading] = useState(false)
  const [msg, setMsg] = useState<string | null>(null)
  const [err, setErr] = useState<string | null>(null)

  const valid =
    email.trim().length > 5 &&
    password.length >= 6 &&
    password === confirm

  const onSubmit = async (e: React.FormEvent) => {
    e.preventDefault()
    setErr(null)
    setMsg(null)

    if (!valid) {
      setErr('Sprawd≈∫ pola formularza.')
      return
    }

    setLoading(true)
    try {
      const { error } = await supabase.auth.signUp({
        email,
        password,
      })
      if (error) throw error
      setMsg(
        'Konto utworzone. Sprawd≈∫ skrzynkƒô i potwierd≈∫ adres e-mail, a nastƒôpnie zaloguj siƒô.'
      )
    } catch (e: any) {
      setErr(e?.message ?? 'Nie uda≈Ço siƒô utworzyƒá konta.')
    } finally {
      setLoading(false)
    }
  }

  return (
    // Dodano ciemne t≈Ço gradientowe do ca≈Çej strony
    <div className="min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900">
      <main className="flex min-h-[calc(100vh-4rem)] items-center justify-center px-4 py-8">
        {/* KARTA ‚Äì prostokƒÖt z zaokrƒÖglonymi rogami, szarym t≈Çem i ciemnym cieniem */}
        <div className="w-full max-w-md rounded-2xl bg-slate-800/95 border border-slate-700 shadow-[0_14px_40px_rgba(0,0,0,0.8)] p-6">
          <h1 className="mb-4 text-2xl font-semibold text-sky-50 text-center">
            Rejestracja
          </h1>

          <form
            onSubmit={onSubmit}
            className="space-y-3"
            autoComplete="off"
          >
            <input
              className="w-full rounded-lg border border-slate-600 bg-slate-900/70 px-3 py-2 text-sm text-sky-50 placeholder:text-slate-400 focus:border-sky-400 focus:outline-none focus:ring-1 focus:ring-sky-400"
              type="email"
              placeholder="Email"
              value={email}
              onChange={(e) => setEmail(e.target.value)}
              required
              name="signup_email"
              autoComplete="off"
            />

            <input
              className="w-full rounded-lg border border-slate-600 bg-slate-900/70 px-3 py-2 text-sm text-sky-50 placeholder:text-slate-400 focus:border-sky-400 focus:outline-none focus:ring-1 focus:ring-sky-400"
              type="password"
              placeholder="Has≈Ço (min. 6 znak√≥w)"
              value={password}
              onChange={(e) => setPassword(e.target.value)}
              minLength={6}
              required
              name="signup_password"
              autoComplete="new-password"
            />

            <input
              className="w-full rounded-lg border border-slate-600 bg-slate-900/70 px-3 py-2 text-sm text-sky-50 placeholder:text-slate-400 focus:border-sky-400 focus:outline-none focus:ring-1 focus:ring-sky-400"
              type="password"
              placeholder="Powt√≥rz has≈Ço"
              value={confirm}
              onChange={(e) => setConfirm(e.target.value)}
              minLength={6}
              required
              name="signup_password_confirm"
              autoComplete="new-password"
            />

            {err && (
              <p className="text-sm text-red-400">
                {err}
              </p>
            )}
            {msg && (
              <p className="text-sm text-emerald-300">
                {msg}
              </p>
            )}

            <button
              className="mt-2 w-full rounded-full bg-gradient-to-r from-sky-500 to-sky-600 px-4 py-2 text-sm font-semibold text-white shadow-[0_10px_25px_rgba(15,23,42,0.9)] transition hover:from-sky-400 hover:to-sky-500 hover:shadow-[0_14px_35px_rgba(15,23,42,1)] disabled:opacity-50 disabled:hover:shadow-none"
              disabled={!valid || loading}
            >
              {loading ? 'Tworzƒô‚Ä¶' : 'Za≈Ç√≥≈º konto'}
            </button>
          </form>
        </div>
      </main>
    </div>
  )
}```

### app/favicon.ico

```
         (  F          (  n  00     (-  ñ         ç  æF  (                                                           $   ]   ∫   ∫   ]   $                                       †   Ú   ˇ   ˇ   ˇ   ˇ   Ú   †                           8   ‡   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ‡   8                  ‚   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ‚              °   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   °       #   Ù   ˇ   ˇOOOˇÆÆÆˇ´´´ˇ´´´ˇ´´´ˇ´´´ˇ≠≠≠ˇgggˇ   ˇ   ˇ   Ù   #   Y   ˇ   ˇ   ˇˇÌÌÌˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇ˝˝˝ˇ555ˇ   ˇ   ˇ   ˇ   Y   ª   ˇ   ˇ   ˇ   ˇkkkˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇéééˇ   ˇ   ˇ   ˇ   ˇ   ª   ª   ˇ   ˇ   ˇ   ˇ			ˇÕÕÕˇˇˇˇˇˇˇˇˇ‰‰‰ˇˇ   ˇ   ˇ   ˇ   ˇ   ª   Y   ˇ   ˇ   ˇ   ˇ   ˇJJJˇ˝˝˝ˇˇˇˇˇkkkˇ   ˇ   ˇ   ˇ   ˇ   ˇ   Y   #   Ù   ˇ   ˇ   ˇ   ˇˇ∂∂∂ˇ’’’ˇ			ˇ   ˇ   ˇ   ˇ   ˇ   Ù   #       °   ˇ   ˇ   ˇ   ˇ   ˇ111ˇDDDˇ   ˇ   ˇ   ˇ   ˇ   ˇ   °              ‚   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ‚                  8   ‡   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ‡   8                           †   Ú   ˇ   ˇ   ˇ   ˇ   Ú   †                                       $   ]   ∫   ∫   ]   $                                                                                                                                                                                                                                                                                    (       @                                                                               ,   U   Å   Ë   Ë   Å   U   ,                                                                                      *   Ö   “   ˘   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˘   “   Ö   *                                                                      ñ   Û   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   Û   ñ                                                          Q   ·   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ·   Q                                               r   ˚   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˚   r                                       r   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   r                               O   ˚   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˚   O                          ‰   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   „                      ó   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ó               (   ı   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   Ù   '           Ü   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ888ˇãããˇàààˇàààˇàààˇàààˇàààˇàààˇàààˇàààˇàààˇàààˇàààˇàààˇâââˇ___ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   Ü          ‘   ˇ   ˇ   ˇ   ˇ   ˇ   ˇˇÓÓÓˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇSSSˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ‘      +   ˙   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇhhhˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇÆÆÆˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˙   +   T   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇˇÀÀÀˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇÙÙÙˇ,,,ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   T   Ç   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇGGGˇ˝˝˝ˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇçççˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   Å   È   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ≠≠≠ˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇ‰‰‰ˇˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   È   È   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ+++ˇÛÛÛˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇjjjˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   È   Å   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇãããˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇÃÃÃˇˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   Ç   T   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇˇ„„„ˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇ˝˝˝ˇIIIˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   T   +   ˙   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇhhhˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇØØØˇˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˙   +      ‘   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇˇÀÀÀˇˇˇˇˇˇˇˇˇÙÙÙˇ,,,ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ‘          Ü   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇGGGˇ˝˝˝ˇˇˇˇˇçççˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   Ü           '   Ù   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ±±±ˇÏÏÏˇˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ı   (               ó   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ333ˇ___ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ó                      „   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ‰                          O   ˚   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˚   O                               r   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   r                                       r   ˚   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˚   r                                               Q   ·   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ·   Q                                                          ñ   Û   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   Û   ñ                                                                      *   Ö   “   ˘   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˘   “   Ö   *                                                                                      ,   U   Å   Ë   Ë   Å   U   ,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               (   0   `           -                                                                                             	   (   L   j   ≥   ¯   ˜   ≥   j   K   (   	                                                                                                                                          V   †   ÿ   ¯   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ¯   ÿ   †   U                                                                                                                      %   ã   ·   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ·   ã   &                                                                                                      ã   Ô   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   Ô   ã                                                                                          Q   ‹   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ‹   R                                                                              ä   ˛   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˛   ä                                                                     ≠   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ≠                                                             ∏   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ∏                                                     Æ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   Æ                                              ä   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ä                                       P   ˝   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˝   O                                  ﬂ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ﬂ                              ã   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ã                       #   Ò   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   Ò   #                   å   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ã                  ‰   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ$$$ˇhhhˇeeeˇeeeˇeeeˇeeeˇeeeˇeeeˇeeeˇeeeˇeeeˇeeeˇeeeˇeeeˇeeeˇeeeˇeeeˇeeeˇeeeˇeeeˇeeeˇeeeˇeeeˇPPPˇˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ‰              U   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇˇÎÎÎˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇsssˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   U           °   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇeeeˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇÃÃÃˇˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   °       	   ⁄   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇˇ………ˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇ˝˝˝ˇHHHˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ⁄   	   (   ˘   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇEEEˇ¸¸¸ˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇÆÆÆˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ¯   (   K   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ™™™ˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇÙÙÙˇ,,,ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   L   j   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ)))ˇÚÚÚˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇåååˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   j   ¥   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇàààˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇ„„„ˇˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ≥   ¯   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇˇ···ˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇiiiˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ¯   ¯   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇeeeˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇÀÀÀˇˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ¯   ≥   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇˇ………ˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇ˝˝˝ˇHHHˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ¥   j   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇEEEˇ¸¸¸ˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇÆÆÆˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   j   L   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ™™™ˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇÙÙÙˇ,,,ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   K   (   ¯   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ)))ˇÚÚÚˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇåååˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˘   (   	   ⁄   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇàààˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇ„„„ˇˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ⁄   	       °   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇˇ···ˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇiiiˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   °           U   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇeeeˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇÃÃÃˇˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   U              ‰   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇˇ………ˇˇˇˇˇˇˇˇˇ˝˝˝ˇHHHˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ‰                  ã   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇEEEˇ¸¸¸ˇˇˇˇˇÆÆÆˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   å                   #   Ò   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ¨¨¨ˇ˚˚˚ˇ,,,ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   Ò   #                       ã   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ222ˇ}}}ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ã                              ﬂ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ﬂ                                  O   ˝   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˝   P                                       ä   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ä                                              Æ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   Æ                                                     ∏   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ∏                                                             ≠   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ≠                                                                     ä   ˛   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˛   ä                                                                              R   ‹   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ‹   Q                                                                                          ã   Ô   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   Ô   ã                                                                                                      &   ã   ·   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ·   ã   %                                                                                                                      U   †   ÿ   ¯   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ¯   ÿ   †   V                                                                                                                                          	   (   K   j   ≥   ˜   ¯   ≥   j   L   (   	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        âPNG

   IHDR         \r®f   sRGB ÆŒÈ   8eXIfMM *    ái            †       †           D"8s  IDATxÌ]	∞’ônî]<QVAñËƒh$	 Nåé13*àq∞¬d™ƒç©I°àòDìL2ì™(Œ(‘ò2÷ƒô—G	ã¡q_@Â±à‡Üäx»õÔª–èæè{o˜ΩΩù”˝˝Uﬂ{}ªOüÂ;Áˇ˚Ù˘œ9›¬ëdÅÅÆ(Dg†–8	ËÙN ∫]ÄÓ@†hx•?v ¿N‡3‡=`;6.&∞‡u‚‡  ±î6âPÅ©–ΩÄ¡@ˇ√†R” P˘iZq ^DN„‡Äwpºÿº–X–h–òHg@¿Ã
:Ÿ‚|5` p"@¿'º…≤ôs{Îp¸*2¿ﬁçÖƒ d “Øåñ»|(0¯
0 ‡ì>KÚ
≥xX¨6 IJ» §C|?$KENÿ}œì|ä¬Úµ·‡ˆh $	2 êŸ|/ß¬è . Nz í#ºè√WÄe¿
‡5Ä„íêàè‹∂à˙‡;¿y ïæ Òg‡s©h^  Iƒ» DL(¢;∏8†“HjgÄcH|x†1†ÀR"åaÄÔÙ”Åï G¡Ÿ@ÖË9`/`%0ËHƒ@jΩ~,∞†€K
ü,t).ŒËIëàÅDËÅT¶O˚)~∫∞VÏÅu$b Ë™õ–U%•7ìÉç®õ˘ _…$b 8AÁ◊¿Äﬂ¯Jˆ3` 510wQÒ?§¯vr—·:¸2˛Kƒ@ §¯v*{%#ÌÇAÅZÄÂíÅ^(ıœ=Ò≥g \„¿WÉ€çÄ…!:‡ﬂ,`‡6˝œ643Å:@íc.FŸü§˘‰Äu?–<êê'·›ÄÉÄî_‹èvp: …8Qæõ
IÒ≈Å∑p{3ŒÛ–kH»¢åG°ûºïÆcÒ—º<ç62&ã
ê◊2uC¡ˇ‡⁄ÚÊï≠ﬂ‚§T¯3⁄
ΩÍÄõÖ;Óºî™dù/~mÄΩ.¯íX∆@{‰w.∞´d]Gï⁄ {lK‹‡Ebúˇ˝(P©RuM¸T€Cõ“⁄√¿d‰Ô])øå_Lm‡=ƒ˚=@búÕ˜KÄ€GUkŸ^úU”ÿ∆ÿ÷¯ö)1ÄÅ»ªg’T¢¬äØ∞m`9⁄\⁄Æ≥¿Q˛Õ@ÿ ‘˝‚∞ñ6:⁄û’^õw¨ùÚÔ∏EóD§¡ Á	¸5∞‡∫ÎƒF–,ﬂ‹
X"“dÄm<ÄnB~ÚÏ@¥∏˜µt◊tèxãª¸;⁄fﬁ>Òì™ÌI8µàªø8”∏C1€™$B∏ïßeÜ©›+˛íjl´‹EZ√«& © S:‚:ä6∞mˆÎ¥ˇ\G1•Á`¢®≈!ìnlªl√∆ä…^ÄQ`Ì∑@OcŸS∆ƒ@e∏Õ∑∫πÁ§qb™pïˇ„SÜƒ@upö∫±F¿D@Âø–ìø∫Ü¶–Ê2@#¿π∆ıL3 £Aíî$H2« _hû∂FH#rq(ÌˇO‡DÉÚ§¨àÅ®‡runGOWaÍbä &ñSgDÒ3¿EDÁtoß*«§ö˙°ƒ9kä›~)øï°,$¬ xøRü1òv‡K ·¿9ÄD‰çÅU(wÆ&LE“‰Í©ªÄS)πÈ3–Y8x8 $.iÄ(ÌåƒK¨≈ÄYúéÏa»]≠ó¥¿4îÙ«Ä	câìÆ≈@3∏f‡ÄÛï4∆ ∆¢Ñˇ–/*b‡¸˛ «˛ò$!IÄ~áÿ7…B*-1`	o ü ∫	ë$ª‡«°DãÅæâîLâà˚‡Úﬂ ÍJ"í‰¿OQ¢À)ïˆ2@#–x4â"$e ®¯∑Iˆ8í‡OiàÅ8¯"› ºG‰ﬁ8[xƒt<Ò.¥¥7&Çm&ÿéRç^ã≥tq˜ ÿï·.æß≈Y≈-2» Ωdß ˚„*_‹‡&d|j\ôWºb „ÙG˘ˆ´‚*gúØ £ëÈáÅƒF4„"IÒäÅÿÉ¥/ b1qÄN»„¿YÄDàÅpºå€9ÅÓ„p—}w\Ø Ûë‘§£ì”1 j`ÄËO˚üÓ≠xK=Ä—HÒ˜ ˜Aìà1ü#æ
D:U8j¿ı˝t˘©Î$b bûA||ÿUºQø¸26%™Ã)1 äËÖ_¿Í¢≥!~DŸ‡∫Êï ø‡+b >A¥‹:]—E$à£50êÚGDhR—tË–¡È›ªwR…)ùP« ëËn$ë 3‹÷Î@bSßNuñ,Y‚¥j’ ≤úÁ:ª°Ù‹;¿·¿ﬂÛ@£`«|„ñ-[)ì'OV˝Ÿ’Ü©sFx⁄Æì‚€•¯n}Õõ7Ø†¸¸≥~˝˙∆∫∫:ªå¿Qó©J_§ŒUKj8ñq0x‡∆;v4 Ãû=[ıhW=æ	›Î	§&∑!e5À8h—¢E„›wﬂ]§¸¸Ò·á6ˆÔﬂ_ıiW}˛SZ⁄?	ø/`ü;vl„æ}˚é2 <±h—" ª¿ß–AÓπë∏‹Å’X,„†m€∂ç+V¨(©¸<πwÔﬁ∆#F®^Ì™◊;ì÷˛aHc ˚‡î)S *ø{a˘ÚÂçp ÿc89(—^Äû˛ˆ4é&E¶€o√ÜÆûW¸/∑†u∆=±^Äû˛*?{k^∑_EÌ«≈˙˙zπÌ™gˆÜ UI-ãÅË{WU*
ú:p˚9.t⁄∑o(/›∫us>˚Ï3Áâ'û^ÅRgÄﬂ‰⁄ûG‚ÃI_DÆëªûçÂ‹~~Ω π≠{¯˙Ÿ?N0ë7ΩSÍÿ.∆ç◊∏ˇ~?}/y]nA;Íÿ£ã≥„2 ]ÒFOB2C?∑_I≠˜úî[–:∞:⁄=#¿OzKÈ-„ à€œ£Ô%Â¥Æ›?j–˛I¿ÆÜPç€Ø§Ê{N -hU›ˇtï:ôúÉò¯Åı ,‚†∑üG◊K -hU€Á¢cÉhP7 ˇŒ°¬ò¡@µn?ø\”-∏k◊.π˝à2„:ı˙ `Ÿ·FÑ€=˝-·†V∑_…GøÁ§‹ÇVÈ ›ı}¢0 WI˘≠™¯F∫˝ ≠ˆÛËsMárZ’8pJ∏Q‹*@OK8ÎˆÛ≥
rZ•‘›ña, ﬂ˚wÀ ÿSÈW^y•üáæ.∑†5Ìat7‘ÿ›è§¸÷Tv#›~7n≠‡A"∏¸ÚÀ’+¥£W¯ËpM¬≈/™hK8à“ÌÁg‰¥F/^Ñ∑´≈å¿M{e Ï®ËRõ|˙)qÿÎ7›tìÊ?8'‡µÄK˘ÌP~∫˝ÓπÁû∞˙\ı˝r⁄—>†«∑Uk ÿeP˜ﬂ|Î^x«ÈˆÛ≥
ã/V/¿¸vÚÙôØÙÅÂÑ‰¢*◊p‚v˚˘ π≠–æ ü]J˚À}êÛàk8(ïàŒ≈«¿ƒâù—£G«óÄOÃm⁄¥q,X†o˙îÚe.‚ò^ °Qx–”ﬂpít˚˘ı‰4^_ÉNó{‡Üæ¯≈yƒ2 Üsê§€œœ –-ÿπsgµs€Ã–iÍvëîZ8
!~PJ?åcÄ´˝Ó∫ÎÆ¿õ|∆] Æ‹Ω{∑≥zıÍ∏ìR¸µ1pn„‘‡zÔÌ•∫ºtlp˚9≥fÕr∫vÌjTÊÆø˛zﬂ4*O L„ã~ï¯—Áû‘ï3òÉ4›~~Ør≠;‘mÍxYå+¸¿ÄÄ°§ÌˆÛ3 r≠;‘mÍxì4‡˜≈:7]’ÅqLö4)U∑ü!r˙1îÍuÍ6øÏ’$Õ¿7õÆË¿8∫wÔÓÃô3«∏|5œ>?Ó\zÈ•ÕOÎ∑úÎÕÜ◊ ¯,ÔEõ≈¿å3úÅöï©2ππÂñ[ú∫∫∫2Wu:EæÇ¥õº^p.H1cJ∫t˚]}ı’BòuÈ‘SOuÆ∫äª…IcÄOêû•Úƒ%É  ∆AZ´˝¸¸¸Ækµ†ë∫D?«5 ﬁ@Q◊¿†ˇÈ3¿wÍ+Æ∏"˝åTôŒS¿ûUﬁ•‡13¿Ó?˚‚5 M'›ã˙ü>p˚˛Zµjï~fj»◊àÅ◊°‘êÇn©ÅÅ¶±>◊ ˇi5D§[bf Ì’~aã'∑`Xcπü„ -º1Ûk¢õΩˇƒÅI´˝¸ﬁ˜˝Ækµ†Q∫≈Ø|ÛkﬂMÀÈ(92»@ít∞…ÌÁ«›ÇX-ËL◊ìaÄ˙N4Äìq‹û'$f0@∑@VÑnAõ‹òY·ΩL9:‚|/^s« ˙ó	®”)0`Íjø∞T\w›uZ-ñƒËÓ¬®\†	@—:¶±cÌt˚˘ú{»-Ë«Rb◊˚1%◊ ÙI,Y%Të€›~áãr˙1îÿı¬CüÄ,º$ñ¥*ÀÄÈ´˝ f<‡π0z˛é•Ëh’F¸Ñ˚¶ ∑ü´˝|‚ÄØ8Z-ËCR¸óπùTg◊ –HRfÄãglYÌñ™πsÁ -ñƒp˜”'+é√ËÓ∂mµ_ÿígÕÕñèÓÁCø{ Ù	Ú√íî»™€œèŒô3g -ËGR|◊π7`GÄﬁÒ•°òÉ0êU∑ü_ŸµZ–è°ÿØüD†)¿±Û\>Å¨ª˝ ó¸–π˝äız Nñ§ƒ@÷›~~¥ -Ë«P¨◊{rsÄø¥@¨<óéúõ|.]∫‘∏|îŒm|g˚ıÎÁ¨_øﬁyÂïW‚KD1ób‡MΩî¢%°s\ì∑ü•r˙1ÀınÏ\ñ∆íÑ"-… ›`.4Ê€~%3ô‡I}[0A≤è$µì= -“>BH"GÆ€èç^rÑ≠<¬EBG›i ⁄%îòí9Ã@^›~~@´˝ä¸˙1‹ÏÄÜ@í t˚-[∂ÃËœ{%@CŸ$mAg¸¯ÒŒö5k Ü—Ö»¯úä/ÂèåOˇàlﬂ‰”øÑ·B–@.X∞¿±u‰p•O¸Ó6úóx≤9MPnø`ﬂ∑o_ßææ^n¡`tÖ
•ß(˙™ªôÉ\r˚˘s∆A“yÛÊÈ€Ç˛TÖ°@h
ÉE0lÿ0ÁŒ;Ôt⁄µ”òk∆∏N†°°¡YµjUê‡
S#Ï|^„Ω∫- |¢›p√Nó.Ö≠ÿﬁ•`◊^{≠zLÒ6ÉÉ4 üƒõÜbÁ®ˆeó]&"™dÄsŒú9Uﬁ•‡U0!¿¡*nP–*`óˇÊõo÷®vïºπ¡i8GçÂ˛‘ˇhh†ÿmúäÕÀ¿‰…ìùsœ=◊{J«U0¿’ÇÛÁœwZ∑Ê˛íà¯îÉÄÏõˆç8bEzÙË·,Y≤DÔ˛![Cü>}úç7:k◊Æìno∆¿fˆ >jvR?#bÄÉXà(∂¸F√ATæF’’iÛÍà[¡{Ï∞zvƒÁ>∫°Cá Ìa+ê[0B2èDµú=ÄÌG~Î(
¯ƒ∫Ò∆’ıèÇLO◊\sç‹Ç>"8|ã`[)
&Lp8¯'âñˆ‰åî”Ì4 oGeŒ#£€è¿lŸí_\ìDÕÄ‹Çë2Zÿl¢‹i¥9éåt‰»ë9f ﬁ¢À-øúºã=ÄùáYÃyçàn?uQ„Ø}XÕ¨ÕsAÔi >=å–1Ê=R…Ì+‡ +≠‹Ç°∏.2 öäKÏ´∑ﬂÙÈ”C∆¢€É20h– áÀ´%53¿5@ÖMAπ%ò¶◊Ã£„»ÌÇº∑j[ı‰9Œ;∏˚ _(Ø˙ßøµ0¿’~r˚’¬\∏{Ùm¡P¸‹ˇÆx#TT9æôn?æè ÌóN#†·ï◊•&Ó}◊ ¨Ø)
›TçVLØ!∏ﬂ‘j¡™Î`Ôp ﬂ8@Rr˚UAVåAÂ¨ö‹=∏„-ﬁÂÄ˜pLH™`@nø*»ä1®‹ÇUìÀı?}w ]ÏH2@∑ﬂ¥i”ÜV∞∏†[êÀØ%Å‡ÙˇÇÎﬂ5 ç8±)–≠
T`Äõ|rZbZ-∏.÷!da+@◊ ŒÁﬂûÛÄZÌgfê[0pΩºÊÜÙ û‰§ I¥…gr∏$∑†o%P«_rCy¿Vú|ﬂΩ†ˇ•‡"mÚYöŒ -Ë[ l⁄ƒk xA„ ¯ì€Ø9]¢[p“§IÂ»®¨pPì«œk ä∫FeŸêÃ»ÌgHE¯dÉnAm"Zñ$éı5}ÑõÇzÂ8¸êÈÙ2r¯Xõ|ñ ≈‡S‹ªwØ≥rÂJÉsôJ÷~ÅTõf˛z{ ÃÕ´ ˜êx–j?jµ‡QïE›nÚ js¿˘¡|Gêx–∑˝<dXt(∑‡QïE›.¨pØ47 ‹)˜¢˛;Öœysµ_´V≠DáÖ»-XTi‘Ì¢˝?õ Ü~ºËñúˇê€œÓ ∑`Q˝=VÙ?öÚ˙^‡
ÄÇπ∫˝ñ.]™|Xﬁ
Ùm¡B~Äø?ä∆¯Jı ﬁD†ó∑‰¸è‹~Ÿh rÍëÛˇ©€ER™¿ÖA›ÄÛäBÊÏ›~w‹qá”æ}˚úï<õ≈ï[–π5˚dÛ⁄-’`ò5 ?êKq›~l4íÏ0@∑‡)ßúíù/IÇÆ(ºú‡áÿã¸Ö•nŒÍ9π˝≤Y≥4Ëú!òCŸà2◊ó*w9¿Å¿GK›êısÓ&ür˚e≥¶s˙È∂?†6Ÿ8J  |(ÚuwO‰¥Åd∞&K)ánAæ ?Röç“n@7,∑∫8¡=ëıˇr˚eΩÜïèn¡Mõ69k◊ÚM7Û¬È˝∑Jï¥RÄ]Üe•n Í9π˝≤Z≥≈Â‚ /?·ûìo>å“Ûïæ§îrzr“¿ ÛÛ`ÂˆÛV{ˆèªuÎÊ4448´V≠ ra˜†p≥ ÓıQRZî<{‰dK.F9ïΩ#~T‚æ˚Ós.æ¯‚ÏN%*À ¿·√ùuÎ8G&ì≤•Ï/W:*x%·{√}@¶ ªÇlıııNc#ÁAIÚ¿¿±«õıiﬁ˜£À*?ÎÿØ¿0}ÄgÄ„˘C"ƒÄp€Ø≥Ääﬂ˚®4Ëñí“è(b¿8Ä_Q˘Yî Ä·Ór7'Äóà`∑ˇÓ ˘j ∏6‡Ö *å©3¿WˆgÉ‰"®‡l¢°¬à1ê:Ï±Sg}%» †	π•P?˜Ñ˛ã1`õê£Ø…Y– „‚é"ãÇD™0b@§∆ ›ˆÅîü9¨¶¿˝æ[t·âF1¿áÙp`k–\U”`ú‹R¯∑A#W81 e`)R€ZMä’ˆ ˜Ä[uÊâF0	rq.¿’Å•⁄ #^=C"ƒÄ9P'´R~fΩñ Ô
pnÄzdC"“e†¶ß?≥\KÄ˜Ω®@&$b }jz˙3€µˆ x/{Ëƒ1 RaÄ#ˇ|˜Á∆üUK≠= &ƒ^ÄÊTMπnë2¿9ˇ5)?s¶¿˚{O'ÛáDàÅD‡íﬂo [kM’oK0øxˇå ‹TdÇ_@]b rÊ ∆G√ƒ∂¿¥; ´ÄØÚáDàÅD‡Í‹1¿gaR€`⁄‹'`0à¬† â>\çÎ/˘ÑÒΩf–˘É¯Òê˜Ñé≈ÄàçÅﬂ!fn˜Z¢|büÜ‹U†.tÆÅÂ‡§ü—¿⁄r™9≈+Äõ˝ë≠Ä±Ó	˝b rnEåDkî= ÊÈ8‡è¿Ÿ¸!b RûCl„ÄPﬁEŸ`º‹åêKÜ'~ﬂ@â†À}*∞!`¯@¡¢6 LÙ†;¿ç	$b@D√¿?#ö»gﬁF˝
‡µVîà1év˝«;√EsÙ›Qπõ«Ã=…Æˆ4ø†ﬂb@T≈¿nÑ˛!πÚ3qº0^ VÄ„ c âµ1‹∂¥∂[˝ÔäÎ¿Mπ=8Ià›â’1@è⁄Ö@Cu∑∑`N∏o¿„ WJƒÄ∆ W˙—Â«e˜±IúØ n¶πN‡m‡ØÄ∏∆‹¥Ù_dÅÅ(ƒ4`E‹ÖI¬ ∞Øú"ÃµÀ1 *3+\˛EÂ —\M‚¿Õ)g	r¡ê¶
ªåËø8ö>ıøpÙ?vI“ ∞0Ä«Ä~¸!b†àÅ≠¯≈$'”%"IøìøéR˝¿iç1 é0∞á? S~&ù‘ ”rÖ‰í∆Ä§{ nÙ_òƒ¿»ÃL‡?íŒTÄe‰‘∆é¿7˘C"rŒ¿OQ~"qIÀ ∞†O 8ù?$b ß‹ãrˇ#@◊_‚ívºJÃôÇ£/πÈ3'd·/Å»÷˜W[§§õÁo'N¸lÛ˙-2Œ €¸Â@j O~”Ó0îÅ¿2` Hƒ@∆ÿÑÚù–+ñ™§›pOBÆ ﬁuOËø»(l„SÄ‘ïü¸¶9»ÙΩÚ~cﬂ:x/ËXdÑ.˘∞∆îÚòd »…V‡y@F $H2≈ ïüÔ¸+M*ïiÄ‹l8O@F $H2¡ ïüÂÆ2≠4& r¥PO¿¥÷¢¸‘¬Ä˚‰7N˘YS Û∂†¯¿YÉ1`„;ˇJS3n≤ g[Å'Åë@W@"la`32 n?'˚HB2p
ÓhƒÅmÄmu âêÅì◊j@F@ò‹V†ç≤≠Z!¶øxI‰î…ˇHÆyô—±)¸˘>¿ÂZ!6 ∫‡îaŒ`‰˛Ç¶ÃdDV$9fÄÎ˘	pMø6ªI®!LG:\LdrwPyÀ~˝P·ß%‘ÊïL3∆·7ÁTK—ƒAmÄmo|≥6©ü	3–È-“h J3øº?é67 ·∂yr∂çî"Ä˚˛‡g»Œ4. $±1¿˜˝_º[*ä∏&∏§òS/ıdq¥ŒÏ„‰â¡Cﬁ‚h ä3øº>ä6≈∂%±ÄÅ∂»„\Ä#¥RZq¶=lK|≈îX∆¿X‰WSàe j5 /°˝–”$±òÅ:‰˝v@ΩÇ†ÜÄŒ8–◊êdÑÅ1(áz2~F‡)¥˘ˆ3¢ÙÕã¡ﬁ¿lÄÆCøÜ†Î˘‚Ë#¥âõÌ=≤.\Lt? %— N$9b†% :‡˛É2˘‰Äu	 …1|-ò	ldÚ¡˜úút $b†¿@?¸•∑@Ü ªF‡c‘ÔœÅ^ÄDîdÄ[9˝‡†êzŸ‡Ääœ:
Hƒ@ æåP2v )~†¶Æ@ï‡¸Ôüz5∞«|Ä˙“øR´÷µ™‡¡|`#†W39ÿÇ∫·<Ó"-±0¿Ô\<Ïd“ÂÄu¿oGLz 1êúGp∞‡óçeíÂÄØdã .¯jHƒ@jÙF 3Äï@ c{s<ˇ˘J&	…@ãê˜Îˆb∏Ÿ¿wÅã  ≤ß ©ùn¡µ‡vú≤˚< âàÄàà,M;ú˚*p>p!0hH¸‡{=ïûª¸x‡]Iƒ» DLhôË⁄‚<'°åh8«@V ¡#Ô„òJˇ∞‡f˚ Iå» ƒHnÖ®˚„Wü}‡N∆t[uÚ$ü¢∞õÅßÅÂ ˛@í 2 	í]&)éÜ #Ä3àìÅ,	=%ØTÙ’¿k¿&‡  IâÄîà˜I∂Æ”≥ Ÿ[8	Ë	¥Lñ]»]tÔTgÅı¿6‡-@b2 UÜOV∫„: A?ÄØ} .iÓ|	‡xCú¬˜rvﬂw; Œ¿#Í>Èi 8_b82 ÜWPÄÏ—ıË Åé {'nØ·”8z;Ä∆§y›ésü ú√@•¶ºP°∑o|¬S˘ih $3ˇ@ﬂπjÏä·    IENDÆB`Ç```

### app/globals.css

```
@tailwind base;
@tailwind components;
@tailwind utilities;




:root {
    --color-bg-dark: #361999;
    --color-bg-light: #78fff1;
}

* {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
}

/*body {
    align-items: left;
    background: linear-gradient(
        to top right,
        var(--color-bg-dark),
        var(--color-bg-light)
    );
    color: #fff;
    display: flex;
    font-family: Helvetica, sans-serif;
    font-size: 24px;
    height: 100vh;
    justify-content: center;
    overflow: hidden;
    width: 100vw;
}

.bg {
    height: 100%;
    left: 0;
    position: absolute;
    overflow: hidden;
    right: 0;
    width: 100%;
}

.bg__dot {
    background: linear-gradient(
        to left,
        var(--color-bg-light),
        rgba(255, 255, 255, 0.3)
    );
    border-radius: 50%;
    opacity: 0.5;
    position: absolute;
}

.bg__dot:nth-child(1) {
    animation: move1 15s infinite linear both;
    bottom: 75vh;
    height: 50vh;
    width: 50vh;
}

.bg__dot:nth-child(2) {
    animation: move2 20s infinite linear both;
    height: 40vh;
    top: 65%;
    width: 40vh;
}

.form {
    backdrop-filter: blur(5px);
    background: linear-gradient(
        to left,
        rgba(255, 255, 255, 0.05),
        rgba(255, 255, 255, 0.35)
    );
    border-radius: 15px;
    box-shadow: 0px 8px 24px 0px rgba(0, 0, 0, 0.3);
    max-height: 100%;
    max-width: 300px;
    overflow-x: hidden;
    overflow-y: auto;
    padding: 36px 24px;
    position: relative;
    text-align: center;
    width: 100%;
}

.form__icon {
    border: solid 3px rgba(255, 255, 255, 0.7);
    border-radius: 50%;
    box-shadow: 0px 8px 18px 0px rgba(0, 0, 0, 0.3);
    height: 72px;
    margin: 0 auto 24px;
    overflow: hidden;
    position: relative;
    width: 72px;
}

.form__icon:before {
    background: rgba(255, 255, 255, 0.7);
    bottom: 0;
    border-radius: 50%;
    content: "";
    display: block;
    height: 24px;
    left: 50%;
    position: absolute;
    transform: translateX(-50%);
    width: 48px;
}

.form__icon:after {
    background: rgba(255, 255, 255, 0.7);
    bottom: 45%;
    border-radius: 50%;
    content: "";
    display: block;
    height: 24px;
    left: 50%;
    position: absolute;
    transform: translateX(-50%);
    width: 24px;
}

.form__input-container {
    margin-bottom: 32px;
    position: relative;
}

.form__input,
.form__button {
    background: linear-gradient(
        to right,
        rgba(255, 255, 255, 0.1),
        rgba(255, 255, 255, 0.25)
    );
    border: none;
    border-radius: 18px;
    box-shadow: 0px 8px 24px 0px rgba(0, 0, 0, 0.3);
    color: #fff;
    font-size: 24px;
    outline: transparent;
    overflow: hidden;
    position: relative;
    transition: background 0.3s ease-out, box-shadow 0.3s ease-out,
        color 0.3s ease-out, outline 0.3s ease-out;
}

.form__input {
    padding: 12px 24px;
    width: 100%;
}

.form__button:after {
    content: "";
    background: rgba(255, 255, 255, 0.7);
    display: block;
    height: 100px;
    left: -100px;
    position: absolute;
    top: -50%;
    transform: skew(-15deg);
    transition: left 0.2s linear;
    width: 70px;
}

.form__input:hover:not(:focus),
.form__button:hover:not(:focus) {
    box-shadow: 0px 8px 8px 0px rgba(0, 0, 0, 0.3);
}

.form__button:hover::after {
    left: 110%;
}

.form__input:focus,
.form__input:focus-visible,
.form__button:focus,
.form__button:focus-visible {
    outline: solid 3px rgba(255, 255, 255, 0.8);
}

.form__input:hover + .form__input-label {
    left: 30px;
    opacity: 0.2;
}

.form__input:focus + .form__input-label,
.form__input:not(:placeholder-shown) + .form__input-label {
    left: 100%;
    opacity: 0;
}

.form__input-label {
    cursor: text;
    left: 24px;
    font-style: italic;
    opacity: 0.4;
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    transition: left 0.2s ease-in, opacity 0.2s ease-in;
}

.form__spacer {
    background: rgba(255, 255, 255, 0.5);
    border-radius: 100%;
    display: block;
    height: 2px;
    margin: 32px auto;
    width: 80%;
}

.form__button {
    cursor: pointer;
    padding: 12px 48px;
}

@keyframes move1 {
    0% {
        transform: translate(-60vw, 0);
    }
    100% {
        transform: translate(120vw, 60vw);
    }
}

@keyframes move2 {
    0% {
        transform: translate(100vw, 0);
    }
    100% {
        transform: translate(-50vw, -30vw);
    }
}

.form__input--nav {
  font-size: 14px;
  padding: 6px 16px;
  border-radius: 9999px;
}

/* Mniejsza wersja przycisku do navbara 
.form__button--nav {
  font-size: 14px;        /* zamiast 24px 
  padding: 6px 24px;      /* mniejsze paddingi 
  border-radius: 9999px;  /* bardziej ‚Äûpill‚Äù jak w pasku 
}*/


@layer components {
  .btn {
    @apply inline-flex items-center justify-center gap-2 px-5 py-2.5 text-sm font-semibold
      rounded-full cursor-pointer select-none
      transition-transform transition-shadow duration-150
      focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2;
  }

  .btn--primary {
    @apply text-white bg-gradient-to-b from-sky-500 to-sky-600
      shadow-[0_6px_14px_rgba(56,189,248,0.35)]
      focus-visible:ring-sky-400 focus-visible:ring-offset-slate-950;
  }

  .btn--primary:hover {
    @apply from-sky-400 to-sky-500 shadow-[0_8px_18px_rgba(56,189,248,0.45)] -translate-y-0.5;
  }

  .btn--primary:active {
    @apply from-sky-600 to-sky-700 shadow-[0_4px_10px_rgba(15,23,42,0.6)] translate-y-0;
  }

  .btn--secondary {
    @apply text-sky-100 border border-sky-500/70 bg-slate-900/60
      shadow-[0_4px_10px_rgba(15,23,42,0.7)]
      focus-visible:ring-sky-400 focus-visible:ring-offset-slate-950;
  }

  .btn--secondary:hover {
    @apply bg-slate-800/80 border-sky-300 shadow-[0_6px_14px_rgba(15,23,42,0.85)] -translate-y-0.5;
  }

  .btn--secondary:active {
    @apply bg-slate-900 border-sky-500 shadow-[0_3px_8px_rgba(15,23,42,0.8)] translate-y-0;
  }

  .btn__icon {
    @apply inline-flex h-5 w-5 items-center justify-center rounded-full border text-[10px];
  }

  .btn__icon--light {
    @apply border-sky-100/80 text-sky-50 bg-sky-900/40;
  }

  .btn__icon--dark {
    @apply border-sky-400/80 text-sky-100 bg-sky-900/40;
  }
}
```

### app/layout.tsx

```
import './globals.css'
import type { Metadata } from 'next'
import LoadGoogleMaps from '@/components/LoadGoogleMaps'
import { createSupabaseServer } from '@/lib/supabase/server'
import Navbar from '@/components/Navbar'

export const dynamic = 'force-dynamic'
export const revalidate = 0

export const metadata: Metadata = {
  title: 'elo-arena',
  description: 'Next.js + Supabase',
}

export default async function RootLayout({ children }: { children: React.ReactNode }) {
  const supabase = await createSupabaseServer()
  const { data: { user } } = await supabase.auth.getUser()

  let role: 'admin' | 'user' | null = null

  if (user) {
    // 1) najpewniejsze: rpc('is_admin')
    const { data: isAdmin, error: rpcError } = await supabase.rpc('is_admin')

    if (!rpcError && typeof isAdmin === 'boolean') {
      role = isAdmin ? 'admin' : 'user'
    } else {
      // 2) fallback: czytaj role bezpo≈õrednio z profiles
      const { data: profile, error: profError } = await supabase
        .from('profiles')
        .select('role')
        .eq('id', user.id)
        .maybeSingle()

      if (profError) {
        console.error('[auth] profiles select error:', profError)
      }
      role = profile?.role === 'admin' ? 'admin' : 'user'
    }
  }

  // Tymczasowy log diagnostyczny ‚Äì usu≈Ñ po potwierdzeniu
  console.log('[auth]', { id: user?.id, email: user?.email, role })

  return (
    <html lang="pl">
      {/* DODAJ GRADIENT TUTAJ - zmodyfikuj klasƒô body */}
      <body className="min-h-dvh antialiased bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900">
        <Navbar user={user ? { id: user.id, email: user.email } : null} role={role} />
        {children}
        <LoadGoogleMaps />
      </body>
    </html>
  )
}```

### app/onboarding/page.tsx

```
import { createSupabaseServer } from '@/lib/supabase/server'
import { redirect } from 'next/navigation'
import UsernameForm from './username-form'

export default async function OnboardingPage() {
  const supabase = await createSupabaseServer()
  const { data: { user } } = await supabase.auth.getUser()
  if (!user) redirect('/auth/signin')

  const { data: profile } = await supabase
    .from('profiles')
    .select('username')
    .eq('id', user.id)
    .single()

  if (profile?.username) redirect('/')

  return (
    <main className="mx-auto max-w-md p-6">
      <h1 className="text-2xl font-semibold mb-4">Ustaw sw√≥j login</h1>
      <UsernameForm />
    </main>
  )
}
```

### app/onboarding/username-form.tsx

```
'use client'

import { useState } from 'react'
import { supabase } from '@/lib/supabase/client'
import { useRouter } from 'next/navigation'

export default function UsernameForm() {
  const [username, setUsername] = useState('')
  const [err, setErr] = useState<string | null>(null)
  const [saving, setSaving] = useState(false)
  const router = useRouter()

  const save = async () => {
    setErr(null); setSaving(true)
    try {
      const clean = username.replace(/\s+/g,'').toLowerCase()
      if (clean.length < 3) { setErr('Login musi mieƒá co najmniej 3 znaki.'); setSaving(false); return }

      const { data: { user } } = await supabase.auth.getUser()
      if (!user) { setErr('Brak sesji. Zaloguj siƒô.'); setSaving(false); return }

      const { error } = await supabase
        .from('profiles')
        .update({ username: clean })
        .eq('id', user.id)

      // 23505 = duplicate key
      if (error && ((error as any).code === '23505' || (error.message||'').includes('duplicate'))) {
        setErr('Ten login jest ju≈º zajƒôty.'); setSaving(false); return
      }
      if (error) { setErr(error.message); setSaving(false); return }

      router.push('/')
    } catch (e:any) {
      setErr(e?.message ?? 'Nie uda≈Ço siƒô zapisaƒá loginu.')
    } finally {
      setSaving(false)
    }
  }

  return (
    <div className="space-y-3">
      <input
        className="w-full rounded border px-3 py-2"
        placeholder="np. michal123"
        value={username}
        onChange={e=>setUsername(e.target.value)}
      />
      {err && <p className="text-sm text-red-600">{err}</p>}
      <button onClick={save} className="rounded bg-black px-4 py-2 text-white disabled:opacity-50" disabled={saving}>
        {saving ? 'Zapisujƒô‚Ä¶' : 'Zapisz login'}
      </button>
    </div>
  )
}
```

### app/page.tsx

```
// app/page.tsx
import Link from 'next/link'
import { createSupabaseServer } from '@/lib/supabase/server'

export const dynamic = 'force-dynamic'
export const revalidate = 0

export default async function HomePage() {
  const supabase = await createSupabaseServer()
  
  // Pobierz najbli≈ºsze turnieje
  const { data: upcomingTournaments } = await supabase
    .from('turniej')
    .select('id, nazwa, data_turnieju, godzina_turnieju, limit_graczy')
    .gte('data_turnieju', new Date().toISOString().split('T')[0])
    .order('data_turnieju', { ascending: true })
    .limit(3)

  // Pobierz statystyki
  const [
    { count: tournamentsCount },
    { count: playersCount },
    { data: usersCount, error: usersError }
  ] = await Promise.all([
    supabase.from('turniej').select('*', { count: 'exact', head: true }),
    supabase.from('gracz').select('*', { count: 'exact', head: true }),
    supabase.rpc('get_users_count')
  ])

  // Obs≈Çuga b≈Çƒôd√≥w dla liczby u≈ºytkownik√≥w
  const totalUsers = usersError ? 0 : (usersCount || 0)

  return (
    <main className="flex flex-col min-h-[calc(100vh-4rem)]">
      {/* Hero Section */}
      <section className="flex-1 flex items-center justify-center px-4 py-12">
        <div className="w-full max-w-6xl text-center space-y-8">
          {/* Nag≈Ç√≥wek */}
          <div className="space-y-4">
            <h1 className="text-4xl md:text-6xl font-bold text-sky-50">
              Witaj w <span className="text-sky-400">ELO Arena</span>
            </h1>
            <p className="text-xl md:text-2xl text-slate-300 max-w-3xl mx-auto">
              Platforma do organizacji i ≈õledzenia turniej√≥w rankingowych
            </p>
          </div>

          {/* Statystyki */}
          <div className="grid grid-cols-1 md:grid-cols-3 gap-6 max-w-2xl mx-auto">
            <div className="rounded-2xl bg-slate-800/80 border border-slate-700 p-6 text-center">
              <div className="text-3xl font-bold text-sky-400">{tournamentsCount || 0}</div>
              <div className="text-sm text-slate-400 mt-2">Turniej√≥w</div>
            </div>
            <div className="rounded-2xl bg-slate-800/80 border border-slate-700 p-6 text-center">
              <div className="text-3xl font-bold text-sky-400">{playersCount || 0}</div>
              <div className="text-sm text-slate-400 mt-2">Graczy</div>
            </div>
            <div className="rounded-2xl bg-slate-800/80 border border-slate-700 p-6 text-center">
              <div className="text-3xl font-bold text-sky-400">{totalUsers}</div>
              <div className="text-sm text-slate-400 mt-2">U≈ºytkownik√≥w</div>
            </div>
          </div>

          {/* Przyciski akcji */}
          <div className="flex flex-col sm:flex-row gap-4 justify-center items-center pt-8">
            <Link
              href="/turniej"
              className="inline-flex items-center gap-2 rounded-full bg-gradient-to-r from-sky-500 to-sky-600 px-8 py-4 text-lg font-semibold text-white shadow-[0_10px_25px_rgba(15,23,42,0.9)] transition hover:from-sky-400 hover:to-sky-500 hover:shadow-[0_14px_35px_rgba(15,23,42,1)]"
            >
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M8 6h13M8 12h13M8 18h13M3 6h.01M3 12h.01M3 18h.01"/>
              </svg>
              PrzeglƒÖdaj turnieje
            </Link>
            
            <Link
              href="/auth/signin"
              className="inline-flex items-center gap-2 rounded-full border border-slate-500 bg-slate-800/80 px-8 py-4 text-lg font-semibold text-sky-100 hover:bg-slate-700 hover:border-sky-400 transition"
            >
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4M10 17l5-5-5-5M13.5 12H3"/>
              </svg>
              Zaloguj siƒô
            </Link>
          </div>
        </div>
      </section>

      {/* NadchodzƒÖce turnieje */}
      {upcomingTournaments && upcomingTournaments.length > 0 && (
        <section className="px-4 py-12">
          <div className="w-full max-w-6xl mx-auto">
            <h2 className="text-2xl md:text-3xl font-bold text-sky-50 text-center mb-8">
              NadchodzƒÖce turnieje
            </h2>
            
            <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
              {upcomingTournaments.map((tournament) => (
                <Link
                  key={tournament.id}
                  href={`/turniej`}
                  className="group rounded-2xl bg-slate-800/80 border border-slate-700 p-6 hover:border-sky-400/70 hover:bg-slate-800 transition-all duration-300"
                >
                  <div className="space-y-3">
                    <h3 className="text-lg font-semibold text-sky-100 group-hover:text-sky-50">
                      {tournament.nazwa}
                    </h3>
                    
                    <div className="space-y-2 text-sm text-slate-300">
                      <div className="flex items-center gap-2">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                          <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                          <line x1="16" y1="2" x2="16" y2="6"/>
                          <line x1="8" y1="2" x2="8" y2="6"/>
                          <line x1="3" y1="10" x2="21" y2="10"/>
                        </svg>
                        <span>
                          {new Date(tournament.data_turnieju!).toLocaleDateString('pl-PL', {
                            weekday: 'long',
                            year: 'numeric',
                            month: 'long',
                            day: 'numeric'
                          })}
                        </span>
                      </div>
                      
                      {tournament.godzina_turnieju && (
                        <div className="flex items-center gap-2">
                          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                            <circle cx="12" cy="12" r="10"/>
                            <polyline points="12 6 12 12 16 14"/>
                          </svg>
                          <span>Godzina: {tournament.godzina_turnieju.slice(0, 5)}</span>
                        </div>
                      )}
                      
                      {tournament.limit_graczy && (
                        <div className="flex items-center gap-2">
                          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                            <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/>
                            <circle cx="9" cy="7" r="4"/>
                          </svg>
                          <span>Limit: {tournament.limit_graczy} graczy</span>
                        </div>
                      )}
                    </div>
                    
                    <div className="pt-2">
                      <span className="inline-flex items-center gap-1 text-sky-400 text-sm font-medium group-hover:gap-2 transition-all">
                        Zobacz szczeg√≥≈Çy
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                          <path d="M5 12h14M12 5l7 7-7 7"/>
                        </svg>
                      </span>
                    </div>
                  </div>
                </Link>
              ))}
            </div>
            
            <div className="text-center mt-8">
              <Link
                href="/turniej"
                className="inline-flex items-center gap-2 rounded-full border border-slate-500 bg-slate-800/80 px-6 py-3 text-sm font-semibold text-sky-100 hover:bg-slate-700 hover:border-sky-400 transition"
              >
                Zobacz wszystkie turnieje
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                  <path d="M5 12h14M12 5l7 7-7 7"/>
                </svg>
              </Link>
            </div>
          </div>
        </section>
      )}

      {/* Features Section */}
      <section className="px-4 py-12">
        <div className="w-full max-w-6xl mx-auto">
          <h2 className="text-2xl md:text-3xl font-bold text-sky-50 text-center mb-12">
            Dlaczego ELO Arena?
          </h2>
          
          <div className="grid grid-cols-1 md:grid-cols-3 gap-8">
            <div className="text-center space-y-4">
              <div className="inline-flex items-center justify-center w-16 h-16 rounded-2xl bg-sky-500/20 border border-sky-400/30">
                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                  <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/>
                  <circle cx="9" cy="7" r="4"/>
                </svg>
              </div>
              <h3 className="text-xl font-semibold text-sky-100">Ranking ELO</h3>
              <p className="text-slate-300">
                ≈öled≈∫ swoje postƒôpy w rankingach ELO i rywalizuj z innymi graczami
              </p>
            </div>
            
            <div className="text-center space-y-4">
              <div className="inline-flex items-center justify-center w-16 h-16 rounded-2xl bg-emerald-500/20 border border-emerald-400/30">
                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                  <path d="M8 6h13M8 12h13M8 18h13M3 6h.01M3 12h.01M3 18h.01"/>
                </svg>
              </div>
              <h3 className="text-xl font-semibold text-sky-100">≈Åatwa organizacja</h3>
              <p className="text-slate-300">
                Tw√≥rz i zarzƒÖdzaj turniejami w prosty i intuicyjny spos√≥b
              </p>
            </div>
            
            <div className="text-center space-y-4">
              <div className="inline-flex items-center justify-center w-16 h-16 rounded-2xl bg-amber-500/20 border border-amber-400/30">
                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                  <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                </svg>
              </div>
              <h3 className="text-xl font-semibold text-sky-100">Statystyki</h3>
              <p className="text-slate-300">
                Analizuj swoje wyniki i por√≥wnuj siƒô z innymi zawodnikami
              </p>
            </div>
          </div>
        </div>
      </section>
    </main>
  )
}```

### app/profile/page.tsx

```
import { redirect } from 'next/navigation'
import { createSupabaseServer } from '@/lib/supabase/server'

// Next 15+: searchParams jest Promisem
type SearchParams = Promise<Record<string, string | string[] | undefined>>

// Dok≈Çadnie te same warto≈õci, co w ENUM w bazie:
const VOIVODESHIPS = [
  'Dolno≈õlƒÖskie',
  'Kujawsko-Pomorskie',
  'Lubelskie',
  'Lubuskie',
  '≈Å√≥dzkie',
  'Ma≈Çopolskie',
  'Mazowieckie',
  'Opolskie',
  'Podkarpackie',
  'Podlaskie',
  'Pomorskie',
  '≈ölƒÖskie',
  '≈öwiƒôtokrzyskie',
  'Warmi≈Ñsko-Mazurskie',
  'Wielkopolskie',
  'Zachodniopomorskie',
] as const

export default async function ProfilePage({
  searchParams,
}: {
  searchParams: SearchParams
}) {
  const sp = await searchParams
  const ok = sp.ok === '1'
  const err = typeof sp.e === 'string' ? sp.e : undefined

  const supabase = await createSupabaseServer()
  const {
    data: { user },
  } = await supabase.auth.getUser()
  if (!user) redirect('/auth/signin')

  const { data: profile } = await supabase
    .from('profiles')
    .select(
      'username, first_name, last_name, birthdate, city, voivodeship, role, email'
    )
    .eq('id', user.id)
    .single()

  const bday = profile?.birthdate ? String(profile.birthdate).slice(0, 10) : ''

  const inputClass =
    'w-full rounded-lg border border-slate-600 bg-slate-900/70 px-3 py-2 ' +
    'text-sm text-sky-50 placeholder:text-slate-400 ' +
    'focus:border-sky-400 focus:outline-none focus:ring-1 focus:ring-sky-400'

  const selectClass =
    'w-full rounded-lg border border-slate-600 bg-slate-900/70 px-3 py-2 ' +
    'text-sm text-sky-50 focus:border-sky-400 focus:outline-none focus:ring-1 focus:ring-sky-400'

  const primaryBtn =
    'inline-flex items-center justify-center rounded-full bg-gradient-to-r ' +
    'from-sky-500 to-sky-600 px-4 py-2 text-sm font-semibold text-white ' +
    'shadow-[0_10px_25px_rgba(15,23,42,0.9)] transition ' +
    'hover:from-sky-400 hover:to-sky-500 hover:shadow-[0_14px_35px_rgba(15,23,42,1)] ' +
    'disabled:opacity-50 disabled:hover:shadow-none'

  const secondaryBtn =
    'inline-flex items-center justify-center rounded-full border border-slate-500 ' +
    'bg-slate-800/80 px-4 py-2 text-sm font-semibold text-sky-100 shadow-sm ' +
    'hover:bg-slate-700 hover:border-sky-400 transition'

  return (
    // Dodano ciemne t≈Ço gradientowe do ca≈Çej strony
    <div className="min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900">
      <main className="flex min-h-[calc(100vh-4rem)] items-center justify-center px-4 py-8">
        {/* KARTA PROFILU */}
        <div className="w-full max-w-xl rounded-2xl bg-slate-800/95 border border-slate-700 shadow-[0_14px_40px_rgba(0,0,0,0.8)] p-6 space-y-5">
          <h1 className="text-2xl font-semibold text-sky-50 text-center">
            Tw√≥j profil
          </h1>

          {ok && (
            <div className="rounded-md border border-emerald-300/70 bg-emerald-900/30 px-3 py-2 text-sm text-emerald-200">
              Zapisano zmiany.
            </div>
          )}

          {err && (
            <div className="rounded-md border border-red-400/80 bg-red-900/40 px-3 py-2 text-sm text-red-100">
              {err === 'username_taken'
                ? 'Login zajƒôty.'
                : err === 'voiv_required'
                ? 'Wybierz wojew√≥dztwo.'
                : err === 'voiv_invalid'
                ? 'Nieprawid≈Çowa warto≈õƒá wojew√≥dztwa.'
                : 'Nie uda≈Ço siƒô zapisaƒá. Spr√≥buj ponownie.'}
            </div>
          )}

          <form action="/profile/update" method="post" className="space-y-4">
            <div>
              <label className="block text-sm font-medium text-sky-100">
                Login (username)
              </label>
              <input
                name="username"
                defaultValue={profile?.username ?? ''}
                className={inputClass}
                maxLength={32}
                placeholder="np. m_kowalski"
              />
              <p className="mt-1 text-xs text-slate-300/80">
                Musi byƒá unikalny.
              </p>
            </div>

            <div className="grid grid-cols-1 gap-4 sm:grid-cols-2">
              <div>
                <label className="block text-sm font-medium text-sky-100">
                  Imiƒô
                </label>
                <input
                  name="first_name"
                  defaultValue={profile?.first_name ?? ''}
                  className={inputClass}
                />
              </div>
              <div>
                <label className="block text-sm font-medium text-sky-100">
                  Nazwisko
                </label>
                <input
                  name="last_name"
                  defaultValue={profile?.last_name ?? ''}
                  className={inputClass}
                />
              </div>
            </div>

            <div>
              <label className="block text-sm font-medium text-sky-100">
                Data urodzenia
              </label>
              <input
                type="date"
                name="birthdate"
                defaultValue={bday}
                className={inputClass}
              />
            </div>

            <div className="grid grid-cols-1 gap-4 sm:grid-cols-2">
              <div>
                <label className="block text-sm font-medium text-sky-100">
                  Miasto
                </label>
                <input
                  name="city"
                  defaultValue={profile?.city ?? ''}
                  className={inputClass}
                />
              </div>

              <div>
                <label className="block text-sm font-medium text-sky-100">
                  Wojew√≥dztwo
                </label>
                <select
                  name="voivodeship"
                  defaultValue={profile?.voivodeship ?? ''}
                  className={selectClass}
                  required
                >
                  <option value="" disabled>
                    ‚Äî wybierz ‚Äî
                  </option>
                  {VOIVODESHIPS.map((v) => (
                    <option key={v} value={v}>
                      {v}
                    </option>
                  ))}
                </select>
              </div>
            </div>

            <div className="text-sm text-sky-100/80">
              <span className="opacity-70">Rola:</span>{' '}
              <span
                className={
                  profile?.role === 'admin'
                    ? 'font-semibold text-red-300'
                    : 'font-medium'
                }
              >
                {profile?.role ?? 'user'}
              </span>{' '}
              ‚Ä¢ <span className="opacity-70">Email:</span>{' '}
              {profile?.email ?? user.email}
            </div>

            <div className="flex flex-wrap gap-2 pt-2 justify-end">
              <button className={primaryBtn} type="submit">
                Zapisz zmiany
              </button>
              <a href="/" className={secondaryBtn}>
                Anuluj
              </a>
            </div>
          </form>
        </div>
      </main>
    </div>
  )
}```

### app/profile/update/route.ts

```
import { NextRequest, NextResponse } from 'next/server'
import { createSupabaseServerMutable } from '@/lib/supabase/server-mutable'

// Ta lista musi byƒá identyczna jak warto≈õci ENUM w bazie:
const VOIVODESHIPS = [
  'Dolno≈õlƒÖskie','Kujawsko-Pomorskie','Lubelskie','Lubuskie','≈Å√≥dzkie','Ma≈Çopolskie',
  'Mazowieckie','Opolskie','Podkarpackie','Podlaskie','Pomorskie','≈ölƒÖskie',
  '≈öwiƒôtokrzyskie','Warmi≈Ñsko-Mazurskie','Wielkopolskie','Zachodniopomorskie',
] as const
type Voiv = typeof VOIVODESHIPS[number]

export async function POST(req: NextRequest) {
  const supabase = await createSupabaseServerMutable()
  const { data: { user } } = await supabase.auth.getUser()
  const origin = req.nextUrl.origin

  if (!user) {
    return NextResponse.redirect(new URL('/auth/signin', origin), { status: 303 })
  }

  const form = await req.formData()
  const username = String(form.get('username') || '').trim() || null
  const first_name = String(form.get('first_name') || '').trim() || null
  const last_name = String(form.get('last_name') || '').trim() || null
  const birthdateRaw = String(form.get('birthdate') || '')
  const city = String(form.get('city') || '').trim() || null

  // Wojew√≥dztwo: wymagane i tylko z listy
  const vRaw = String(form.get('voivodeship') || '')
  if (!vRaw) {
    return NextResponse.redirect(new URL('/profile?e=voiv_required', origin), { status: 303 })
  }
  const voivodeship = VOIVODESHIPS.includes(vRaw as Voiv) ? (vRaw as Voiv) : null
  if (!voivodeship) {
    return NextResponse.redirect(new URL('/profile?e=voiv_invalid', origin), { status: 303 })
  }

  const birthdate = birthdateRaw ? birthdateRaw : null // YYYY-MM-DD

  const updates: Record<string, any> = {
    username, first_name, last_name, birthdate, city, voivodeship,
  }

  const { error } = await supabase
    .from('profiles')
    .update(updates)
    .eq('id', user.id)

  if (error) {
    // 23505: unique_violation (np. username), 22P02: invalid input (ENUM), 23514: check_violation
    const code = (error as any).code
    const reason =
      code === '23505' ? 'username_taken' :
      code === '22P02' ? 'voiv_invalid' :
      code === '23514' ? 'voiv_invalid' :
      'save_failed'
    return NextResponse.redirect(new URL(`/profile?e=${reason}`, origin), { status: 303 })
  }

  return NextResponse.redirect(new URL('/profile?ok=1', origin), { status: 303 })
}
```

### app/turniej/create/route.ts

```
import { NextRequest, NextResponse } from 'next/server'
import { createSupabaseServerMutable } from '@/lib/supabase/server-mutable'

const urlRe = /^https?:\/\/\S+$/i
const sheetColRe = /^[A-Za-z]$/
const uuidRe = /^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i

function extractSheetId(url: string): string | null {
  try {
    const u = new URL(url)
    const byQuery = u.searchParams.get('id')
    if (byQuery) return byQuery
    const m = u.pathname.match(/\/spreadsheets\/d\/([a-zA-Z0-9-_]+)/)
    return m ? m[1] : null
  } catch {
    return null
  }
}

export async function POST(req: NextRequest) {
  const origin = req.nextUrl.origin
  const supabase = await createSupabaseServerMutable()

  const { data: { user } } = await supabase.auth.getUser()
  if (!user) return NextResponse.redirect(new URL('/auth/signin', origin), { status: 303 })
  const { data: isAdmin } = await supabase.rpc('is_admin')
  if (!isAdmin) return NextResponse.redirect(new URL('/', origin), { status: 303 })

  const fd = await req.formData()

  // Tournament data
  const nazwa = String(fd.get('nazwa') || '').trim()
  const data_turnieju = String(fd.get('data_turnieju') || '').trim()
  const godzina_turnieju = String(fd.get('godzina_turnieju') || '').trim()
  const zakonczenie_turnieju = String(fd.get('zakonczenie_turnieju') || '').trim() || null

  const gsheet_url_raw = String(fd.get('gsheet_url') || '').trim() || null
  let gsheet_id = String(fd.get('gsheet_id') || '').trim() || null
  const arkusz_nazwa = String(fd.get('arkusz_nazwa') || '').trim() || null

  const kolumna_nazwisk_raw = String(fd.get('kolumna_nazwisk') || '').trim()
  const kolumna_nazwisk = kolumna_nazwisk_raw ? kolumna_nazwisk_raw.toUpperCase() : null

  const pierwszy_wiersz_z_nazwiskiem_raw = fd.get('pierwszy_wiersz_z_nazwiskiem')
  const pierwszy_wiersz_z_nazwiskiem =
    pierwszy_wiersz_z_nazwiskiem_raw ? Number(pierwszy_wiersz_z_nazwiskiem_raw) : 2

  const limit_graczy_raw = fd.get('limit_graczy')
  const limit_graczy = limit_graczy_raw ? Number(limit_graczy_raw) : null

  // Location ID - this is the crucial field
  const miejsce_id = String(fd.get('miejsce_id') || '').trim()

  console.log('Form data received:', {
    nazwa,
    data_turnieju,
    godzina_turnieju,
    miejsce_id,
    wszystkieFields: Array.from(fd.keys())
  })

  // Validations
  if (!nazwa) return NextResponse.redirect(new URL('/turniej/new?e=invalid_input', origin), { status: 303 })
  if (!data_turnieju || !godzina_turnieju) {
    return NextResponse.redirect(new URL('/turniej/new?e=date_time_required', origin), { status: 303 })
  }
  
  // Validate that miejsce_id is provided and is a valid UUID
  if (!miejsce_id) {
    console.error('miejsce_id is missing from form data')
    return NextResponse.redirect(new URL('/turniej/new?e=location_required', origin), { status: 303 })
  }
  
  if (!uuidRe.test(miejsce_id)) {
    console.error('miejsce_id is not a valid UUID:', miejsce_id)
    return NextResponse.redirect(new URL('/turniej/new?e=invalid_location_id', origin), { status: 303 })
  }

  if (kolumna_nazwisk && !sheetColRe.test(kolumna_nazwisk)) {
    return NextResponse.redirect(new URL('/turniej/new?e=sheet_col_invalid', origin), { status: 303 })
  }
  if (pierwszy_wiersz_z_nazwiskiem !== null && (!Number.isFinite(pierwszy_wiersz_z_nazwiskiem) || pierwszy_wiersz_z_nazwiskiem < 1)) {
    return NextResponse.redirect(new URL('/turniej/new?e=number_invalid', origin), { status: 303 })
  }
  if (limit_graczy !== null && (!Number.isFinite(limit_graczy) || limit_graczy < 1)) {
    return NextResponse.redirect(new URL('/turniej/new?e=number_invalid', origin), { status: 303 })
  }

  let gsheet_url = gsheet_url_raw
  if (gsheet_url && !urlRe.test(gsheet_url)) {
    return NextResponse.redirect(new URL('/turniej/new?e=url_invalid', origin), { status: 303 })
  }
  if (!gsheet_id && gsheet_url) {
    gsheet_id = extractSheetId(gsheet_url)
  }

  // Verify that the location exists
  const { data: location, error: locationError } = await supabase
    .from('miejsce_turnieju')
    .select('id')
    .eq('id', miejsce_id)
    .single()

  if (locationError || !location) {
    console.error('Location not found:', miejsce_id, locationError)
    return NextResponse.redirect(new URL('/turniej/new?e=location_not_found', origin), { status: 303 })
  }

  const payload = {
    nazwa,
    data_turnieju,
    godzina_turnieju,
    zakonczenie_turnieju,
    gsheet_url,
    gsheet_id,
    arkusz_nazwa,
    kolumna_nazwisk,
    pierwszy_wiersz_z_nazwiskiem,
    limit_graczy,
    // Usuniƒôte: lat i lng - u≈ºywamy wsp√≥≈Çrzƒôdnych z miejsca_turnieju
    miejsce_id,
    created_by: user.id,
  }

  console.log('Inserting tournament with payload:', payload)

  const { error } = await supabase.from('turniej').insert(payload)
  if (error) {
    console.error('insert turniej error', error)
    return NextResponse.redirect(new URL('/turniej/new?e=database_error', origin), { status: 303 })
  }

  return NextResponse.redirect(new URL('/admin?ok=1', origin), { status: 303 })
}```

### app/turniej/new/page.tsx

```
// app/turniej/new/page.tsx
import { redirect } from 'next/navigation'
import { createSupabaseServer } from '@/lib/supabase/server'
import AutoHide from '@/components/AutoHide'

type SearchParams = Promise<Record<string, string | string[] | undefined>>

export const dynamic = 'force-dynamic'
export const revalidate = 0

export default async function NewTurniejPage({ searchParams }: { searchParams: SearchParams }) {
  const sp = await searchParams
  const ok = sp.ok === '1'
  const err = typeof sp.e === 'string' ? sp.e : undefined

  const supabase = await createSupabaseServer()
  const { data: { user } } = await supabase.auth.getUser()
  if (!user) redirect('/auth/signin')
  const { data: isAdmin } = await supabase.rpc('is_admin')
  if (!isAdmin) redirect('/')

  // Pobierz istniejƒÖce miejsca turnieju
  const { data: miejsca } = await supabase
    .from('miejsce_turnieju')
    .select('id, nazwa, miasto, wojewodztwo, adres')
    .order('nazwa', { ascending: true })

  return (
    <main className="flex min-h-[calc(100vh-4rem)] items-center justify-center px-4 py-8 bg-slate-900">
      <div className="w-full max-w-2xl rounded-2xl bg-slate-800/95 border border-slate-700 shadow-[0_14px_40px_rgba(0,0,0,0.8)] p-6 space-y-6">
        <h1 className="text-2xl font-semibold text-sky-50">Dodaj turniej</h1>

        {ok && (
          <AutoHide>
            <div className="rounded-md border border-green-400/50 bg-green-500/10 px-4 py-3 text-sm text-green-200">
              Turniej zosta≈Ç utworzony.
            </div>
          </AutoHide>
        )}
        {err && (
          <AutoHide>
            <div className="rounded-md border border-red-400/50 bg-red-500/10 px-4 py-3 text-sm text-red-200">
              {{
                invalid_input: 'Nieprawid≈Çowe dane formularza.',
                date_time_required: 'Podaj datƒô i godzinƒô wydarzenia.',
                sheet_col_invalid: 'Kolumna nazwisk musi byƒá literƒÖ (A‚ÄìZ).',
                number_invalid: 'Nieprawid≈Çowa warto≈õƒá liczbowa.',
                url_invalid: 'Link musi zaczynaƒá siƒô od http(s)://',
                location_required: 'Wybierz miejsce turnieju.',
                invalid_location_id: 'Nieprawid≈Çowy identyfikator miejsca.',
                location_not_found: 'Wybrane miejsce nie istnieje.',
                database_error: 'B≈ÇƒÖd bazy danych podczas zapisywania.',
              }[err] ?? 'Nie uda≈Ço siƒô zapisaƒá.'}
            </div>
          </AutoHide>
        )}

        <form action="/turniej/create" method="post" className="space-y-5">
          {/* Nazwa turnieju */}
          <div>
            <label className="block text-sm font-medium text-sky-100">Nazwa turnieju *</label>
            <input 
              name="nazwa" 
              required 
              className="mt-1 w-full rounded border border-slate-600 bg-slate-900/80 px-3 py-2 text-sky-100 placeholder:text-slate-500 focus:border-sky-500 focus:ring-1 focus:ring-sky-500" 
              placeholder="np. ELO Arena Open" 
            />
          </div>

          {/* Data i godziny */}
          <div className="grid grid-cols-1 gap-4 sm:grid-cols-3">
            <div>
              <label className="block text-sm font-medium text-sky-100">Data turnieju *</label>
              <input 
                type="date" 
                name="data_turnieju" 
                required 
                className="mt-1 w-full rounded border border-slate-600 bg-slate-900/80 px-3 py-2 text-sky-100 focus:border-sky-500 focus:ring-1 focus:ring-sky-500" 
              />
            </div>
            <div>
              <label className="block text-sm font-medium text-sky-100">Godzina startu *</label>
              <input 
                type="time" 
                name="godzina_turnieju" 
                required 
                className="mt-1 w-full rounded border border-slate-600 bg-slate-900/80 px-3 py-2 text-sky-100 focus:border-sky-500 focus:ring-1 focus:ring-sky-500" 
              />
            </div>
            <div>
              <label className="block text-sm font-medium text-sky-100">Godzina zako≈Ñczenia</label>
              <input 
                type="time" 
                name="zakonczenie_turnieju" 
                className="mt-1 w-full rounded border border-slate-600 bg-slate-900/80 px-3 py-2 text-sky-100 focus:border-sky-500 focus:ring-1 focus:ring-sky-500" 
              />
            </div>
          </div>

          {/* Miejsce turnieju */}
          <div>
            <label className="block text-sm font-medium text-sky-100">Miejsce turnieju *</label>
            <select 
              name="miejsce_id" 
              required
              className="mt-1 w-full rounded border border-slate-600 bg-slate-900/80 px-3 py-2 text-sky-100 focus:border-sky-500 focus:ring-1 focus:ring-sky-500"
            >
              <option value="">‚Äî wybierz miejsce turnieju ‚Äî</option>
              {miejsca?.map((miejsce) => (
                <option key={miejsce.id} value={miejsce.id}>
                  {miejsce.nazwa} - {miejsce.miasto}
                  {miejsce.wojewodztwo && `, ${miejsce.wojewodztwo}`}
                </option>
              ))}
            </select>
            <div className="mt-2 flex justify-between items-center">
              <p className="text-xs text-slate-400">
                Je≈õli nie ma odpowiedniego miejsca, dodaj je najpierw w panelu administracyjnym.
              </p>
              <a 
                href="/admin/miejsca/new" 
                className="text-xs text-sky-400 hover:text-sky-300 hover:underline"
                target="_blank"
                rel="noopener noreferrer"
              >
                Dodaj nowe miejsce ‚Üí
              </a>
            </div>
          </div>

          {/* Arkusz Google */}
          <div>
            <label className="block text-sm font-medium text-sky-100">Link do arkusza Google (opcjonalnie)</label>
            <input 
              name="gsheet_url" 
              className="mt-1 w-full rounded border border-slate-600 bg-slate-900/80 px-3 py-2 text-sky-100 placeholder:text-slate-500 focus:border-sky-500 focus:ring-1 focus:ring-sky-500" 
              placeholder="https://docs.google.com/spreadsheets/d/..." 
            />
            <p className="mt-1 text-xs text-slate-400">ID arkusza wyciƒÖgniemy automatycznie.</p>
          </div>

          {/* Szczeg√≥≈Çy arkusza */}
          <div className="grid grid-cols-1 gap-4 sm:grid-cols-3">
            <div>
              <label className="block text-sm font-medium text-sky-100">Nazwa karty (opcjonalnie)</label>
              <input 
                name="arkusz_nazwa" 
                className="mt-1 w-full rounded border border-slate-600 bg-slate-900/80 px-3 py-2 text-sky-100 placeholder:text-slate-500 focus:border-sky-500 focus:ring-1 focus:ring-sky-500" 
                placeholder="np. Lista" 
              />
            </div>
            <div>
              <label className="block text-sm font-medium text-sky-100">Kolumna nazwisk</label>
              <input 
                name="kolumna_nazwisk" 
                className="mt-1 w-full rounded border border-slate-600 bg-slate-900/80 px-3 py-2 text-sky-100 placeholder:text-slate-500 focus:border-sky-500 focus:ring-1 focus:ring-sky-500" 
                placeholder="np. B" 
                maxLength={2} 
              />
              <p className="mt-1 text-xs text-slate-400">Jedna litera A-Z.</p>
            </div>
            <div>
              <label className="block text-sm font-medium text-sky-100">Pierwszy wiersz z nazwiskiem</label>
              <input 
                type="number" 
                name="pierwszy_wiersz_z_nazwiskiem" 
                min={1} 
                defaultValue={2} 
                className="mt-1 w-full rounded border border-slate-600 bg-slate-900/80 px-3 py-2 text-sky-100 focus:border-sky-500 focus:ring-1 focus:ring-sky-500" 
              />
            </div>
          </div>

          {/* Limit graczy */}
          <div className="grid grid-cols-1 gap-4 sm:grid-cols-2">
            <div>
              <label className="block text-sm font-medium text-sky-100">Limit graczy (opcjonalnie)</label>
              <input 
                type="number" 
                name="limit_graczy" 
                min={1} 
                className="mt-1 w-full rounded border border-slate-600 bg-slate-900/80 px-3 py-2 text-sky-100 focus:border-sky-500 focus:ring-1 focus:ring-sky-500" 
              />
            </div>
          </div>

          {/* Przyciski akcji */}
          <div className="flex gap-2 pt-4">
            <button 
              className="rounded-full bg-sky-600 hover:bg-sky-500 px-6 py-2 text-sm font-semibold text-white transition focus:outline-none focus:ring-2 focus:ring-sky-500 focus:ring-offset-2 focus:ring-offset-slate-800" 
              type="submit"
            >
              Utw√≥rz turniej
            </button>
            <a 
              href="/admin" 
              className="rounded-full border border-slate-600 bg-slate-700 hover:bg-slate-600 px-6 py-2 text-sm font-semibold text-sky-100 transition"
            >
              Anuluj
            </a>
          </div>
        </form>
      </div>
    </main>
  )
}```

### app/turniej/page.tsx

```
import { createSupabaseServer } from '@/lib/supabase/server'

export const dynamic = 'force-dynamic'
export const revalidate = 0

type Row = {
  id: string
  nazwa: string
  data_turnieju: string | null     // YYYY-MM-DD
  godzina_turnieju: string | null  // HH:MM[:SS]
  zakonczenie_turnieju: string | null  // HH:MM[:SS]
  gsheet_url: string | null
  limit_graczy: number | null
  miejsce_turnieju: {
    id: string
    nazwa: string
    miasto: string
    wojewodztwo: string | null
    adres: string | null
    latitude: number | null
    longitude: number | null
  } | null
}

function joinDateTime(d: string | null, t: string | null): Date | null {
  if (!d) return null
  const hhmm = (t ?? '00:00').slice(0, 5)
  return new Date(`${d}T${hhmm}`)
}

function capitalizeFirst(str: string): string {
  return str.charAt(0).toUpperCase() + str.slice(1)
}

function formatDatePL(d: Date) {
  const formatted = d.toLocaleDateString('pl-PL', {
    weekday: 'long',
    year: '2-digit',
    month: 'numeric',
    day: 'numeric',
  })
  return capitalizeFirst(formatted)
}

function formatTimeHHMM(raw: string | null) {
  if (!raw) return '00:00'
  return raw.slice(0, 5)
}

/**
 * Czy turniej jest ju≈º zako≈Ñczony?
 * - je≈õli jest godzina zako≈Ñczenia -> przesz≈Çy, gdy now > end
 * - je≈õli nie ma zako≈Ñczenia -> przesz≈Çy po 6h od startu
 */
function isPastTournament(start: Date | null, end: Date | null): boolean {
  if (!start) return false
  const now = new Date()
  const sixHours = 6 * 60 * 60 * 1000

  if (end) {
    return now.getTime() > end.getTime()
  }

  // fallback: jak dotychczas ‚Äì 6 godzin od startu
  if (now.getTime() - start.getTime() > sixHours) {
    return true
  }
  return false
}

/**
 * Status turnieju ‚Äì uwzglƒôdnia godzinƒô zako≈Ñczenia.
 * - przysz≈Ço≈õƒá -> dzisiaj / jutro / pojutrze / za X dni
 * - teraz (miƒôdzy startem a ko≈Ñcem) -> w trakcie
 * - po ko≈Ñcu (lub po 6h je≈õli brak ko≈Ñca) -> zako≈Ñczony
 */
function statusBadge(start: Date | null, end: Date | null) {
  if (!start) return null
  const now = new Date()
  const sixHours = 6 * 60 * 60 * 1000

  // je≈õli mamy godzinƒô zako≈Ñczenia
  if (end) {
    if (now.getTime() < start.getTime()) {
      // PRZYSZ≈ÅO≈öƒÜ ‚Äì liczymy r√≥≈ºnicƒô po datach (bez godzin)
      const startDate = new Date(start.getFullYear(), start.getMonth(), start.getDate())
      const today = new Date(now.getFullYear(), now.getMonth(), now.getDate())
      const diffTime = startDate.getTime() - today.getTime()
      const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24))

      if (diffDays === 0) return { text: 'dzisiaj', style: 'bg-sky-500/15 text-white border-sky-400/60' }
      if (diffDays === 1) return { text: 'jutro', style: 'bg-sky-500/15 text-white border-sky-400/60' }
      if (diffDays === 2) return { text: 'pojutrze', style: 'bg-sky-500/15 text-white border-sky-400/60' }
      return { text: `za ${diffDays} dni`, style: 'bg-sky-500/15 text-white border-sky-400/60' }
    }

    if (now.getTime() >= start.getTime() && now.getTime() <= end.getTime()) {
      return {
        text: 'w trakcie',
        style: 'bg-green-500/15 text-green-100 border-green-400/70',
      }
    }

    // po zako≈Ñczeniu
    return {
      text: 'zako≈Ñczony',
      style: 'bg-red-500/15 text-red-100 border-red-400/70',
    }
  }

  // brak godziny zako≈Ñczenia -> stara logika 6h
  const ms = start.getTime() - now.getTime()
  if (ms > 0) {
    const startDate = new Date(start.getFullYear(), start.getMonth(), start.getDate())
    const today = new Date(now.getFullYear(), now.getMonth(), now.getDate())
    const diffTime = startDate.getTime() - today.getTime()
    const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24))

    if (diffDays === 0) return { text: 'dzisiaj', style: 'bg-sky-500/15 text-white border-sky-400/60' }
    if (diffDays === 1) return { text: 'jutro', style: 'bg-sky-500/15 text-white border-sky-400/60' }
    if (diffDays === 2) return { text: 'pojutrze', style: 'bg-sky-500/15 text-white border-sky-400/60' }
    return { text: `za ${diffDays} dni`, style: 'bg-sky-500/15 text-white border-sky-400/60' }
  } else {
    const since = now.getTime() - start.getTime()
    if (since <= sixHours) {
      return {
        text: 'w trakcie',
        style: 'bg-green-500/15 text-green-100 border-green-400/70',
      }
    }
    return {
      text: 'zako≈Ñczony',
      style: 'bg-red-500/15 text-red-100 border-red-400/70',
    }
  }
}

// Google Calendar URL: u≈ºywa godziny zako≈Ñczenia je≈õli istnieje
function createGoogleCalendarUrl(r: Row): string | null {
  if (!r.data_turnieju) return null

  const start = joinDateTime(r.data_turnieju, r.godzina_turnieju)
  if (!start) return null

  const formatDateForGoogle = (date: Date) =>
    date.toISOString().replace(/-|:|\.\d+/g, '').slice(0, 15) + 'Z'

  const startTime = formatDateForGoogle(start)

  let end: Date
  if (r.zakonczenie_turnieju) {
    const e = joinDateTime(r.data_turnieju, r.zakonczenie_turnieju)
    end = e ?? new Date(start.getTime() + 3 * 60 * 60 * 1000)
  } else {
    end = new Date(start.getTime() + 3 * 60 * 60 * 1000)
  }
  const endTime = formatDateForGoogle(end)

  const details: string[] = []
  if (r.limit_graczy) details.push(`Limit graczy: ${r.limit_graczy}`)
  if (r.gsheet_url) details.push(`Arkusz Google: ${r.gsheet_url}`)
  if (r.zakonczenie_turnieju) details.push(`Zako≈Ñczenie: ${formatTimeHHMM(r.zakonczenie_turnieju)}`)
  if (r.miejsce_turnieju) {
    details.push(`Miejsce: ${r.miejsce_turnieju.nazwa}, ${r.miejsce_turnieju.miasto}`)
  }

  const params = new URLSearchParams({
    action: 'TEMPLATE',
    text: r.nazwa,
    dates: `${startTime}/${endTime}`,
    details: details.join('\n'),
    location: r.miejsce_turnieju?.latitude && r.miejsce_turnieju?.longitude 
      ? `https://maps.google.com/?q=${r.miejsce_turnieju.latitude},${r.miejsce_turnieju.longitude}`
      : r.miejsce_turnieju?.adres || '',
    ctz: 'Europe/Warsaw',
  })

  return `https://calendar.google.com/calendar/render?${params.toString()}`
}

function TournamentCard({ r }: { r: Row }) {
  const start = joinDateTime(r.data_turnieju, r.godzina_turnieju)
  const end = r.zakonczenie_turnieju
    ? joinDateTime(r.data_turnieju, r.zakonczenie_turnieju)
    : null
  const badge = statusBadge(start, end)
  const calendarUrl = createGoogleCalendarUrl(r)

  // Bezpieczne sprawdzenie wsp√≥≈Çrzƒôdnych
  const hasCoordinates = r.miejsce_turnieju?.latitude !== null && 
                         r.miejsce_turnieju?.longitude !== null &&
                         r.miejsce_turnieju !== null

  return (
    <details className="group rounded-xl border border-slate-600/70 bg-slate-900/70 px-4 py-3 shadow-sm open:shadow-md transition-shadow">
      <summary className="flex cursor-pointer list-none items-center justify-between gap-3">
        <div className="min-w-0">
          <div className="truncate text-base font-semibold text-sky-100">
            {r.nazwa}
          </div>
          <div className="mt-0.5 text-xs text-sky-200/80">
            {start ? (
              <>
                {formatDatePL(start)} ‚Ä¢{' '}
                {formatTimeHHMM(r.godzina_turnieju)}
                {end && ` - ${formatTimeHHMM(r.zakonczenie_turnieju)}`}
                {r.miejsce_turnieju && <> ‚Ä¢ {r.miejsce_turnieju.nazwa}, {r.miejsce_turnieju.miasto}</>}
                {r.limit_graczy ? <> ‚Ä¢ limit: {r.limit_graczy}</> : null}
              </>
            ) : (
              <>‚Äî</>
            )}
          </div>
        </div>
        {badge && (
          <span
            className={`shrink-0 rounded-full border px-3 py-1 text-xs font-medium ${badge.style}`}
          >
            {badge.text}
          </span>
        )}
      </summary>

      {/* rozwijane szczeg√≥≈Çy */}
      <div className="mt-4 grid gap-4 sm:grid-cols-2">
        <div className="space-y-2">
          <div className="text-sm font-medium text-sky-100">Szczeg√≥≈Çy</div>
          <ul className="text-sm text-sky-100/90 leading-relaxed">
            <li>
              <span className="opacity-70">Data:</span>{' '}
              {start ? formatDatePL(start) : '‚Äî'}
            </li>
            <li>
              <span className="opacity-70">Godzina rozpoczƒôcia:</span>{' '}
              {formatTimeHHMM(r.godzina_turnieju)}
            </li>
            <li>
              <span className="opacity-70">Godzina zako≈Ñczenia:</span>{' '}
              {r.zakonczenie_turnieju
                ? formatTimeHHMM(r.zakonczenie_turnieju)
                : 'nieustalona'}
            </li>
            {r.miejsce_turnieju && (
              <li>
                <span className="opacity-70">Miejsce:</span>{' '}
                {r.miejsce_turnieju.nazwa}, {r.miejsce_turnieju.miasto}
                {r.miejsce_turnieju.wojewodztwo && `, ${r.miejsce_turnieju.wojewodztwo}`}
                {r.miejsce_turnieju.adres && ` (${r.miejsce_turnieju.adres})`}
              </li>
            )}
            {r.limit_graczy && (
              <li>
                <span className="opacity-70">Limit graczy:</span>{' '}
                {r.limit_graczy}
              </li>
            )}
          </ul>

          <div className="flex flex-wrap gap-2 pt-2">
            {r.gsheet_url && (
              <a
                href={r.gsheet_url}
                target="_blank"
                rel="noreferrer"
                className="inline-flex items-center gap-2 rounded-full border border-sky-500/70 bg-slate-900/80 px-4 py-2 text-sm font-semibold text-sky-100 hover:bg-slate-800 hover:border-sky-300 transition"
              >
                Arkusz Google
                <svg
                  width="16"
                  height="16"
                  viewBox="0 0 24 24"
                  fill="none"
                  aria-hidden
                >
                  <path
                    d="M14 3h7v7m0-7L10 14"
                    stroke="currentColor"
                    strokeWidth="2"
                    strokeLinecap="round"
                    strokeLinejoin="round"
                  />
                  <path
                    d="M21 14v7H3V3h7"
                    stroke="currentColor"
                    strokeWidth="2"
                    strokeLinecap="round"
                    strokeLinejoin="round"
                  />
                </svg>
              </a>
            )}

            {calendarUrl && (
              <a
                href={calendarUrl}
                target="_blank"
                rel="noreferrer"
                className="inline-flex items-center gap-2 rounded-full border border-blue-500/70 bg-blue-600/20 px-4 py-2 text-sm font-semibold text-blue-100 hover:bg-blue-500/30 hover:border-blue-400 transition"
              >
                <svg
                  width="16"
                  height="16"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  strokeWidth="2"
                >
                  <rect x="3" y="4" width="18" height="18" rx="2" ry="2" />
                  <line x1="16" y1="2" x2="16" y2="6" />
                  <line x1="8" y1="2" x2="8" y2="6" />
                  <line x1="3" y1="10" x2="21" y2="10" />
                </svg>
                Dodaj do kalendarza
              </a>
            )}
          </div>
        </div>

        {/* mini mapa (tylko je≈õli sƒÖ wsp√≥≈Çrzƒôdne) */}
        <div className="space-y-2">
          <div className="text-sm font-medium text-sky-100">Lokalizacja</div>
          {hasCoordinates && r.miejsce_turnieju ? (
            <div className="overflow-hidden rounded-lg border border-slate-600 bg-slate-900">
              <div className="aspect-[16/9]">
                <iframe
                  title={`Mapa ${r.nazwa}`}
                  src={`https://www.google.com/maps?q=${r.miejsce_turnieju.latitude},${r.miejsce_turnieju.longitude}&z=14&output=embed`}
                  className="h-full w-full"
                  loading="lazy"
                  referrerPolicy="no-referrer-when-downgrade"
                />
              </div>
              <div className="border-t border-slate-700 bg-slate-900/90 p-2">
                <div className="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-2">
                  <a
                    href={`https://www.google.com/maps/search/?api=1&query=${r.miejsce_turnieju.latitude},${r.miejsce_turnieju.longitude}`}
                    target="_blank"
                    rel="noreferrer"
                    className="text-xs font-medium text-sky-300 hover:text-sky-100 hover:underline"
                  >
                    Otw√≥rz w Mapach Google
                  </a>
                  <div className="flex gap-2">
                    <a
                      href={`https://www.google.com/maps/dir/?api=1&destination=${r.miejsce_turnieju.latitude},${r.miejsce_turnieju.longitude}`}
                      target="_blank"
                      rel="noreferrer"
                      className="inline-flex items-center gap-1 rounded-full bg-green-600 hover:bg-green-500 px-3 py-1 text-xs font-medium text-white transition"
                    >
                      <svg
                        width="12"
                        height="12"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        strokeWidth="2"
                      >
                        <path d="M12 2L14.09 8.26L21 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L3 9.27L9.91 8.26L12 2Z" />
                      </svg>
                      Nawiguj
                    </a>
                  </div>
                </div>
              </div>
            </div>
          ) : r.miejsce_turnieju ? (
            <div className="rounded-md border border-slate-600 bg-slate-900/80 px-3 py-2 text-sm text-sky-100/80">
              Brak wsp√≥≈Çrzƒôdnych dla miejsca: {r.miejsce_turnieju.nazwa}
            </div>
          ) : (
            <div className="rounded-md border border-slate-600 bg-slate-900/80 px-3 py-2 text-sm text-sky-100/80">
              Brak przypisanego miejsca.
            </div>
          )}
        </div>
      </div>
    </details>
  )
}

export default async function TurniejListPage() {
  const supabase = await createSupabaseServer()
  const { data: rows } = await supabase
    .from('turniej')
    .select(`
      id,
      nazwa,
      data_turnieju,
      godzina_turnieju,
      zakonczenie_turnieju,
      gsheet_url,
      arkusz_nazwa,
      limit_graczy,
      miejsce_turnieju (
        id,
        nazwa,
        miasto,
        wojewodztwo,
        adres,
        latitude,
```

### components/AutoHide.tsx

```
'use client'

import { useEffect, useState } from 'react'

export default function AutoHide({
  children,
  ms = 5000,
}: {
  children: React.ReactNode
  ms?: number
}) {
  const [show, setShow] = useState(true)
  useEffect(() => {
    const t = setTimeout(() => setShow(false), ms)
    return () => clearTimeout(t)
  }, [ms])
  if (!show) return null
  return <>{children}</>
}
```

### components/DeleteTurniej.tsx

```
// components/DeleteTurniej.tsx
'use client'

import { useRouter } from 'next/navigation'
import { useState } from 'react'

interface DeleteTurniejProps {
  id: string
  nazwa: string
}

export default function DeleteTurniej({ id, nazwa }: DeleteTurniejProps) {
  const router = useRouter()
  const [isOpen, setIsOpen] = useState(false)

  const handleDelete = async () => {
    try {
      const response = await fetch(`/admin/turniej/${id}/delete`, {
        method: 'POST',
      })

      if (response.ok) {
        router.refresh()
      } else {
        alert('B≈ÇƒÖd podczas usuwania turnieju.')
      }
    } catch (err) {
      console.error('B≈ÇƒÖd usuwania:', err)
      alert('WystƒÖpi≈Ç b≈ÇƒÖd podczas usuwania turnieju.')
    } finally {
      setIsOpen(false)
    }
  }

  return (
    <>
      <button 
        onClick={() => setIsOpen(true)}
        className="inline-flex items-center gap-1 rounded bg-red-600 hover:bg-red-500 px-3 py-1 text-xs font-medium text-white transition"
      >
        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
          <path d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
        </svg>
        Usu≈Ñ
      </button>

      {/* Modal potwierdzenia */}
      {isOpen && (
        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/70 p-4">
          <div className="w-full max-w-md rounded-2xl bg-slate-800 border border-slate-600 shadow-2xl transform transition-all">
            {/* Nag≈Ç√≥wek */}
            <div className="flex items-center gap-3 border-b border-slate-600 px-6 py-4">
              <div className="flex h-10 w-10 items-center justify-center rounded-full bg-red-500/20">
                <svg className="h-6 w-6 text-red-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z" />
                </svg>
              </div>
              <div>
                <h3 className="text-lg font-semibold text-sky-100">Potwierd≈∫ usuniƒôcie</h3>
                <p className="text-sm text-slate-400">Ta akcja jest nieodwracalna</p>
              </div>
            </div>

            {/* Tre≈õƒá */}
            <div className="px-6 py-4">
              <p className="text-sky-100 mb-2">
                Czy na pewno chcesz usunƒÖƒá turniej:
              </p>
              <p className="text-lg font-semibold text-red-300 bg-red-500/10 border border-red-500/30 rounded-lg px-4 py-3 mb-4">
                "{nazwa}"
              </p>
              <div className="flex items-center gap-2 text-sm text-slate-400 bg-slate-700/50 rounded-lg px-3 py-2">
                <svg className="h-4 w-4 text-red-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                <span>Wszystkie dane zwiƒÖzane z turniejem zostanƒÖ trwale usuniƒôte</span>
              </div>
            </div>

            {/* Przyciski akcji */}
            <div className="flex justify-end gap-3 border-t border-slate-600 px-6 py-4">
              <button
                onClick={() => setIsOpen(false)}
                className="rounded-full border border-slate-500 bg-slate-700 hover:bg-slate-600 px-6 py-2 text-sm font-medium text-sky-100 transition flex items-center gap-2"
              >
                <svg className="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                </svg>
                Anuluj
              </button>
              <button
                onClick={handleDelete}
                className="rounded-full bg-gradient-to-r from-red-600 to-red-500 hover:from-red-500 hover:to-red-400 px-6 py-2 text-sm font-medium text-white transition flex items-center gap-2 shadow-lg shadow-red-500/25"
              >
                <svg className="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                </svg>
                Tak, usu≈Ñ turniej
              </button>
            </div>
          </div>
        </div>
      )}
    </>
  )
}```

### components/LoadGoogleMaps.tsx

```
'use client'

import Script from 'next/script'

export default function LoadGoogleMaps() {
  const apiKey = process.env.NEXT_PUBLIC_GOOGLE_MAPS_API_KEY
  if (!apiKey) return null

  return (
    <Script
      id="google-maps-sdk"
      src={`https://maps.googleapis.com/maps/api/js?key=${apiKey}`}
      strategy="afterInteractive"
    />
  )
}
```

### components/MapPicker.tsx

```
// components/MapPicker.tsx
'use client'

import { useEffect, useRef, useState } from 'react'

type Props = {
  targetLatId: string
  targetLngId: string
  lat?: number | null
  lng?: number | null
  buttonLabel?: string
  onLocationChange?: (lat: number, lng: number) => void // DODANE
}

function mapsReady() {
  return typeof window !== 'undefined' && !!(window as any).google?.maps
}

export default function MapPicker({
  targetLatId,
  targetLngId,
  lat,
  lng,
  buttonLabel = 'Ustaw pinezkƒô',
  onLocationChange, // DODANE
}: Props) {
  const [open, setOpen] = useState(false)
  const [ready, setReady] = useState(mapsReady())
  const [failed, setFailed] = useState(false)

  const mapRef = useRef<HTMLDivElement>(null)
  const markerRef = useRef<google.maps.Marker | null>(null)
  const gmapRef = useRef<google.maps.Map | null>(null)

  const defaultCenter = {
    lat: typeof lat === 'number' ? lat : 52.2297,
    lng: typeof lng === 'number' ? lng : 21.0122,
  }

  // Czekamy a≈º google.maps bƒôdzie dostƒôpne
  useEffect(() => {
    if (!open || ready) return
    let tries = 0
    const t = setInterval(() => {
      tries++
      const ok = mapsReady()
      setReady(ok)
      if (ok || tries > 50) {
        clearInterval(t)
        if (!ok) setFailed(true)
      }
    }, 100)
    return () => clearInterval(t)
  }, [open, ready])

  // Inicjalizacja mapy po otwarciu i ready
  useEffect(() => {
    if (!open || !ready || !mapRef.current) return
    
    const raf = requestAnimationFrame(() => {
      try {
        const map = new google.maps.Map(mapRef.current!, {
          center: defaultCenter,
          zoom: 12,
        })
        gmapRef.current = map

        const marker = new google.maps.Marker({
          position: defaultCenter,
          map,
          draggable: true,
        })
        markerRef.current = marker

        // DODANE: Wywo≈Çaj callback z poczƒÖtkowƒÖ lokalizacjƒÖ
        if (onLocationChange) {
          onLocationChange(defaultCenter.lat, defaultCenter.lng)
        }

        map.addListener('click', (e: google.maps.MapMouseEvent) => {
          const pos = e.latLng
          if (pos) {
            marker.setPosition(pos)
            // DODANE: Wywo≈Çaj callback gdy klikniƒôto na mapƒô
            if (onLocationChange) {
              onLocationChange(pos.lat(), pos.lng())
            }
          }
        })

        // DODANE: Obs≈Çuga przeciƒÖgania markera
        marker.addListener('dragend', () => {
          const pos = marker.getPosition()
          if (pos && onLocationChange) {
            onLocationChange(pos.lat(), pos.lng())
          }
        })
      } catch (e) {
        setFailed(true)
        console.error('Map init error', e)
      }
    })
    
    return () => {
      cancelAnimationFrame(raf)
      markerRef.current?.setMap(null)
      markerRef.current = null
      gmapRef.current = null
    }
  }, [open, ready])

  function confirmPick() {
    const pos = markerRef.current?.getPosition()
    if (pos) {
      const latEl = document.getElementById(targetLatId) as HTMLInputElement | null
      const lngEl = document.getElementById(targetLngId) as HTMLInputElement | null
      if (latEl) latEl.value = String(pos.lat())
      if (lngEl) lngEl.value = String(pos.lng())
      
      // DODANE: Wywo≈Çaj callback r√≥wnie≈º przy potwierdzeniu
      if (onLocationChange) {
        onLocationChange(pos.lat(), pos.lng())
      }
    }
    setOpen(false)
  }

  return (
    <>
      <button 
        type="button" 
        className="rounded bg-sky-600 hover:bg-sky-500 px-4 py-2 text-sm font-medium text-white transition"
        onClick={() => { setFailed(false); setOpen(true) }}
      >
        {buttonLabel}
      </button>

      {open && (
        <div className="fixed inset-0 z-[100] flex items-center justify-center bg-black/50 p-4">
          <div className="w-full max-w-3xl overflow-hidden rounded-lg bg-white shadow-xl">
            <div className="flex items-center justify-between border-b px-6 py-4">
              <h3 className="text-lg font-semibold text-gray-900">Wybierz lokalizacjƒô na mapie</h3>
              <button 
                type="button" 
                className="text-gray-400 hover:text-gray-500 text-xl"
                onClick={() => setOpen(false)}
              >
                √ó
              </button>
            </div>

            {!process.env.NEXT_PUBLIC_GOOGLE_MAPS_API_KEY && (
              <div className="p-6 text-center text-red-600">
                Brak klucza Google Maps API. Skontaktuj siƒô z administratorem.
              </div>
            )}

            {!ready && !failed && (
              <div className="flex h-96 w-full items-center justify-center text-gray-600">
                <div className="text-center">
                  <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-2"></div>
                  <p>≈Åadowanie mapy...</p>
                </div>
              </div>
            )}

            {failed && (
              <div className="flex h-96 w-full flex-col items-center justify-center gap-4 p-6 text-center text-red-600">
                <p>Nie uda≈Ço siƒô za≈Çadowaƒá mapy.</p>
                <button
                  type="button"
                  className="rounded bg-blue-600 hover:bg-blue-700 px-4 py-2 text-white text-sm font-medium transition"
                  onClick={() => { setReady(mapsReady()); setFailed(false) }}
                >
                  Spr√≥buj ponownie
                </button>
              </div>
            )}

            {ready && !failed && (
              <div className="h-96 w-full" ref={mapRef} />
            )}

            <div className="flex justify-between items-center border-t px-6 py-4">
              <div className="text-sm text-gray-500">
                Kliknij na mapie, aby ustawiƒá pinezkƒô
              </div>
              <div className="flex gap-3">
                <button 
                  type="button" 
                  className="rounded border border-gray-300 bg-white hover:bg-gray-50 px-4 py-2 text-gray-700 text-sm font-medium transition"
                  onClick={() => setOpen(false)}
                >
                  Anuluj
                </button>
                <button 
                  type="button" 
                  className="rounded bg-blue-600 hover:bg-blue-700 px-4 py-2 text-white text-sm font-medium transition disabled:opacity-50"
                  onClick={confirmPick} 
                  disabled={!ready || failed}
                >
                  Zapisz
                </button>
              </div>
            </div>
          </div>
        </div>
      )}
    </>
  )
}```

### components/MiejsceForm.tsx

```
// components/MiejsceForm.tsx
'use client'

import { useState } from 'react'
import { useRouter } from 'next/navigation'
import { supabase } from '@/lib/supabase/client'

const WOJEWODZTWA = [
  'dolno≈õlƒÖskie',
  'kujawsko-pomorskie',
  'lubelskie',
  'lubuskie',
  '≈Ç√≥dzkie',
  'ma≈Çopolskie',
  'mazowieckie',
  'opolskie',
  'podkarpackie',
  'podlaskie',
  'pomorskie',
  '≈õlƒÖskie',
  '≈õwiƒôtokrzyskie',
  'warmi≈Ñsko-mazurskie',
  'wielkopolskie',
  'zachodniopomorskie',
]

type Miejsce = {
  id?: string
  nazwa: string
  miasto: string
  wojewodztwo: string | null
  adres: string | null
  latitude: number
  longitude: number
}

type Props = {
  mode: 'new' | 'edit'
  initial: Miejsce | null
}

export default function MiejsceForm({ mode, initial }: Props) {
  const router = useRouter()

  const [nazwa, setNazwa] = useState(initial?.nazwa ?? '')
  const [miasto, setMiasto] = useState(initial?.miasto ?? '')
  const [wojewodztwo, setWojewodztwo] = useState(initial?.wojewodztwo ?? '')
  const [adres, setAdres] = useState(initial?.adres ?? '')
  const [latitude, setLatitude] = useState(
    initial?.latitude ?? 52.0 // domy≈õlnie ≈õrodek PL
  )
  const [longitude, setLongitude] = useState(
    initial?.longitude ?? 19.0
  )
  const [coordinatesInput, setCoordinatesInput] = useState('')

  const [saving, setSaving] = useState(false)
  const [error, setError] = useState<string | null>(null)
  const [success, setSuccess] = useState(false)

  // Funkcja do parsowania wklejonych wsp√≥≈Çrzƒôdnych
  const handleCoordinatesPaste = () => {
    if (!coordinatesInput.trim()) return
    
    try {
      // Usu≈Ñ wszystkie nawiasy, cudzys≈Çowy i nadmiarowe spacje
      const cleanInput = coordinatesInput
        .replace(/[()"']/g, '')
        .replace(/\s+/g, ' ')
        .trim()
      
      // Podziel na czƒô≈õci po przecinku
      const parts = cleanInput.split(',').map(part => part.trim())
      
      if (parts.length !== 2) {
        setError('Proszƒô podaƒá dok≈Çadnie dwie wsp√≥≈Çrzƒôdne oddzielone przecinkiem (szeroko≈õƒá, d≈Çugo≈õƒá)')
        return
      }
      
      const lat = parseFloat(parts[0])
      const lng = parseFloat(parts[1])
      
      if (isNaN(lat) || isNaN(lng)) {
        setError('Nieprawid≈Çowy format wsp√≥≈Çrzƒôdnych. Upewnij siƒô, ≈ºe poda≈Çe≈õ liczby')
        return
      }
      
      // Sprawd≈∫ zakresy wsp√≥≈Çrzƒôdnych (przybli≈ºone dla Polski)
      if (lat < 49.0 || lat > 54.9 || lng < 14.0 || lng > 24.2) {
        setError('Wsp√≥≈Çrzƒôdne znajdujƒÖ siƒô poza obszarem Polski. Czy na pewno sƒÖ poprawne?')
        return
      }
      
      setLatitude(lat)
      setLongitude(lng)
      setCoordinatesInput('') // Wyczy≈õƒá pole po sukcesie
      setError(null)
    } catch (err) {
      setError('WystƒÖpi≈Ç b≈ÇƒÖd podczas przetwarzania wsp√≥≈Çrzƒôdnych')
    }
  }

  function resetForm() {
    setNazwa('')
    setMiasto('')
    setWojewodztwo('')
    setAdres('')
    setLatitude(52.0)
    setLongitude(19.0)
    setCoordinatesInput('')
    setError(null)
    setSuccess(false)
  }

  async function handleSubmit(e: React.FormEvent) {
    e.preventDefault()
    setSaving(true)
    setError(null)
    setSuccess(false)

    const payload = {
      nazwa,
      miasto,
      wojewodztwo: wojewodztwo || null,
      adres: adres || null,
      latitude,
      longitude,
    }

    try {
      const table = supabase.from('miejsce_turnieju')
      let resp
      
      if (mode === 'new') {
        resp = await table.insert(payload)
      } else {
        resp = await table.update(payload).eq('id', initial!.id)
      }

      if (resp.error) {
        console.error(resp.error)
        setError('Nie uda≈Ço siƒô zapisaƒá miejsca turnieju.')
        setSaving(false)
        return
      }

      // Sukces - r√≥≈ºne zachowanie dla trybu new/edit
      if (mode === 'new') {
        setSuccess(true)
        resetForm() // Resetuj formularz dla nowego wpisu
      } else {
        router.push('/admin/miejsca')
      }
    } catch (err: any) {
      console.error(err)
      setError('WystƒÖpi≈Ç nieoczekiwany b≈ÇƒÖd podczas zapisywania.')
    } finally {
      setSaving(false)
    }
  }

  return (
    <form
      onSubmit={handleSubmit}
      className="space-y-6 rounded-2xl border border-slate-700 bg-slate-800/95 p-6 shadow-[0_14px_40px_rgba(0,0,0,0.8)]"
    >
      <h1 className="mb-2 text-2xl font-semibold text-sky-50">
        {mode === 'new' ? 'Dodaj miejsce turnieju' : 'Edytuj miejsce turnieju'}
      </h1>
      <p className="text-sm text-slate-400">
        Zdefiniuj lokalizacjƒô, kt√≥ra mo≈ºe byƒá wykorzystywana przez wiele turniej√≥w.
      </p>

      {/* Komunikat sukcesu */}
      {success && (
        <div className="rounded-md border border-green-400/50 bg-green-500/10 px-4 py-3">
          <div className="flex items-center">
            <div className="flex-shrink-0">
              <svg className="h-5 w-5 text-green-400" viewBox="0 0 20 20" fill="currentColor">
                <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clipRule="evenodd" />
              </svg>
            </div>
            <div className="ml-3">
              <p className="text-sm font-medium text-green-200">
                Miejsce zosta≈Ço pomy≈õlnie dodane!
              </p>
              <p className="mt-1 text-sm text-green-300">
                Mo≈ºesz dodaƒá kolejne miejsce poni≈ºej.
              </p>
            </div>
            <div className="ml-auto pl-3">
              <div className="-mx-1.5 -my-1.5">
                <button
                  type="button"
                  onClick={() => setSuccess(false)}
                  className="inline-flex rounded-md bg-green-500/10 p-1.5 text-green-400 hover:bg-green-500/20"
                >
                  <span className="sr-only">Zamknij</span>
                  <svg className="h-3 w-3" viewBox="0 0 20 20" fill="currentColor">
                    <path fillRule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clipRule="evenodd" />
                  </svg>
                </button>
              </div>
            </div>
          </div>
        </div>
      )}

      {/* Komunikat b≈Çƒôdu */}
      {error && (
        <div className="rounded-md border border-red-400/50 bg-red-500/10 px-4 py-3 text-sm text-red-200">
          {error}
        </div>
      )}

      {/* Nazwa */}
      <div className="space-y-1">
        <label className="text-sm font-medium text-slate-100">
          Nazwa miejsca
        </label>
        <input
          className="w-full rounded-md border border-slate-600 bg-slate-900/60 px-3 py-2 text-sm text-sky-50"
          value={nazwa}
          onChange={(e) => setNazwa(e.target.value)}
          placeholder="np. SP 5 w Poznaniu, Klub X"
          required
        />
      </div>

      {/* Miasto + wojew√≥dztwo */}
      <div className="grid gap-4 md:grid-cols-2">
        <div className="space-y-1">
          <label className="text-sm font-medium text-slate-100">
            Miasto
          </label>
          <input
            className="w-full rounded-md border border-slate-600 bg-slate-900/60 px-3 py-2 text-sm text-sky-50"
            value={miasto}
            onChange={(e) => setMiasto(e.target.value)}
            placeholder="np. Pozna≈Ñ"
            required
          />
        </div>

        <div className="space-y-1">
          <label className="text-sm font-medium text-slate-100">
            Wojew√≥dztwo
          </label>
          <select
            className="w-full rounded-md border border-slate-600 bg-slate-900/60 px-3 py-2 text-sm text-sky-50"
            value={wojewodztwo ?? ''}
            onChange={(e) => setWojewodztwo(e.target.value)}
          >
            <option value="">‚Äî wybierz wojew√≥dztwo (opcjonalne) ‚Äî</option>
            {WOJEWODZTWA.map((w) => (
              <option key={w} value={w}>
                {w}
              </option>
            ))}
          </select>
        </div>
      </div>

      {/* Adres */}
      <div className="space-y-1">
        <label className="text-sm font-medium text-slate-100">
          Adres (opcjonalnie)
        </label>
        <textarea
          className="w-full rounded-md border border-slate-600 bg-slate-900/60 px-3 py-2 text-sm text-sky-50"
          rows={2}
          value={adres ?? ''}
          onChange={(e) => setAdres(e.target.value)}
          placeholder="np. ul. Szkolna 10, 60-123 Pozna≈Ñ"
        />
      </div>

      {/* Wsp√≥≈Çrzƒôdne - BEZ MAPY */}
      <div className="rounded-xl border border-slate-700 bg-slate-900/40 p-4 space-y-4">
        <div className="flex items-center justify-between gap-2">
          <h2 className="text-sm font-semibold text-sky-100">
            Wsp√≥≈Çrzƒôdne geograficzne
          </h2>
          <span className="text-xs text-slate-400">
            wprowad≈∫ rƒôcznie lub wklej wsp√≥≈Çrzƒôdne
          </span>
        </div>

        {/* Pole do wklejania wsp√≥≈Çrzƒôdnych */}
        <div className="space-y-2">
          <label className="text-xs font-medium text-slate-300">
            Wklej wsp√≥≈Çrzƒôdne (szeroko≈õƒá, d≈Çugo≈õƒá)
          </label>
          <div className="flex gap-2">
            <input
              type="text"
              className="flex-1 rounded-md border border-slate-600 bg-slate-900/60 px-3 py-2 text-sm text-sky-50"
              value={coordinatesInput}
              onChange={(e) => setCoordinatesInput(e.target.value)}
              placeholder=""
            />
            <button
              type="button"
              onClick={handleCoordinatesPaste}
              className="rounded bg-sky-600 hover:bg-sky-500 px-4 py-2 text-sm font-medium text-white transition"
            >
              Zastosuj
            </button>
          </div>
          <p className="text-xs text-slate-400">
            Wklej wsp√≥≈Çrzƒôdne w formacie "szeroko≈õƒá, d≈Çugo≈õƒá" - automatycznie zostanƒÖ przypisane do p√≥l poni≈ºej
          </p>
        </div>

        {/* Inputy liczbowe do rƒôcznego wprowadzania wsp√≥≈Çrzƒôdnych */}
        <div className="grid gap-4 md:grid-cols-2">
          <div className="space-y-1">
            <label className="text-xs font-medium text-slate-300">
              Szeroko≈õƒá geograficzna (latitude)
            </label>
            <input
              id="latitude-input"
              type="number"
              step="0.000001"
              className="w-full rounded-md border border-slate-600 bg-slate-900/60 px-3 py-2 text-sm text-sky-50"
              value={latitude}
              onChange={(e) => setLatitude(Number(e.target.value))}
              required
            />
          </div>
          <div className="space-y-1">
            <label className="text-xs font-medium text-slate-300">
              D≈Çugo≈õƒá geograficzna (longitude)
            </label>
            <input
              id="longitude-input"
              type="number"
              step="0.000001"
              className="w-full rounded-md border border-slate-600 bg-slate-900/60 px-3 py-2 text-sm text-sky-50"
              value={longitude}
              onChange={(e) => setLongitude(Number(e.target.value))}
              required
            />
          </div>
        </div>

        <p className="text-xs text-slate-400">
          Wprowad≈∫ wsp√≥≈Çrzƒôdne rƒôcznie lub wklej je w powy≈ºszym polu.
        </p>
      </div>

      {/* Przyciski */}
      <div className="flex justify-between gap-3 pt-4">
        <div className="flex gap-3">
          {mode === 'new' && (
            <button
              type="button"
              onClick={resetForm}
              className="rounded-full border border-slate-500 px-5 py-2 text-sm text-slate-100 hover:bg-slate-700/60"
            >
              Wyczy≈õƒá formularz
            </button>
          )}
        </div>
        
        <div className="flex gap-3">
          <button
            type="button"
            className="rounded-full border border-slate-500 px-5 py-2 text-sm text-slate-100 hover:bg-slate-700/60"
            onClick={() => router.push('/admin/miejsca')}
          >
            {mode === 'new' ? 'Wr√≥ƒá do listy' : 'Anuluj'}
          </button>
          <button
            type="submit"
            disabled={saving}
            className="rounded-full bg-sky-600 px-6 py-2 text-sm font-semibold text-white hover:bg-sky-500 disabled:opacity-60"
          >
            {saving
              ? 'Zapisywanie...'
              : mode === 'new'
              ? 'Dodaj miejsce'
              : 'Zapisz zmiany'}
          </button>
        </div>
      </div>
    </form>
  )
}```

### components/Navbar.tsx

```
'use client'

import Link from 'next/link'
import { useEffect, useState } from 'react'
import { usePathname } from 'next/navigation'

type UserLite = { id: string; email?: string | null } | null
type Role = 'admin' | 'organizer' | 'user' | null


export default function Navbar({ user, role }: { user: UserLite; role: Role }) {
  const [open, setOpen] = useState(false)
  const pathname = usePathname()

  useEffect(() => { setOpen(false) }, [pathname])

  const NavLink = ({ href, children }: { href: string; children: React.ReactNode }) => {
    const active = pathname === href
    return (
      <Link
        href={href}
        className={[
          'relative px-3 py-2 text-sm font-medium transition',
          'text-sky-200/80 hover:text-sky-300',
          active ? 'text-sky-300' : '',
        ].join(' ')}
      >
        {children}
        {active && (
          <span className="absolute inset-x-2 -bottom-1 h-0.5 rounded-full bg-sky-400" />
        )}
      </Link>
    )
  }

  const inputStyle =
    'h-9 rounded-lg border border-slate-600 bg-slate-900/70 px-3 text-xs text-sky-50 ' +
    'placeholder:text-slate-400 shadow-sm focus:outline-none focus:ring-1 focus:ring-sky-400'

  const buttonPrimary =
    'h-9 rounded-full bg-gradient-to-r from-sky-500 to-sky-600 px-5 text-sm font-semibold text-white ' +
    'shadow-[0_5px_18px_rgba(15,23,42,0.8)] transition ' +
    'hover:from-sky-400 hover:to-sky-500 hover:shadow-[0_7px_22px_rgba(15,23,42,1)]'

  const buttonSecondary =
    'h-9 rounded-full bg-slate-900/70 border border-sky-600 px-5 text-sm font-semibold text-sky-100 ' +
    'shadow-sm hover:bg-slate-800 hover:border-sky-400 transition'

  return (
    <header className="sticky top-0 z-50">
      {/* Pasek akcentu */}
      <div className="h-1 w-full bg-gradient-to-r from-sky-500 via-sky-400 to-sky-500" />

      <nav className="
        w-full 
        bg-slate-900/95
        backdrop-blur-md
        border-b border-slate-700
        shadow-[0_8px_25px_rgba(0,0,0,0.7)]
      ">
        <div className="mx-auto flex max-w-7xl items-center justify-between px-6 py-3">

          {/* LEWA STRONA */}
          <div className="flex items-center gap-4">
            <Link href="/" className="flex items-center gap-2">
              <span className="inline-flex h-8 w-8 items-center justify-center rounded-lg 
                bg-sky-500 text-slate-900 font-bold shadow-md">
                EA
              </span>
            </Link>

            <div className="hidden md:flex items-center gap-3">
              <NavLink href="/turniej">Turnieje</NavLink>

              {!user && <NavLink href="/auth/signup">Rejestracja</NavLink>}

              {user && <NavLink href="/profile">Profil</NavLink>}
              {role === 'admin' && <NavLink href="/admin">Admin</NavLink>}
            </div>
          </div>

          {/* PRAWA STRONA */}
          <div className="hidden md:flex items-center gap-3">

            {user ? (
              <>
                <span className="inline-flex h-9 items-center truncate rounded-full 
                  border border-sky-600 bg-slate-800/70 px-4 text-xs font-medium text-sky-200">
                  <span className="opacity-70">Zalogowano:</span>&nbsp;{user.email}
                </span>

                <form action="/auth/signout" method="post">
                  <button className={buttonSecondary}>
                    Wyloguj
                  </button>
                </form>
              </>
            ) : (
              <form
  action="/auth/signin/submit"
  method="post"
  className="flex items-center gap-2"
  autoComplete="off"
>

  {/* Fake input ‚Äì przechwytuje autouzupe≈Çnianie */}
  <input type="text" autoComplete="username" className="hidden" />
  <input type="password" autoComplete="current-password" className="hidden" />

  <input
    name="identifier"
    placeholder="E-mail lub login"
    autoComplete="email"
    className={inputStyle}
  />

  <input
    type="password"
    name="password"
    placeholder="Has≈Ço"
    autoComplete="new-password"
    className={inputStyle}
  />

  <button className={buttonPrimary}>Zaloguj</button>
</form>

            )}

          </div>

          {/* BURGER MOBILE */}
          <button
            className="md:hidden inline-flex h-10 w-10 items-center justify-center 
            rounded-md border border-sky-600 bg-slate-800/70 text-sky-200"
            onClick={() => setOpen((v) => !v)}
          >
            <svg width="22" height="22" viewBox="0 0 24 24" stroke="currentColor">
              <path d="M4 6h16M4 12h16M4 18h16" strokeWidth="2" strokeLinecap="round" />
            </svg>
          </button>
        </div>

        {/* MENU MOBILE */}
        {open && (
          <div className="md:hidden border-t border-sky-700 bg-slate-900/95 px-4 py-3 space-y-2">

            <NavLink href="/turniej">Turnieje</NavLink>
            {!user && <NavLink href="/auth/signup">Rejestracja</NavLink>}
            {user && <NavLink href="/profile">Profil</NavLink>}
            {role === 'admin' && <NavLink href="/admin">Admin</NavLink>}

            <div className="border-t border-sky-700 my-3" />

            {user ? (
              <form action="/auth/signout" method="post">
                <button className={`${buttonPrimary} w-full justify-center`}>
                  Wyloguj
                </button>
              </form>
            ) : (
              <Link href="/auth/signin" className={`${buttonPrimary} w-full justify-center`}>
                Zaloguj
              </Link>
            )}

          </div>
        )}

      </nav>
    </header>
  )
}
```

### components/SheetPicker.tsx

```
'use client'

import { useState } from 'react'

type Props = {
  urlInputId: string        // id inputa z linkiem do Google Sheets
  sheetInputId: string      // id inputa, do kt√≥rego wpiszemy nazwƒô karty
  gidHiddenInputId?: string // (opcjonalnie) id ukrytego inputa na gid
}

export default function SheetPicker({ urlInputId, sheetInputId, gidHiddenInputId }: Props) {
  const [loading, setLoading] = useState(false)
  const [error, setError] = useState<string | null>(null)
  const [sheets, setSheets] = useState<{ name: string; gid: string | null }[]>([])
  const [selected, setSelected] = useState<string>('')

  async function fetchSheets() {
    setError(null)
    setSheets([])
    setSelected('')
    const urlEl = document.getElementById(urlInputId) as HTMLInputElement | null
    if (!urlEl || !urlEl.value) {
      setError('Wklej najpierw link do Google Sheets.')
      return
    }
    setLoading(true)
    try {
      const res = await fetch(`/api/gsheets/list?url=${encodeURIComponent(urlEl.value)}`, { cache: 'no-store' })
      const data = await res.json()
      if (!res.ok) throw new Error(data?.error || 'fetch_failed')
      setSheets(data.sheets || [])
      if ((data.sheets || []).length === 0) {
        setError('Nie znaleziono arkuszy. Upewnij siƒô, ≈ºe dokument jest publiczny/opublikowany.')
      }
    } catch (e: any) {
      setError('Nie uda≈Ço siƒô pobraƒá listy arkuszy.')
    } finally {
      setLoading(false)
    }
  }

  function applySelection(name: string) {
    setSelected(name)
    const sheetEl = document.getElementById(sheetInputId) as HTMLInputElement | null
    if (sheetEl) sheetEl.value = name
    // je≈õli mamy hidden na gid, ustaw go dla wygody (je≈õli wybrany ma gid)
    if (gidHiddenInputId) {
      const gidEl = document.getElementById(gidHiddenInputId) as HTMLInputElement | null
      const found = sheets.find(s => s.name === name)
      if (gidEl) gidEl.value = found?.gid ?? ''
    }
  }

  return (
    <div className="flex flex-col gap-2">
      <div className="flex items-center gap-2">
        <button type="button" className="pill pill--secondary" onClick={fetchSheets} disabled={loading}>
          {loading ? 'Pobieranie‚Ä¶' : 'Pobierz arkusze'}
        </button>
        {error && <span className="text-xs text-red-700">{error}</span>}
      </div>

      {sheets.length > 0 && (
        <div className="flex items-center gap-2">
          <select
            className="rounded border px-3 py-2"
            value={selected}
            onChange={(e) => applySelection(e.target.value)}
          >
            <option value="" disabled>‚Äî wybierz kartƒô ‚Äî</option>
            {sheets.map((s) => (
              <option key={`${s.name}-${s.gid ?? 'nogid'}`} value={s.name}>
                {s.name}{s.gid ? ` (gid: ${s.gid})` : ''}
              </option>
            ))}
          </select>
          <span className="text-xs text-slate-600">Zapisze nazwƒô do pola ‚ÄûNazwa karty‚Äù.</span>
        </div>
      )}
    </div>
  )
}
```

### eslint.config.mjs

```
import { defineConfig, globalIgnores } from "eslint/config";
import nextVitals from "eslint-config-next/core-web-vitals";
import nextTs from "eslint-config-next/typescript";

const eslintConfig = defineConfig([
  ...nextVitals,
  ...nextTs,
  // Override default ignores of eslint-config-next.
  globalIgnores([
    // Default ignores of eslint-config-next:
    ".next/**",
    "out/**",
    "build/**",
    "next-env.d.ts",
  ]),
]);

export default eslintConfig;
```

### lib/supabase/admin.ts

```
import { createClient } from '@supabase/supabase-js'

export const supabaseAdmin = createClient(
  process.env.NEXT_PUBLIC_SUPABASE_URL!,
  process.env.SUPABASE_SERVICE_ROLE!,   // tylko na serwerze!
  { auth: { persistSession: false } }
)
```

### lib/supabase/client.ts

```
'use client'
import { createBrowserClient } from '@supabase/ssr'
export const supabase = createBrowserClient(
  process.env.NEXT_PUBLIC_SUPABASE_URL!,
  process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!
)
```

### lib/supabase/server-mutable.ts

```
// lib/supabase/server-mutable.ts
import { cookies } from 'next/headers'
import { createServerClient, type CookieOptions } from '@supabase/ssr'

export async function createSupabaseServerMutable() {
  const store = await cookies()

  return createServerClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,
    {
      cookies: {
        get(name: string) {
          return store.get(name)?.value
        },
        set(name: string, value: string, options?: CookieOptions) {
          store.set({ name, value, ...options })
        },
        remove(name: string, options?: CookieOptions) {
          store.set({ name, value: '', ...options, maxAge: 0 })
        },
      },
    }
  )
}
```

### lib/supabase/server.ts

```
// lib/supabase/server.ts
import { cookies } from 'next/headers'
import { createServerClient, type CookieOptions } from '@supabase/ssr'

export async function createSupabaseServer() {
  // NEXT 15: cookies() jest async
  const store = await cookies()

  return createServerClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,
    {
      cookies: {
        get(name: string) {
          return store.get(name)?.value
        },
        // w RSC nie modyfikujemy cookies
        set(_name: string, _value: string, _options?: CookieOptions) {},
        remove(_name: string, _options?: CookieOptions) {},
      },
    }
  )
}
```

### next.config.ts

```
import type { NextConfig } from "next";

const nextConfig: NextConfig = {
  /* config options here */
  reactCompiler: true,
};

export default nextConfig;
```

### package.json

```
{
  "name": "elo-arena",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "eslint"
  },
  "dependencies": {
    "@supabase/ssr": "^0.7.0",
    "@supabase/supabase-js": "^2.80.0",
    "@vercel/analytics": "^1.5.0",
    "next": "16.0.1",
    "react": "19.2.0",
    "react-dom": "19.2.0"
  },
  "devDependencies": {
    "@types/google.maps": "^3.58.1",
    "@types/node": "^20",
    "@types/react": "^19",
    "@types/react-dom": "^19",
    "autoprefixer": "^10.4.21",
    "babel-plugin-react-compiler": "1.0.0",
    "eslint": "^9",
    "eslint-config-next": "16.0.1",
    "postcss": "^8.5.6",
    "tailwindcss": "^3.4.18",
    "typescript": "^5"
  }
}
```

### postcss.config.js

```
module.exports = {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
}
```

### tailwind.config.js

```
/** @type {import('tailwindcss').Config} */
module.exports = {
  content: [
    './app/**/*.{js,ts,jsx,tsx,mdx}',
    './components/**/*.{js,ts,jsx,tsx,mdx}',
    './pages/**/*.{js,ts,jsx,tsx,mdx}',
  ],
  theme: { extend: {} },
  plugins: [],
}
```

### tsconfig.json

```
{
  "compilerOptions": {
    "target": "ES2017",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "react-jsx",
    "incremental": true,
    "plugins": [
      {
        "name": "next"
      }
    ],
    "paths": {
      "@/*": ["./*"]
    }
  },
  "include": [
    "next-env.d.ts",
    "**/*.ts",
    "**/*.tsx",
    ".next/types/**/*.ts",
    ".next/dev/types/**/*.ts",
    "**/*.mts"
  ],
  "exclude": ["node_modules"]
}
```

