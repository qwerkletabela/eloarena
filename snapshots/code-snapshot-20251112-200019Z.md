# Code snapshot (2025-11-12T20:00:18Z)

## Git

```
commit 873942eaa71aa90f57e51a78d2170b5b780639fc
Author:     MichaÅ‚ <qwerkle.tabela@gmail.com>
AuthorDate: Wed Nov 12 21:00:05 2025 +0100
Commit:     MichaÅ‚ <qwerkle.tabela@gmail.com>
CommitDate: Wed Nov 12 21:00:05 2025 +0100

    feat(turniej/new): add Lat/Lng inputs and 'Dodaj pinezkÄ™' (Google Map modal) to create form
```

## Tree

```
total 320
drwxr-xr-x 9 runner runner   4096 Nov 12 20:00 .
drwxr-xr-x 3 runner runner   4096 Nov 12 20:00 ..
drwxr-xr-x 7 runner runner   4096 Nov 12 20:00 .git
drwxr-xr-x 3 runner runner   4096 Nov 12 20:00 .github
-rw-r--r-- 1 runner runner    480 Nov 12 20:00 .gitignore
-rw-r--r-- 1 runner runner   1450 Nov 12 20:00 README.md
drwxr-xr-x 8 runner runner   4096 Nov 12 20:00 app
-rw-r--r-- 1 runner runner    396 Nov 12 20:00 code-snapshot.md
drwxr-xr-x 2 runner runner   4096 Nov 12 20:00 components
-rw-r--r-- 1 runner runner   3364 Nov 12 20:00 db.txt
-rw-r--r-- 1 runner runner    465 Nov 12 20:00 eslint.config.mjs
drwxr-xr-x 3 runner runner   4096 Nov 12 20:00 lib
-rw-r--r-- 1 runner runner    156 Nov 12 20:00 next.config.ts
-rw-r--r-- 1 runner runner 249796 Nov 12 20:00 package-lock.json
-rw-r--r-- 1 runner runner    746 Nov 12 20:00 package.json
-rw-r--r-- 1 runner runner     82 Nov 12 20:00 postcss.config.js
drwxr-xr-x 2 runner runner   4096 Nov 12 20:00 public
drwxr-xr-x 2 runner runner   4096 Nov 12 20:00 snapshots
-rw-r--r-- 1 runner runner    246 Nov 12 20:00 tailwind.config.js
-rw-r--r-- 1 runner runner    666 Nov 12 20:00 tsconfig.json

app/
app/api/resolve-email/route.ts
app/admin/turniej/page.tsx
app/admin/users/page.tsx
app/admin/page.tsx
app/globals.css
app/turniej/new/page.tsx
app/turniej/create/route.ts
app/turniej/page.tsx
app/auth/signout/route.ts
app/auth/login/route.ts
app/auth/signin/page.tsx
app/auth/signup/page.tsx
app/profile/update/route.ts
app/profile/page.tsx
app/layout.tsx
app/onboarding/username-form.tsx
app/onboarding/page.tsx
app/favicon.ico
app/page.tsx

components/
components/MapPicker.tsx
components/Navbar.tsx

lib/
lib/supabase/server-mutable.ts
lib/supabase/server.ts
lib/supabase/admin.ts
lib/supabase/client.ts
```

## Files

### app/admin/page.tsx

```
import { createSupabaseServer } from '@/lib/supabase/server'
import { redirect } from 'next/navigation'
import Link from 'next/link'

export const dynamic = 'force-dynamic'
export const revalidate = 0

export default async function AdminPage() {
  const supabase = await createSupabaseServer()
  const { data: { user } } = await supabase.auth.getUser()
  if (!user) redirect('/auth/signin')

  const { data: isAdmin } = await supabase.rpc('is_admin')
  if (!isAdmin) redirect('/')

  return (
    <main className="mx-auto max-w-5xl p-6 space-y-8">
      <header>
        <h1 className="text-2xl font-semibold">Panel admina</h1>
        <p className="mt-1 text-sm text-slate-600">Szybkie akcje i zarzÄ…dzanie.</p>
      </header>

      {/* Sekcja: ZarzÄ…dzaj uÅ¼ytkownikami */}
      <section className="space-y-3">
        <h2 className="text-lg font-semibold">ZarzÄ…dzaj uÅ¼ytkownikami</h2>
        <div className="flex flex-wrap gap-3">
          <Link href="/admin/users" className="pill pill--secondary">Lista uÅ¼ytkownikÃ³w</Link>
        </div>
      </section>

      {/* Sekcja: Turnieje */}
      <section className="space-y-3">
        <h2 className="text-lg font-semibold">Turnieje</h2>
        <div className="flex flex-wrap gap-3">
          <Link href="/admin/turniej" className="pill pill--secondary">Lista turniejÃ³w</Link>
          <Link href="/turniej/new" className="pill pill--primary">Dodaj turniej</Link>

        </div>
      </section>
      
    </main>
  )
}
```

### app/admin/turniej/[id]/edit/page.tsx

```
import { redirect } from 'next/navigation'
import { createSupabaseServer } from '@/lib/supabase/server'
import Link from 'next/link'
import MapPicker from '@/components/MapPicker'

export const dynamic = 'force-dynamic'
export const revalidate = 0

type Params = Promise<{ id: string }>
type SearchParams = Promise<Record<string, string | string[] | undefined>>

export default async function EditTurniejPage({ params, searchParams }: { params: Params, searchParams: SearchParams }) {
  const { id } = await params
  const sp = await searchParams
  const ok = sp.ok === '1'
  const err = typeof sp.e === 'string' ? sp.e : undefined

  const supabase = await createSupabaseServer()
  const { data: { user } } = await supabase.auth.getUser()
  if (!user) redirect('/auth/signin')
  const { data: isAdmin } = await supabase.rpc('is_admin')
  if (!isAdmin) redirect('/')

  const { data: t } = await supabase
    .from('turniej')
    .select('*')
    .eq('id', id)
    .maybeSingle()

  if (!t) redirect('/admin/turniej')

  return (
    <main className="mx-auto max-w-2xl p-6 space-y-6">
      <div className="flex items-center justify-between">
        <h1 className="text-2xl font-semibold">Edytuj: {t.nazwa}</h1>
        <Link href="/admin/turniej" className="pill pill--secondary">â† Lista</Link>
      </div>

      {ok && <div className="rounded-md border border-green-200 bg-green-50 px-3 py-2 text-sm text-green-700">Zapisano.</div>}
      {err && <div className="rounded-md border border-red-200 bg-red-50 px-3 py-2 text-sm text-red-700">Nie udaÅ‚o siÄ™ zapisaÄ‡.</div>}

      <form action={`/admin/turniej/${t.id}/update`} method="post" className="space-y-5">
        <div>
          <label className="block text-sm font-medium">Nazwa *</label>
          <input name="nazwa" defaultValue={t.nazwa ?? ''} required className="mt-1 w-full rounded border px-3 py-2" />
        </div>

        <div className="grid grid-cols-1 gap-4 sm:grid-cols-2">
          <div>
            <label className="block text-sm font-medium">Data *</label>
            <input type="date" name="data_turnieju" defaultValue={t.data_turnieju ?? ''} required className="mt-1 w-full rounded border px-3 py-2" />
          </div>
          <div>
            <label className="block text-sm font-medium">Godzina *</label>
            <input type="time" name="godzina_turnieju" defaultValue={t.godzina_turnieju ?? ''} required className="mt-1 w-full rounded border px-3 py-2" />
          </div>
        </div>

        <div>
          <label className="block text-sm font-medium">Link do arkusza Google</label>
          <input name="gsheet_url" defaultValue={t.gsheet_url ?? ''} className="mt-1 w-full rounded border px-3 py-2" placeholder="https://docs.google.com/..." />
        </div>

        <div className="grid grid-cols-1 gap-4 sm:grid-cols-3">
          <div className="sm:col-span-2">
            <label className="block text-sm font-medium">ID arkusza</label>
            <input name="gsheet_id" defaultValue={t.gsheet_id ?? ''} className="mt-1 w-full rounded border px-3 py-2" />
          </div>
          <div>
            <label className="block text-sm font-medium">Nazwa karty</label>
            <input name="arkusz_nazwa" defaultValue={t.arkusz_nazwa ?? ''} className="mt-1 w-full rounded border px-3 py-2" />
          </div>
        </div>

        <div className="grid grid-cols-1 gap-4 sm:grid-cols-3">
          <div>
            <label className="block text-sm font-medium">Kolumna nazwisk</label>
            <input name="kolumna_nazwisk" defaultValue={t.kolumna_nazwisk ?? ''} className="mt-1 w-full rounded border px-3 py-2" placeholder="np. B" maxLength={2} />
          </div>
          <div>
            <label className="block text-sm font-medium">Pierwszy wiersz</label>
            <input type="number" name="pierwszy_wiersz_z_nazwiskiem" defaultValue={t.pierwszy_wiersz_z_nazwiskiem ?? 2} min={1} className="mt-1 w-full rounded border px-3 py-2" />
          </div>
          <div>
            <label className="block text-sm font-medium">Limit graczy</label>
            <input type="number" name="limit_graczy" defaultValue={t.limit_graczy ?? ''} min={1} className="mt-1 w-full rounded border px-3 py-2" />
          </div>
        </div>

        {/* LAT/LNG + przycisk MapPicker */}
        {/* LAT/LNG + przycisk MapPicker */}
<div className="grid grid-cols-1 gap-4 sm:grid-cols-3">
  <div>
    <label className="block text-sm font-medium">Lat</label>
    <input id="lat" name="lat" defaultValue={t.lat ?? ''} className="mt-1 w-full rounded border px-3 py-2" />
  </div>
  <div>
    <label className="block text-sm font-medium">Lng</label>
    <input id="lng" name="lng" defaultValue={t.lng ?? ''} className="mt-1 w-full rounded border px-3 py-2" />
  </div>
  <div className="flex items-end">
    <MapPicker
      targetLatId="lat"
      targetLngId="lng"
      lat={t.lat ?? null}
      lng={t.lng ?? null}
      buttonLabel="Ustaw pinezkÄ™"
    />
  </div>
</div>


        <div className="flex gap-2 pt-2">
          <button className="pill pill--primary" type="submit">Zapisz</button>
          <Link href="/admin/turniej" className="pill pill--secondary">Anuluj</Link>
        </div>
      </form>
    </main>
  )
}
```

### app/admin/turniej/[id]/update/route.ts

```
import { NextRequest, NextResponse } from 'next/server'
import { createSupabaseServerMutable } from '@/lib/supabase/server-mutable'

const urlRe = /^https?:\/\/\S+$/i
const sheetColRe = /^[A-Za-z]$/
const UUID_RE = /^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i

export async function POST(req: NextRequest, ctx: { params: Promise<{ id: string }> }) {
  const origin = req.nextUrl.origin
  const { id } = await ctx.params
  if (!id || !UUID_RE.test(id)) {
    return NextResponse.redirect(new URL('/admin/turniej?e=invalid_id', origin), { status: 303 })
  }

  const supabase = await createSupabaseServerMutable()
  const { data: { user } } = await supabase.auth.getUser()
  if (!user) return NextResponse.redirect(new URL('/auth/signin', origin), { status: 303 })
  const { data: isAdmin } = await supabase.rpc('is_admin')
  if (!isAdmin) return NextResponse.redirect(new URL('/', origin), { status: 303 })

  const fd = await req.formData()
  const nazwa = String(fd.get('nazwa') || '').trim()
  const data_turnieju = String(fd.get('data_turnieju') || '').trim()
  const godzina_turnieju = String(fd.get('godzina_turnieju') || '').trim()

  const gsheet_url = (String(fd.get('gsheet_url') || '').trim()) || null
  const gsheet_id = (String(fd.get('gsheet_id') || '').trim()) || null
  const arkusz_nazwa = (String(fd.get('arkusz_nazwa') || '').trim()) || null

  const kolumna_nazwisk_raw = String(fd.get('kolumna_nazwisk') || '').trim()
  const kolumna_nazwisk = kolumna_nazwisk_raw ? kolumna_nazwisk_raw.toUpperCase() : null

  const pierwszy_wiersz_raw = fd.get('pierwszy_wiersz_z_nazwiskiem')
  const pierwszy_wiersz_z_nazwiskiem = pierwszy_wiersz_raw ? Number(pierwszy_wiersz_raw) : null

  const limit_graczy_raw = fd.get('limit_graczy')
  const limit_graczy = limit_graczy_raw !== null && String(limit_graczy_raw) !== '' ? Number(limit_graczy_raw) : null

  const lat_raw = fd.get('lat')
  const lng_raw = fd.get('lng')
  const lat = lat_raw !== null && String(lat_raw) !== '' ? Number(lat_raw) : null
  const lng = lng_raw !== null && String(lng_raw) !== '' ? Number(lng_raw) : null

  if (!nazwa || !data_turnieju || !godzina_turnieju) {
    return NextResponse.redirect(new URL(`/admin/turniej/${id}/edit?e=invalid_input`, origin), { status: 303 })
  }
  if (kolumna_nazwisk && !sheetColRe.test(kolumna_nazwisk)) {
    return NextResponse.redirect(new URL(`/admin/turniej/${id}/edit?e=sheet_col_invalid`, origin), { status: 303 })
  }
  if (pierwszy_wiersz_z_nazwiskiem !== null && (!Number.isFinite(pierwszy_wiersz_z_nazwiskiem) || pierwszy_wiersz_z_nazwiskiem < 1)) {
    return NextResponse.redirect(new URL(`/admin/turniej/${id}/edit?e=number_invalid`, origin), { status: 303 })
  }
  if (limit_graczy !== null && (!Number.isFinite(limit_graczy) || limit_graczy < 1)) {
    return NextResponse.redirect(new URL(`/admin/turniej/${id}/edit?e=number_invalid`, origin), { status: 303 })
  }
  if (gsheet_url && !urlRe.test(gsheet_url)) {
    return NextResponse.redirect(new URL(`/admin/turniej/${id}/edit?e=url_invalid`, origin), { status: 303 })
  }
  if (lat !== null && !Number.isFinite(lat)) {
    return NextResponse.redirect(new URL(`/admin/turniej/${id}/edit?e=number_invalid`, origin), { status: 303 })
  }
  if (lng !== null && !Number.isFinite(lng)) {
    return NextResponse.redirect(new URL(`/admin/turniej/${id}/edit?e=number_invalid`, origin), { status: 303 })
  }

  const updates: Record<string, any> = {
    nazwa, data_turnieju, godzina_turnieju,
    gsheet_url, gsheet_id, arkusz_nazwa,
    kolumna_nazwisk, pierwszy_wiersz_z_nazwiskiem,
    limit_graczy, lat, lng,
  }

  const { error } = await supabase.from('turniej').update(updates).eq('id', id)
  if (error) {
    console.error('update turniej error', error)
    return NextResponse.redirect(new URL(`/admin/turniej/${id}/edit?e=save_failed`, origin), { status: 303 })
  }

  return NextResponse.redirect(new URL(`/admin/turniej/${id}/edit?ok=1`, origin), { status: 303 })
}
```

### app/admin/turniej/page.tsx

```
// app/admin/turniej/page.tsx
import { redirect } from 'next/navigation'
import Link from 'next/link'
import { createSupabaseServer } from '@/lib/supabase/server'

export const dynamic = 'force-dynamic'
export const revalidate = 0

export default async function AdminTurniejList() {
  const supabase = await createSupabaseServer()

  // wymagane logowanie
  const { data: { user } } = await supabase.auth.getUser()
  if (!user) redirect('/auth/signin')

  // wymagany admin
  const { data: isAdmin } = await supabase.rpc('is_admin')
  if (!isAdmin) redirect('/')

  // lista turniejÃ³w (dowolne pola z Twojej tabeli)
  const { data: rows, error } = await supabase
    .from('turniej')
    .select('id, nazwa, data_turnieju, godzina_turnieju, limit_graczy, created_at')
    .order('created_at', { ascending: false })
    .limit(200)

  if (error) {
    return (
      <main className="mx-auto max-w-5xl p-6">
        <h1 className="text-2xl font-semibold mb-4">Turnieje (admin)</h1>
        <p className="text-sm text-red-700">Nie udaÅ‚o siÄ™ pobraÄ‡ danych.</p>
      </main>
    )
  }

  return (
    <main className="mx-auto max-w-5xl p-6 space-y-4">
      <div className="flex items-center justify-between">
        <h1 className="text-2xl font-semibold">Turnieje (admin)</h1>
        <Link href="/turniej/new" className="pill pill--primary">Dodaj turniej</Link>
      </div>

      <div className="overflow-x-auto rounded border">
        <table className="min-w-full text-sm border-collapse">
          <thead className="bg-red-50">
            <tr className="border-b">
              <th className="px-3 py-2 text-left">Nazwa</th>
              <th className="px-3 py-2 text-left">Data</th>
              <th className="px-3 py-2 text-left">Limit</th>
              <th className="px-3 py-2 text-right">Akcje</th>
            </tr>
          </thead>
          <tbody>
            {rows?.map((r) => (
              <tr key={r.id} className="border-b last:border-0">
                <td className="px-3 py-2">
                  <Link href={`/admin/turniej/${r.id}/edit`} className="underline">
                    {r.nazwa}
                  </Link>
                </td>
                <td className="px-3 py-2">
                  {r.data_turnieju ?? 'â€”'}{r.godzina_turnieju ? ` â€¢ ${r.godzina_turnieju}` : ''}
                </td>
                <td className="px-3 py-2">{r.limit_graczy ?? 'â€”'}</td>
                <td className="px-3 py-2 text-right">
                  <Link href={`/admin/turniej/${r.id}/edit`} className="pill pill--secondary">
                    Edytuj
                  </Link>
                </td>
              </tr>
            ))}
            {!rows?.length && (
              <tr>
                <td className="px-3 py-6 text-sm opacity-60" colSpan={4}>
                  Brak rekordÃ³w.
                </td>
              </tr>
            )}
          </tbody>
        </table>
      </div>
    </main>
  )
}
```

### app/admin/users/[id]/role/route.ts

```
import { NextRequest, NextResponse } from 'next/server'
import { createSupabaseServerMutable } from '@/lib/supabase/server-mutable'

// Prosty regex do walidacji UUID v4 (opcjonalnie, ale pomaga Å‚adnie wyÅ‚apaÄ‡ bÅ‚Ä™dy)
const UUID_RE = /^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i

export async function POST(
  req: NextRequest,
  ctx: { params: Promise<{ id: string }> } // <-- params jako Promise (Next 15)
) {
  const supabase = await createSupabaseServerMutable()
  const origin = req.nextUrl.origin

  // â¬‡ï¸ kluczowa zmiana â€“ rozpakuj params:
  const { id: targetId } = await ctx.params

  // (opcjonalnie) twarda walidacja UUID
  if (!targetId || !UUID_RE.test(targetId)) {
    return NextResponse.redirect(new URL('/admin/users?e=invalid_id', origin), { status: 303 })
  }

  // kto wykonuje?
  const { data: { user } } = await supabase.auth.getUser()
  if (!user) {
    return NextResponse.redirect(new URL('/auth/signin', origin), { status: 303 })
  }

  // tylko admin moÅ¼e zmieniaÄ‡ role
  const { data: isAdmin } = await supabase.rpc('is_admin')
  if (!isAdmin) {
    return NextResponse.redirect(new URL('/', origin), { status: 303 })
  }

  // rola z formularza
  const form = await req.formData()
  const role = String(form.get('role') || '')
  if (role !== 'admin' && role !== 'user') {
    return NextResponse.redirect(new URL('/admin/users?e=invalid_role', origin), { status: 303 })
  }

  // aktualizacja roli
  const { error } = await supabase
    .from('profiles')
    .update({ role })
    .eq('id', targetId)

  if (error) {
    console.error('role update error', error)
    return NextResponse.redirect(new URL('/admin/users?e=update_failed', origin), { status: 303 })
  }

  return NextResponse.redirect(new URL('/admin/users?ok=1', origin), { status: 303 })
}
```

### app/admin/users/page.tsx

```
import { redirect } from 'next/navigation'
import { createSupabaseServer } from '@/lib/supabase/server'
import Link from 'next/link'

type SearchParams = Promise<Record<string, string | string[] | undefined>>

export const dynamic = 'force-dynamic'
export const revalidate = 0

export default async function AdminUsersPage({ searchParams }: { searchParams: SearchParams }) {
  const sp = await searchParams
  const ok = sp.ok === '1'
  const err = typeof sp.e === 'string' ? sp.e : undefined

  const supabase = await createSupabaseServer()
  const { data: { user } } = await supabase.auth.getUser()
  if (!user) redirect('/auth/signin')

  // twardy guard â€“ tylko admin
  const { data: isAdmin } = await supabase.rpc('is_admin')
  if (!isAdmin) redirect('/')

  // pobierz userÃ³w (prosto: max 100)
  const { data: users, error } = await supabase
    .from('profiles')
    .select('id, email, username, role, created_at')
    .order('created_at', { ascending: false })
    .limit(100)

  if (error) {
    console.error('profiles list error', error)
  }

  return (
    <main className="mx-auto max-w-5xl p-6 space-y-6">
      <div className="flex items-center justify-between">
        <h1 className="text-2xl font-semibold">UÅ¼ytkownicy</h1>
        <Link href="/admin" className="pill pill--secondary">â† Panel admina</Link>
      </div>

      {ok && (
        <div className="rounded-md border border-green-200 bg-green-50 px-3 py-2 text-sm text-green-700">
          Zmieniono rolÄ™ uÅ¼ytkownika.
        </div>
      )}
      {err && (
        <div className="rounded-md border border-red-200 bg-red-50 px-3 py-2 text-sm text-red-700">
          {err === 'invalid_role' ? 'NieprawidÅ‚owa rola.' : 'Nie udaÅ‚o siÄ™ zmieniÄ‡ roli.'}
        </div>
      )}

      <div className="overflow-x-auto rounded border">
        <table className="min-w-full border-collapse text-sm">
          <thead className="bg-red-50">
            <tr className="border-b">
              <th className="px-3 py-2 text-left">Email</th>
              <th className="px-3 py-2 text-left">Login</th>
              <th className="px-3 py-2 text-left">Rola</th>
              <th className="px-3 py-2 text-right">Akcje</th>
            </tr>
          </thead>
          <tbody>
            {users?.map((u) => (
              <tr key={u.id} className="border-b last:border-0">
                <td className="px-3 py-2">{u.email}</td>
                <td className="px-3 py-2">{u.username ?? <span className="opacity-60">â€”</span>}</td>
                <td className="px-3 py-2">
                  {u.role === 'admin'
                    ? <span className="rounded-full bg-red-600/10 px-2 py-1 text-red-700">admin</span>
                    : <span className="rounded-full bg-slate-500/10 px-2 py-1 text-slate-700">user</span>}
                </td>
                <td className="px-3 py-2 text-right">
                  {u.role === 'admin' ? (
                    <form action={`/admin/users/${u.id}/role`} method="post" className="inline">
                      <input type="hidden" name="role" value="user" />
                      <button className="pill pill--secondary">UsuÅ„ admina</button>
                    </form>
                  ) : (
                    <form action={`/admin/users/${u.id}/role`} method="post" className="inline">
                      <input type="hidden" name="role" value="admin" />
                      <button className="pill pill--primary">Nadaj admina</button>
                    </form>
                  )}
                </td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>

      <p className="text-xs opacity-60">
        Pokazano maks. 100 ostatnio utworzonych kont.
      </p>
    </main>
  )
}
```

### app/api/resolve-email/route.ts

```
import { NextResponse } from 'next/server'
import { supabaseAdmin } from '@/lib/supabase/admin'

export async function POST(req: Request) {
  const { identifier } = await req.json() as { identifier: string }
  const input = identifier.trim().toLowerCase()

  // jeÅ›li to e-mail, nie ma co rozwiÄ…zywaÄ‡
  if (input.includes('@')) {
    return NextResponse.json({ email: input })
  }

  // login -> email (tylko na serwerze, przez Service Role)
  const { data, error } = await supabaseAdmin
    .from('profiles')
    .select('email')
    .eq('username', input)
    .single()

  if (error || !data?.email) {
    return NextResponse.json({ error: 'Nie znaleziono uÅ¼ytkownika o takim loginie.' }, { status: 404 })
  }

  return NextResponse.json({ email: data.email.toLowerCase() })
}
```

### app/auth/login/route.ts

```
import { NextRequest, NextResponse } from 'next/server'
import { createSupabaseServerMutable } from '@/lib/supabase/server-mutable'
import { supabaseAdmin } from '@/lib/supabase/admin'

export async function POST(req: NextRequest) {
  const form = await req.formData()
  let identifier = String(form.get('identifier') || '').trim().toLowerCase()
  const password = String(form.get('password') || '')

  // 1) username -> email (jeÅ›li trzeba)
  if (!identifier.includes('@')) {
    const { data, error } = await supabaseAdmin
      .from('profiles')
      .select('email')
      .eq('username', identifier)
      .single()

    if (error || !data?.email) {
      return NextResponse.redirect(new URL('/auth/signin?e=notfound', req.url))
    }
    identifier = data.email.toLowerCase()
  }

  // 2) Logowanie â€“ cookies ustawi siÄ™ po stronie serwera
  const supabase = await createSupabaseServerMutable()
  const { error } = await supabase.auth.signInWithPassword({
    email: identifier,
    password,
  })

  if (error) {
    return NextResponse.redirect(new URL('/auth/signin?e=invalid', req.url))
  }

  // 3) Sukces: redirect â€“ SSR od razu widzi sesjÄ™
  const site = process.env.NEXT_PUBLIC_SITE_URL
  return NextResponse.redirect(new URL('/', site || req.url))
}
```

### app/auth/signin/page.tsx

```
'use client'

import { useEffect, useMemo, useState } from 'react'
import { useSearchParams } from 'next/navigation'

export default function SignIn() {
  const [identifier, setIdentifier] = useState('')
  const [password, setPassword] = useState('')
  const sp = useSearchParams()
  const err = useMemo(() => {
    const e = sp.get('e')
    if (e === 'notfound') return 'Nie znaleziono uÅ¼ytkownika o takim loginie.'
    if (e === 'invalid') return 'NieprawidÅ‚owy email/login lub hasÅ‚o.'
    return null
  }, [sp])

  // (opcjonalnie) zresetuj query po 1 renderze, Å¼eby adres byÅ‚ czysty
  useEffect(() => { history.replaceState(null, '', '/auth/signin') }, [])

  return (
    <main className="mx-auto max-w-md p-6 space-y-4">
      <h1 className="text-2xl font-semibold">Logowanie</h1>
      <form action="/auth/login" method="post" className="space-y-3">
        <input
          className="w-full rounded border px-3 py-2"
          name="identifier"
          placeholder="Email lub login"
          value={identifier}
          onChange={e=>setIdentifier(e.target.value)}
          required
        />
        <input
          className="w-full rounded border px-3 py-2"
          type="password"
          name="password"
          placeholder="HasÅ‚o"
          value={password}
          onChange={e=>setPassword(e.target.value)}
          required
        />
        {err && <p className="text-sm text-red-600">{err}</p>}
        <button className="rounded bg-black px-4 py-2 text-white">Zaloguj</button>
      </form>
    </main>
  )
}
```

### app/auth/signout/route.ts

```
import { NextResponse } from 'next/server'
import { createSupabaseServerMutable } from '@/lib/supabase/server-mutable'

export async function POST() {
  const supabase = await createSupabaseServerMutable(); // <-- DODAJ await
  await supabase.auth.signOut()
  return NextResponse.redirect(new URL('/', process.env.NEXT_PUBLIC_SITE_URL || 'http://localhost:3000'))
}
```

### app/auth/signup/page.tsx

```
'use client'

import { useState } from 'react'
import { supabase } from '@/lib/supabase/client'

export default function SignUp() {
  const [email, setEmail] = useState('')
  const [password, setPassword] = useState('')
  const [confirm, setConfirm] = useState('')
  const [loading, setLoading] = useState(false)
  const [msg, setMsg] = useState<string | null>(null)
  const [err, setErr] = useState<string | null>(null)

  const valid = email.trim().length > 5 && password.length >= 6 && password === confirm

  const onSubmit = async (e: React.FormEvent) => {
    e.preventDefault()
    setErr(null); setMsg(null)
    if (!valid) { setErr('SprawdÅº pola formularza.'); return }
    setLoading(true)
    try {
      const { error } = await supabase.auth.signUp({ email, password }) // BEZ meta
      if (error) throw error
      setMsg('Konto utworzone. SprawdÅº skrzynkÄ™ i potwierdÅº adres e-mail, a nastÄ™pnie zaloguj siÄ™.')
    } catch (e:any) {
      setErr(e?.message ?? 'Nie udaÅ‚o siÄ™ utworzyÄ‡ konta.')
    } finally {
      setLoading(false)
    }
  }

  return (
    <main className="mx-auto max-w-md p-6 space-y-4">
      <h1 className="text-2xl font-semibold">Rejestracja</h1>
      <form onSubmit={onSubmit} className="space-y-3">
        <input className="w-full rounded border px-3 py-2" type="email" placeholder="Email"
               value={email} onChange={e=>setEmail(e.target.value)} required />
        <input className="w-full rounded border px-3 py-2" type="password" placeholder="HasÅ‚o (min. 6 znakÃ³w)"
               value={password} onChange={e=>setPassword(e.target.value)} minLength={6} required />
        <input className="w-full rounded border px-3 py-2" type="password" placeholder="PowtÃ³rz hasÅ‚o"
               value={confirm} onChange={e=>setConfirm(e.target.value)} minLength={6} required />
        {err && <p className="text-sm text-red-600">{err}</p>}
        {msg && <p className="text-sm text-green-700">{msg}</p>}
        <button className="rounded bg-black px-4 py-2 text-white disabled:opacity-50" disabled={!valid || loading}>
          {loading ? 'TworzÄ™â€¦' : 'ZaÅ‚Ã³Å¼ konto'}
        </button>
      </form>
    </main>
  )
}
```

### app/favicon.ico

```
         (  F          (  n  00     (-  –           ¾F  (                                                           $   ]   º   º   ]   $                                           ò   ÿ   ÿ   ÿ   ÿ   ò                               8   à   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   à   8                  â   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   â              ¡   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ¡       #   ô   ÿ   ÿOOOÿ®®®ÿ«««ÿ«««ÿ«««ÿ«««ÿ­­­ÿgggÿ   ÿ   ÿ   ô   #   Y   ÿ   ÿ   ÿÿíííÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿıııÿ555ÿ   ÿ   ÿ   ÿ   Y   »   ÿ   ÿ   ÿ   ÿkkkÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿ   ÿ   ÿ   ÿ   ÿ   »   »   ÿ   ÿ   ÿ   ÿ			ÿÍÍÍÿÿÿÿÿÿÿÿÿäääÿÿ   ÿ   ÿ   ÿ   ÿ   »   Y   ÿ   ÿ   ÿ   ÿ   ÿJJJÿıııÿÿÿÿÿkkkÿ   ÿ   ÿ   ÿ   ÿ   ÿ   Y   #   ô   ÿ   ÿ   ÿ   ÿÿ¶¶¶ÿÕÕÕÿ			ÿ   ÿ   ÿ   ÿ   ÿ   ô   #       ¡   ÿ   ÿ   ÿ   ÿ   ÿ111ÿDDDÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ¡              â   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   â                  8   à   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   à   8                               ò   ÿ   ÿ   ÿ   ÿ   ò                                           $   ]   º   º   ]   $                                                                                                                                                                                                                                                                                    (       @                                                                               ,   U      è   è      U   ,                                                                                      *   …   Ò   ù   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ù   Ò   …   *                                                                      –   ó   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ó   –                                                          Q   á   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   á   Q                                               r   û   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   û   r                                       r   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   r                               O   û   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   û   O                          ä   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ã                      —   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   —               (   õ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ô   '           †   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ888ÿ‹‹‹ÿˆˆˆÿˆˆˆÿˆˆˆÿˆˆˆÿˆˆˆÿˆˆˆÿˆˆˆÿˆˆˆÿˆˆˆÿˆˆˆÿˆˆˆÿˆˆˆÿ‰‰‰ÿ___ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   †          Ô   ÿ   ÿ   ÿ   ÿ   ÿ   ÿÿîîîÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿSSSÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   Ô      +   ú   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿhhhÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿ®®®ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ú   +   T   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿÿËËËÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿôôôÿ,,,ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   T   ‚   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿGGGÿıııÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ      é   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ­­­ÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿäääÿÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   é   é   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ+++ÿóóóÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿjjjÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   é      ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ‹‹‹ÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÌÌÌÿÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ‚   T   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿÿãããÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿıııÿIIIÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   T   +   ú   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿhhhÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿ¯¯¯ÿÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ú   +      Ô   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿÿËËËÿÿÿÿÿÿÿÿÿôôôÿ,,,ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   Ô          †   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿGGGÿıııÿÿÿÿÿÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   †           '   ô   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ±±±ÿìììÿÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   õ   (               —   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ333ÿ___ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   —                      ã   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ä                          O   û   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   û   O                               r   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   r                                       r   û   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   û   r                                               Q   á   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   á   Q                                                          –   ó   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ó   –                                                                      *   …   Ò   ù   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ù   Ò   …   *                                                                                      ,   U      è   è      U   ,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               (   0   `           -                                                                                             	   (   L   j   ³   ø   ÷   ³   j   K   (   	                                                                                                                                          V       Ø   ø   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ø   Ø       U                                                                                                                      %   ‹   á   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   á   ‹   &                                                                                                      ‹   ï   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ï   ‹                                                                                          Q   Ü   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   Ü   R                                                                              Š   ş   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ş   Š                                                                     ­   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ­                                                             ¸   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ¸                                                     ®   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ®                                              Š   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   Š                                       P   ı   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ı   O                                  ß   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ß                              ‹   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ‹                       #   ñ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ñ   #                   Œ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ‹                  ä   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ$$$ÿhhhÿeeeÿeeeÿeeeÿeeeÿeeeÿeeeÿeeeÿeeeÿeeeÿeeeÿeeeÿeeeÿeeeÿeeeÿeeeÿeeeÿeeeÿeeeÿeeeÿeeeÿeeeÿPPPÿÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ä              U   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿÿëëëÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿsssÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   U           ¡   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿeeeÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÌÌÌÿÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ¡       	   Ú   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿÿÉÉÉÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿıııÿHHHÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   Ú   	   (   ù   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿEEEÿüüüÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿ®®®ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ø   (   K   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿªªªÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿôôôÿ,,,ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   L   j   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ)))ÿòòòÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿŒŒŒÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   j   ´   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿˆˆˆÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿãããÿÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ³   ø   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿÿáááÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿiiiÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ø   ø   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿeeeÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿËËËÿÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ø   ³   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿÿÉÉÉÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿıııÿHHHÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ´   j   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿEEEÿüüüÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿ®®®ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   j   L   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿªªªÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿôôôÿ,,,ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   K   (   ø   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ)))ÿòòòÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿŒŒŒÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ù   (   	   Ú   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿˆˆˆÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿãããÿÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   Ú   	       ¡   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿÿáááÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿiiiÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ¡           U   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿeeeÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÌÌÌÿÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   U              ä   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿÿÉÉÉÿÿÿÿÿÿÿÿÿıııÿHHHÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ä                  ‹   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿEEEÿüüüÿÿÿÿÿ®®®ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   Œ                   #   ñ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ¬¬¬ÿûûûÿ,,,ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ñ   #                       ‹   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ222ÿ}}}ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ‹                              ß   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ß                                  O   ı   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ı   P                                       Š   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   Š                                              ®   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ®                                                     ¸   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ¸                                                             ­   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ­                                                                     Š   ş   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ş   Š                                                                              R   Ü   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   Ü   Q                                                                                          ‹   ï   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ï   ‹                                                                                                      &   ‹   á   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   á   ‹   %                                                                                                                      U       Ø   ø   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ÿ   ø   Ø       V                                                                                                                                          	   (   K   j   ³   ÷   ø   ³   j   L   (   	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        ‰PNG

   IHDR         \r¨f   sRGB ®Îé   8eXIfMM *    ‡i                                D"8s  IDATxí]	°Õ™n”]<QVA–èÄh$	ÊNŒ13*ˆq°ÂdªÄ©I¡ˆ˜D“L2“ª(Î(Ô˜2ÖÄ™ÑG	‹Áq_@å±ˆà†ŠxÈ›ï»Ğ¾{o÷½½ÓııUß{}»OŸå;çÿûôùÏ9İÂ‘d®(Dg Ğ8	èôN º]€î@ hx¥?v ÀNà3à=`;ğ6ğ.ğ&°àuâà  ±”6‰P©Ğ½€Á@ÿÃ RÓ PùiZqÊ^DNãà€wp¼Ø¼ĞXĞhĞ˜Hg@ÀÌ
:Ùâ|ğ5` p"@À'¼É²™s{ëpü*ğ2ÀŞ…Ä d Ò¯Œ–È|(0ø
0 à“>Kò
³xX¬6 IJÈ ¤C|?$KENØ}Ï“|ŠÂòµáàöh $	2 Ù|/§Â . Nz ’#¼ÃW€eÀ
à5€ã’ˆÜ¶ˆúà;Ày •¾ ñgàs©h^  IÄÈ DL(¢;¸8 ÒHjg€cH|x 1 ËR"Œa€ïôÓ• GÁÙ@…è9`/`%0èHÄ@jğ½~,° ÛK
Ÿ,t).ÎèI‘ˆDèT¦Oû)~º°Vìu$b èª›ĞU%¥7“ƒ¨›ù _É$b 8Aç×À€ßøJö3` 510wQñ?¤øvrğÑá:ü2şKÄ@ ¤øv*{%#í‚AZ€å’^(õÏ=ñ³g \ãÀWƒÛ€É!:àß,`à6ıÏ643:@’c.FÙŸ¤ğùä€u?Ğ<'áİ€ƒ€”_Üvp: É8Q¾›
IñÅ·p{3ÎóĞkHÈ¢ŒG¡¼•®cñÑ¼<62&‹
×2uCÁÿàÚòæ•­ßâ¤Tø3Ú
½ê€›…;î¼”ªd/~m€½.ø’XÆ@{äw.°ğ«d]G•Ú {lKÜàEbœÿı(P©RuMüTÛC›ÒÚÃÀdäï])¿Œ_Lmà=Äû=@bœÍ÷K€ÛGUkÙ^œUÓØÆØÖøš)1€È»gÕT¢ÂŠ¯°m`9Ú\Ú®³ÀQşÍ@ØÊÔıâ°–6ğ:ÚÕ^›w¬òï¸E—D¤Á ç	ü5°àºëÄFĞ,ßÜ
ğX"Òd€mğ<€nB~òì@´¸÷µt×tx‹»ü;ÚfŞ>ñ“ªíI8µˆ»¿8Ó¸C1Ûª$B¸•§e†©İ+ş’jl«ÜEZÃÇ& ©ÊS:â:Š6°möë´ÿ\G1¥ç`¢¨Å!“nl»lÃÆŠÉ^€Q`í·@OcÙSÆÄ@e¸Í·º¹ç¤qbªp•ÿãS†Ä@upšº±FÀD@å¿Ğ“¿º†¦Ğæ2@#À¹ÆõL3 £A’”$H2Ç _h¶FH#rq(íÿOàDƒò¤¬ˆ¨àrunGOWaêbŠ &–SgDñ3ÀEDçto§*Ç¤šú¡Ä9kŠİ~)¿•¡,$Â x¿RŸ1˜vàK áÀ9€DäU(ğw®&LEÒäê©»€S)¹é3ĞY8x8 $.i€(íŒÄK¬Å€YœìğaÈ]­—´À4”ôÇ€	c‰“®Å@3¸fà€ó•4Æ Æ¢„ÿĞ/*bàüş Çş˜$!I€~‡Ø7ÉB*-1`	o Ÿ º	‘$»àÇ¡D‹¾‰”L‰ˆûàòß êJ"’äÀOQ¢Ë)•ö2@#Ğx4‰"$e ¨ø·Iö8’àOiˆ8ø"İ ¼GäŞ8[xÄt<ñ.´´7&‚m&ØR^‹³tq÷ Ø•á.¾§ÅYÅ-2È ½d§ ûã*_Üà&d|j\™W¼b ãôGùö«â*gœ¯ £‘é‡ÄF4ã"IñŠØƒ´/ b1q€NÈğãÀY€Dˆp¼ŒÛ9îãpÑ}w\¯ ó‘Ô¤£“Ó1 j`€èOûŸî­xK=€ÑHñ÷ ÷A“ˆ1Ÿ#¾
D:U8jÀõıtù©ë$b bA||ØU¼Q¿ü26%ªÌ)1 Šè…_Àê¢³!~DÙàºæ• ¿à+b >A´Ü:]ÑE$ˆ£50òGDhRÑtèĞÁéİ»wRÉ)ğPÇ ‘èn$‘ 3ÜÖë@bS§Nu–,Yâ´jÕÊ²œç:»¡ôÜ;ÀáÀßó@£`Ç|ã–-[)“'OVıÙÕ†©sFxÚ®“âÛ¥øn}Í›7¯ üü³~ıúÆºº:»ŒÀQ—©J_¤ÎUKj8–q0xğàÆ;v4 Ì=[õhW=¾	İë	¤&·!e5Ë8hÑ¢Eãİwß]¤üüñá‡6öïß_õiW}şSZÚ?	¿/`Ÿ;vlã¾}û2 <±hÑ" »À§ĞAî¹‘¸ÜÕX,ã mÛ¶+V¬(©ü<¹wïŞÆ#F¨^íª×;“ÖşaHğc ûà”)SÊ*¿{aùòåpÊØc89(Ñ^€şö4&E¦ÛoÃ†®Wü/· uÆ=±^€ş*?{k^·_EíÇÅúúz¹íªgö† UI-‹è{WU*
œ:pû9.tÚ·o(/İºus>ûì3ç‰'^Rg€ßäÚGâÌI_D®‘»åÜ~~½ ¹­{øúÙ?N0‘7½SêØ.Æ×¸ÿ~?}/y]nA;êØ£‹³ã2 ]ñFOB2C?·_I­÷œ”[Ğ:°:Ú=#ÀOzKé-ã ˆÛÏ£ï%å´®İ?jĞşIÀ®†PÛ¯¤æ{NÊ-hUİÿt•:™œƒ˜øõ ,â ·ŸG×KÊ-hUÛç¢cƒhP7 ÿÎ¡Â˜Á@µn?¿\Ó-¸k×.¹ıˆ2ã:õú ğ`ÙáF„Û=ı-á V·_ÉG¿ç¤Ü‚Vé İõ}¢0 WIù­ªøFºıÊ­öóèsM‡rZÕ8pJ¸QÜ*@OK8ëöó³
rZ¥Ôİ–a, ßûwË ØSéW^y¥Ÿ‡¾.· 5íat7ÔØİ¤üÖTv#İ~7n­àA"¸üòËÕ+´£WøèpMÂÅ/ªhK8ˆÒíçgä´F/^„·«ÅŒÀM{e ì¨èR›|ú)qØë7İt“æ?8'àµ€KùíP~ºıî¹ç°ú\õırÚÑ> Ç·Uk ØeP÷ß|ë^xÇéöó³
‹/V/Àüvòô™¯ôå„ä¢*×pâvûù ¹­Ğ¾ÊŸ]JûË}óˆk8(•ˆÎÅÇÀÄ‰Ñ£GÇ—€OÌmÚ´q,X oúğ”òe.â˜^ ¡QxĞÓßp’tûùõä4^_ƒN—{à†¾øÅyÄ2 †s¤ÛÏÏ Ğ-Ø¹sgµsÛÌĞiêv‘”Z8
!~PJ?Œc€«ıîºë®À›|Æ] ®Ü½{·³zõê¸“Rüµ1pnãÔàzïí¥º¼tlpû9³fÍrºvíjTæ®¿şzß4*OÊLã‹~•øÑçÔ•3˜ƒ4İ~~¯r­;ÔmêxYŒ+üÀ€€¡¤íöó3 r­;Ômêx“4à÷Å:7]ÕqLš4)U·Ÿ!rú1”êuê6¿ìÕ$ÍÀ7›®èÀ8ºwïîÌ™3Ç¸|5Ï>?î\zé¥ÍOë·œëÍ†× ğø,ïE›ÅÀŒ3œš•©2¹¹å–[œººº2Wu:E¾‚´›¼^p.H1cJºtû]}õÕB˜uéÔSOu®ºŠ»ÉIc€O¥òÄ%ƒ  ÆAZ«ıüüü®kµ ‘ºD?Ç5 Ş@Q×À ÿé3Àwê+®¸"ıŒT™ÎSÀUŞ¥à13Àî?ûâ5 M'İ‹úŸ>pûşZµj•~fjÈ×ˆ×¡Ô‚n©¦±>× ğÿi5D¤[bf íÕ~a‹'·`Xc¹Ÿã -¼1ók¢›½ÿÄI«ıüŞ÷ı®kµ QºÅ¯|ókßMËé(92È@’t°ÉíçÇİ‚X-èL×“a€úN4€“qÜ'$f0@·@V„nA›Ü˜Yá½L9:â|/^sÇ ú—	¨Ó)0`êj¿°T\wİuZ-–ÄèîÂ¨\ 	@Ñ:¦±cítûùœ{È-èÇRb×û1%× ôI,Y%T‘Ûİ~‡‹rú1”ØõÂCŸ€,¼$–´*Ë€é«ıÊf<à¹0zş¥èhÕFü„û¦ ·Ÿ«ı|â€¯8Z-èCRü—¹Tg× ĞHRf€‹glYí–ª¹sçÊ-–Äp÷Ó'+Ãèî¶mµ_Ø’gÍÍ–îçC¿{ ô	òÃ’”ÈªÛÏÎ™3gÊ-èGR|×¹7`G€Şñ¥¡˜ƒ0U·Ÿ_ÙµZĞ¡Ø¯ŸD )À±ó\>¬»ıÊ—üĞ¹ıŠõz N–¤Ä@Öİ~~´Ê-èÇP¬×{rs€¿´@¬<—œ›|.]ºÔ¸|”Îm|gûõëç¬_¿Şyå•WâKD1—bàM½”¢%¡s\“·Ÿ¥rú1Ëõnì\–Æ’„"-É İ`.4æÛ~%3™àI}[0A²$µ“= -Ò>BH"G®Û^r„­<ÂEBGİi Ú%”˜’9Ì@^İ~~@«ıŠüú1Üì€†@’ tû-[¶ÌèÏ{%@CÙ$ğmAgüøñÎš5kÊ†Ñ…ÈøœŠ/åŒOÿˆlßäÓ¿„áBĞ@.X°À±uäp¥Oüî6œ—x²9MPn¿`ß·o_§¾¾^nÁ`t…
¥§(úª»™ƒ\rûùsÆAÒyóæéÛ‚şT…¡@h
ƒE0lØ0çÎ;ïtÚµÓ˜kÆ¸N ¡¡ÁYµjUà
S#ì|^ã½º- |¢İpÃN—.…­ØŞ¥`×^{­zLñ6ƒƒ4 ŸÄ›†bç¨öe—]&"ªd€sÎœ9UŞ¥àU0ğ!ÀÁ*nPĞ*`—ÿæ›oÖ¨v•¼¹Ái8GåşÔÿhh ØmœŠÍËÀäÉ“sÏ=×{JÇU0ÀÕ‚óçÏwZ·æş’ˆø”ƒ€ì›ö8bEzôèá,Y²Dïş![CŸ>}œ7:k×®“noÆÀfö >jvR?#b€ƒXˆ(¶üFÃAT¾FÕÕióêˆ[Á{ì°zvÄç>º¡C‡Êía+[0B2Dµœ=€íG~ë(
øÄºñÆÕõ‚LO×\sÜ‚>"8|‹`[)
&Lp8ø'‰–öäŒ”Óí4 oGeÎ#£ÛÀlÙ’_\“DÍ€Ü‚‘2ZØl¢Üi´9ŒtäÈ‘9f Ş¢Ë-¿œ¼‹=€‡YÌyˆn?uQã¯}XÍ¬ÍsAïi >=ŒĞ1æ=RÉí+à +­Ü‚¡¸.2 šŠKì«·ßôéÓCÆ¢Ûƒ20hĞ ‡Ë«%53À5@…MA¹%˜¦×Ì£ãÈí‚¼·j[õä9Î;¸û _(¯ú§¿µ0ÀÕ~rûÕÂ\¸{ômÁPüÜÿ®x#TT9¾™n?¾Êí—N# á•×¥&î}× ¬¯)
İTVL¯!¸ßÔjÁªë`ïp ß8@RrûUAVŒAå¬šÜ=¸ã-Şå€÷pLHª`@n¿*ÈŠ1¨Ü‚U“Ëõ?}w ]ìH2@·ß´iÓ†V°¸ [Ë¯%àôÿ‚ëß5 8±)Ğ­
T`€›|rZbZ-¸.Ö!da+@× ğÎçßó€Zígf[0p½¼æ†ô ä¤ I´Égr¸$· o%PÇ_rCyÀVœ|ß½ ÿ¥à"mòYšÎÊ-è[ lÚÄk xAã ø“Û¯9]¢[pÒ¤IåÈ¨¬pP“ÇÏk ŠºFeÙÌÈígHEødƒnAm"Z–$õ5}„›‚zå8üéô2røX›|– ÅàSÜ»w¯³råJƒs™JÖ~T›fşz{ ÌÍ« ÷xĞj?jµàQ•Eİnò ğjsÀùÁ|GxĞ·ı<dXt(·àQ•Eİ.¬p¯47 Üğ)÷¢ş;…Ïysµ_«V­D‡…È-XTiÔí¢ı?› †~¼è–œÿÛÏî ·`Qı=Vô?šòú^à
€‚¹ºı–.]ª|XŞ
ômÁB~€¿?ŠÆøJõ ŞD —·äüÜ~Ùh rê‘óÿ©ÛERªÀ…Aİ€óŠBæìİ~wÜq‡Ó¾}ûœ•<›Å•[Ğ¹5ûdóÚ-Õ`˜5 ?Kqİ~l4’ì0@·à)§œ’/I‚®(¼œà‡Ø‹ü…¥nÎê9¹ı²Y³4èœ!˜CÙˆ2×—*w9ÀÀGKİõsî&Ÿrûe³¦súé¶? 6Ù8JÊ |(òuwOä´d°&K)‡nA¾Ê?RšÒn@7,·º8Á=‘õÿrûe½†•nÁM›69k×òM7óÂéı·J•´R€]†e¥nÊê9¹ı²Z³Ååâ /?á“o>ŒÒó•¾¤”rzrÒÀ óó`åöóV{ö»uëæ4448«V­Êra÷ p³ îõQRZ”<{ädK.F9•½#~Tâ¾ûîs.¾øâìN%*Ë ÀğáÃuë8G&“²¥ì/W:*x%á{Ã}@¦ »‚lõõõNc#çAIòÀÀ±Ç›õiŞ÷£Ë*?ëØ¯À0}€g€ãùC"Ä€pÛ¯³€Šßû¨4è–’Ò(bÀ8€_QùY” €áîr7'€—ˆ`·ÿî ùj ¸6à… *Œ©3ÀWögƒä"¨àl¢¡Âˆ1:ì±Sg}%È  	¹¥P?÷„ş‹1`›£¯ÉYĞ ãâ"‹‚Dª0b@¤Æ İö”Ÿ9¬¦Àğı¾[tá‰F1À‡ôp`kĞ\UÓ`œÜRø·A#W81 e`)RÛZMŠÕö ÷€[uæ‰F0ğ	rq.ÀÕ¥Ú #^ğ=C"Ä€9P'«R~f½– ï
pn€zdC"Òe ¦§?³\K€÷½¨@&$b }jzú3Ûµö x/{èÄ1 Ra€#ÿ|÷çÆŸUK­= &Ä^€æTM¹n‘2À9ÿ5)?s¦Àû{O'ó‡DˆDà’ßo [kMÕoK0¿xÿŒ ÜTd‚_@]b ræ ÆGÃÄ¶À´; «€¯ò‡DˆDàêÜ1ÀgaRÛ`ÚÜ'`0ˆÂ  ‰>\ë/ù„ñ½fĞùƒøñ÷„Å€ˆß!fn÷Z¢|bŸ†ÜğU .t®åà¤ŸÑÀÚrª9Å+€›ı‘­€±î	ıb rnEŒDk”= æé8àÀÙü!b RClã€PŞEÙ`¼ÜŒK†'~ß@‰ Ë}*°!`ø@Á¢6 Lô ;À	$b@DÃÀ?#šÈgŞFı
àµV”ˆ1vıÇ;ÃEsôİQ¹›ÇÌ=É®ö4¿ ßb@TÅÀn„ş!¹ò3q¼0^ÊV€ã c ‰µ1ğÜ¶´¶[ıïŠëÀM¹=8Iˆİ‰Õ1@Ú…@Cu··`N¸oÀã WJÄ€Æ WúÑåÇe÷±Iœ¯ n¦¹Nàmà¯€¸ÆÜ´ô_d(Ä4`EÜ…IÂ °¯œ"ÌµË1 *3ğ+\şEå Ñ\MâÀÍ)g	rÁ¦
»Œè¿8š>õ¿pô?vIÒ °0€Ç€~ü!b ˆ­øÅ$'Ó%"I¿“¿RıÀi1 0°‡? S~&Ô Ór…ä’Æ€¤{ nô_˜ÄÀÈÌLà?’ÎT€eäÔÆÀ7ùC"rÎÀOQ~"qIË ° O 8?$b §Ü‹rÿ#@×_â’v¼JÌ™‚£/¹é3ğ'dá/ÈÖ÷W[¤¤›ço'Nüğlóú-2Î Ûüå@jÊO~Óî0”À2` HÄ@ÆØ„òĞ+–ª¤İpOB® ŞuOè¿È(lãS€Ô•Ÿü¦9Èô½ò~ğcß:x/èXd„.ğù°Æ”ò˜d ÈÉVày@F $H2Å •Ÿïü+M*•i€Ül8O@F $H2Á •Ÿå®2­4& r´POÀ´Ö¢üÔÂ€ûä7NùYS ó¶ øÀYƒ1`ğã;ÿJS3n² g['‘@W@"la`32Ên?'ûHB2p
îhÄm€mu ‰“×j@F@˜ÜV ²­Z!¦¿xIä”ÉÿH®y™Ñ±)üù>ÀåZ!6 ºà”aÎ`äş‚¦ÌdDV$9f€ëù	pM¿6»I¨!LG:\LdrwPyË~ıPá§%Ôæ•L3Æá7çTKÑÄAm€mo|³6©Ÿ	3Ğé-Òh J3¿¼?67 á¶yr¶”"€ûşàgÈÎ4. $±1À÷ı_¼[*Š¸&¸¤˜S/õdq´Îìãä‰ÁCŞâh Š3¿¼>Š6Å¶%±€¶Èã\€#´RZq¦ğ=lK|Å”XÆÀXäWSˆe j5 /¡ıĞÓ$±˜:äıv@½‚ †€Î8Ğ×d„1(‡z2~Fà)´ùö3¢ôÍ‹ÁŞÀl€®C¿† ëùâè#´‰›í=².\Lt? %Ñ N$9b %Ê:àşƒ2ùä€u	 É1|-˜	ldòÁ÷œœt $b À@?ü¥·@† »FàcÔïÏ^€D”d€[9ıà zÙà€ŠÏ:
HÄ@ ¾ŒP2v )~ ¦®@•àüïŸz5°Ç|€úÒ¿R«ÖµªàÁ|`# W39Ø‚ºá<î"-±0Àï\<ìdÒå€uÀoGLz 1œGp°à—e’å€¯d‹ .øjHÄ@jôFÊ3€•@ c{s<ÿùJ&	É@‹÷ëöb¸ÙÀw‹  ²§ ©nÁµàvğœ²û< ‰ˆ€ˆˆ,M;œû*p>p!0hHüà{=•»ğüxà]IÄÈ DLh™èÚâ<'¡Œh8Ç@V Á#ïã˜Jÿ°àfû IŒÈ ÄHn…¨ûãWŸ}àNÆt[uò$Ÿ¢°›§å ş@’ 2 	’]&)† #€3ˆ“,	=%¯TôÕÀkÀ&à  I‰€”ˆ÷I¶®Ó³ğ Ù[8	è	´L–]È]tïTğgõÀ6à-@b2 U†OVºã: A?€¯} .iî|	àxCœÂ÷rvßw; ÎÀ#ê>éi 8_b82 †WP€ìÑõè  {'n¯áÓ8ğz;€Æ¤yİsŸ œÃ@¥¦¼P¡·o|ÂSùih $3ğÿ@ß¹jìŠá    IEND®B`‚```

### app/globals.css

```
@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  html, body { @apply bg-white text-slate-900 antialiased; }
  ::selection { @apply bg-red-600 text-white; }
  a { @apply text-red-700 underline-offset-2; }
}

@layer components {
  .btn { @apply inline-flex items-center justify-center rounded-md px-3 py-2 text-sm font-medium transition; }
  .btn-ghost { @apply btn border border-red-200 bg-white text-red-700 hover:bg-red-50 active:bg-red-100; }
  .btn-primary { @apply btn bg-red-600 text-white hover:bg-red-700 active:bg-red-800; }

  /* Link w nawigacji */
  .nav-link {
    @apply no-underline px-3 py-2 rounded-md text-sm font-medium transition
           text-red-700 hover:bg-red-50 hover:text-red-800;
  }
  .nav-link--active {
    @apply bg-red-600 text-white;
  }

  /* â€PiguÅ‚kaâ€ â€“ baza */
  .pill {
    @apply no-underline hover:no-underline
           inline-flex items-center gap-2 rounded-full px-4 py-2 text-sm font-semibold
           transition focus:outline-none focus-visible:ring-2 focus-visible:ring-red-500 focus-visible:ring-offset-2
           transition-shadow transform-gpu hover:-translate-y-0.5 active:translate-y-0;
  }

  .pill--primary {
    @apply text-white bg-gradient-to-b from-red-500 to-red-600
           hover:from-red-600 hover:to-red-700 active:from-red-700 active:to-red-800
           shadow-[0_6px_14px_rgba(220,38,38,0.25)]
           hover:shadow-[0_9px_20px_rgba(220,38,38,0.35)]
           active:shadow-[0_4px_10px_rgba(220,38,38,0.25)];
  }

  .pill--secondary {
    @apply text-red-700 border border-red-200 bg-white
           hover:bg-red-50 active:bg-red-100
           shadow-[0_4px_10px_rgba(0,0,0,0.08)]
           hover:shadow-[0_6px_14px_rgba(0,0,0,0.10)]
           active:shadow-[0_3px_8px_rgba(0,0,0,0.08)];
  }

  .pill__icon { /* mniejsza kropka/strzaÅ‚ka */
    @apply inline-flex h-5 w-5 items-center justify-center rounded-full border border-red-300 text-red-700;
  }
  .pill__icon--light { @apply border-white/80 text-white; }

  /* PiguÅ‚ka informacyjna (jak secondary, bez strzaÅ‚ki) */
  .pill--info {
    @apply text-red-700 border border-red-200 bg-white
        /* hover:bg-red-50 active:bg-red-100 
         shadow-[0_4px_10px_rgba(0,0,0,0.08)]
         hover:shadow-[0_6px_14px_rgba(0,0,0,0.10)]
         active:shadow-[0_3px_8px_rgba(0,0,0,0.08)];*/
}

}```

### app/layout.tsx

```
import './globals.css'
import type { Metadata } from 'next'
import { createSupabaseServer } from '@/lib/supabase/server'
import Navbar from '@/components/Navbar'

export const dynamic = 'force-dynamic'
export const revalidate = 0

export const metadata: Metadata = {
  title: 'elo-arena',
  description: 'Next.js + Supabase',
}

export default async function RootLayout({ children }: { children: React.ReactNode }) {
  const supabase = await createSupabaseServer()
  const { data: { user } } = await supabase.auth.getUser()

  let role: 'admin' | 'user' | null = null

  if (user) {
    // 1) najpewniejsze: rpc('is_admin')
    const { data: isAdmin, error: rpcError } = await supabase.rpc('is_admin')

    if (!rpcError && typeof isAdmin === 'boolean') {
      role = isAdmin ? 'admin' : 'user'
    } else {
      // 2) fallback: czytaj role bezpoÅ›rednio z profiles
      const { data: profile, error: profError } = await supabase
        .from('profiles')
        .select('role')
        .eq('id', user.id)
        .maybeSingle()

      if (profError) {
        console.error('[auth] profiles select error:', profError)
      }
      role = profile?.role === 'admin' ? 'admin' : 'user'
    }
  }

  // Tymczasowy log diagnostyczny â€“ usuÅ„ po potwierdzeniu
  console.log('[auth]', { id: user?.id, email: user?.email, role })

  return (
    <html lang="pl">
      <body className="min-h-dvh antialiased">
        <Navbar user={user ? { id: user.id, email: user.email } : null} role={role} />
        {children}
      </body>
    </html>
  )
}
```

### app/onboarding/page.tsx

```
import { createSupabaseServer } from '@/lib/supabase/server'
import { redirect } from 'next/navigation'
import UsernameForm from './username-form'

export default async function OnboardingPage() {
  const supabase = await createSupabaseServer()
  const { data: { user } } = await supabase.auth.getUser()
  if (!user) redirect('/auth/signin')

  const { data: profile } = await supabase
    .from('profiles')
    .select('username')
    .eq('id', user.id)
    .single()

  if (profile?.username) redirect('/')

  return (
    <main className="mx-auto max-w-md p-6">
      <h1 className="text-2xl font-semibold mb-4">Ustaw swÃ³j login</h1>
      <UsernameForm />
    </main>
  )
}
```

### app/onboarding/username-form.tsx

```
'use client'

import { useState } from 'react'
import { supabase } from '@/lib/supabase/client'
import { useRouter } from 'next/navigation'

export default function UsernameForm() {
  const [username, setUsername] = useState('')
  const [err, setErr] = useState<string | null>(null)
  const [saving, setSaving] = useState(false)
  const router = useRouter()

  const save = async () => {
    setErr(null); setSaving(true)
    try {
      const clean = username.replace(/\s+/g,'').toLowerCase()
      if (clean.length < 3) { setErr('Login musi mieÄ‡ co najmniej 3 znaki.'); setSaving(false); return }

      const { data: { user } } = await supabase.auth.getUser()
      if (!user) { setErr('Brak sesji. Zaloguj siÄ™.'); setSaving(false); return }

      const { error } = await supabase
        .from('profiles')
        .update({ username: clean })
        .eq('id', user.id)

      // 23505 = duplicate key
      if (error && ((error as any).code === '23505' || (error.message||'').includes('duplicate'))) {
        setErr('Ten login jest juÅ¼ zajÄ™ty.'); setSaving(false); return
      }
      if (error) { setErr(error.message); setSaving(false); return }

      router.push('/')
    } catch (e:any) {
      setErr(e?.message ?? 'Nie udaÅ‚o siÄ™ zapisaÄ‡ loginu.')
    } finally {
      setSaving(false)
    }
  }

  return (
    <div className="space-y-3">
      <input
        className="w-full rounded border px-3 py-2"
        placeholder="np. michal123"
        value={username}
        onChange={e=>setUsername(e.target.value)}
      />
      {err && <p className="text-sm text-red-600">{err}</p>}
      <button onClick={save} className="rounded bg-black px-4 py-2 text-white disabled:opacity-50" disabled={saving}>
        {saving ? 'ZapisujÄ™â€¦' : 'Zapisz login'}
      </button>
    </div>
  )
}
```

### app/page.tsx

```
export default function Home() {
  return (
    <main className="p-6">
      <div className="rounded p-4 bg-red-600 text-white">
        Tailwind dziaÅ‚a ğŸ”¥
      </div>
    </main>
  )
}
```

### app/profile/page.tsx

```
import { redirect } from 'next/navigation'
import { createSupabaseServer } from '@/lib/supabase/server'

// Next 15+: searchParams jest Promisem
type SearchParams = Promise<Record<string, string | string[] | undefined>>

// DokÅ‚adnie te same wartoÅ›ci, co w ENUM w bazie:
const VOIVODESHIPS = [
  'DolnoÅ›lÄ…skie',
  'Kujawsko-Pomorskie',
  'Lubelskie',
  'Lubuskie',
  'ÅÃ³dzkie',
  'MaÅ‚opolskie',
  'Mazowieckie',
  'Opolskie',
  'Podkarpackie',
  'Podlaskie',
  'Pomorskie',
  'ÅšlÄ…skie',
  'ÅšwiÄ™tokrzyskie',
  'WarmiÅ„sko-Mazurskie',
  'Wielkopolskie',
  'Zachodniopomorskie',
] as const

export default async function ProfilePage({
  searchParams,
}: {
  searchParams: SearchParams
}) {
  const sp = await searchParams
  const ok = sp.ok === '1'
  const err = typeof sp.e === 'string' ? sp.e : undefined

  const supabase = await createSupabaseServer()
  const { data: { user } } = await supabase.auth.getUser()
  if (!user) redirect('/auth/signin')

  const { data: profile } = await supabase
    .from('profiles')
    .select('username, first_name, last_name, birthdate, city, voivodeship, role, email')
    .eq('id', user.id)
    .single()

  const bday = profile?.birthdate ? String(profile.birthdate).slice(0, 10) : ''

  return (
    <main className="mx-auto max-w-xl p-6 space-y-6">
      <h1 className="text-2xl font-semibold">TwÃ³j profil</h1>

      {ok && (
        <div className="rounded-md border border-green-200 bg-green-50 px-3 py-2 text-sm text-green-700">
          Zapisano zmiany.
        </div>
      )}
      {err && (
        <div className="rounded-md border border-red-200 bg-red-50 px-3 py-2 text-sm text-red-700">
          {err === 'username_taken'
            ? 'Login zajÄ™ty.'
            : err === 'voiv_required'
            ? 'Wybierz wojewÃ³dztwo.'
            : err === 'voiv_invalid'
            ? 'NieprawidÅ‚owa wartoÅ›Ä‡ wojewÃ³dztwa.'
            : 'Nie udaÅ‚o siÄ™ zapisaÄ‡. SprÃ³buj ponownie.'}
        </div>
      )}

      <form action="/profile/update" method="post" className="space-y-4">
        <div>
          <label className="block text-sm font-medium text-slate-700">Login (username)</label>
          <input
            name="username"
            defaultValue={profile?.username ?? ''}
            className="mt-1 w-full rounded border px-3 py-2"
            maxLength={32}
            placeholder="np. m_kowalski"
          />
          <p className="mt-1 text-xs text-slate-500">Musi byÄ‡ unikalny.</p>
        </div>

        <div className="grid grid-cols-1 gap-4 sm:grid-cols-2">
          <div>
            <label className="block text-sm font-medium text-slate-700">ImiÄ™</label>
            <input name="first_name" defaultValue={profile?.first_name ?? ''} className="mt-1 w-full rounded border px-3 py-2" />
          </div>
          <div>
            <label className="block text-sm font-medium text-slate-700">Nazwisko</label>
            <input name="last_name" defaultValue={profile?.last_name ?? ''} className="mt-1 w-full rounded border px-3 py-2" />
          </div>
        </div>

        <div>
          <label className="block text-sm font-medium text-slate-700">Data urodzenia</label>
          <input type="date" name="birthdate" defaultValue={bday} className="mt-1 w-full rounded border px-3 py-2" />
        </div>

        <div className="grid grid-cols-1 gap-4 sm:grid-cols-2">
          <div>
            <label className="block text-sm font-medium text-slate-700">Miasto</label>
            <input name="city" defaultValue={profile?.city ?? ''} className="mt-1 w-full rounded border px-3 py-2" />
          </div>

          {/* SELECT wojewÃ³dztwa â€“ wymagany, dokÅ‚adnie wartoÅ›ci z ENUM */}
          <div>
            <label className="block text-sm font-medium text-slate-700">WojewÃ³dztwo</label>
            <select
              name="voivodeship"
              defaultValue={profile?.voivodeship ?? ''}
              className="mt-1 w-full rounded border px-3 py-2 bg-white"
              required
            >
              <option value="" disabled>â€” wybierz â€”</option>
              <option>DolnoÅ›lÄ…skie</option>
              <option>Kujawsko-Pomorskie</option>
              <option>Lubelskie</option>
              <option>Lubuskie</option>
              <option>ÅÃ³dzkie</option>
              <option>MaÅ‚opolskie</option>
              <option>Mazowieckie</option>
              <option>Opolskie</option>
              <option>Podkarpackie</option>
              <option>Podlaskie</option>
              <option>Pomorskie</option>
              <option>ÅšlÄ…skie</option>
              <option>ÅšwiÄ™tokrzyskie</option>
              <option>WarmiÅ„sko-Mazurskie</option>
              <option>Wielkopolskie</option>
              <option>Zachodniopomorskie</option>
  </select>
          </div>
        </div>

        <div className="text-sm text-slate-600">
          <span className="opacity-70">Rola:</span>{' '}
          <span className={profile?.role === 'admin' ? 'font-semibold text-red-700' : ''}>
            {profile?.role ?? 'user'}
          </span>{' '}
          â€¢ <span className="opacity-70">Email:</span> {profile?.email ?? user.email}
        </div>

        <div className="flex gap-2 pt-2">
          <button className="pill pill--primary" type="submit">Zapisz zmiany</button>
          <a href="/" className="pill pill--secondary">Anuluj</a>
        </div>
      </form>
    </main>
  )
}
```

### app/profile/update/route.ts

```
import { NextRequest, NextResponse } from 'next/server'
import { createSupabaseServerMutable } from '@/lib/supabase/server-mutable'

// Ta lista musi byÄ‡ identyczna jak wartoÅ›ci ENUM w bazie:
const VOIVODESHIPS = [
  'DolnoÅ›lÄ…skie','Kujawsko-Pomorskie','Lubelskie','Lubuskie','ÅÃ³dzkie','MaÅ‚opolskie',
  'Mazowieckie','Opolskie','Podkarpackie','Podlaskie','Pomorskie','ÅšlÄ…skie',
  'ÅšwiÄ™tokrzyskie','WarmiÅ„sko-Mazurskie','Wielkopolskie','Zachodniopomorskie',
] as const
type Voiv = typeof VOIVODESHIPS[number]

export async function POST(req: NextRequest) {
  const supabase = await createSupabaseServerMutable()
  const { data: { user } } = await supabase.auth.getUser()
  const origin = req.nextUrl.origin

  if (!user) {
    return NextResponse.redirect(new URL('/auth/signin', origin), { status: 303 })
  }

  const form = await req.formData()
  const username = String(form.get('username') || '').trim() || null
  const first_name = String(form.get('first_name') || '').trim() || null
  const last_name = String(form.get('last_name') || '').trim() || null
  const birthdateRaw = String(form.get('birthdate') || '')
  const city = String(form.get('city') || '').trim() || null

  // WojewÃ³dztwo: wymagane i tylko z listy
  const vRaw = String(form.get('voivodeship') || '')
  if (!vRaw) {
    return NextResponse.redirect(new URL('/profile?e=voiv_required', origin), { status: 303 })
  }
  const voivodeship = VOIVODESHIPS.includes(vRaw as Voiv) ? (vRaw as Voiv) : null
  if (!voivodeship) {
    return NextResponse.redirect(new URL('/profile?e=voiv_invalid', origin), { status: 303 })
  }

  const birthdate = birthdateRaw ? birthdateRaw : null // YYYY-MM-DD

  const updates: Record<string, any> = {
    username, first_name, last_name, birthdate, city, voivodeship,
  }

  const { error } = await supabase
    .from('profiles')
    .update(updates)
    .eq('id', user.id)

  if (error) {
    // 23505: unique_violation (np. username), 22P02: invalid input (ENUM), 23514: check_violation
    const code = (error as any).code
    const reason =
      code === '23505' ? 'username_taken' :
      code === '22P02' ? 'voiv_invalid' :
      code === '23514' ? 'voiv_invalid' :
      'save_failed'
    return NextResponse.redirect(new URL(`/profile?e=${reason}`, origin), { status: 303 })
  }

  return NextResponse.redirect(new URL('/profile?ok=1', origin), { status: 303 })
}
```

### app/turniej/create/route.ts

```
import { NextRequest, NextResponse } from 'next/server'
import { createSupabaseServerMutable } from '@/lib/supabase/server-mutable'

const urlRe = /^https?:\/\/\S+$/i
const sheetColRe = /^[A-Za-z]$/

function extractSheetId(url: string): string | null {
  try {
    const u = new URL(url)
    const byQuery = u.searchParams.get('id')
    if (byQuery) return byQuery
    const m = u.pathname.match(/\/spreadsheets\/d\/([a-zA-Z0-9-_]+)/)
    return m ? m[1] : null
  } catch {
    return null
  }
}

export async function POST(req: NextRequest) {
  const origin = req.nextUrl.origin
  const supabase = await createSupabaseServerMutable()

  const { data: { user } } = await supabase.auth.getUser()
  if (!user) return NextResponse.redirect(new URL('/auth/signin', origin), { status: 303 })
  const { data: isAdmin } = await supabase.rpc('is_admin')
  if (!isAdmin) return NextResponse.redirect(new URL('/', origin), { status: 303 })

  const fd = await req.formData()

  const nazwa = String(fd.get('nazwa') || '').trim()
  const data_turnieju = String(fd.get('data_turnieju') || '').trim()
  const godzina_turnieju = String(fd.get('godzina_turnieju') || '').trim()

  const gsheet_url_raw = String(fd.get('gsheet_url') || '').trim() || null
  let gsheet_id = String(fd.get('gsheet_id') || '').trim() || null
  const arkusz_nazwa = String(fd.get('arkusz_nazwa') || '').trim() || null

  const kolumna_nazwisk_raw = String(fd.get('kolumna_nazwisk') || '').trim()
  const kolumna_nazwisk = kolumna_nazwisk_raw ? kolumna_nazwisk_raw.toUpperCase() : null

  const pierwszy_wiersz_z_nazwiskiem_raw = fd.get('pierwszy_wiersz_z_nazwiskiem')
  const pierwszy_wiersz_z_nazwiskiem =
    pierwszy_wiersz_z_nazwiskiem_raw ? Number(pierwszy_wiersz_z_nazwiskiem_raw) : 2

  const limit_graczy_raw = fd.get('limit_graczy')
  const limit_graczy = limit_graczy_raw ? Number(limit_graczy_raw) : null

  const lat_raw = fd.get('lat')
  const lng_raw = fd.get('lng')
  const lat = lat_raw !== null && String(lat_raw) !== '' ? Number(lat_raw) : null
  const lng = lng_raw !== null && String(lng_raw) !== '' ? Number(lng_raw) : null

  // walidacje
  if (!nazwa) return NextResponse.redirect(new URL('/turniej/new?e=invalid_input', origin), { status: 303 })
  if (!data_turnieju || !godzina_turnieju) {
    return NextResponse.redirect(new URL('/turniej/new?e=date_time_required', origin), { status: 303 })
  }
  if (kolumna_nazwisk && !sheetColRe.test(kolumna_nazwisk)) {
    return NextResponse.redirect(new URL('/turniej/new?e=sheet_col_invalid', origin), { status: 303 })
  }
  if (pierwszy_wiersz_z_nazwiskiem !== null && (!Number.isFinite(pierwszy_wiersz_z_nazwiskiem) || pierwszy_wiersz_z_nazwiskiem < 1)) {
    return NextResponse.redirect(new URL('/turniej/new?e=number_invalid', origin), { status: 303 })
  }
  if (limit_graczy !== null && (!Number.isFinite(limit_graczy) || limit_graczy < 1)) {
    return NextResponse.redirect(new URL('/turniej/new?e=number_invalid', origin), { status: 303 })
  }
  if (lat !== null && !Number.isFinite(lat)) return NextResponse.redirect(new URL('/turniej/new?e=number_invalid', origin), { status: 303 })
  if (lng !== null && !Number.isFinite(lng)) return NextResponse.redirect(new URL('/turniej/new?e=number_invalid', origin), { status: 303 })

  let gsheet_url = gsheet_url_raw
  if (gsheet_url && !urlRe.test(gsheet_url)) {
    return NextResponse.redirect(new URL('/turniej/new?e=url_invalid', origin), { status: 303 })
  }
  if (!gsheet_id && gsheet_url) {
    gsheet_id = extractSheetId(gsheet_url)
  }

  const payload: Record<string, any> = {
    nazwa,
    data_turnieju,
    godzina_turnieju,
    gsheet_url,
    gsheet_id,
    arkusz_nazwa,
    kolumna_nazwisk,
    pierwszy_wiersz_z_nazwiskiem,
    limit_graczy,
    lat,
    lng,
    created_by: user.id,
  }

  const { error } = await supabase.from('turniej').insert(payload)
  if (error) {
    console.error('insert turniej error', error)
    return NextResponse.redirect(new URL('/turniej/new?e=invalid_input', origin), { status: 303 })
  }

  return NextResponse.redirect(new URL('/admin?ok=1', origin), { status: 303 })
}
```

### app/turniej/new/page.tsx

```
import { redirect } from 'next/navigation'
import { createSupabaseServer } from '@/lib/supabase/server'
import MapPicker from '@/components/MapPicker'   // <â€” NOWE

type SearchParams = Promise<Record<string, string | string[] | undefined>>

export const dynamic = 'force-dynamic'
export const revalidate = 0

export default async function NewTurniejPage({ searchParams }: { searchParams: SearchParams }) {
  const sp = await searchParams
  const ok = sp.ok === '1'
  const err = typeof sp.e === 'string' ? sp.e : undefined

  const supabase = await createSupabaseServer()
  const { data: { user } } = await supabase.auth.getUser()
  if (!user) redirect('/auth/signin')
  const { data: isAdmin } = await supabase.rpc('is_admin')
  if (!isAdmin) redirect('/')

  return (
    <main className="mx-auto max-w-2xl p-6 space-y-6">
      <h1 className="text-2xl font-semibold">Dodaj turniej</h1>

      {ok && (
        <div className="rounded-md border border-green-200 bg-green-50 px-3 py-2 text-sm text-green-700">
          Turniej zostaÅ‚ utworzony.
        </div>
      )}
      {err && (
        <div className="rounded-md border border-red-200 bg-red-50 px-3 py-2 text-sm text-red-700">
          {{
            invalid_input: 'NieprawidÅ‚owe dane formularza.',
            date_time_required: 'Podaj datÄ™ i godzinÄ™ wydarzenia.',
            sheet_col_invalid: 'Kolumna nazwisk musi byÄ‡ literÄ… (Aâ€“Z).',
            number_invalid: 'NieprawidÅ‚owa wartoÅ›Ä‡ liczbowa.',
            url_invalid: 'Link musi zaczynaÄ‡ siÄ™ od http(s)://',
          }[err] ?? 'Nie udaÅ‚o siÄ™ zapisaÄ‡.'}
        </div>
      )}

      <form action="/turniej/create" method="post" className="space-y-5">
        <div>
          <label className="block text-sm font-medium">Nazwa turnieju *</label>
          <input name="nazwa" required className="mt-1 w-full rounded border px-3 py-2" placeholder="np. ELO Arena Open" />
        </div>

        <div className="grid grid-cols-1 gap-4 sm:grid-cols-2">
          <div>
            <label className="block text-sm font-medium">Data turnieju *</label>
            <input type="date" name="data_turnieju" required className="mt-1 w-full rounded border px-3 py-2" />
          </div>
          <div>
            <label className="block text-sm font-medium">Godzina startu *</label>
            <input type="time" name="godzina_turnieju" required className="mt-1 w-full rounded border px-3 py-2" />
          </div>
        </div>

        <div>
          <label className="block text-sm font-medium">Link do arkusza Google (opcjonalnie)</label>
          <input name="gsheet_url" className="mt-1 w-full rounded border px-3 py-2" placeholder="https://docs.google.com/spreadsheets/d/..." />
          <p className="mt-1 text-xs text-slate-500">ID arkusza wyciÄ…gniemy automatycznie (lub podaj poniÅ¼ej).</p>
        </div>

        <div className="grid grid-cols-1 gap-4 sm:grid-cols-3">
          <div className="sm:col-span-2">
            <label className="block text-sm font-medium">ID arkusza (opcjonalnie)</label>
            <input name="gsheet_id" className="mt-1 w-full rounded border px-3 py-2" placeholder="np. 1AbCDeFg..." />
          </div>
          <div>
            <label className="block text-sm font-medium">Nazwa karty (opcjonalnie)</label>
            <input name="arkusz_nazwa" className="mt-1 w-full rounded border px-3 py-2" placeholder="np. Lista" />
          </div>
        </div>

        <div className="grid grid-cols-1 gap-4 sm:grid-cols-3">
          <div>
            <label className="block text-sm font-medium">Kolumna nazwisk</label>
            <input name="kolumna_nazwisk" className="mt-1 w-full rounded border px-3 py-2" placeholder="np. B" maxLength={2} />
            <p className="mt-1 text-xs text-slate-500">Jedna litera Aâ€“Z.</p>
          </div>
          <div>
            <label className="block text-sm font-medium">Pierwszy wiersz z nazwiskiem</label>
            <input type="number" name="pierwszy_wiersz_z_nazwiskiem" min={1} defaultValue={2} className="mt-1 w-full rounded border px-3 py-2" />
          </div>
          <div>
            <label className="block text-sm font-medium">Limit graczy (opcjonalnie)</label>
            <input type="number" name="limit_graczy" min={1} className="mt-1 w-full rounded border px-3 py-2" />
          </div>
        </div>

        {/* NOWE: LAT/LNG + guzik â€Dodaj pinezkÄ™â€ */}
        <div className="grid grid-cols-1 gap-4 sm:grid-cols-3">
          <div>
            <label className="block text-sm font-medium">Lat</label>
            <input id="lat" name="lat" className="mt-1 w-full rounded border px-3 py-2" placeholder="np. 52.2297" />
          </div>
          <div>
            <label className="block text-sm font-medium">Lng</label>
            <input id="lng" name="lng" className="mt-1 w-full rounded border px-3 py-2" placeholder="np. 21.0122" />
          </div>
          <div className="flex items-end">
            <MapPicker
              targetLatId="lat"
              targetLngId="lng"
              lat={null}
              lng={null}
              buttonLabel="Dodaj pinezkÄ™"
            />
          </div>
        </div>

        <div className="flex gap-2 pt-2">
          <button className="pill pill--primary" type="submit">UtwÃ³rz</button>
          <a href="/admin" className="pill pill--secondary">Anuluj</a>
        </div>
      </form>
    </main>
  )
}
```

### app/turniej/page.tsx

```
import { createSupabaseServer } from '@/lib/supabase/server'

export const dynamic = 'force-dynamic'
export const revalidate = 0

type Row = {
  id: string
  nazwa: string
  data_turnieju: string | null     // YYYY-MM-DD
  godzina_turnieju: string | null  // HH:MM[:SS]
  gsheet_url: string | null
  arkusz_nazwa: string | null
  limit_graczy: number | null
  lat: number | null
  lng: number | null
}

function joinDateTime(d: string | null, t: string | null): Date | null {
  if (!d) return null
  // godzina moÅ¼e byÄ‡ "HH:MM:SS" lub "HH:MM"; bierzemy HH:MM
  const hhmm = (t ?? '00:00').slice(0, 5)
  // traktujemy czas lokalny (Warszawa)
  return new Date(`${d}T${hhmm}`)
}

function formatDatePL(d: Date) {
  return d.toLocaleDateString('pl-PL', { weekday: 'short', month: 'short', day: 'numeric' })
}

function formatTimeHHMM(raw: string | null) {
  if (!raw) return '00:00'
  const hhmm = raw.slice(0,5)
  return hhmm
}

function statusBadge(start: Date | null) {
  if (!start) return null
  const now = new Date()
  const ms = start.getTime() - now.getTime()
  const sixHours = 6 * 60 * 60 * 1000

  if (ms > 0) {
    // przyszÅ‚oÅ›Ä‡
    const days = Math.floor(ms / (24 * 60 * 60 * 1000))
    if (days === 0) return { text: 'dzisiaj', style: 'bg-blue-50 text-blue-700 border-blue-200' }
    if (days === 1) return { text: 'jutro', style: 'bg-blue-50 text-blue-700 border-blue-200' }
    if (days === 2) return { text: 'pojutrze', style: 'bg-blue-50 text-blue-700 border-blue-200' }
    return { text: `za ${days} dni`, style: 'bg-blue-50 text-blue-700 border-blue-200' }
  } else {
    // przeszÅ‚oÅ›Ä‡/teraz
    const since = now.getTime() - start.getTime()
    if (since <= sixHours) return { text: 'w trakcie', style: 'bg-amber-50 text-amber-700 border-amber-200' }
    return { text: 'zakoÅ„czony', style: 'bg-slate-100 text-slate-700 border-slate-200' }
  }
}

export default async function TurniejListPage() {
  const supabase = await createSupabaseServer()
  const { data: rows } = await supabase
    .from('turniej')
    .select('id,nazwa,data_turnieju,godzina_turnieju,gsheet_url,arkusz_nazwa,limit_graczy,lat,lng')
    .order('data_turnieju', { ascending: true })
    .limit(200)

  return (
    <main className="mx-auto max-w-5xl p-6 space-y-5">
      <h1 className="text-2xl font-semibold">Turnieje</h1>

      <div className="space-y-4">
        {rows?.map((r) => {
          const start = joinDateTime(r.data_turnieju, r.godzina_turnieju)
          const badge = statusBadge(start)
          return (
            <details
              key={r.id}
              className="group rounded-xl border border-red-100 bg-white/80 backdrop-blur px-4 py-3 shadow-sm open:shadow transition-shadow"
            >
              <summary className="flex cursor-pointer list-none items-center justify-between gap-3">
                <div className="min-w-0">
                  <div className="truncate text-base font-semibold text-red-800">{r.nazwa}</div>
                  <div className="mt-0.5 text-xs text-red-700/80">
                    {start ? (
                      <>
                        {formatDatePL(start)} â€¢ {formatTimeHHMM(r.godzina_turnieju)}
                        {r.limit_graczy ? <> â€¢ limit: {r.limit_graczy}</> : null}
                      </>
                    ) : (
                      <>â€”</>
                    )}
                  </div>
                </div>
                {badge && (
                  <span className={`shrink-0 rounded-full border px-3 py-1 text-xs font-medium ${badge.style}`}>
                    {badge.text}
                  </span>
                )}
              </summary>

              {/* rozwijane szczegÃ³Å‚y */}
              <div className="mt-4 grid gap-4 sm:grid-cols-2">
                <div className="space-y-2">
                  <div className="text-sm font-medium text-slate-700">SzczegÃ³Å‚y</div>
                  <ul className="text-sm text-slate-700/90 leading-relaxed">
                    <li><span className="opacity-70">Data:</span> {start ? formatDatePL(start) : 'â€”'}</li>
                    <li><span className="opacity-70">Godzina:</span> {formatTimeHHMM(r.godzina_turnieju)}</li>
                    {r.limit_graczy && <li><span className="opacity-70">Limit graczy:</span> {r.limit_graczy}</li>}
                    {r.arkusz_nazwa && <li><span className="opacity-70">Arkusz (karta):</span> {r.arkusz_nazwa}</li>}
                  </ul>

                  {r.gsheet_url && (
                    <div className="pt-2">
                      <a
                        href={r.gsheet_url}
                        target="_blank"
                        rel="noreferrer"
                        className="inline-flex items-center gap-2 rounded-full border border-red-200 bg-white px-4 py-2 text-sm font-semibold text-red-700 hover:bg-red-50"
                      >
                        Arkusz Google
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden>
                          <path d="M14 3h7v7m0-7L10 14" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" />
                          <path d="M21 14v7H3V3h7" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" />
                        </svg>
                      </a>
                    </div>
                  )}
                </div>

                {/* mini mapa (tylko jeÅ›li sÄ… wspÃ³Å‚rzÄ™dne) */}
                <div className="space-y-2">
                  <div className="text-sm font-medium text-slate-700">Lokalizacja</div>
                  {r.lat !== null && r.lng !== null ? (
                    <div className="overflow-hidden rounded-lg border">
                      <div className="aspect-[16/9]">
                        <iframe
                          title={`Mapa ${r.nazwa}`}
                          src={`https://www.google.com/maps?q=${r.lat},${r.lng}&z=14&output=embed`}
                          className="h-full w-full"
                          loading="lazy"
                          referrerPolicy="no-referrer-when-downgrade"
                        />
                      </div>
                      <div className="border-t bg-slate-50/50 p-2 text-right">
                        <a
                          href={`https://www.google.com/maps/search/?api=1&query=${r.lat},${r.lng}`}
                          target="_blank"
                          rel="noreferrer"
                          className="text-xs font-medium text-red-700 hover:underline"
                        >
                          OtwÃ³rz w Mapach Google
                        </a>
                      </div>
                    </div>
                  ) : (
                    <div className="rounded-md border border-slate-200 bg-slate-50 px-3 py-2 text-sm text-slate-600">
                      Brak wspÃ³Å‚rzÄ™dnych.
                    </div>
                  )}
                </div>
              </div>
            </details>
          )
        })}

        {!rows?.length && (
          <div className="rounded-md border px-4 py-6 text-sm opacity-70">Brak turniejÃ³w.</div>
        )}
      </div>
    </main>
  )
}
```

### components/MapPicker.tsx

```
'use client'

import { useEffect, useRef, useState } from 'react'
import Script from 'next/script'

type Props = {
  targetLatId: string
  targetLngId: string
  lat?: number | null
  lng?: number | null
  buttonLabel?: string
}

export default function MapPicker({
  targetLatId,
  targetLngId,
  lat,
  lng,
  buttonLabel = 'Ustaw pinezkÄ™',
}: Props) {
  const [open, setOpen] = useState(false)
  const [apiReady, setApiReady] = useState(false)
  const [apiError, setApiError] = useState<string | null>(null)

  const mapRef = useRef<HTMLDivElement>(null)
  const markerRef = useRef<google.maps.Marker | null>(null)
  const gmapRef = useRef<google.maps.Map | null>(null)

  const defaultCenter = {
    lat: typeof lat === 'number' ? lat : 50.0620,
    lng: typeof lng === 'number' ? lng : 19.9371,
  }

  useEffect(() => {
    if (!open || !apiReady || !mapRef.current) return

    try {
      const map = new google.maps.Map(mapRef.current, {
        center: defaultCenter,
        zoom: 12,
      })
      gmapRef.current = map

      const marker = new google.maps.Marker({
        position: defaultCenter,
        map,
        draggable: true,
      })
      markerRef.current = marker

      map.addListener('click', (e: google.maps.MapMouseEvent) => {
        const pos = e.latLng
        if (pos) marker.setPosition(pos)
      })
    } catch (e) {
      setApiError('Nie moÅ¼na zainicjowaÄ‡ mapy (sprawdÅº klucz API/Console).')
      console.error(e)
    }

    return () => {
      markerRef.current?.setMap(null)
      markerRef.current = null
      gmapRef.current = null
    }
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [open, apiReady])

  function confirmPick() {
    const pos = markerRef.current?.getPosition()
    if (pos) {
      const latEl = document.getElementById(targetLatId) as HTMLInputElement | null
      const lngEl = document.getElementById(targetLngId) as HTMLInputElement | null
      if (latEl) latEl.value = String(pos.lat())
      if (lngEl) lngEl.value = String(pos.lng())
    }
    setOpen(false)
  }

  const apiKey = process.env.NEXT_PUBLIC_GOOGLE_MAPS_API_KEY
  const hasKey = Boolean(apiKey)

  return (
    <>
      {hasKey && (
        <Script
          id="google-maps"
          src={`https://maps.googleapis.com/maps/api/js?key=${apiKey}`}
          strategy="afterInteractive"
          onLoad={() => setApiReady(true)}
          onError={() => setApiError('Nie udaÅ‚o siÄ™ zaÅ‚adowaÄ‡ Google Maps JS API (sprawdÅº klucz/referrer).')}
        />
      )}

      <button type="button" className="pill pill--secondary" onClick={() => setOpen(true)}>
        {buttonLabel}
      </button>

      {open && (
        <div className="fixed inset-0 z-[100] flex items-center justify-center bg-black/40 p-4">
          <div className="w-full max-w-3xl rounded-lg bg-white shadow-lg">
            <div className="flex items-center justify-between border-b px-4 py-3">
              <h3 className="font-semibold">Wybierz lokalizacjÄ™</h3>
              <button type="button" className="text-sm underline" onClick={() => setOpen(false)}>Zamknij</button>
            </div>

            {!hasKey && (
              <div className="p-4 text-sm text-red-700">
                Brak zmiennej <code>NEXT_PUBLIC_GOOGLE_MAPS_API_KEY</code> w Å›rodowisku.
              </div>
            )}

            {apiError && (
              <div className="p-4 text-sm text-red-700">{apiError}</div>
            )}

            <div className="h-[60vh] w-full" ref={mapRef} />

            <div className="flex justify-end gap-2 border-t px-4 py-3">
              <button type="button" className="pill pill--secondary" onClick={() => setOpen(false)}>Anuluj</button>
              <button type="button" className="pill pill--primary" onClick={confirmPick} disabled={!apiReady}>
                Ustaw
              </button>
            </div>
          </div>
        </div>
      )}
    </>
  )
}
```

### components/Navbar.tsx

```
'use client'

import Link from 'next/link'
import { useEffect, useState } from 'react'
import { usePathname } from 'next/navigation'

type UserLite = { id: string; email?: string | null } | null
type Role = 'admin' | 'user' | null

export default function Navbar({ user, role }: { user: UserLite; role: Role }) {
  const [open, setOpen] = useState(false)
  const pathname = usePathname()
  useEffect(() => { setOpen(false) }, [pathname])

  const NavLink = ({ href, children }: { href: string; children: React.ReactNode }) => {
    const active = pathname === href
    return (
      <Link href={href} className={`nav-link ${active ? 'nav-link--active' : ''}`}>
        {children}
      </Link>
    )
  }

  const Arrow = ({ light }: { light?: boolean }) => (
    <span className={`pill__icon ${light ? 'pill__icon--light' : ''}`} aria-hidden>
      <svg width="12" height="12" viewBox="0 0 24 24" fill="none">
        <path d="M8 5l8 7-8 7" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" />
      </svg>
    </span>
  )

  return (
    <header className="sticky top-0 z-50 border-b border-red-200 bg-white/80 backdrop-blur">
      <div className="h-1 w-full bg-gradient-to-r from-red-600 via-red-500 to-red-600" />

      <nav className="mx-auto flex max-w-6xl items-center justify-between gap-4 px-4 py-3">
        <Link href="/" className="flex items-center gap-2">
          <span className="inline-block h-6 w-6 rounded bg-red-600" aria-hidden />
          <span className="text-lg font-semibold tracking-tight text-red-700">elo-arena</span>
        </Link>

        <div className="hidden md:flex items-center gap-1">
          <NavLink href="/">Strona gÅ‚Ã³wna</NavLink>
          <NavLink href="/turniej">Turnieje</NavLink>
          {user && <NavLink href="/profile">Profil</NavLink>}
          {role === 'admin' && <NavLink href="/admin">Admin</NavLink>}
        </div>

        <div className="hidden md:flex items-center gap-3">
          {user ? (
            <>
              <span
  className="pill pill--info max-w-[320px] truncate"
  title={user.email || undefined}
>
  <span className="opacity-70">Zalogowano:</span>&nbsp;{user.email ?? 'â€”'}
</span>
              <form action="/auth/signout" method="post">
                <button className="pill pill--secondary" aria-label="Wyloguj">
                  Wyloguj
                  <Arrow />
                </button>
              </form>
            </>
          ) : (
            <>
              <Link href="/auth/signin" className="pill pill--secondary">
                ZALOGUJ
                <Arrow />
              </Link>
              <Link href="/auth/signup" className="pill pill--primary">
                ZAÅÃ“Å» KONTO
                <Arrow light />
              </Link>
            </>
          )}
        </div>

        <button
          className="md:hidden inline-flex h-10 w-10 items-center justify-center rounded-md border border-red-200 text-red-700 hover:bg-red-50"
          onClick={() => setOpen(v => !v)}
          aria-label="OtwÃ³rz menu"
          aria-expanded={open}
        >
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none" aria-hidden>
            <path d="M4 6h16M4 12h16M4 18h16" stroke="currentColor" strokeWidth="2" strokeLinecap="round" />
          </svg>
        </button>
      </nav>

      {open && (
        <div className="md:hidden border-t border-red-200 bg-white">
          <div className="mx-auto flex max-w-6xl flex-col gap-2 px-4 py-3">
            <NavLink href="/">Strona gÅ‚Ã³wna</NavLink>
            <NavLink href="/turniej">Turnieje</NavLink>
            {user && <NavLink href="/profile">Profil</NavLink>}
            {role === 'admin' && <NavLink href="/admin">Admin</NavLink>}

            <div className="my-2 border-t border-red-100" />

            {user ? (
  <div className="flex items-center justify-between">
    <span
  className="pill pill--info max-w-[100%] truncate"
  title={user.email || undefined}
>
  <span className="opacity-70">Zalogowano:</span>&nbsp;{user.email ?? 'â€”'}
</span>

    <form action="/auth/signout" method="post">
      <button className="pill pill--secondary">
        Wyloguj <Arrow />
      </button>
    </form>
  </div>
) : (
              <div className="flex items-center gap-2">
                <Link href="/auth/signin" className="flex-1 text-center pill pill--secondary">
                  ZALOGUJ <Arrow />
                </Link>
                <Link href="/auth/signup" className="flex-1 text-center pill pill--primary">
                  ZAÅÃ“Å» KONTO <Arrow light />
                </Link>
              </div>
            )}
          </div>
        </div>
      )}
    </header>
  )
}
```

### eslint.config.mjs

```
import { defineConfig, globalIgnores } from "eslint/config";
import nextVitals from "eslint-config-next/core-web-vitals";
import nextTs from "eslint-config-next/typescript";

const eslintConfig = defineConfig([
  ...nextVitals,
  ...nextTs,
  // Override default ignores of eslint-config-next.
  globalIgnores([
    // Default ignores of eslint-config-next:
    ".next/**",
    "out/**",
    "build/**",
    "next-env.d.ts",
  ]),
]);

export default eslintConfig;
```

### lib/supabase/admin.ts

```
import { createClient } from '@supabase/supabase-js'

export const supabaseAdmin = createClient(
  process.env.NEXT_PUBLIC_SUPABASE_URL!,
  process.env.SUPABASE_SERVICE_ROLE!,   // tylko na serwerze!
  { auth: { persistSession: false } }
)
```

### lib/supabase/client.ts

```
'use client'
import { createBrowserClient } from '@supabase/ssr'
export const supabase = createBrowserClient(
  process.env.NEXT_PUBLIC_SUPABASE_URL!,
  process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!
)
```

### lib/supabase/server-mutable.ts

```
// lib/supabase/server-mutable.ts
import { cookies } from 'next/headers'
import { createServerClient, type CookieOptions } from '@supabase/ssr'

export async function createSupabaseServerMutable() {
  const store = await cookies()

  return createServerClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,
    {
      cookies: {
        get(name: string) {
          return store.get(name)?.value
        },
        set(name: string, value: string, options?: CookieOptions) {
          store.set({ name, value, ...options })
        },
        remove(name: string, options?: CookieOptions) {
          store.set({ name, value: '', ...options, maxAge: 0 })
        },
      },
    }
  )
}
```

### lib/supabase/server.ts

```
// lib/supabase/server.ts
import { cookies } from 'next/headers'
import { createServerClient, type CookieOptions } from '@supabase/ssr'

export async function createSupabaseServer() {
  // NEXT 15: cookies() jest async
  const store = await cookies()

  return createServerClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,
    {
      cookies: {
        get(name: string) {
          return store.get(name)?.value
        },
        // w RSC nie modyfikujemy cookies
        set(_name: string, _value: string, _options?: CookieOptions) {},
        remove(_name: string, _options?: CookieOptions) {},
      },
    }
  )
}
```

### next.config.ts

```
import type { NextConfig } from "next";

const nextConfig: NextConfig = {
  /* config options here */
  reactCompiler: true,
};

export default nextConfig;
```

### package.json

```
{
  "name": "elo-arena",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "eslint"
  },
  "dependencies": {
    "@supabase/ssr": "^0.7.0",
    "@supabase/supabase-js": "^2.80.0",
    "@vercel/analytics": "^1.5.0",
    "next": "16.0.1",
    "react": "19.2.0",
    "react-dom": "19.2.0"
  },
  "devDependencies": {
    "@types/google.maps": "^3.58.1",
    "@types/node": "^20",
    "@types/react": "^19",
    "@types/react-dom": "^19",
    "autoprefixer": "^10.4.21",
    "babel-plugin-react-compiler": "1.0.0",
    "eslint": "^9",
    "eslint-config-next": "16.0.1",
    "postcss": "^8.5.6",
    "tailwindcss": "^3.4.18",
    "typescript": "^5"
  }
}
```

### postcss.config.js

```
module.exports = {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
}
```

### tailwind.config.js

```
/** @type {import('tailwindcss').Config} */
module.exports = {
  content: [
    './app/**/*.{js,ts,jsx,tsx,mdx}',
    './components/**/*.{js,ts,jsx,tsx,mdx}',
    './pages/**/*.{js,ts,jsx,tsx,mdx}',
  ],
  theme: { extend: {} },
  plugins: [],
}
```

### tsconfig.json

```
{
  "compilerOptions": {
    "target": "ES2017",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "react-jsx",
    "incremental": true,
    "plugins": [
      {
        "name": "next"
      }
    ],
    "paths": {
      "@/*": ["./*"]
    }
  },
  "include": [
    "next-env.d.ts",
    "**/*.ts",
    "**/*.tsx",
    ".next/types/**/*.ts",
    ".next/dev/types/**/*.ts",
    "**/*.mts"
  ],
  "exclude": ["node_modules"]
}
```

