# Code snapshot (2025-11-21T18:43:33Z)

## Git

```
commit a1d71862ad0a3bb66f8d746e70e0de6219a04007
Author:     Michał <qwerkle.tabela@gmail.com>
AuthorDate: Fri Nov 21 19:42:48 2025 +0100
Commit:     Michał <qwerkle.tabela@gmail.com>
CommitDate: Fri Nov 21 19:42:48 2025 +0100

    modified Navbar button style for better aesthetics
```

## Tree

```
total 328
drwxr-xr-x 9 runner runner   4096 Nov 21 18:43 .
drwxr-xr-x 3 runner runner   4096 Nov 21 18:43 ..
drwxr-xr-x 7 runner runner   4096 Nov 21 18:43 .git
drwxr-xr-x 3 runner runner   4096 Nov 21 18:43 .github
-rw-r--r-- 1 runner runner    480 Nov 21 18:43 .gitignore
-rw-r--r-- 1 runner runner   1450 Nov 21 18:43 README.md
drwxr-xr-x 8 runner runner   4096 Nov 21 18:43 app
-rw-r--r-- 1 runner runner    354 Nov 21 18:43 code-snapshot.md
drwxr-xr-x 2 runner runner   4096 Nov 21 18:43 components
-rw-r--r-- 1 runner runner  11194 Nov 21 18:43 db.txt
-rw-r--r-- 1 runner runner    465 Nov 21 18:43 eslint.config.mjs
drwxr-xr-x 3 runner runner   4096 Nov 21 18:43 lib
-rw-r--r-- 1 runner runner    156 Nov 21 18:43 next.config.ts
-rw-r--r-- 1 runner runner 249796 Nov 21 18:43 package-lock.json
-rw-r--r-- 1 runner runner    746 Nov 21 18:43 package.json
-rw-r--r-- 1 runner runner     82 Nov 21 18:43 postcss.config.js
drwxr-xr-x 2 runner runner   4096 Nov 21 18:43 public
drwxr-xr-x 2 runner runner   4096 Nov 21 18:43 snapshots
-rw-r--r-- 1 runner runner    246 Nov 21 18:43 tailwind.config.js
-rw-r--r-- 1 runner runner    666 Nov 21 18:43 tsconfig.json

app/
app/api/resolve-email/route.ts
app/admin/turniej/page.tsx
app/admin/users/page.tsx
app/admin/page.tsx
app/globals.css
app/turniej/new/page.tsx
app/turniej/create/route.ts
app/turniej/page.tsx
app/auth/signout/route.ts
app/auth/login/route.ts
app/auth/signin/page.tsx
app/auth/signup/page.tsx
app/profile/update/route.ts
app/profile/page.tsx
app/layout.tsx
app/onboarding/username-form.tsx
app/onboarding/page.tsx
app/favicon.ico
app/page.tsx

components/
components/MapPicker.tsx
components/LoadGoogleMaps.tsx
components/SheetPicker.tsx
components/Navbar.tsx
components/AutoHide.tsx

lib/
lib/supabase/server-mutable.ts
lib/supabase/server.ts
lib/supabase/admin.ts
lib/supabase/client.ts
```

## Files

### app/admin/gracz/add/route.ts

```
// app/admin/gracz/add/route.ts
import { NextRequest, NextResponse } from 'next/server'
import { createSupabaseServerMutable } from '@/lib/supabase/server-mutable'

export async function POST(req: NextRequest) {
  const origin = req.nextUrl.origin
  const supabase = await createSupabaseServerMutable()

  const { data: { user } } = await supabase.auth.getUser()
  const { data: isAdmin } = await supabase.rpc('is_admin')
  if (!user || !isAdmin) {
    return NextResponse.redirect(new URL('/', origin), { status: 303 })
  }

  const fd = await req.formData()
  const imie = String(fd.get('imie') || '').trim()
  const nazwisko = String(fd.get('nazwisko') || '').trim()
  const back = String(fd.get('back') || '/admin') // gdzie wracamy po akcji

  if (!imie || !nazwisko) {
    return NextResponse.redirect(new URL(`${back}?e=add_invalid`, origin), { status: 303 })
  }

  const { error } = await supabase
    .from('gracz')
    .upsert({ imie, nazwisko }, { onConflict: 'fullname_norm' })

  const url = new URL(back, origin)
  if (error) url.searchParams.set('e', 'add_failed')
  else url.searchParams.set('ok', '1')
  return NextResponse.redirect(url, { status: 303 })
}
```

### app/admin/page.tsx

```
import { createSupabaseServer } from '@/lib/supabase/server'
import { redirect } from 'next/navigation'
import Link from 'next/link'

export const dynamic = 'force-dynamic'
export const revalidate = 0

export default async function AdminPage() {
  const supabase = await createSupabaseServer()
  const { data: { user } } = await supabase.auth.getUser()
  if (!user) redirect('/auth/signin')

  const { data: isAdmin } = await supabase.rpc('is_admin')
  if (!isAdmin) redirect('/')

  return (
    <main className="mx-auto max-w-5xl p-6 space-y-8">
      <header>
        <h1 className="text-2xl font-semibold">Panel admina</h1>
        <p className="mt-1 text-sm text-slate-600">Szybkie akcje i zarządzanie.</p>
      </header>

      {/* Sekcja: Zarządzaj użytkownikami */}
      <section className="space-y-3">
        <h2 className="text-lg font-semibold">Zarządzaj użytkownikami</h2>
        <div className="flex flex-wrap gap-3">
          <Link href="/admin/users" className="pill pill--secondary">Lista użytkowników</Link>
        </div>
      </section>

      {/* Sekcja: Turnieje */}
      <section className="space-y-3">
        <h2 className="text-lg font-semibold">Turnieje</h2>
        <div className="flex flex-wrap gap-3">
          <Link href="/admin/turniej" className="pill pill--secondary">Lista turniejów</Link>
          <Link href="/turniej/new" className="pill pill--primary">Dodaj turniej</Link>

        </div>
      </section>
      
    </main>
  )
}
```

### app/admin/turniej/[id]/edit/page.tsx

```
// app/admin/turniej/[id]/edit/page.tsx
import { redirect } from 'next/navigation'
import { createSupabaseServer } from '@/lib/supabase/server'
import Link from 'next/link'
import MapPicker from '@/components/MapPicker'
import AutoHide from '@/components/AutoHide'
import SheetPicker from '@/components/SheetPicker' // Client component

export const dynamic = 'force-dynamic'
export const revalidate = 0

type Params = Promise<{ id: string }>
type SearchParams = Promise<Record<string, string | string[] | undefined>>

type TurniejRow = {
  id: string
  nazwa: string | null
  data_turnieju: string | null
  godzina_turnieju: string | null
  gsheet_url: string | null
  gsheet_id: string | null
  arkusz_nazwa: string | null
  kolumna_nazwisk: string | null
  pierwszy_wiersz_z_nazwiskiem: number | null
  limit_graczy: number | null
  lat: number | null
  lng: number | null
}

type WynikRow = {
  id: string
  gracz_id: string
  full_name: string | null
  club: string | null
  status: string | null
  seed: number | null
  miejsce: number | null
  punkty: number | null
}

/** Parser CSV (prosty, wspiera cudzysłowy) + heurystyka separatora , / ; */
function parseCsv(text: string): string[][] {
  const firstLine = text.split(/\r?\n/)[0] ?? ''
  const sep = (firstLine.match(/;/g)?.length ?? 0) > (firstLine.match(/,/g)?.length ?? 0) ? ';' : ','
  const rows: string[][] = []
  let i = 0, field = '', row: string[] = [], inQuotes = false
  while (i < text.length) {
    const ch = text[i]
    if (inQuotes) {
      if (ch === '"') {
        if (text[i + 1] === '"') { field += '"'; i += 2; continue }
        inQuotes = false; i++; continue
      }
      field += ch; i++; continue
    } else {
      if (ch === '"') { inQuotes = true; i++; continue }
      if (ch === sep) { row.push(field); field = ''; i++; continue }
      if (ch === '\n') { row.push(field); rows.push(row); row = []; field = ''; i++; continue }
      if (ch === '\r') { i++; continue }
      field += ch; i++
    }
  }
  row.push(field); rows.push(row)
  return rows
}

/** A→0, B→1, ... */
function colLetterToIndex(letter: string) {
  const l = letter.trim().toUpperCase()
  if (!/^[A-Z]+$/.test(l)) return null
  let idx = 0
  for (let i = 0; i < l.length; i++) idx = idx * 26 + (l.charCodeAt(i) - 64)
  return idx - 1
}

/** Odogonkowienie PL */
function unaccentPl(s: string) {
  const map: Record<string, string> = {
    'ą':'a','ć':'c','ę':'e','ł':'l','ń':'n','ó':'o','ś':'s','ź':'z','ż':'z',
    'Ą':'A','Ć':'C','Ę':'E','Ł':'L','Ń':'N','Ó':'O','Ś':'S','Ź':'Z','Ż':'Z'
  }
  return s.replace(/[ĄĆĘŁŃÓŚŹŻąćęłńóśźż]/g, ch => map[ch] ?? ch)
}

/** Normalizacja jak w SQL public.norm_txt */
function normTxt(s: string) {
  return unaccentPl(s)
    .toLowerCase()
    .normalize('NFD')
    .replace(/[\u0300-\u036f]/g, '')
    .replace(/\s+/g, ' ')
    .trim()
}

/** „Imię Nazwisko” → { imie, nazwisko } */
function splitFullName(full: string) {
  const clean = full.replace(/\s+/g, ' ').trim()
  if (!clean) return null
  const parts = clean.split(' ')
  const nazwisko = parts.pop()!
  const imie = parts.join(' ')
  if (!imie || !nazwisko) return null
  return { imie, nazwisko }
}

/** Budowa URL CSV z gsheet_url (+ opcjonalnie nazwa karty) */
function buildCsvUrl(sheetUrl: string, sheetName?: string | null) {
  const m = sheetUrl.match(/spreadsheets\/d\/([a-zA-Z0-9-_]+)/)
  const id = m?.[1]
  if (!id) return null
  if (sheetName && !/^\d+$/.test(sheetName)) {
    return `https://docs.google.com/spreadsheets/d/${id}/gviz/tq?tqx=out:csv&sheet=${encodeURIComponent(sheetName)}`
  }
  const gidMatch = sheetUrl.match(/[?&]gid=(\d+)/)
  const gid = gidMatch?.[1]
  if (gid) return `https://docs.google.com/spreadsheets/d/${id}/export?format=csv&gid=${gid}`
  return `https://docs.google.com/spreadsheets/d/${id}/export?format=csv`
}

/** Usuwa BOM, NBSP, zero-width; normalizuje spacje */
function cleanCell(s: string) {
  return String(s ?? '')
    .replace(/^\uFEFF/, '')
    .replace(/[\u00A0\u200B\u200C\u200D\u2060]/g, ' ')
    .replace(/\s+/g, ' ')
    .trim()
}

export default async function EditTurniejPage({ params, searchParams }: { params: Params, searchParams: SearchParams }) {
  const { id } = await params
  const sp = await searchParams
  const ok = sp.ok === '1'
  const err = typeof sp.e === 'string' ? sp.e : undefined

  const supabase = await createSupabaseServer()
  const { data: { user } } = await supabase.auth.getUser()
  if (!user) redirect('/auth/signin')
  const { data: isAdmin } = await supabase.rpc('is_admin')
  if (!isAdmin) redirect('/')

  const { data: t } = await supabase
    .from('turniej')
    .select('*')
    .eq('id', id)
    .maybeSingle<TurniejRow>()
  if (!t) redirect('/admin/turniej')

  const { data: uczestnicy } = await supabase
    .from('v_wyniki')
    .select('id, gracz_id, full_name, club, status, seed, miejsce, punkty')
    .eq('turniej_id', id)
    .order('miejsce', { ascending: true, nullsFirst: false })
    .order('seed', { ascending: true, nullsFirst: false })
    .returns<WynikRow[]>() // <-- uczestnicy: WynikRow[] | null

  // ---- PODGLĄD Z ARKUSZA ----
  let preview: string[] = []
  let previewError: string | null = null

  if (t.gsheet_url && t.kolumna_nazwisk && t.pierwszy_wiersz_z_nazwiskiem) {
    try {
      const csvUrl = buildCsvUrl(t.gsheet_url, t.arkusz_nazwa)
      if (!csvUrl) throw new Error('Nieprawidłowy link do arkusza')
      const resp = await fetch(csvUrl, { cache: 'no-store' })
      if (!resp.ok) throw new Error(`Nie udało się pobrać CSV (${resp.status})`)
      const text = await resp.text()

      const rows = parseCsv(text)
      const colIdx = colLetterToIndex(t.kolumna_nazwisk)
      if (colIdx == null) throw new Error('Nieprawidłowa kolumna (użyj litery, np. B)')

      const startAt = Number(t.pierwszy_wiersz_z_nazwiskiem) || 1 // 1-based
      const rowsFrom = rows.filter((_, idx) => idx + 1 >= startAt)
      preview = rowsFrom.map(r => cleanCell(r[colIdx] ?? ''))
    } catch (e: any) {
      previewError = e?.message || 'Błąd podglądu arkusza'
    }
  }

  // Przygotuj listę do sprawdzenia w bazie tylko dla poprawnych „Imię Nazwisko”
  const toParse = preview
    .map(raw => {
      const clean = raw.replace(/\s+/g, ' ').trim()
      if (!clean) return null
      const parts = clean.split(' ')
      if (parts.length < 2) return null
      const nazwisko = parts.pop()!
      const imie = parts.join(' ')
      if (!imie || !nazwisko) return null
      const norm = normTxt(`${imie} ${nazwisko}`)
      return { raw: clean, imie, nazwisko, norm }
    })
    .filter(Boolean) as { raw: string, imie: string, nazwisko: string, norm: string }[]

  let existsMap = new Map<string, true>()
  if (toParse.length) {
    const norms = Array.from(new Set(toParse.map(r => r.norm)))
    const { data: found } = await supabase
      .from('gracz')
      .select('fullname_norm')
      .in('fullname_norm', norms)
    found?.forEach(r => { if (r.fullname_norm) existsMap.set(String(r.fullname_norm), true) })
  }

  return (
    <main className="mx-auto max-w-5xl p-6 space-y-8">
      <div className="flex items-center justify-between">
        <h1 className="text-2xl font-semibold">Edytuj: {t.nazwa}</h1>
        <Link href="/admin/turniej" className="pill pill--secondary">← Lista</Link>
      </div>

      {ok && (
        <AutoHide>
          <div className="rounded-md border border-green-200 bg-green-50 px-3 py-2 text-sm text-green-700">
            Zapisano.
          </div>
        </AutoHide>
      )}
      {err && (
        <AutoHide>
          <div className="rounded-md border border-red-200 bg-red-50 px-3 py-2 text-sm text-red-700">
            {err === 'add_failed' && 'Nie udało się dodać gracza.'}
            {err === 'add_invalid' && 'Brak imienia lub nazwiska.'}
            {!['add_failed', 'add_invalid'].includes(err) && 'Nie udało się zapisać.'}
          </div>
        </AutoHide>
      )}

      {/* Formularz turnieju */}
      <form action={`/admin/turniej/${t.id}/update`} method="post" className="space-y-5 max-w-2xl">
        <div>
          <label className="block text-sm font-medium">Nazwa *</label>
          <input name="nazwa" defaultValue={t.nazwa ?? ''} required className="mt-1 w-full rounded border px-3 py-2" />
        </div>

        <div className="grid grid-cols-1 gap-4 sm:grid-cols-2">
          <div>
            <label className="block text-sm font-medium">Data *</label>
            <input type="date" name="data_turnieju" defaultValue={t.data_turnieju ?? ''} required className="mt-1 w-full rounded border px-3 py-2" />
          </div>
          <div>
            <label className="block text-sm font-medium">Godzina *</label>
            <input type="time" name="godzina_turnieju" defaultValue={t.godzina_turnieju ?? ''} required className="mt-1 w-full rounded border px-3 py-2" />
          </div>
        </div>

        <div>
          <label className="block text-sm font-medium">Link do arkusza Google</label>
          <input
            id="gsheet_url"                 // ID potrzebne dla SheetPicker
            name="gsheet_url"
            defaultValue={t.gsheet_url ?? ''}
            className="mt-1 w-full rounded border px-3 py-2"
            placeholder="https://docs.google.com/spreadsheets/d/..."
          />
        </div>

        <div className="grid grid-cols-1 gap-4 sm:grid-cols-3">
          <div className="sm:col-span-2">
            <label className="block text-sm font-medium">ID arkusza</label>
            <input name="gsheet_id" defaultValue={t.gsheet_id ?? ''} className="mt-1 w-full rounded border px-3 py-2" />
          </div>
          <div>
            <label className="block text-sm font-medium">Nazwa karty</label>
            <input
              id="arkusz_nazwa"            // ID potrzebne dla SheetPicker
              name="arkusz_nazwa"
              defaultValue={t.arkusz_nazwa ?? ''}
              className="mt-1 w-full rounded border px-3 py-2"
              placeholder="np. Lista"
            />
          </div>
        </div>

        {/* Wybór karty z pliku (klient) */}
        <div>
          <label className="block text-sm font-medium">Wybierz kartę z pliku</label>
          <div className="mt-1">
            <SheetPicker
              urlInputId="gsheet_url"
              sheetInputId="arkusz_nazwa"
              // gidHiddenInputId="arkusz_gid" // opcjonalnie, jeśli dodasz hidden input
            />
          </div>
        </div>

        <div className="grid grid-cols-1 gap-4 sm:grid-cols-3">
          <div>
            <label className="block text-sm font-medium">Kolumna nazwisk</label>
            <input name="kolumna_nazwisk" defaultValue={t.kolumna_nazwisk ?? ''} className="mt-1 w-full rounded border px-3 py-2" placeholder="np. B" maxLength={2} />
          </div>
          <div>
            <label className="block text-sm font-medium">Pierwszy wiersz</label>
            <input
              type="number"
              name="pierwszy_wiersz_z_nazwiskiem"
              defaultValue={t.pierwszy_wiersz_z_nazwiskiem ?? 2}
              min={1}
              className="mt-1 w-full rounded border px-3 py-2"
            />
          </div>
          <div>
            <label className="block text-sm font-medium">Limit graczy</label>
            <input type="number" name="limit_graczy" defaultValue={t.limit_graczy ?? ''} min={1} className="mt-1 w-full rounded border px-3 py-2" />
          </div>
        </div>

        {/* LAT/LNG + MapPicker */}
        <div className="grid grid-cols-1 gap-4 sm:grid-cols-3">
          <div>
            <label className="block text-sm font-medium">Lat</label>
            <input id="lat" name="lat" defaultValue={t.lat ?? ''} className="mt-1 w-full rounded border px-3 py-2" />
          </div>
          <div>
            <label className="block text-sm font-medium">Lng</label>
            <input id="lng" name="lng" defaultValue={t.lng ?? ''} className="mt-1 w-full rounded border px-3 py-2" />
          </div>
          <div className="flex items-end">
            <MapPicker
              targetLatId="lat"
              targetLngId="lng"
              lat={t.lat ?? null}
              lng={t.lng ?? null}
              buttonLabel="Ustaw pinezkę"
            />
          </div>
        </div>

        <div className="flex gap-2 pt-2">
          <button className="pill pill--primary" type="submit">Zapisz</button>
          <Link href="/admin/turniej" className="pill pill--secondary">Anuluj</Link>
        </div>
      </form>

      {/* --- Podgląd z arkusza (na stronie) --- */}
      <section className="grid grid-cols-1 lg:grid-cols-2 gap-6">
        {/* Kolumna 1: lista uczestników (z bazy) */}
        <div className="space-y-2">
          <h3 className="text-base font-semibold">Lista uczestników (z bazy)</h3>
          <div className="overflow-x-auto rounded border">
            <table className="min-w-full text-sm border-collapse">
              <thead className="bg-red-50">
                <tr className="border-b">
                  <th className="px-3 py-2 text-left">#</th>
                  <th className="px-3 py-2 text-left">Zawodnik</th>
                  <th className="px-3 py-2 text-left">Status</th>
                  <th className="px-3 py-2 text-left">Seed</th>
                  <th className="px-3 py-2 text-left">Miejsce</th>
                  <th className="px-3 py-2 text-left">Punkty</th>
                </tr>
              </thead>
              <tbody>
                {uczestnicy?.map((r, i) => (
                  <tr key={r.id} className="border-b last:border-0">
                    <td className="px-3 py-2">{i + 1}</td>
                    <td className="px-3 py-2">{r.full_name ?? '—'}</td>
                    <td className="px-3 py-2">{r.status ?? 'registered'}</td>
                    <td className="px-3 py-2">{r.seed ?? '—'}</td>
                    <td className="px-3 py-2">{r.miejsce ?? '—'}</td>
                    <td className="px-3 py-2">{r.punkty ?? '—'}</td>
                  </tr>
                ))}
                {!(uczestnicy && uczestnicy.length) && (
                  <tr>
                    <td className="px-3 py-6 text-sm opacity-60" colSpan={6}>
                      Brak uczestników. Użyj importu lub dodaj ręcznie.
                    </td>
                  </tr>
                )}
              </tbody>
            </table>
          </div>
        </div>

        {/* Kolumna 2: podgląd kolumny z arkusza + status w bazie + dodawanie */}
        <div className="space-y-2">
          <h3 className="text-base font-semibold">Podgląd z arkusza (kolumna)</h3>
          <p className="text-xs text-slate-600">
            {t.gsheet_url ? <>Źródło: <a className="underline" href={t.gsheet_url} target="_blank" rel="noreferrer">Google Sheet</a></> : 'Brak linku'}
            {t.kolumna_nazwisk ? <> • kolumna: <strong>{t.kolumna_nazwisk}</strong></> : null}
            {typeof t.pierwszy_wiersz_z_nazwiskiem === 'number' ? <> • od wiersza: <strong>{t.pierwszy_wiersz_z_nazwiskiem}</strong></> : null}
          </p>

          {previewError && (
            <div className="rounded-md border border-amber-200 bg-amber-50 px-3 py-2 text-sm text-amber-800">
              {previewError}
            </div>
          )}

          <div className="overflow-x-auto rounded border">
            <table className="min-w-full text-sm border-collapse">
              <thead className="bg-slate-50">
                <tr className="border-b">
                  <th className="px-3 py-2 text-left">#</th>
                  <th className="px-3 py-2 text-left">Z arkusza</th>
                  <th className="px-3 py-2 text-left">Status w bazie</th>
                  <th className="px-3 py-2 text-left">Akcja</th>
                </tr>
              </thead>
              <tbody>
```

### app/admin/turniej/[id]/import/preview/route.ts

```
import { NextRequest, NextResponse } from 'next/server'
import { createSupabaseServer } from '@/lib/supabase/server'

// pomocnicze funkcje (te same co w imporcie)
function buildCsvUrl(sheetUrl: string, sheetName?: string | null) {
  const m = sheetUrl.match(/spreadsheets\/d\/([a-zA-Z0-9-_]+)/)
  const id = m?.[1]; if (!id) return null
  if (sheetName && !/^\d+$/.test(sheetName)) {
    return `https://docs.google.com/spreadsheets/d/${id}/gviz/tq?tqx=out:csv&sheet=${encodeURIComponent(sheetName)}`
  }
  const gidMatch = sheetUrl.match(/[?&]gid=(\d+)/)
  const gid = gidMatch?.[1]
  if (gid) return `https://docs.google.com/spreadsheets/d/${id}/export?format=csv&gid=${gid}`
  return `https://docs.google.com/spreadsheets/d/${id}/export?format=csv`
}

function colLetterToIndex(letter: string) {
  const l = letter.trim().toUpperCase()
  if (!/^[A-Z]+$/.test(l)) return null
  let idx = 0
  for (let i = 0; i < l.length; i++) idx = idx * 26 + (l.charCodeAt(i) - 64)
  return idx - 1
}

function parseCsv(text: string): string[][] {
  const firstLine = text.split(/\r?\n/)[0] ?? ''
  const sep = (firstLine.match(/;/g)?.length ?? 0) > (firstLine.match(/,/g)?.length ?? 0) ? ';' : ','
  const rows: string[][] = []
  let i = 0, field = '', row: string[] = [], inQuotes = false
  while (i < text.length) {
    const ch = text[i]
    if (inQuotes) {
      if (ch === '"') { if (text[i + 1] === '"') { field += '"'; i += 2; continue } inQuotes = false; i++; continue }
      field += ch; i++; continue
    } else {
      if (ch === '"') { inQuotes = true; i++; continue }
      if (ch === sep) { row.push(field); field = ''; i++; continue }
      if (ch === '\n') { row.push(field); rows.push(row); row = []; field = ''; i++; continue }
      if (ch === '\r') { i++; continue }
      field += ch; i++
    }
  }
  row.push(field); rows.push(row)
  return rows
}

export async function GET(req: NextRequest, ctx: { params: Promise<{ id: string }> }) {
  const { id } = await ctx.params
  const supabase = await createSupabaseServer()

  // auth + admin
  const { data: { user } } = await supabase.auth.getUser()
  const { data: isAdmin } = await supabase.rpc('is_admin')
  if (!user || !isAdmin) {
    return new NextResponse('Unauthorized', { status: 401 })
  }

  // turniej
  const { data: t, error } = await supabase
    .from('turniej')
    .select('nazwa, gsheet_url, arkusz_nazwa, kolumna_nazwisk, pierwszy_wiersz_z_nazwiskiem')
    .eq('id', id)
    .maybeSingle()
  if (error || !t) return new NextResponse('Turniej nie znaleziony', { status: 404 })

  if (!t.gsheet_url || !t.kolumna_nazwisk || !t.pierwszy_wiersz_z_nazwiskiem) {
    return new NextResponse('Brak konfiguracji arkusza (url/kolumna/pierwszy wiersz)', { status: 400 })
  }

  const csvUrl = buildCsvUrl(t.gsheet_url, t.arkusz_nazwa)
  if (!csvUrl) return new NextResponse('Zły link do arkusza', { status: 400 })

  let csv = ''
  try {
    const r = await fetch(csvUrl, { headers: { 'cache-control': 'no-cache' } })
    if (!r.ok) return new NextResponse(`Nie można pobrać CSV (${r.status})`, { status: 400 })
    csv = await r.text()
  } catch {
    return new NextResponse('Błąd pobierania CSV', { status: 400 })
  }

  const colIdx = colLetterToIndex(t.kolumna_nazwisk)
  if (colIdx == null) return new NextResponse('Nieprawidłowa kolumna', { status: 400 })

  const rows = parseCsv(csv)
  const startAt = Math.max(1, t.pierwszy_wiersz_z_nazwiskiem || 1)
  const names = rows.slice(startAt - 1).map(r => (r[colIdx] || '').trim()).filter(Boolean)

  // prosty HTML – lista tylko z podanej kolumny
  const html = `<!doctype html>
<html lang="pl">
<meta charset="utf-8" />
<title>Podgląd: ${t.nazwa ?? 'Turniej'}</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<style>
  body { font-family: ui-sans-serif, system-ui, sans-serif; padding: 16px; }
  h1 { font-size: 18px; margin: 0 0 12px; }
  ol { padding-left: 20px; }
  li { padding: 4px 0; border-bottom: 1px solid #eee; }
  .meta { color:#6b7280; font-size:12px; margin: 6px 0 12px; }
</style>
<h1>Podgląd kolumny nazwisk</h1>
<div class="meta">
Źródło: ${t.gsheet_url ? `<a href="${t.gsheet_url}" target="_blank" rel="noreferrer">Arkusz</a>` : '—'}
 • kolumna: <b>${t.kolumna_nazwisk}</b>
 • od wiersza: <b>${startAt}</b>
</div>
<ol>
  ${names.map(n => `<li>${n.replace(/</g, '&lt;')}</li>`).join('\n')}
</ol>
</html>`
  return new NextResponse(html, { status: 200, headers: { 'content-type': 'text/html; charset=utf-8' } })
}
```

### app/admin/turniej/[id]/import/route.ts

```
// app/admin/turniej/[id]/import/route.ts
import { NextRequest, NextResponse } from 'next/server'
import { createSupabaseServerMutable } from '@/lib/supabase/server-mutable'

type TurniejRow = {
  id: string
  nazwa: string | null
  gsheet_url: string | null
  arkusz_nazwa: string | null
  kolumna_nazwisk: string | null
  pierwszy_wiersz_z_nazwiskiem: number | null
}

/** Buduje URL CSV z gsheet_url i (opcjonalnie) nazwą karty. */
function buildCsvUrl(sheetUrl: string, sheetName?: string | null) {
  const m = sheetUrl.match(/spreadsheets\/d\/([a-zA-Z0-9-_]+)/)
  const id = m?.[1]
  if (!id) return null

  // Jeśli jest nazwa karty – użyj gviz CSV
  if (sheetName && !/^\d+$/.test(sheetName)) {
    return `https://docs.google.com/spreadsheets/d/${id}/gviz/tq?tqx=out:csv&sheet=${encodeURIComponent(sheetName)}`
  }

  // Jeśli w URL jest gid – użyj go
  const gidMatch = sheetUrl.match(/[?&]gid=(\d+)/)
  const gid = gidMatch?.[1]
  if (gid) return `https://docs.google.com/spreadsheets/d/${id}/export?format=csv&gid=${gid}`

  // Domyślnie: pierwsza karta
  return `https://docs.google.com/spreadsheets/d/${id}/export?format=csv`
}

/** Zamienia literę kolumny (np. "B") na indeks 0-based. */
function colLetterToIndex(letter: string) {
  const l = letter.trim().toUpperCase()
  if (!/^[A-Z]+$/.test(l)) return null
  let idx = 0
  for (let i = 0; i < l.length; i++) {
    idx = idx * 26 + (l.charCodeAt(i) - 64)
  }
  return idx - 1
}

/** Prosty parser CSV: wspiera cudzysłowy i separator , lub ; */
function parseCsv(text: string): string[][] {
  const firstLine = text.split(/\r?\n/)[0] ?? ''
  const sep = (firstLine.match(/;/g)?.length ?? 0) > (firstLine.match(/,/g)?.length ?? 0) ? ';' : ','
  const rows: string[][] = []
  let i = 0, field = '', row: string[] = [], inQuotes = false
  while (i < text.length) {
    const ch = text[i]
    if (inQuotes) {
      if (ch === '"') {
        if (text[i + 1] === '"') { field += '"'; i += 2; continue }
        inQuotes = false; i++; continue
      } else { field += ch; i++; continue }
    } else {
      if (ch === '"') { inQuotes = true; i++; continue }
      if (ch === sep) { row.push(field); field = ''; i++; continue }
      if (ch === '\n') { row.push(field); rows.push(row); row = []; field = ''; i++; continue }
      if (ch === '\r') { i++; continue }
      field += ch; i++
    }
  }
  row.push(field); rows.push(row)
  return rows
}

/** Rozbija „Imię Nazwisko” na { imie, nazwisko }. Ostatnie słowo = nazwisko. */
function splitFullName(full: string) {
  const clean = full.replace(/\s+/g, ' ').trim()
  if (!clean) return null
  const parts = clean.split(' ')
  const nazwisko = parts.pop()!
  const imie = parts.join(' ')
  if (!imie || !nazwisko) return null
  return { imie, nazwisko }
}

export async function POST(req: NextRequest, ctx: { params: Promise<{ id: string }> }) {
  const { id } = await ctx.params
  const origin = req.nextUrl.origin
  const supabase = await createSupabaseServerMutable()

  // auth + admin
  const { data: { user } } = await supabase.auth.getUser()
  if (!user) return NextResponse.redirect(new URL('/auth/signin', origin), { status: 303 })
  const { data: isAdmin } = await supabase.rpc('is_admin')
  if (!isAdmin) return NextResponse.redirect(new URL('/', origin), { status: 303 })

  // pobierz konfigurację turnieju
  const { data: t, error: terr } = await supabase
    .from('turniej')
    .select('id, nazwa, gsheet_url, arkusz_nazwa, kolumna_nazwisk, pierwszy_wiersz_z_nazwiskiem')
    .eq('id', id)
    .single<TurniejRow>()

  if (terr || !t) {
    console.error('[import] no_tournament', terr)
    return NextResponse.redirect(new URL(`/admin/turniej/${id}/edit?e=no_tournament`, origin), { status: 303 })
  }
  if (!t.gsheet_url || !t.kolumna_nazwisk || !t.pierwszy_wiersz_z_nazwiskiem) {
    return NextResponse.redirect(new URL(`/admin/turniej/${id}/edit?e=missing_sheet_cfg`, origin), { status: 303 })
  }

  const csvUrl = buildCsvUrl(t.gsheet_url, t.arkusz_nazwa)
  if (!csvUrl) {
    return NextResponse.redirect(new URL(`/admin/turniej/${id}/edit?e=bad_sheet_url`, origin), { status: 303 })
  }

  // pobierz CSV
  let csvText = ''
  try {
    const resp = await fetch(csvUrl, { headers: { 'cache-control': 'no-cache' } })
    if (!resp.ok) {
      console.error('[import] fetch_failed', resp.status, await resp.text().catch(() => ''))
      return NextResponse.redirect(new URL(`/admin/turniej/${id}/edit?e=fetch_failed&s=${resp.status}`, origin), { status: 303 })
    }
    csvText = await resp.text()
  } catch (e) {
    console.error('[import] fetch_error', e)
    return NextResponse.redirect(new URL(`/admin/turniej/${id}/edit?e=fetch_failed`, origin), { status: 303 })
  }

  // CSV -> rows -> wybór kolumny
  const rows = parseCsv(csvText)
  const colIdx = colLetterToIndex(t.kolumna_nazwisk!)
  if (colIdx == null) {
    return NextResponse.redirect(new URL(`/admin/turniej/${id}/edit?e=col_invalid`, origin), { status: 303 })
  }

  const startAt = Math.max(1, t.pierwszy_wiersz_z_nazwiskiem || 1) // 1-based
  const picked = rows.slice(startAt - 1).map(r => (r[colIdx] || '').trim()).filter(Boolean)
  if (!picked.length) {
    console.warn('[import] empty_after_parse', { startAt, colIdx, totalRows: rows.length })
    return NextResponse.redirect(new URL(`/admin/turniej/${id}/edit?e=empty_after_parse`, origin), { status: 303 })
  }

  // przygotuj payload graczy
  const grPayload: { imie: string; nazwisko: string }[] = []
  for (const full of picked) {
    const s = splitFullName(full)
    if (!s) continue
    grPayload.push({ imie: s.imie, nazwisko: s.nazwisko })
  }
  if (!grPayload.length) {
    return NextResponse.redirect(new URL(`/admin/turniej/${id}/edit?e=empty_after_parse`, origin), { status: 303 })
  }

  // upsert graczy po kolumnie unikatowej (fullname_norm)
  const { data: inserted, error: gerr } = await supabase
    .from('gracz')
    .upsert(grPayload, { onConflict: 'fullname_norm' }) // <- poprawka
    .select('id')

  if (gerr) {
    console.error('[import] gracz_upsert_failed', gerr)
    return NextResponse.redirect(new URL(`/admin/turniej/${id}/edit?e=gracz_upsert_failed`, origin), { status: 303 })
  }

  // zbuduj payload do wyniki (unikat: turniej_id, gracz_id)
  const ids = new Set<string>()
  inserted?.forEach(r => ids.add(r.id))

  const wynikiPayload = Array.from(ids).map(gracz_id => ({ turniej_id: id, gracz_id }))
  if (wynikiPayload.length) {
    const { error: werr } = await supabase
      .from('wyniki')
      .upsert(wynikiPayload, { onConflict: 'turniej_id,gracz_id' })
    if (werr) {
      console.error('[import] wyniki_upsert_failed', werr)
      return NextResponse.redirect(new URL(`/admin/turniej/${id}/edit?e=wyniki_upsert_failed`, origin), { status: 303 })
    }
  }

  return NextResponse.redirect(new URL(`/admin/turniej/${id}/edit?ok=1`, origin), { status: 303 })
}
```

### app/admin/turniej/[id]/update/route.ts

```
import { NextRequest, NextResponse } from 'next/server'
import { createSupabaseServerMutable } from '@/lib/supabase/server-mutable'

const urlRe = /^https?:\/\/\S+$/i
const sheetColRe = /^[A-Za-z]$/
const UUID_RE = /^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i

export async function POST(req: NextRequest, ctx: { params: Promise<{ id: string }> }) {
  const origin = req.nextUrl.origin
  const { id } = await ctx.params
  if (!id || !UUID_RE.test(id)) {
    return NextResponse.redirect(new URL('/admin/turniej?e=invalid_id', origin), { status: 303 })
  }

  const supabase = await createSupabaseServerMutable()
  const { data: { user } } = await supabase.auth.getUser()
  if (!user) return NextResponse.redirect(new URL('/auth/signin', origin), { status: 303 })
  const { data: isAdmin } = await supabase.rpc('is_admin')
  if (!isAdmin) return NextResponse.redirect(new URL('/', origin), { status: 303 })

  const fd = await req.formData()
  const nazwa = String(fd.get('nazwa') || '').trim()
  const data_turnieju = String(fd.get('data_turnieju') || '').trim()
  const godzina_turnieju = String(fd.get('godzina_turnieju') || '').trim()

  const gsheet_url = (String(fd.get('gsheet_url') || '').trim()) || null
  const gsheet_id = (String(fd.get('gsheet_id') || '').trim()) || null
  const arkusz_nazwa = (String(fd.get('arkusz_nazwa') || '').trim()) || null

  const kolumna_nazwisk_raw = String(fd.get('kolumna_nazwisk') || '').trim()
  const kolumna_nazwisk = kolumna_nazwisk_raw ? kolumna_nazwisk_raw.toUpperCase() : null

  const pierwszy_wiersz_raw = fd.get('pierwszy_wiersz_z_nazwiskiem')
  const pierwszy_wiersz_z_nazwiskiem = pierwszy_wiersz_raw ? Number(pierwszy_wiersz_raw) : null

  const limit_graczy_raw = fd.get('limit_graczy')
  const limit_graczy = limit_graczy_raw !== null && String(limit_graczy_raw) !== '' ? Number(limit_graczy_raw) : null

  const lat_raw = fd.get('lat')
  const lng_raw = fd.get('lng')
  const lat = lat_raw !== null && String(lat_raw) !== '' ? Number(lat_raw) : null
  const lng = lng_raw !== null && String(lng_raw) !== '' ? Number(lng_raw) : null

  if (!nazwa || !data_turnieju || !godzina_turnieju) {
    return NextResponse.redirect(new URL(`/admin/turniej/${id}/edit?e=invalid_input`, origin), { status: 303 })
  }
  if (kolumna_nazwisk && !sheetColRe.test(kolumna_nazwisk)) {
    return NextResponse.redirect(new URL(`/admin/turniej/${id}/edit?e=sheet_col_invalid`, origin), { status: 303 })
  }
  if (pierwszy_wiersz_z_nazwiskiem !== null && (!Number.isFinite(pierwszy_wiersz_z_nazwiskiem) || pierwszy_wiersz_z_nazwiskiem < 1)) {
    return NextResponse.redirect(new URL(`/admin/turniej/${id}/edit?e=number_invalid`, origin), { status: 303 })
  }
  if (limit_graczy !== null && (!Number.isFinite(limit_graczy) || limit_graczy < 1)) {
    return NextResponse.redirect(new URL(`/admin/turniej/${id}/edit?e=number_invalid`, origin), { status: 303 })
  }
  if (gsheet_url && !urlRe.test(gsheet_url)) {
    return NextResponse.redirect(new URL(`/admin/turniej/${id}/edit?e=url_invalid`, origin), { status: 303 })
  }
  if (lat !== null && !Number.isFinite(lat)) {
    return NextResponse.redirect(new URL(`/admin/turniej/${id}/edit?e=number_invalid`, origin), { status: 303 })
  }
  if (lng !== null && !Number.isFinite(lng)) {
    return NextResponse.redirect(new URL(`/admin/turniej/${id}/edit?e=number_invalid`, origin), { status: 303 })
  }

  const updates: Record<string, any> = {
    nazwa, data_turnieju, godzina_turnieju,
    gsheet_url, gsheet_id, arkusz_nazwa,
    kolumna_nazwisk, pierwszy_wiersz_z_nazwiskiem,
    limit_graczy, lat, lng,
  }

  const { error } = await supabase.from('turniej').update(updates).eq('id', id)
  if (error) {
    console.error('update turniej error', error)
    return NextResponse.redirect(new URL(`/admin/turniej/${id}/edit?e=save_failed`, origin), { status: 303 })
  }

  return NextResponse.redirect(new URL(`/admin/turniej/${id}/edit?ok=1`, origin), { status: 303 })
}
```

### app/admin/turniej/page.tsx

```
// app/admin/turniej/page.tsx
import { redirect } from 'next/navigation'
import Link from 'next/link'
import { createSupabaseServer } from '@/lib/supabase/server'

export const dynamic = 'force-dynamic'
export const revalidate = 0

export default async function AdminTurniejList() {
  const supabase = await createSupabaseServer()

  // wymagane logowanie
  const { data: { user } } = await supabase.auth.getUser()
  if (!user) redirect('/auth/signin')

  // wymagany admin
  const { data: isAdmin } = await supabase.rpc('is_admin')
  if (!isAdmin) redirect('/')

  // lista turniejów (dowolne pola z Twojej tabeli)
  const { data: rows, error } = await supabase
    .from('turniej')
    .select('id, nazwa, data_turnieju, godzina_turnieju, limit_graczy, created_at')
    .order('created_at', { ascending: false })
    .limit(200)

  if (error) {
    return (
      <main className="mx-auto max-w-5xl p-6">
        <h1 className="text-2xl font-semibold mb-4">Turnieje (admin)</h1>
        <p className="text-sm text-red-700">Nie udało się pobrać danych.</p>
      </main>
    )
  }

  return (
    <main className="mx-auto max-w-5xl p-6 space-y-4">
      <div className="flex items-center justify-between">
        <h1 className="text-2xl font-semibold">Turnieje (admin)</h1>
        <Link href="/turniej/new" className="pill pill--primary">Dodaj turniej</Link>
      </div>

      <div className="overflow-x-auto rounded border">
        <table className="min-w-full text-sm border-collapse">
          <thead className="bg-red-50">
            <tr className="border-b">
              <th className="px-3 py-2 text-left">Nazwa</th>
              <th className="px-3 py-2 text-left">Data</th>
              <th className="px-3 py-2 text-left">Limit</th>
              <th className="px-3 py-2 text-right">Akcje</th>
            </tr>
          </thead>
          <tbody>
            {rows?.map((r) => (
              <tr key={r.id} className="border-b last:border-0">
                <td className="px-3 py-2">
                  <Link href={`/admin/turniej/${r.id}/edit`} className="underline">
                    {r.nazwa}
                  </Link>
                </td>
                <td className="px-3 py-2">
                  {r.data_turnieju ?? '—'}{r.godzina_turnieju ? ` • ${r.godzina_turnieju}` : ''}
                </td>
                <td className="px-3 py-2">{r.limit_graczy ?? '—'}</td>
                <td className="px-3 py-2 text-right">
                  <Link href={`/admin/turniej/${r.id}/edit`} className="pill pill--secondary">
                    Edytuj
                  </Link>
                </td>
              </tr>
            ))}
            {!rows?.length && (
              <tr>
                <td className="px-3 py-6 text-sm opacity-60" colSpan={4}>
                  Brak rekordów.
                </td>
              </tr>
            )}
          </tbody>
        </table>
      </div>
    </main>
  )
}
```

### app/admin/users/[id]/role/route.ts

```
import { NextRequest, NextResponse } from 'next/server'
import { createSupabaseServerMutable } from '@/lib/supabase/server-mutable'

// Prosty regex do walidacji UUID v4 (opcjonalnie, ale pomaga ładnie wyłapać błędy)
const UUID_RE = /^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i

export async function POST(
  req: NextRequest,
  ctx: { params: Promise<{ id: string }> } // <-- params jako Promise (Next 15)
) {
  const supabase = await createSupabaseServerMutable()
  const origin = req.nextUrl.origin

  // ⬇️ kluczowa zmiana – rozpakuj params:
  const { id: targetId } = await ctx.params

  // (opcjonalnie) twarda walidacja UUID
  if (!targetId || !UUID_RE.test(targetId)) {
    return NextResponse.redirect(new URL('/admin/users?e=invalid_id', origin), { status: 303 })
  }

  // kto wykonuje?
  const { data: { user } } = await supabase.auth.getUser()
  if (!user) {
    return NextResponse.redirect(new URL('/auth/signin', origin), { status: 303 })
  }

  // tylko admin może zmieniać role
  const { data: isAdmin } = await supabase.rpc('is_admin')
  if (!isAdmin) {
    return NextResponse.redirect(new URL('/', origin), { status: 303 })
  }

  // rola z formularza
  const form = await req.formData()
  const role = String(form.get('role') || '')
  if (role !== 'admin' && role !== 'user') {
    return NextResponse.redirect(new URL('/admin/users?e=invalid_role', origin), { status: 303 })
  }

  // aktualizacja roli
  const { error } = await supabase
    .from('profiles')
    .update({ role })
    .eq('id', targetId)

  if (error) {
    console.error('role update error', error)
    return NextResponse.redirect(new URL('/admin/users?e=update_failed', origin), { status: 303 })
  }

  return NextResponse.redirect(new URL('/admin/users?ok=1', origin), { status: 303 })
}
```

### app/admin/users/page.tsx

```
import { redirect } from 'next/navigation'
import { createSupabaseServer } from '@/lib/supabase/server'
import Link from 'next/link'

type SearchParams = Promise<Record<string, string | string[] | undefined>>

export const dynamic = 'force-dynamic'
export const revalidate = 0

export default async function AdminUsersPage({ searchParams }: { searchParams: SearchParams }) {
  const sp = await searchParams
  const ok = sp.ok === '1'
  const err = typeof sp.e === 'string' ? sp.e : undefined

  const supabase = await createSupabaseServer()
  const { data: { user } } = await supabase.auth.getUser()
  if (!user) redirect('/auth/signin')

  // twardy guard – tylko admin
  const { data: isAdmin } = await supabase.rpc('is_admin')
  if (!isAdmin) redirect('/')

  // pobierz userów (prosto: max 100)
  const { data: users, error } = await supabase
    .from('profiles')
    .select('id, email, username, role, created_at')
    .order('created_at', { ascending: false })
    .limit(100)

  if (error) {
    console.error('profiles list error', error)
  }

  return (
    <main className="mx-auto max-w-5xl p-6 space-y-6">
      <div className="flex items-center justify-between">
        <h1 className="text-2xl font-semibold">Użytkownicy</h1>
        <Link href="/admin" className="pill pill--secondary">← Panel admina</Link>
      </div>

      {ok && (
        <div className="rounded-md border border-green-200 bg-green-50 px-3 py-2 text-sm text-green-700">
          Zmieniono rolę użytkownika.
        </div>
      )}
      {err && (
        <div className="rounded-md border border-red-200 bg-red-50 px-3 py-2 text-sm text-red-700">
          {err === 'invalid_role' ? 'Nieprawidłowa rola.' : 'Nie udało się zmienić roli.'}
        </div>
      )}

      <div className="overflow-x-auto rounded border">
        <table className="min-w-full border-collapse text-sm">
          <thead className="bg-red-50">
            <tr className="border-b">
              <th className="px-3 py-2 text-left">Email</th>
              <th className="px-3 py-2 text-left">Login</th>
              <th className="px-3 py-2 text-left">Rola</th>
              <th className="px-3 py-2 text-right">Akcje</th>
            </tr>
          </thead>
          <tbody>
            {users?.map((u) => (
              <tr key={u.id} className="border-b last:border-0">
                <td className="px-3 py-2">{u.email}</td>
                <td className="px-3 py-2">{u.username ?? <span className="opacity-60">—</span>}</td>
                <td className="px-3 py-2">
                  {u.role === 'admin'
                    ? <span className="rounded-full bg-red-600/10 px-2 py-1 text-red-700">admin</span>
                    : <span className="rounded-full bg-slate-500/10 px-2 py-1 text-slate-700">user</span>}
                </td>
                <td className="px-3 py-2 text-right">
                  {u.role === 'admin' ? (
                    <form action={`/admin/users/${u.id}/role`} method="post" className="inline">
                      <input type="hidden" name="role" value="user" />
                      <button className="pill pill--secondary">Usuń admina</button>
                    </form>
                  ) : (
                    <form action={`/admin/users/${u.id}/role`} method="post" className="inline">
                      <input type="hidden" name="role" value="admin" />
                      <button className="pill pill--primary">Nadaj admina</button>
                    </form>
                  )}
                </td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>

      <p className="text-xs opacity-60">
        Pokazano maks. 100 ostatnio utworzonych kont.
      </p>
    </main>
  )
}
```

### app/api/resolve-email/gsheets/list/route.ts

```
// app/api/gsheets/list/route.ts
import { NextRequest, NextResponse } from 'next/server'

function extractSheetId(url: string) {
  const m = url.match(/spreadsheets\/d\/([a-zA-Z0-9-_]+)/)
  return m?.[1] ?? null
}

export async function GET(req: NextRequest) {
  const url = req.nextUrl.searchParams.get('url') || ''
  const sheetId = extractSheetId(url)
  if (!sheetId) {
    return NextResponse.json({ error: 'invalid_url' }, { status: 400 })
  }

  // Publiczny feed z listą arkuszy (wymaga publikacji/udostępnienia linkiem)
  const feed = `https://spreadsheets.google.com/feeds/worksheets/${sheetId}/public/full?alt=json`

  try {
    const r = await fetch(feed, { cache: 'no-store' })
    if (!r.ok) {
      return NextResponse.json({ error: 'fetch_failed', status: r.status }, { status: 400 })
    }
    const j = await r.json() as any
    const entries: any[] = j?.feed?.entry || []

    const sheets = entries.map((e) => {
      const name: string = e?.title?.$t ?? ''
      const linkHref: string = e?.link?.[0]?.href ?? ''
      // spróbuj wyciągnąć gid z href
      const gidMatch = linkHref.match(/[?&]gid=(\d+)/)
      const gid = gidMatch?.[1] ?? null
      return { name, gid }
    }).filter(s => s.name)

    return NextResponse.json({ sheets }, { status: 200 })
  } catch (e) {
    return NextResponse.json({ error: 'exception' }, { status: 500 })
  }
}
```

### app/api/resolve-email/gsheets/sheets/route.ts

```
import { NextRequest, NextResponse } from 'next/server'

function extractSpreadsheetId(url: string) {
  // wspiera: .../spreadsheets/d/{ID}/...  (link udostępniony)
  const m = url.match(/spreadsheets\/d\/([a-zA-Z0-9-_]+)/)
  return m?.[1] || null
}

export async function GET(req: NextRequest) {
  try {
    const url = req.nextUrl.searchParams.get('url') || ''
    const idFromUrl = extractSpreadsheetId(url)
    const id = idFromUrl || url.trim() // pozwól też wkleić samo ID

    if (!id) {
      return NextResponse.json({ error: 'missing_id' }, { status: 400 })
    }
    const key = process.env.GOOGLE_SHEETS_API_KEY
    if (!key) {
      return NextResponse.json({ error: 'missing_api_key' }, { status: 500 })
    }

    // pobieramy tylko tytuły kart (bez danych)
    const api = `https://sheets.googleapis.com/v4/spreadsheets/${id}?fields=sheets(properties(title))&key=${key}`
    const res = await fetch(api, { cache: 'no-store' })
    if (!res.ok) {
      const txt = await res.text()
      return NextResponse.json({ error: 'fetch_failed', details: txt }, { status: 502 })
    }

    const json = await res.json()
    const titles: string[] =
      json?.sheets?.map((s: any) => s?.properties?.title).filter(Boolean) ?? []

    return NextResponse.json({ spreadsheetId: id, sheets: titles })
  } catch (e: any) {
    return NextResponse.json({ error: 'exception', message: e?.message }, { status: 500 })
  }
}
```

### app/api/resolve-email/route.ts

```
import { NextResponse } from 'next/server'
import { supabaseAdmin } from '@/lib/supabase/admin'

export async function POST(req: Request) {
  const { identifier } = await req.json() as { identifier: string }
  const input = identifier.trim().toLowerCase()

  // jeśli to e-mail, nie ma co rozwiązywać
  if (input.includes('@')) {
    return NextResponse.json({ email: input })
  }

  // login -> email (tylko na serwerze, przez Service Role)
  const { data, error } = await supabaseAdmin
    .from('profiles')
    .select('email')
    .eq('username', input)
    .single()

  if (error || !data?.email) {
    return NextResponse.json({ error: 'Nie znaleziono użytkownika o takim loginie.' }, { status: 404 })
  }

  return NextResponse.json({ email: data.email.toLowerCase() })
}
```

### app/auth/login/route.ts

```
// app/auth/signin/route.ts (lub odpowiednia ścieżka POST)
import { NextRequest, NextResponse } from 'next/server'
import { createSupabaseServerMutable } from '@/lib/supabase/server-mutable'
import { supabaseAdmin } from '@/lib/supabase/admin'

export async function POST(req: NextRequest) {
  const form = await req.formData()
  let identifier = String(form.get('identifier') || '').trim().toLowerCase()
  const password = String(form.get('password') || '')

  // Zawsze bierz origin z requestu (działa na localhost i na Vercel)
  const origin = req.nextUrl.origin

  // 1) username -> email (jeśli trzeba)
  if (!identifier.includes('@')) {
    const { data, error } = await supabaseAdmin
      .from('profiles')
      .select('email')
      .eq('username', identifier)
      .single()

    if (error || !data?.email) {
      return NextResponse.redirect(new URL('/auth/signin?e=notfound', origin), { status: 303 })
    }
    identifier = data.email.toLowerCase()
  }

  // 2) Logowanie
  const supabase = await createSupabaseServerMutable()
  const { error } = await supabase.auth.signInWithPassword({
    email: identifier,
    password,
  })

  if (error) {
    return NextResponse.redirect(new URL('/auth/signin?e=invalid', origin), { status: 303 })
  }

  // 3) Sukces
  return NextResponse.redirect(new URL('/', origin), { status: 303 })
}
```

### app/auth/signin/page.tsx

```
'use client'

import { useEffect, useMemo, useState } from 'react'
import { useSearchParams } from 'next/navigation'

export default function SignIn() {
  const [identifier, setIdentifier] = useState('')
  const [password, setPassword] = useState('')
  const sp = useSearchParams()
  const err = useMemo(() => {
    const e = sp.get('e')
    if (e === 'notfound') return 'Nie znaleziono użytkownika o takim loginie.'
    if (e === 'invalid') return 'Nieprawidłowy email/login lub hasło.'
    return null
  }, [sp])

  // (opcjonalnie) zresetuj query po 1 renderze, żeby adres był czysty
  useEffect(() => { history.replaceState(null, '', '/auth/signin') }, [])

  return (
    <main className="mx-auto max-w-md p-6 space-y-4">
      <h1 className="text-2xl font-semibold">Logowanie</h1>
      <form action="/auth/login" method="post" className="space-y-3">
        <input
          className="w-full rounded border px-3 py-2"
          name="identifier"
          placeholder="Email lub login"
          value={identifier}
          onChange={e=>setIdentifier(e.target.value)}
          required
        />
        <input
          className="w-full rounded border px-3 py-2"
          type="password"
          name="password"
          placeholder="Hasło"
          value={password}
          onChange={e=>setPassword(e.target.value)}
          required
        />
        {err && <p className="text-sm text-red-600">{err}</p>}
        <button className="rounded bg-black px-4 py-2 text-white">Zaloguj</button>
      </form>
    </main>
  )
}
```

### app/auth/signin/submit/route.ts

```
import { NextRequest, NextResponse } from 'next/server'
import { createSupabaseServerMutable } from '@/lib/supabase/server-mutable'
import { supabaseAdmin } from '@/lib/supabase/admin'

export async function POST(req: NextRequest) {
  const origin = req.nextUrl.origin
  const form = await req.formData()
  let identifier = String(form.get('identifier') || '').trim().toLowerCase()
  const password = String(form.get('password') || '')

  if (identifier && !identifier.includes('@')) {
    const { data, error } = await supabaseAdmin
      .from('profiles')
      .select('email')
      .eq('username', identifier)
      .maybeSingle()

    if (error || !data?.email) {
      return NextResponse.redirect(new URL('/auth/signin?e=notfound', origin), { status: 303 })
    }
    identifier = data.email.toLowerCase()
  }

  const supabase = await createSupabaseServerMutable()
  const { error } = await supabase.auth.signInWithPassword({ email: identifier, password })

  if (error) {
    return NextResponse.redirect(new URL('/auth/signin?e=invalid', origin), { status: 303 })
  }

  return NextResponse.redirect(new URL('/', origin), { status: 303 })
}
```

### app/auth/signout/route.ts

```
import { NextResponse } from 'next/server'
import { createSupabaseServerMutable } from '@/lib/supabase/server-mutable'

export async function POST() {
  const supabase = await createSupabaseServerMutable(); // <-- DODAJ await
  await supabase.auth.signOut()
  return NextResponse.redirect(new URL('/', process.env.NEXT_PUBLIC_SITE_URL || 'http://localhost:3000'))
}
```

### app/auth/signup/page.tsx

```
'use client'

import { useState } from 'react'
import { supabase } from '@/lib/supabase/client'

export default function SignUp() {
  const [email, setEmail] = useState('')
  const [password, setPassword] = useState('')
  const [confirm, setConfirm] = useState('')
  const [loading, setLoading] = useState(false)
  const [msg, setMsg] = useState<string | null>(null)
  const [err, setErr] = useState<string | null>(null)

  const valid =
    email.trim().length > 5 &&
    password.length >= 6 &&
    password === confirm

  const onSubmit = async (e: React.FormEvent) => {
    e.preventDefault()
    setErr(null)
    setMsg(null)

    if (!valid) {
      setErr('Sprawdź pola formularza.')
      return
    }

    setLoading(true)
    try {
      const { error } = await supabase.auth.signUp({
        email,
        password,
      })
      if (error) throw error
      setMsg(
        'Konto utworzone. Sprawdź skrzynkę i potwierdź adres e-mail, a następnie zaloguj się.'
      )
    } catch (e: any) {
      setErr(e?.message ?? 'Nie udało się utworzyć konta.')
    } finally {
      setLoading(false)
    }
  }

  return (
    <main className="flex min-h-[calc(100vh-4rem)] items-center justify-center px-4 py-8">
      {/* KARTA – prostokąt z zaokrąglonymi rogami, szarym tłem i ciemnym cieniem */}
      <div className="w-full max-w-md rounded-2xl bg-slate-800/95 border border-slate-700 shadow-[0_14px_40px_rgba(0,0,0,0.8)] p-6">
        <h1 className="mb-4 text-2xl font-semibold text-sky-50 text-center">
          Rejestracja
        </h1>

        <form
          onSubmit={onSubmit}
          className="space-y-3"
          autoComplete="off"
        >
          <input
            className="w-full rounded-lg border border-slate-600 bg-slate-900/70 px-3 py-2 text-sm text-sky-50 placeholder:text-slate-400 focus:border-sky-400 focus:outline-none focus:ring-1 focus:ring-sky-400"
            type="email"
            placeholder="Email"
            value={email}
            onChange={(e) => setEmail(e.target.value)}
            required
            name="signup_email"
            autoComplete="off"
          />

          <input
            className="w-full rounded-lg border border-slate-600 bg-slate-900/70 px-3 py-2 text-sm text-sky-50 placeholder:text-slate-400 focus:border-sky-400 focus:outline-none focus:ring-1 focus:ring-sky-400"
            type="password"
            placeholder="Hasło (min. 6 znaków)"
            value={password}
            onChange={(e) => setPassword(e.target.value)}
            minLength={6}
            required
            name="signup_password"
            autoComplete="new-password"
          />

          <input
            className="w-full rounded-lg border border-slate-600 bg-slate-900/70 px-3 py-2 text-sm text-sky-50 placeholder:text-slate-400 focus:border-sky-400 focus:outline-none focus:ring-1 focus:ring-sky-400"
            type="password"
            placeholder="Powtórz hasło"
            value={confirm}
            onChange={(e) => setConfirm(e.target.value)}
            minLength={6}
            required
            name="signup_password_confirm"
            autoComplete="new-password"
          />

          {err && (
            <p className="text-sm text-red-400">
              {err}
            </p>
          )}
          {msg && (
            <p className="text-sm text-emerald-300">
              {msg}
            </p>
          )}

          <button
            className="mt-2 w-full rounded-full bg-gradient-to-r from-sky-500 to-sky-600 px-4 py-2 text-sm font-semibold text-white shadow-[0_10px_25px_rgba(15,23,42,0.9)] transition hover:from-sky-400 hover:to-sky-500 hover:shadow-[0_14px_35px_rgba(15,23,42,1)] disabled:opacity-50 disabled:hover:shadow-none"
            disabled={!valid || loading}
          >
            {loading ? 'Tworzę…' : 'Załóż konto'}
          </button>
        </form>
      </div>
    </main>
  )
}
```

### app/favicon.ico

```
         (  F          (  n  00     (-             F  (                                                           $   ]         ]   $                                                                                       8                                 8                                                                                                               #         OOOggg            #   Y         555            Y               kkk                              			                  Y               JJJkkk                  Y   #               			                  #                      111DDD                                                                                   8                                 8                                                                                       $   ]         ]   $                                                                                                                                                                                                                                                                                    (       @                                                                               ,   U               U   ,                                                                                      *                                       *                                                                                                                                                                             Q                                                         Q                                               r                                                               r                                       r                                                                     r                               O                                                                           O                                                                                                                                                                                                                           (                                                                                       '                             888___                                                 SSS                           +                        hhh                           +   T                        ,,,                           T                              GGG                                                                                                                              +++jjj                                                                                                         T                                 III                                    T   +                                    hhh                                    +                                       ,,,                                                                                  GGG                                                  '                                                                              (                                                   333___                                                                                                                                                                  O                                                                           O                               r                                                                     r                                       r                                                               r                                               Q                                                         Q                                                                                                                                                                             *                                       *                                                                                      ,   U               U   ,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               (   0   `           -                                                                                             	   (   L   j               j   K   (   	                                                                                                                                          V                                             U                                                                                                                      %                                                               &                                                                                                                                                                                                                                                                     Q                                                                                 R                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         P                                                                                                                     O                                                                                                                                                                                                                                                                                                                                       #                                                                                                                                 #                                                                                                                                                                                                 $$$hhheeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeePPP                                         U                              sss                                 U                                            eee                                        	                                    HHH                                       	   (                                       EEE                                          (   K                                          ,,,                                          L   j                                          )))                                             j                                                                                                                                             iii                                                                                                   eee                                                                                                   HHH                                                      j                                                   EEE                                                      j   L                                                      ,,,                                                      K   (                                                      )))                                                         (   	                                                                                                                  	                                                             iii                                                                    U                                                         eee                                                         U                                                                    HHH                                                                                                                                    EEE                                                                               #                                                            ,,,                                                            #                                                                                222}}}                                                                                                                                                                                                                                                 O                                                                                                                     P                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         R                                                                                 Q                                                                                                                                                                                                                                                                     &                                                               %                                                                                                                      U                                             V                                                                                                                                          	   (   K   j               j   L   (   	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        PNG

   IHDR         \rf   sRGB    8eXIfMM *    i                              D"8s  IDATx]	ՙn]<QVAh$	N13*qdčIDL2((Ԙ2ęG	q_@屈xțЏ{oU{}O;9d(Dg8	N ]@hx?v N3=`;6.&u  6Pн@àR PiZq^DNwpXhИHg@
:|5` p"@'ɲs{p*2 d ү|(0
0 >K
xX6 IJ C|?$KEN}ϓ|h $	2 |/ . Nz #We
5ܶ;y  gsh^  I DL(;8HjgcH|x1R"aӁ G@9`/`%0H@j~,K
,t).IDTO)~Vu$b 誛U%7 _$b 8AJ3` 510wQ?vr:2K@ v*{%#AZ咁^(=g \W!:,`6643:@c.Fٟu?<'_܏vp: 8Q
IŁp{3kHȢGcѼ<62&
2uC敭T3
;d/~m.X@{w.d]G {lKEb(PRuMTCd])_Lm==@bKGUk^U)1gTm`9\Q@Ⱆ6:ڞ^wED 	5F,
X"dm<nB~@ttx;f>I88C1۪$Be+jlEZ& S::6m\G1`!nllƊ^Q`@OcS@eͷqbpS@upFD@Г2@#L3 A$H2 _hFH#rq(OD򤬈runGOWab &SgD3EDto*Ǥ9k~),$ xR1vK 9D䍁U(w&LEꩻS)3Y8x8 $.i(KŀYa]4ǀ	c@3f4 Ƣ/*b $!I~7B*-1`	o  	$ǡDL J"OQ)2@#x4"$e I8Oi8" G8[xt<.7&m&؎R^tq ؕ.Y-2 d *_&d|j\Wb G*g 釁F4"I؃/ b1qNYDp9p}w\ Ԥ1 j`OxK=H A1#
D:U8jt$b bA||UQ26%)1 _ꢳ!~D +b >A:]E$50GDhRtݻwR)P n$ 3@bSNu,Yjʲ:;@`|-[)'OVՆsFxڮۥn}͛7~ƺ:QJ_UKj8q0x;v4 ̞=[hW=		&!e58hѢEw]6_iW}SZ?	/`;vl}2 <h" A܁X,m۶+V(<w#F^;aHc )S*{apc89(^4&EoÆW/u=^*?{k^_Ezg UI-{WU*
:p9.tڷo(/ݺus>3'^RgڞGI_D~~ {?N07S.ƍ׸~?}/y]nA;أ2 ]FOB2C?_I[::=#OzK- ϣ%?jIPۯ{N-hUt: ,GK-hUchP7 @n?\-k.2: `F=-V_G܂V }0 WIFʭsMrZ8pJQ*@OK8
rZݖa, w SW^y.5at7ݏTv#~7nA"+WpM/hK8gF/^M{e R|)q7t?8'KP~瞰\r>ǷUk eP|^x
/V/v*pv ʟ]J}k8(ĉѣGǗOmڴq,Xoe.^ Qxpt4^_N{y2 s -عsgsivZ8
!~PJ?c|] ܽ{z긓R1pnztlp9frvjT殿z4*OL~ԕ34~~r;mxY+3 r;mx4:7]ՁqL4)U!r1u6$78w̙3Ǹ|5>?\zO͆ ,E32[2Wu:E^p.H1cJt]}BuSOuIcO%  AZkD?5 @Q3w+"TSUޥ13?5 M'݋>pZj~fj׈סԐn> i5D[bf ~a'`Xc -1kāIkQů|kM(92@t݂X-LדaN4qܞ'$f0@@VnAܘYL9:|/^s 	)0`jT\wuZ-¨\	@:ct{-Rb1% I,Y%T~r1C,$*ˀf<0zhF |8Z-CRTg HRfglYs-p'+m_ؒgC{ 	ȪϏΙ3g-GR|׹7`G񥡘0U_ٵZЏدD)\>ʗz N@~~-P{rs@<|.]Ը|m|g_yWKD1bM%s\r1n\ƒ"- `.4~%3I}[0A$= ->BH"Gۏ^r<EBGi %9@^~~@1@ t-[{%@C$mAgΚ5kʆх/双OlӿB@.XupO6x9MPn`߷o_^n`t
(\rsAyۂT@h
E0l0;tڵӘkƸNYjU
S#|^㽺- |pN.ޥ`^{zL64 ěbe]&"dsΜ9UޥU0!*nP*`o֨vi8Ghhmɓs={JU0ՂwZ8bEz,YD![C>}7:k׮nof >jvR?#bX(FATFi[{zv>Ca+[0B2D=G~(
ĺLO\s܂>"8|`[)
&Lp8'4 oGe#ۏlْ_\D̀܂2Zli9tȑ9f ޢ-=Yyn?uQ}XͬsAi >=1=R+ +܂.2 KCƢۃ20h ˫%535@MA%̣j[9; _(0~r\{mPx#TT9n?N#ץ&} )
TVL!j`p 8@RrUAVA=-pLH`@n*Ȋ1܂U?}w ]H2@ߴiV[˯%5 8)Э
T`|rZbZ-.!da+@ ߞZgf[0p  Igr$o%P_rCyV|߽"mY-[ lk xA ۯ9][pҤIȨpPk FeِgHEdnAm"Z$5}z82rX| SܻwrJsJ~Tfz{ ͫ xj?jQEn js|Gxз<dXt(QE.p47 );ys_VD-XTi? ~薜 `Q=V?^
.]|X
mB~?J D~h rERA݀B~wqӾ}<ŕ[й5d-`5 ?Kq~l40@)/I(؋n9Y4!Cو2ח*w9GKݐs&res?68J |(uwO䴁d&K)nA?Rn@7,8=renM69kM7JR]en9Z /?នo>󕾤rzr `V{u4448Vrap QRZ<{dK.F9#~Ts.N%* Ýu8G&/W:*x%{}@ lNc#AIi*?د0}gC"Āpۯ4薒ҏ(b8_QY r7'` j 6 *3Wg"l1:Sg}% 	P?1`Y "D0b@ 9[tF1p`k\U`RA#W81 e`)RZM [uF0	rq. #^=C"Ā9P'R~f 
pnzdC"e?\K@&$b }jz3۵ x/{1 Ra#|ƟUK= &^TMn295)?s{O'DDo [kMoK0x Td_@]b r G; DD1gaR`'`0  >\/fŀ!fnZ|bU.tटr9+	b rnEDk= 8!b RClPE`܌K'~@}*!`@6 L;	$b@D?#gF
V1v;EsQ=ɮ4b@Tn!3q0^V c 1ܶ[M=8I1@څ@Cu`No WJĀ WeI nNmீܴ_d(4`E܅I "̵1 *3+\E \M)g	r
8>p?vI 0ǀ~!b$'%"IRi1 0? S~& r{ n_L?TeƎ7C"rOQ~"qI O 8?$b ܋r#@_vJ̙/3'd/W[o'Nl-2 @jO~02` H@؄+pOB uO(lSԕ9~c:x/Xd.Ɣd Vy@F $H2 +M*il8O@F $H2 24& rPO֢7NYS Y1`;JS3n g['@W@"la`32n?'HB2p
hāmmu j@F@VZ!xIHyѱ)>Z!6 a`dDV$9f	pM6I!LG:\LdrwPy~P%L37TKAmmo|6	3-h J3?67 yr"g4. $1_[*&S/dqCh 3>6Ŷ%\#RZq=lK|ŔXXWSe j5 /$:v@8d1(z2~F)3͋lC#=.\Lt? % N$9b%:2u	 1|-	ldt $b@?@ Fcρ^Dd[9ࠐz:
H@ P2v )~@z5|Rֵ|`#W39؂<"-0\<duoGLz 1Gpe倯d .jH@jF3@ c{s<J&	@bw   nv< ,M;*p>p!0hH{=x]I DLh<'h8@V #Jf I HnW}Nt[u$ @ 2 	]&) #3,	=%Tk&  IIӳ [8		L]]tTg6-@b2 UOV: A?} .i|	xCrvw; #>i 8_b82 WP  {'n8z;Ƥys @Po|Sih $3@߹j    IENDB````

### app/globals.css

```
@tailwind base;
@tailwind components;
@tailwind utilities;




:root {
    --color-bg-dark: #361999;
    --color-bg-light: #78fff1;
}

* {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
}

/*body {
    align-items: left;
    background: linear-gradient(
        to top right,
        var(--color-bg-dark),
        var(--color-bg-light)
    );
    color: #fff;
    display: flex;
    font-family: Helvetica, sans-serif;
    font-size: 24px;
    height: 100vh;
    justify-content: center;
    overflow: hidden;
    width: 100vw;
}

.bg {
    height: 100%;
    left: 0;
    position: absolute;
    overflow: hidden;
    right: 0;
    width: 100%;
}

.bg__dot {
    background: linear-gradient(
        to left,
        var(--color-bg-light),
        rgba(255, 255, 255, 0.3)
    );
    border-radius: 50%;
    opacity: 0.5;
    position: absolute;
}

.bg__dot:nth-child(1) {
    animation: move1 15s infinite linear both;
    bottom: 75vh;
    height: 50vh;
    width: 50vh;
}

.bg__dot:nth-child(2) {
    animation: move2 20s infinite linear both;
    height: 40vh;
    top: 65%;
    width: 40vh;
}

.form {
    backdrop-filter: blur(5px);
    background: linear-gradient(
        to left,
        rgba(255, 255, 255, 0.05),
        rgba(255, 255, 255, 0.35)
    );
    border-radius: 15px;
    box-shadow: 0px 8px 24px 0px rgba(0, 0, 0, 0.3);
    max-height: 100%;
    max-width: 300px;
    overflow-x: hidden;
    overflow-y: auto;
    padding: 36px 24px;
    position: relative;
    text-align: center;
    width: 100%;
}

.form__icon {
    border: solid 3px rgba(255, 255, 255, 0.7);
    border-radius: 50%;
    box-shadow: 0px 8px 18px 0px rgba(0, 0, 0, 0.3);
    height: 72px;
    margin: 0 auto 24px;
    overflow: hidden;
    position: relative;
    width: 72px;
}

.form__icon:before {
    background: rgba(255, 255, 255, 0.7);
    bottom: 0;
    border-radius: 50%;
    content: "";
    display: block;
    height: 24px;
    left: 50%;
    position: absolute;
    transform: translateX(-50%);
    width: 48px;
}

.form__icon:after {
    background: rgba(255, 255, 255, 0.7);
    bottom: 45%;
    border-radius: 50%;
    content: "";
    display: block;
    height: 24px;
    left: 50%;
    position: absolute;
    transform: translateX(-50%);
    width: 24px;
}

.form__input-container {
    margin-bottom: 32px;
    position: relative;
}

.form__input,
.form__button {
    background: linear-gradient(
        to right,
        rgba(255, 255, 255, 0.1),
        rgba(255, 255, 255, 0.25)
    );
    border: none;
    border-radius: 18px;
    box-shadow: 0px 8px 24px 0px rgba(0, 0, 0, 0.3);
    color: #fff;
    font-size: 24px;
    outline: transparent;
    overflow: hidden;
    position: relative;
    transition: background 0.3s ease-out, box-shadow 0.3s ease-out,
        color 0.3s ease-out, outline 0.3s ease-out;
}

.form__input {
    padding: 12px 24px;
    width: 100%;
}

.form__button:after {
    content: "";
    background: rgba(255, 255, 255, 0.7);
    display: block;
    height: 100px;
    left: -100px;
    position: absolute;
    top: -50%;
    transform: skew(-15deg);
    transition: left 0.2s linear;
    width: 70px;
}

.form__input:hover:not(:focus),
.form__button:hover:not(:focus) {
    box-shadow: 0px 8px 8px 0px rgba(0, 0, 0, 0.3);
}

.form__button:hover::after {
    left: 110%;
}

.form__input:focus,
.form__input:focus-visible,
.form__button:focus,
.form__button:focus-visible {
    outline: solid 3px rgba(255, 255, 255, 0.8);
}

.form__input:hover + .form__input-label {
    left: 30px;
    opacity: 0.2;
}

.form__input:focus + .form__input-label,
.form__input:not(:placeholder-shown) + .form__input-label {
    left: 100%;
    opacity: 0;
}

.form__input-label {
    cursor: text;
    left: 24px;
    font-style: italic;
    opacity: 0.4;
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    transition: left 0.2s ease-in, opacity 0.2s ease-in;
}

.form__spacer {
    background: rgba(255, 255, 255, 0.5);
    border-radius: 100%;
    display: block;
    height: 2px;
    margin: 32px auto;
    width: 80%;
}

.form__button {
    cursor: pointer;
    padding: 12px 48px;
}

@keyframes move1 {
    0% {
        transform: translate(-60vw, 0);
    }
    100% {
        transform: translate(120vw, 60vw);
    }
}

@keyframes move2 {
    0% {
        transform: translate(100vw, 0);
    }
    100% {
        transform: translate(-50vw, -30vw);
    }
}

.form__input--nav {
  font-size: 14px;
  padding: 6px 16px;
  border-radius: 9999px;
}

/* Mniejsza wersja przycisku do navbara 
.form__button--nav {
  font-size: 14px;        /* zamiast 24px 
  padding: 6px 24px;      /* mniejsze paddingi 
  border-radius: 9999px;  /* bardziej „pill” jak w pasku 
}*/


@layer components {
  .btn {
    @apply inline-flex items-center justify-center gap-2 px-5 py-2.5 text-sm font-semibold
      rounded-full cursor-pointer select-none
      transition-transform transition-shadow duration-150
      focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2;
  }

  .btn--primary {
    @apply text-white bg-gradient-to-b from-sky-500 to-sky-600
      shadow-[0_6px_14px_rgba(56,189,248,0.35)]
      focus-visible:ring-sky-400 focus-visible:ring-offset-slate-950;
  }

  .btn--primary:hover {
    @apply from-sky-400 to-sky-500 shadow-[0_8px_18px_rgba(56,189,248,0.45)] -translate-y-0.5;
  }

  .btn--primary:active {
    @apply from-sky-600 to-sky-700 shadow-[0_4px_10px_rgba(15,23,42,0.6)] translate-y-0;
  }

  .btn--secondary {
    @apply text-sky-100 border border-sky-500/70 bg-slate-900/60
      shadow-[0_4px_10px_rgba(15,23,42,0.7)]
      focus-visible:ring-sky-400 focus-visible:ring-offset-slate-950;
  }

  .btn--secondary:hover {
    @apply bg-slate-800/80 border-sky-300 shadow-[0_6px_14px_rgba(15,23,42,0.85)] -translate-y-0.5;
  }

  .btn--secondary:active {
    @apply bg-slate-900 border-sky-500 shadow-[0_3px_8px_rgba(15,23,42,0.8)] translate-y-0;
  }

  .btn__icon {
    @apply inline-flex h-5 w-5 items-center justify-center rounded-full border text-[10px];
  }

  .btn__icon--light {
    @apply border-sky-100/80 text-sky-50 bg-sky-900/40;
  }

  .btn__icon--dark {
    @apply border-sky-400/80 text-sky-100 bg-sky-900/40;
  }
}
```

### app/layout.tsx

```
import './globals.css'
import type { Metadata } from 'next'
import LoadGoogleMaps from '@/components/LoadGoogleMaps'
import { createSupabaseServer } from '@/lib/supabase/server'
import Navbar from '@/components/Navbar'


export const dynamic = 'force-dynamic'
export const revalidate = 0

export const metadata: Metadata = {
  title: 'elo-arena',
  description: 'Next.js + Supabase',
}

export default async function RootLayout({ children }: { children: React.ReactNode }) {
  const supabase = await createSupabaseServer()
  const { data: { user } } = await supabase.auth.getUser()

  let role: 'admin' | 'user' | null = null

  if (user) {
    // 1) najpewniejsze: rpc('is_admin')
    const { data: isAdmin, error: rpcError } = await supabase.rpc('is_admin')

    if (!rpcError && typeof isAdmin === 'boolean') {
      role = isAdmin ? 'admin' : 'user'
    } else {
      // 2) fallback: czytaj role bezpośrednio z profiles
      const { data: profile, error: profError } = await supabase
        .from('profiles')
        .select('role')
        .eq('id', user.id)
        .maybeSingle()

      if (profError) {
        console.error('[auth] profiles select error:', profError)
      }
      role = profile?.role === 'admin' ? 'admin' : 'user'
    }
  }

  // Tymczasowy log diagnostyczny – usuń po potwierdzeniu
  console.log('[auth]', { id: user?.id, email: user?.email, role })

  return (
    <html lang="pl">
      <body className="min-h-dvh antialiased">
        <Navbar user={user ? { id: user.id, email: user.email } : null} role={role} />
        {children}
        <LoadGoogleMaps />
      </body>
    </html>
  )
}
```

### app/onboarding/page.tsx

```
import { createSupabaseServer } from '@/lib/supabase/server'
import { redirect } from 'next/navigation'
import UsernameForm from './username-form'

export default async function OnboardingPage() {
  const supabase = await createSupabaseServer()
  const { data: { user } } = await supabase.auth.getUser()
  if (!user) redirect('/auth/signin')

  const { data: profile } = await supabase
    .from('profiles')
    .select('username')
    .eq('id', user.id)
    .single()

  if (profile?.username) redirect('/')

  return (
    <main className="mx-auto max-w-md p-6">
      <h1 className="text-2xl font-semibold mb-4">Ustaw swój login</h1>
      <UsernameForm />
    </main>
  )
}
```

### app/onboarding/username-form.tsx

```
'use client'

import { useState } from 'react'
import { supabase } from '@/lib/supabase/client'
import { useRouter } from 'next/navigation'

export default function UsernameForm() {
  const [username, setUsername] = useState('')
  const [err, setErr] = useState<string | null>(null)
  const [saving, setSaving] = useState(false)
  const router = useRouter()

  const save = async () => {
    setErr(null); setSaving(true)
    try {
      const clean = username.replace(/\s+/g,'').toLowerCase()
      if (clean.length < 3) { setErr('Login musi mieć co najmniej 3 znaki.'); setSaving(false); return }

      const { data: { user } } = await supabase.auth.getUser()
      if (!user) { setErr('Brak sesji. Zaloguj się.'); setSaving(false); return }

      const { error } = await supabase
        .from('profiles')
        .update({ username: clean })
        .eq('id', user.id)

      // 23505 = duplicate key
      if (error && ((error as any).code === '23505' || (error.message||'').includes('duplicate'))) {
        setErr('Ten login jest już zajęty.'); setSaving(false); return
      }
      if (error) { setErr(error.message); setSaving(false); return }

      router.push('/')
    } catch (e:any) {
      setErr(e?.message ?? 'Nie udało się zapisać loginu.')
    } finally {
      setSaving(false)
    }
  }

  return (
    <div className="space-y-3">
      <input
        className="w-full rounded border px-3 py-2"
        placeholder="np. michal123"
        value={username}
        onChange={e=>setUsername(e.target.value)}
      />
      {err && <p className="text-sm text-red-600">{err}</p>}
      <button onClick={save} className="rounded bg-black px-4 py-2 text-white disabled:opacity-50" disabled={saving}>
        {saving ? 'Zapisuję…' : 'Zapisz login'}
      </button>
    </div>
  )
}
```

### app/page.tsx

```
// app/page.tsx
export default function HomePage() {
  return (
    <main className="px-6 py-6">
      <div className="inline-flex rounded-lg bg-red-600 px-6 py-3 text-white text-lg font-semibold shadow-lg">
        Tailwind działa 🔥
      </div>
    </main>
  )
}
```

### app/profile/page.tsx

```
import { redirect } from 'next/navigation'
import { createSupabaseServer } from '@/lib/supabase/server'

// Next 15+: searchParams jest Promisem
type SearchParams = Promise<Record<string, string | string[] | undefined>>

// Dokładnie te same wartości, co w ENUM w bazie:
const VOIVODESHIPS = [
  'Dolnośląskie',
  'Kujawsko-Pomorskie',
  'Lubelskie',
  'Lubuskie',
  'Łódzkie',
  'Małopolskie',
  'Mazowieckie',
  'Opolskie',
  'Podkarpackie',
  'Podlaskie',
  'Pomorskie',
  'Śląskie',
  'Świętokrzyskie',
  'Warmińsko-Mazurskie',
  'Wielkopolskie',
  'Zachodniopomorskie',
] as const

export default async function ProfilePage({
  searchParams,
}: {
  searchParams: SearchParams
}) {
  const sp = await searchParams
  const ok = sp.ok === '1'
  const err = typeof sp.e === 'string' ? sp.e : undefined

  const supabase = await createSupabaseServer()
  const { data: { user } } = await supabase.auth.getUser()
  if (!user) redirect('/auth/signin')

  const { data: profile } = await supabase
    .from('profiles')
    .select('username, first_name, last_name, birthdate, city, voivodeship, role, email')
    .eq('id', user.id)
    .single()

  const bday = profile?.birthdate ? String(profile.birthdate).slice(0, 10) : ''

  return (
    <main className="mx-auto max-w-xl p-6 space-y-6">
      <h1 className="text-2xl font-semibold">Twój profil</h1>

      {ok && (
        <div className="rounded-md border border-green-200 bg-green-50 px-3 py-2 text-sm text-green-700">
          Zapisano zmiany.
        </div>
      )}
      {err && (
        <div className="rounded-md border border-red-200 bg-red-50 px-3 py-2 text-sm text-red-700">
          {err === 'username_taken'
            ? 'Login zajęty.'
            : err === 'voiv_required'
            ? 'Wybierz województwo.'
            : err === 'voiv_invalid'
            ? 'Nieprawidłowa wartość województwa.'
            : 'Nie udało się zapisać. Spróbuj ponownie.'}
        </div>
      )}

      <form action="/profile/update" method="post" className="space-y-4">
        <div>
          <label className="block text-sm font-medium text-slate-700">Login (username)</label>
          <input
            name="username"
            defaultValue={profile?.username ?? ''}
            className="mt-1 w-full rounded border px-3 py-2"
            maxLength={32}
            placeholder="np. m_kowalski"
          />
          <p className="mt-1 text-xs text-slate-500">Musi być unikalny.</p>
        </div>

        <div className="grid grid-cols-1 gap-4 sm:grid-cols-2">
          <div>
            <label className="block text-sm font-medium text-slate-700">Imię</label>
            <input name="first_name" defaultValue={profile?.first_name ?? ''} className="mt-1 w-full rounded border px-3 py-2" />
          </div>
          <div>
            <label className="block text-sm font-medium text-slate-700">Nazwisko</label>
            <input name="last_name" defaultValue={profile?.last_name ?? ''} className="mt-1 w-full rounded border px-3 py-2" />
          </div>
        </div>

        <div>
          <label className="block text-sm font-medium text-slate-700">Data urodzenia</label>
          <input type="date" name="birthdate" defaultValue={bday} className="mt-1 w-full rounded border px-3 py-2" />
        </div>

        <div className="grid grid-cols-1 gap-4 sm:grid-cols-2">
          <div>
            <label className="block text-sm font-medium text-slate-700">Miasto</label>
            <input name="city" defaultValue={profile?.city ?? ''} className="mt-1 w-full rounded border px-3 py-2" />
          </div>

          {/* SELECT województwa – wymagany, dokładnie wartości z ENUM */}
          <div>
            <label className="block text-sm font-medium text-slate-700">Województwo</label>
            <select
              name="voivodeship"
              defaultValue={profile?.voivodeship ?? ''}
              className="mt-1 w-full rounded border px-3 py-2 bg-white"
              required
            >
              <option value="" disabled>— wybierz —</option>
              <option>Dolnośląskie</option>
              <option>Kujawsko-Pomorskie</option>
              <option>Lubelskie</option>
              <option>Lubuskie</option>
              <option>Łódzkie</option>
              <option>Małopolskie</option>
              <option>Mazowieckie</option>
              <option>Opolskie</option>
              <option>Podkarpackie</option>
              <option>Podlaskie</option>
              <option>Pomorskie</option>
              <option>Śląskie</option>
              <option>Świętokrzyskie</option>
              <option>Warmińsko-Mazurskie</option>
              <option>Wielkopolskie</option>
              <option>Zachodniopomorskie</option>
  </select>
          </div>
        </div>

        <div className="text-sm text-slate-600">
          <span className="opacity-70">Rola:</span>{' '}
          <span className={profile?.role === 'admin' ? 'font-semibold text-red-700' : ''}>
            {profile?.role ?? 'user'}
          </span>{' '}
          • <span className="opacity-70">Email:</span> {profile?.email ?? user.email}
        </div>

        <div className="flex gap-2 pt-2">
          <button className="pill pill--primary" type="submit">Zapisz zmiany</button>
          <a href="/" className="pill pill--secondary">Anuluj</a>
        </div>
      </form>
    </main>
  )
}
```

### app/profile/update/route.ts

```
import { NextRequest, NextResponse } from 'next/server'
import { createSupabaseServerMutable } from '@/lib/supabase/server-mutable'

// Ta lista musi być identyczna jak wartości ENUM w bazie:
const VOIVODESHIPS = [
  'Dolnośląskie','Kujawsko-Pomorskie','Lubelskie','Lubuskie','Łódzkie','Małopolskie',
  'Mazowieckie','Opolskie','Podkarpackie','Podlaskie','Pomorskie','Śląskie',
  'Świętokrzyskie','Warmińsko-Mazurskie','Wielkopolskie','Zachodniopomorskie',
] as const
type Voiv = typeof VOIVODESHIPS[number]

export async function POST(req: NextRequest) {
  const supabase = await createSupabaseServerMutable()
  const { data: { user } } = await supabase.auth.getUser()
  const origin = req.nextUrl.origin

  if (!user) {
    return NextResponse.redirect(new URL('/auth/signin', origin), { status: 303 })
  }

  const form = await req.formData()
  const username = String(form.get('username') || '').trim() || null
  const first_name = String(form.get('first_name') || '').trim() || null
  const last_name = String(form.get('last_name') || '').trim() || null
  const birthdateRaw = String(form.get('birthdate') || '')
  const city = String(form.get('city') || '').trim() || null

  // Województwo: wymagane i tylko z listy
  const vRaw = String(form.get('voivodeship') || '')
  if (!vRaw) {
    return NextResponse.redirect(new URL('/profile?e=voiv_required', origin), { status: 303 })
  }
  const voivodeship = VOIVODESHIPS.includes(vRaw as Voiv) ? (vRaw as Voiv) : null
  if (!voivodeship) {
    return NextResponse.redirect(new URL('/profile?e=voiv_invalid', origin), { status: 303 })
  }

  const birthdate = birthdateRaw ? birthdateRaw : null // YYYY-MM-DD

  const updates: Record<string, any> = {
    username, first_name, last_name, birthdate, city, voivodeship,
  }

  const { error } = await supabase
    .from('profiles')
    .update(updates)
    .eq('id', user.id)

  if (error) {
    // 23505: unique_violation (np. username), 22P02: invalid input (ENUM), 23514: check_violation
    const code = (error as any).code
    const reason =
      code === '23505' ? 'username_taken' :
      code === '22P02' ? 'voiv_invalid' :
      code === '23514' ? 'voiv_invalid' :
      'save_failed'
    return NextResponse.redirect(new URL(`/profile?e=${reason}`, origin), { status: 303 })
  }

  return NextResponse.redirect(new URL('/profile?ok=1', origin), { status: 303 })
}
```

### app/turniej/create/route.ts

```
import { NextRequest, NextResponse } from 'next/server'
import { createSupabaseServerMutable } from '@/lib/supabase/server-mutable'

const urlRe = /^https?:\/\/\S+$/i
const sheetColRe = /^[A-Za-z]$/

function extractSheetId(url: string): string | null {
  try {
    const u = new URL(url)
    const byQuery = u.searchParams.get('id')
    if (byQuery) return byQuery
    const m = u.pathname.match(/\/spreadsheets\/d\/([a-zA-Z0-9-_]+)/)
    return m ? m[1] : null
  } catch {
    return null
  }
}

export async function POST(req: NextRequest) {
  const origin = req.nextUrl.origin
  const supabase = await createSupabaseServerMutable()

  const { data: { user } } = await supabase.auth.getUser()
  if (!user) return NextResponse.redirect(new URL('/auth/signin', origin), { status: 303 })
  const { data: isAdmin } = await supabase.rpc('is_admin')
  if (!isAdmin) return NextResponse.redirect(new URL('/', origin), { status: 303 })

  const fd = await req.formData()

  const nazwa = String(fd.get('nazwa') || '').trim()
  const data_turnieju = String(fd.get('data_turnieju') || '').trim()
  const godzina_turnieju = String(fd.get('godzina_turnieju') || '').trim()

  const gsheet_url_raw = String(fd.get('gsheet_url') || '').trim() || null
  let gsheet_id = String(fd.get('gsheet_id') || '').trim() || null
  const arkusz_nazwa = String(fd.get('arkusz_nazwa') || '').trim() || null

  const kolumna_nazwisk_raw = String(fd.get('kolumna_nazwisk') || '').trim()
  const kolumna_nazwisk = kolumna_nazwisk_raw ? kolumna_nazwisk_raw.toUpperCase() : null

  const pierwszy_wiersz_z_nazwiskiem_raw = fd.get('pierwszy_wiersz_z_nazwiskiem')
  const pierwszy_wiersz_z_nazwiskiem =
    pierwszy_wiersz_z_nazwiskiem_raw ? Number(pierwszy_wiersz_z_nazwiskiem_raw) : 2

  const limit_graczy_raw = fd.get('limit_graczy')
  const limit_graczy = limit_graczy_raw ? Number(limit_graczy_raw) : null

  const lat_raw = fd.get('lat')
  const lng_raw = fd.get('lng')
  const lat = lat_raw !== null && String(lat_raw) !== '' ? Number(lat_raw) : null
  const lng = lng_raw !== null && String(lng_raw) !== '' ? Number(lng_raw) : null

  // walidacje
  if (!nazwa) return NextResponse.redirect(new URL('/turniej/new?e=invalid_input', origin), { status: 303 })
  if (!data_turnieju || !godzina_turnieju) {
    return NextResponse.redirect(new URL('/turniej/new?e=date_time_required', origin), { status: 303 })
  }
  if (kolumna_nazwisk && !sheetColRe.test(kolumna_nazwisk)) {
    return NextResponse.redirect(new URL('/turniej/new?e=sheet_col_invalid', origin), { status: 303 })
  }
  if (pierwszy_wiersz_z_nazwiskiem !== null && (!Number.isFinite(pierwszy_wiersz_z_nazwiskiem) || pierwszy_wiersz_z_nazwiskiem < 1)) {
    return NextResponse.redirect(new URL('/turniej/new?e=number_invalid', origin), { status: 303 })
  }
  if (limit_graczy !== null && (!Number.isFinite(limit_graczy) || limit_graczy < 1)) {
    return NextResponse.redirect(new URL('/turniej/new?e=number_invalid', origin), { status: 303 })
  }
  if (lat !== null && !Number.isFinite(lat)) return NextResponse.redirect(new URL('/turniej/new?e=number_invalid', origin), { status: 303 })
  if (lng !== null && !Number.isFinite(lng)) return NextResponse.redirect(new URL('/turniej/new?e=number_invalid', origin), { status: 303 })

  let gsheet_url = gsheet_url_raw
  if (gsheet_url && !urlRe.test(gsheet_url)) {
    return NextResponse.redirect(new URL('/turniej/new?e=url_invalid', origin), { status: 303 })
  }
  if (!gsheet_id && gsheet_url) {
    gsheet_id = extractSheetId(gsheet_url)
  }

  const payload: Record<string, any> = {
    nazwa,
    data_turnieju,
    godzina_turnieju,
    gsheet_url,
    gsheet_id,
    arkusz_nazwa,
    kolumna_nazwisk,
    pierwszy_wiersz_z_nazwiskiem,
    limit_graczy,
    lat,
    lng,
    created_by: user.id,
  }

  const { error } = await supabase.from('turniej').insert(payload)
  if (error) {
    console.error('insert turniej error', error)
    return NextResponse.redirect(new URL('/turniej/new?e=invalid_input', origin), { status: 303 })
  }

  return NextResponse.redirect(new URL('/admin?ok=1', origin), { status: 303 })
}
```

### app/turniej/new/page.tsx

```
import { redirect } from 'next/navigation'
import { createSupabaseServer } from '@/lib/supabase/server'
import MapPicker from '@/components/MapPicker'   // <— NOWE
import AutoHide from '@/components/AutoHide'

type SearchParams = Promise<Record<string, string | string[] | undefined>>

export const dynamic = 'force-dynamic'
export const revalidate = 0

export default async function NewTurniejPage({ searchParams }: { searchParams: SearchParams }) {
  const sp = await searchParams
  const ok = sp.ok === '1'
  const err = typeof sp.e === 'string' ? sp.e : undefined

  const supabase = await createSupabaseServer()
  const { data: { user } } = await supabase.auth.getUser()
  if (!user) redirect('/auth/signin')
  const { data: isAdmin } = await supabase.rpc('is_admin')
  if (!isAdmin) redirect('/')

  return (
    <main className="mx-auto max-w-2xl p-6 space-y-6">
      <h1 className="text-2xl font-semibold">Dodaj turniej</h1>

      {ok && (
        <AutoHide>
        <div className="rounded-md border border-green-200 bg-green-50 px-3 py-2 text-sm text-green-700">
          Turniej został utworzony.
        </div>
        </AutoHide>
      )}
      {err && (
        <AutoHide>
        <div className="rounded-md border border-red-200 bg-red-50 px-3 py-2 text-sm text-red-700">
          {{
            invalid_input: 'Nieprawidłowe dane formularza.',
            date_time_required: 'Podaj datę i godzinę wydarzenia.',
            sheet_col_invalid: 'Kolumna nazwisk musi być literą (A–Z).',
            number_invalid: 'Nieprawidłowa wartość liczbowa.',
            url_invalid: 'Link musi zaczynać się od http(s)://',
          }[err] ?? 'Nie udało się zapisać.'}
        </div>
        </AutoHide>
      )}

      <form action="/turniej/create" method="post" className="space-y-5">
        <div>
          <label className="block text-sm font-medium">Nazwa turnieju *</label>
          <input name="nazwa" required className="mt-1 w-full rounded border px-3 py-2" placeholder="np. ELO Arena Open" />
        </div>

        <div className="grid grid-cols-1 gap-4 sm:grid-cols-2">
          <div>
            <label className="block text-sm font-medium">Data turnieju *</label>
            <input type="date" name="data_turnieju" required className="mt-1 w-full rounded border px-3 py-2" />
          </div>
          <div>
            <label className="block text-sm font-medium">Godzina startu *</label>
            <input type="time" name="godzina_turnieju" required className="mt-1 w-full rounded border px-3 py-2" />
          </div>
        </div>

        <div>
          <label className="block text-sm font-medium">Link do arkusza Google (opcjonalnie)</label>
          <input name="gsheet_url" className="mt-1 w-full rounded border px-3 py-2" placeholder="https://docs.google.com/spreadsheets/d/..." />
          <p className="mt-1 text-xs text-slate-500">ID arkusza wyciągniemy automatycznie (lub podaj poniżej).</p>
        </div>

        <div className="grid grid-cols-1 gap-4 sm:grid-cols-3">
          
          <div>
            <label className="block text-sm font-medium">Nazwa karty (opcjonalnie)</label>
            <input name="arkusz_nazwa" className="mt-1 w-full rounded border px-3 py-2" placeholder="np. Lista" />
          </div>
        </div>

        <div className="grid grid-cols-1 gap-4 sm:grid-cols-3">
          <div>
            <label className="block text-sm font-medium">Kolumna nazwisk</label>
            <input name="kolumna_nazwisk" className="mt-1 w-full rounded border px-3 py-2" placeholder="np. B" maxLength={2} />
            <p className="mt-1 text-xs text-slate-500">Jedna litera A–Z.</p>
          </div>
          <div>
            <label className="block text-sm font-medium">Pierwszy wiersz z nazwiskiem</label>
            <input type="number" name="pierwszy_wiersz_z_nazwiskiem" min={1} defaultValue={2} className="mt-1 w-full rounded border px-3 py-2" />
          </div>
          <div>
            <label className="block text-sm font-medium">Limit graczy (opcjonalnie)</label>
            <input type="number" name="limit_graczy" min={1} className="mt-1 w-full rounded border px-3 py-2" />
          </div>
        </div>

        {/* NOWE: LAT/LNG + guzik „Dodaj pinezkę” */}
        <div className="grid grid-cols-1 gap-4 sm:grid-cols-3">
          <div>
            <label className="block text-sm font-medium">Lat</label>
            <input id="lat" name="lat" className="mt-1 w-full rounded border px-3 py-2" placeholder="np. 52.2297" />
          </div>
          <div>
            <label className="block text-sm font-medium">Lng</label>
            <input id="lng" name="lng" className="mt-1 w-full rounded border px-3 py-2" placeholder="np. 21.0122" />
          </div>
          <div className="flex items-end">
            <MapPicker
              targetLatId="lat"
              targetLngId="lng"
              lat={null}
              lng={null}
              buttonLabel="Dodaj pinezkę"
            />
          </div>
        </div>

        <div className="flex gap-2 pt-2">
          <button className="pill pill--primary" type="submit">Utwórz</button>
          <a href="/admin" className="pill pill--secondary">Anuluj</a>
        </div>
      </form>
    </main>
  )
}
```

### app/turniej/page.tsx

```
import { createSupabaseServer } from '@/lib/supabase/server'

export const dynamic = 'force-dynamic'
export const revalidate = 0

type Row = {
  id: string
  nazwa: string
  data_turnieju: string | null     // YYYY-MM-DD
  godzina_turnieju: string | null  // HH:MM[:SS]
  gsheet_url: string | null
  arkusz_nazwa: string | null
  limit_graczy: number | null
  lat: number | null
  lng: number | null
}

function joinDateTime(d: string | null, t: string | null): Date | null {
  if (!d) return null
  // godzina może być "HH:MM:SS" lub "HH:MM"; bierzemy HH:MM
  const hhmm = (t ?? '00:00').slice(0, 5)
  // traktujemy czas lokalny (Warszawa)
  return new Date(`${d}T${hhmm}`)
}

function formatDatePL(d: Date) {
  return d.toLocaleDateString('pl-PL', { weekday: 'short', month: 'short', day: 'numeric' })
}

function formatTimeHHMM(raw: string | null) {
  if (!raw) return '00:00'
  const hhmm = raw.slice(0,5)
  return hhmm
}

function statusBadge(start: Date | null) {
  if (!start) return null
  const now = new Date()
  const ms = start.getTime() - now.getTime()
  const sixHours = 6 * 60 * 60 * 1000

  if (ms > 0) {
    // przyszłość
    const days = Math.floor(ms / (24 * 60 * 60 * 1000))
    if (days === 0) return { text: 'dzisiaj', style: 'bg-blue-50 text-blue-700 border-blue-200' }
    if (days === 1) return { text: 'jutro', style: 'bg-blue-50 text-blue-700 border-blue-200' }
    if (days === 2) return { text: 'pojutrze', style: 'bg-blue-50 text-blue-700 border-blue-200' }
    return { text: `za ${days} dni`, style: 'bg-blue-50 text-blue-700 border-blue-200' }
  } else {
    // przeszłość/teraz
    const since = now.getTime() - start.getTime()
    if (since <= sixHours) return { text: 'w trakcie', style: 'bg-amber-50 text-amber-700 border-amber-200' }
    return { text: 'zakończony', style: 'bg-slate-100 text-slate-700 border-slate-200' }
  }
}

export default async function TurniejListPage() {
  const supabase = await createSupabaseServer()
  const { data: rows } = await supabase
    .from('turniej')
    .select('id,nazwa,data_turnieju,godzina_turnieju,gsheet_url,arkusz_nazwa,limit_graczy,lat,lng')
    .order('data_turnieju', { ascending: true })
    .limit(200)

  return (
    <main className="mx-auto max-w-5xl p-6 space-y-5">
      <h1 className="text-2xl font-semibold">Turnieje</h1>

      <div className="space-y-4">
        {rows?.map((r) => {
          const start = joinDateTime(r.data_turnieju, r.godzina_turnieju)
          const badge = statusBadge(start)
          return (
            <details
              key={r.id}
              className="group rounded-xl border border-red-100 bg-white/80 backdrop-blur px-4 py-3 shadow-sm open:shadow transition-shadow"
            >
              <summary className="flex cursor-pointer list-none items-center justify-between gap-3">
                <div className="min-w-0">
                  <div className="truncate text-base font-semibold text-red-800">{r.nazwa}</div>
                  <div className="mt-0.5 text-xs text-red-700/80">
                    {start ? (
                      <>
                        {formatDatePL(start)} • {formatTimeHHMM(r.godzina_turnieju)}
                        {r.limit_graczy ? <> • limit: {r.limit_graczy}</> : null}
                      </>
                    ) : (
                      <>—</>
                    )}
                  </div>
                </div>
                {badge && (
                  <span className={`shrink-0 rounded-full border px-3 py-1 text-xs font-medium ${badge.style}`}>
                    {badge.text}
                  </span>
                )}
              </summary>

              {/* rozwijane szczegóły */}
              <div className="mt-4 grid gap-4 sm:grid-cols-2">
                <div className="space-y-2">
                  <div className="text-sm font-medium text-slate-700">Szczegóły</div>
                  <ul className="text-sm text-slate-700/90 leading-relaxed">
                    <li><span className="opacity-70">Data:</span> {start ? formatDatePL(start) : '—'}</li>
                    <li><span className="opacity-70">Godzina:</span> {formatTimeHHMM(r.godzina_turnieju)}</li>
                    {r.limit_graczy && <li><span className="opacity-70">Limit graczy:</span> {r.limit_graczy}</li>}
                    {r.arkusz_nazwa && <li><span className="opacity-70">Arkusz (karta):</span> {r.arkusz_nazwa}</li>}
                  </ul>

                  {r.gsheet_url && (
                    <div className="pt-2">
                      <a
                        href={r.gsheet_url}
                        target="_blank"
                        rel="noreferrer"
                        className="inline-flex items-center gap-2 rounded-full border border-red-200 bg-white px-4 py-2 text-sm font-semibold text-red-700 hover:bg-red-50"
                      >
                        Arkusz Google
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden>
                          <path d="M14 3h7v7m0-7L10 14" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" />
                          <path d="M21 14v7H3V3h7" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" />
                        </svg>
                      </a>
                    </div>
                  )}
                </div>

                {/* mini mapa (tylko jeśli są współrzędne) */}
                <div className="space-y-2">
                  <div className="text-sm font-medium text-slate-700">Lokalizacja</div>
                  {r.lat !== null && r.lng !== null ? (
                    <div className="overflow-hidden rounded-lg border">
                      <div className="aspect-[16/9]">
                        <iframe
                          title={`Mapa ${r.nazwa}`}
                          src={`https://www.google.com/maps?q=${r.lat},${r.lng}&z=14&output=embed`}
                          className="h-full w-full"
                          loading="lazy"
                          referrerPolicy="no-referrer-when-downgrade"
                        />
                      </div>
                      <div className="border-t bg-slate-50/50 p-2 text-right">
                        <a
                          href={`https://www.google.com/maps/search/?api=1&query=${r.lat},${r.lng}`}
                          target="_blank"
                          rel="noreferrer"
                          className="text-xs font-medium text-red-700 hover:underline"
                        >
                          Otwórz w Mapach Google
                        </a>
                      </div>
                    </div>
                  ) : (
                    <div className="rounded-md border border-slate-200 bg-slate-50 px-3 py-2 text-sm text-slate-600">
                      Brak współrzędnych.
                    </div>
                  )}
                </div>
              </div>
            </details>
          )
        })}

        {!rows?.length && (
          <div className="rounded-md border px-4 py-6 text-sm opacity-70">Brak turniejów.</div>
        )}
      </div>
    </main>
  )
}
```

### components/AutoHide.tsx

```
'use client'

import { useEffect, useState } from 'react'

export default function AutoHide({
  children,
  ms = 5000,
}: {
  children: React.ReactNode
  ms?: number
}) {
  const [show, setShow] = useState(true)
  useEffect(() => {
    const t = setTimeout(() => setShow(false), ms)
    return () => clearTimeout(t)
  }, [ms])
  if (!show) return null
  return <>{children}</>
}
```

### components/LoadGoogleMaps.tsx

```
'use client'

import Script from 'next/script'

export default function LoadGoogleMaps() {
  const apiKey = process.env.NEXT_PUBLIC_GOOGLE_MAPS_API_KEY
  if (!apiKey) return null

  return (
    <Script
      id="google-maps-sdk"
      src={`https://maps.googleapis.com/maps/api/js?key=${apiKey}`}
      strategy="afterInteractive"
    />
  )
}
```

### components/MapPicker.tsx

```
'use client'

import { useEffect, useRef, useState } from 'react'

type Props = {
  targetLatId: string
  targetLngId: string
  lat?: number | null
  lng?: number | null
  buttonLabel?: string
}

function mapsReady() {
  return typeof window !== 'undefined' && !!(window as any).google?.maps
}

export default function MapPicker({
  targetLatId,
  targetLngId,
  lat,
  lng,
  buttonLabel = 'Ustaw pinezkę',
}: Props) {
  const [open, setOpen] = useState(false)
  const [ready, setReady] = useState(mapsReady())
  const [failed, setFailed] = useState(false)

  const mapRef = useRef<HTMLDivElement>(null)
  const markerRef = useRef<google.maps.Marker | null>(null)
  const gmapRef = useRef<google.maps.Map | null>(null)

  const defaultCenter = {
    lat: typeof lat === 'number' ? lat : 52.2297,
    lng: typeof lng === 'number' ? lng : 21.0122,
  }

  // Czekamy aż google.maps będzie dostępne (polling do 5s)
  useEffect(() => {
    if (!open || ready) return
    let tries = 0
    const t = setInterval(() => {
      tries++
      const ok = mapsReady()
      setReady(ok)
      if (ok || tries > 50) { // ~5s
        clearInterval(t)
        if (!ok) setFailed(true)
      }
    }, 100)
    return () => clearInterval(t)
  }, [open, ready])

  // Inicjalizacja mapy po otwarciu i ready
  useEffect(() => {
    if (!open || !ready || !mapRef.current) return
    // Poczekaj aż modal wyrenderuje wymiary
    const raf = requestAnimationFrame(() => {
      try {
        const map = new google.maps.Map(mapRef.current!, {
          center: defaultCenter,
          zoom: 12,
        })
        gmapRef.current = map

        const marker = new google.maps.Marker({
          position: defaultCenter,
          map,
          draggable: true,
        })
        markerRef.current = marker

        map.addListener('click', (e: google.maps.MapMouseEvent) => {
          const pos = e.latLng
          if (pos) marker.setPosition(pos)
        })
      } catch (e) {
        setFailed(true)
        // eslint-disable-next-line no-console
        console.error('Map init error', e)
      }
    })
    return () => {
      cancelAnimationFrame(raf)
      markerRef.current?.setMap(null)
      markerRef.current = null
      gmapRef.current = null
    }
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [open, ready])

  function confirmPick() {
    const pos = markerRef.current?.getPosition()
    if (pos) {
      const latEl = document.getElementById(targetLatId) as HTMLInputElement | null
      const lngEl = document.getElementById(targetLngId) as HTMLInputElement | null
      if (latEl) latEl.value = String(pos.lat())
      if (lngEl) lngEl.value = String(pos.lng())
    }
    setOpen(false)
  }

  return (
    <>
      <button type="button" className="pill pill--secondary" onClick={() => { setFailed(false); setOpen(true) }}>
        {buttonLabel}
      </button>

      {open && (
        <div className="fixed inset-0 z-[100] flex items-center justify-center bg-black/40 p-4">
          <div className="w-full max-w-3xl overflow-hidden rounded-lg bg-white shadow-lg">
            <div className="flex items-center justify-between border-b px-4 py-3">
              <h3 className="font-semibold">Wybierz lokalizację</h3>
              <button type="button" className="text-sm underline" onClick={() => setOpen(false)}>Zamknij</button>
            </div>

            {/* Stan: brak klucza */}
            {!process.env.NEXT_PUBLIC_GOOGLE_MAPS_API_KEY && (
              <div className="p-4 text-sm text-red-700">
                Brak <code>NEXT_PUBLIC_GOOGLE_MAPS_API_KEY</code>. Dodaj do .env.local i zrestartuj dev server.
              </div>
            )}

            {/* Stan: ładowanie SDK */}
            {!ready && !failed && (
              <div className="flex h-[60vh] w-full items-center justify-center text-sm text-slate-600">
                Ładowanie mapy…
              </div>
            )}

            {/* Stan: błąd */}
            {failed && (
              <div className="flex h-[60vh] w-full flex-col items-center justify-center gap-2 p-4 text-center text-sm text-red-700">
                Nie udało się załadować mapy. Sprawdź klucz/referrer i wtyczki blokujące.
                <button
                  type="button"
                  className="pill pill--secondary"
                  onClick={() => { setReady(mapsReady()); setFailed(false) }}
                >
                  Spróbuj ponownie
                </button>
              </div>
            )}

            {/* Mapa */}
            {ready && !failed && (
              <div className="h-[60vh] w-full" ref={mapRef} />
            )}

            <div className="flex justify-end gap-2 border-t px-4 py-3">
              <button type="button" className="pill pill--secondary" onClick={() => setOpen(false)}>Anuluj</button>
              <button type="button" className="pill pill--primary" onClick={confirmPick} disabled={!ready || failed}>
                Ustaw
              </button>
            </div>
          </div>
        </div>
      )}
    </>
  )
}
```

### components/Navbar.tsx

```
'use client'

import Link from 'next/link'
import { useEffect, useState } from 'react'
import { usePathname } from 'next/navigation'

type UserLite = { id: string; email?: string | null } | null
type Role = 'admin' | 'user' | null

export default function Navbar({ user, role }: { user: UserLite; role: Role }) {
  const [open, setOpen] = useState(false)
  const pathname = usePathname()

  useEffect(() => { setOpen(false) }, [pathname])

  const NavLink = ({ href, children }: { href: string; children: React.ReactNode }) => {
    const active = pathname === href
    return (
      <Link
        href={href}
        className={[
          'relative px-3 py-2 text-sm font-medium transition',
          'text-sky-200/80 hover:text-sky-300',
          active ? 'text-sky-300' : '',
        ].join(' ')}
      >
        {children}
        {active && (
          <span className="absolute inset-x-2 -bottom-1 h-0.5 rounded-full bg-sky-400" />
        )}
      </Link>
    )
  }

  const inputStyle =
    'h-9 rounded-lg border border-slate-600 bg-slate-900/70 px-3 text-xs text-sky-50 ' +
    'placeholder:text-slate-400 shadow-sm focus:outline-none focus:ring-1 focus:ring-sky-400'

  const buttonPrimary =
    'h-9 rounded-full bg-gradient-to-r from-sky-500 to-sky-600 px-5 text-sm font-semibold text-white ' +
    'shadow-[0_5px_18px_rgba(15,23,42,0.8)] transition ' +
    'hover:from-sky-400 hover:to-sky-500 hover:shadow-[0_7px_22px_rgba(15,23,42,1)]'

  const buttonSecondary =
    'h-9 rounded-full bg-slate-900/70 border border-sky-600 px-5 text-sm font-semibold text-sky-100 ' +
    'shadow-sm hover:bg-slate-800 hover:border-sky-400 transition'

  return (
    <header className="sticky top-0 z-50">
      {/* Pasek akcentu */}
      <div className="h-1 w-full bg-gradient-to-r from-sky-500 via-sky-400 to-sky-500" />

      <nav className="
        w-full 
        bg-slate-900/95
        backdrop-blur-md
        border-b border-slate-700
        shadow-[0_8px_25px_rgba(0,0,0,0.7)]
      ">
        <div className="mx-auto flex max-w-7xl items-center justify-between px-6 py-3">

          {/* LEWA STRONA */}
          <div className="flex items-center gap-4">
            <Link href="/" className="flex items-center gap-2">
              <span className="inline-flex h-8 w-8 items-center justify-center rounded-lg 
                bg-sky-500 text-slate-900 font-bold shadow-md">
                EA
              </span>
            </Link>

            <div className="hidden md:flex items-center gap-3">
              <NavLink href="/turniej">Turnieje</NavLink>

              {!user && <NavLink href="/auth/signup">Rejestracja</NavLink>}

              {user && <NavLink href="/profile">Profil</NavLink>}
              {role === 'admin' && <NavLink href="/admin">Admin</NavLink>}
            </div>
          </div>

          {/* PRAWA STRONA */}
          <div className="hidden md:flex items-center gap-3">

            {user ? (
              <>
                <span className="inline-flex h-9 items-center truncate rounded-full 
                  border border-sky-600 bg-slate-800/70 px-4 text-xs font-medium text-sky-200">
                  <span className="opacity-70">Zalogowano:</span>&nbsp;{user.email}
                </span>

                <form action="/auth/signout" method="post">
                  <button className={buttonSecondary}>
                    Wyloguj
                  </button>
                </form>
              </>
            ) : (
              <form
  action="/auth/signin/submit"
  method="post"
  className="flex items-center gap-2"
  autoComplete="off"
>

  {/* Fake input – przechwytuje autouzupełnianie */}
  <input type="text" autoComplete="username" className="hidden" />
  <input type="password" autoComplete="current-password" className="hidden" />

  <input
    name="identifier"
    placeholder="E-mail lub login"
    autoComplete="new-email"
    className={inputStyle}
  />

  <input
    type="password"
    name="password"
    placeholder="Hasło"
    autoComplete="new-password"
    className={inputStyle}
  />

  <button className={buttonPrimary}>Zaloguj</button>
</form>

            )}

          </div>

          {/* BURGER MOBILE */}
          <button
            className="md:hidden inline-flex h-10 w-10 items-center justify-center 
            rounded-md border border-sky-600 bg-slate-800/70 text-sky-200"
            onClick={() => setOpen((v) => !v)}
          >
            <svg width="22" height="22" viewBox="0 0 24 24" stroke="currentColor">
              <path d="M4 6h16M4 12h16M4 18h16" strokeWidth="2" strokeLinecap="round" />
            </svg>
          </button>
        </div>

        {/* MENU MOBILE */}
        {open && (
          <div className="md:hidden border-t border-sky-700 bg-slate-900/95 px-4 py-3 space-y-2">

            <NavLink href="/turniej">Turnieje</NavLink>
            {!user && <NavLink href="/auth/signup">Rejestracja</NavLink>}
            {user && <NavLink href="/profile">Profil</NavLink>}
            {role === 'admin' && <NavLink href="/admin">Admin</NavLink>}

            <div className="border-t border-sky-700 my-3" />

            {user ? (
              <form action="/auth/signout" method="post">
                <button className={`${buttonPrimary} w-full justify-center`}>
                  Wyloguj
                </button>
              </form>
            ) : (
              <Link href="/auth/signin" className={`${buttonPrimary} w-full justify-center`}>
                Zaloguj
              </Link>
            )}

          </div>
        )}

      </nav>
    </header>
  )
}
```

### components/SheetPicker.tsx

```
'use client'

import { useState } from 'react'

type Props = {
  urlInputId: string        // id inputa z linkiem do Google Sheets
  sheetInputId: string      // id inputa, do którego wpiszemy nazwę karty
  gidHiddenInputId?: string // (opcjonalnie) id ukrytego inputa na gid
}

export default function SheetPicker({ urlInputId, sheetInputId, gidHiddenInputId }: Props) {
  const [loading, setLoading] = useState(false)
  const [error, setError] = useState<string | null>(null)
  const [sheets, setSheets] = useState<{ name: string; gid: string | null }[]>([])
  const [selected, setSelected] = useState<string>('')

  async function fetchSheets() {
    setError(null)
    setSheets([])
    setSelected('')
    const urlEl = document.getElementById(urlInputId) as HTMLInputElement | null
    if (!urlEl || !urlEl.value) {
      setError('Wklej najpierw link do Google Sheets.')
      return
    }
    setLoading(true)
    try {
      const res = await fetch(`/api/gsheets/list?url=${encodeURIComponent(urlEl.value)}`, { cache: 'no-store' })
      const data = await res.json()
      if (!res.ok) throw new Error(data?.error || 'fetch_failed')
      setSheets(data.sheets || [])
      if ((data.sheets || []).length === 0) {
        setError('Nie znaleziono arkuszy. Upewnij się, że dokument jest publiczny/opublikowany.')
      }
    } catch (e: any) {
      setError('Nie udało się pobrać listy arkuszy.')
    } finally {
      setLoading(false)
    }
  }

  function applySelection(name: string) {
    setSelected(name)
    const sheetEl = document.getElementById(sheetInputId) as HTMLInputElement | null
    if (sheetEl) sheetEl.value = name
    // jeśli mamy hidden na gid, ustaw go dla wygody (jeśli wybrany ma gid)
    if (gidHiddenInputId) {
      const gidEl = document.getElementById(gidHiddenInputId) as HTMLInputElement | null
      const found = sheets.find(s => s.name === name)
      if (gidEl) gidEl.value = found?.gid ?? ''
    }
  }

  return (
    <div className="flex flex-col gap-2">
      <div className="flex items-center gap-2">
        <button type="button" className="pill pill--secondary" onClick={fetchSheets} disabled={loading}>
          {loading ? 'Pobieranie…' : 'Pobierz arkusze'}
        </button>
        {error && <span className="text-xs text-red-700">{error}</span>}
      </div>

      {sheets.length > 0 && (
        <div className="flex items-center gap-2">
          <select
            className="rounded border px-3 py-2"
            value={selected}
            onChange={(e) => applySelection(e.target.value)}
          >
            <option value="" disabled>— wybierz kartę —</option>
            {sheets.map((s) => (
              <option key={`${s.name}-${s.gid ?? 'nogid'}`} value={s.name}>
                {s.name}{s.gid ? ` (gid: ${s.gid})` : ''}
              </option>
            ))}
          </select>
          <span className="text-xs text-slate-600">Zapisze nazwę do pola „Nazwa karty”.</span>
        </div>
      )}
    </div>
  )
}
```

### eslint.config.mjs

```
import { defineConfig, globalIgnores } from "eslint/config";
import nextVitals from "eslint-config-next/core-web-vitals";
import nextTs from "eslint-config-next/typescript";

const eslintConfig = defineConfig([
  ...nextVitals,
  ...nextTs,
  // Override default ignores of eslint-config-next.
  globalIgnores([
    // Default ignores of eslint-config-next:
    ".next/**",
    "out/**",
    "build/**",
    "next-env.d.ts",
  ]),
]);

export default eslintConfig;
```

### lib/supabase/admin.ts

```
import { createClient } from '@supabase/supabase-js'

export const supabaseAdmin = createClient(
  process.env.NEXT_PUBLIC_SUPABASE_URL!,
  process.env.SUPABASE_SERVICE_ROLE!,   // tylko na serwerze!
  { auth: { persistSession: false } }
)
```

### lib/supabase/client.ts

```
'use client'
import { createBrowserClient } from '@supabase/ssr'
export const supabase = createBrowserClient(
  process.env.NEXT_PUBLIC_SUPABASE_URL!,
  process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!
)
```

### lib/supabase/server-mutable.ts

```
// lib/supabase/server-mutable.ts
import { cookies } from 'next/headers'
import { createServerClient, type CookieOptions } from '@supabase/ssr'

export async function createSupabaseServerMutable() {
  const store = await cookies()

  return createServerClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,
    {
      cookies: {
        get(name: string) {
          return store.get(name)?.value
        },
        set(name: string, value: string, options?: CookieOptions) {
          store.set({ name, value, ...options })
        },
        remove(name: string, options?: CookieOptions) {
          store.set({ name, value: '', ...options, maxAge: 0 })
        },
      },
    }
  )
}
```

### lib/supabase/server.ts

```
// lib/supabase/server.ts
import { cookies } from 'next/headers'
import { createServerClient, type CookieOptions } from '@supabase/ssr'

export async function createSupabaseServer() {
  // NEXT 15: cookies() jest async
  const store = await cookies()

  return createServerClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,
    {
      cookies: {
        get(name: string) {
          return store.get(name)?.value
        },
        // w RSC nie modyfikujemy cookies
        set(_name: string, _value: string, _options?: CookieOptions) {},
        remove(_name: string, _options?: CookieOptions) {},
      },
    }
  )
}
```

### next.config.ts

```
import type { NextConfig } from "next";

const nextConfig: NextConfig = {
  /* config options here */
  reactCompiler: true,
};

export default nextConfig;
```

### package.json

```
{
  "name": "elo-arena",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "eslint"
  },
  "dependencies": {
    "@supabase/ssr": "^0.7.0",
    "@supabase/supabase-js": "^2.80.0",
    "@vercel/analytics": "^1.5.0",
    "next": "16.0.1",
    "react": "19.2.0",
    "react-dom": "19.2.0"
  },
  "devDependencies": {
    "@types/google.maps": "^3.58.1",
    "@types/node": "^20",
    "@types/react": "^19",
    "@types/react-dom": "^19",
    "autoprefixer": "^10.4.21",
    "babel-plugin-react-compiler": "1.0.0",
    "eslint": "^9",
    "eslint-config-next": "16.0.1",
    "postcss": "^8.5.6",
    "tailwindcss": "^3.4.18",
    "typescript": "^5"
  }
}
```

### postcss.config.js

```
module.exports = {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
}
```

### tailwind.config.js

```
/** @type {import('tailwindcss').Config} */
module.exports = {
  content: [
    './app/**/*.{js,ts,jsx,tsx,mdx}',
    './components/**/*.{js,ts,jsx,tsx,mdx}',
    './pages/**/*.{js,ts,jsx,tsx,mdx}',
  ],
  theme: { extend: {} },
  plugins: [],
}
```

### tsconfig.json

```
{
  "compilerOptions": {
    "target": "ES2017",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "react-jsx",
    "incremental": true,
    "plugins": [
      {
        "name": "next"
      }
    ],
    "paths": {
      "@/*": ["./*"]
    }
  },
  "include": [
    "next-env.d.ts",
    "**/*.ts",
    "**/*.tsx",
    ".next/types/**/*.ts",
    ".next/dev/types/**/*.ts",
    "**/*.mts"
  ],
  "exclude": ["node_modules"]
}
```

