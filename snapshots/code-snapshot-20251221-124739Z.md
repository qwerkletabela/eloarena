# Code snapshot (2025-12-21T12:47:38Z)

## Git

```
commit 042b849061300b348a521759b7c8d19fcce5d9c4
Author:     Micha≈Ç <qwerkle.tabela@gmail.com>
AuthorDate: Sun Dec 21 13:47:25 2025 +0100
Commit:     Micha≈Ç <qwerkle.tabela@gmail.com>
CommitDate: Sun Dec 21 13:47:25 2025 +0100

    aktulizacja dodawania i edycji turnieju
```

## Tree

```
total 384
drwxr-xr-x 10 runner runner   4096 Dec 21 12:47 .
drwxr-xr-x  3 runner runner   4096 Dec 21 12:47 ..
drwxr-xr-x  7 runner runner   4096 Dec 21 12:47 .git
drwxr-xr-x  3 runner runner   4096 Dec 21 12:47 .github
-rw-r--r--  1 runner runner    480 Dec 21 12:47 .gitignore
-rw-r--r--  1 runner runner   1450 Dec 21 12:47 README.md
drwxr-xr-x 10 runner runner   4096 Dec 21 12:47 app
-rw-r--r--  1 runner runner    343 Dec 21 12:47 code-snapshot.md
drwxr-xr-x  4 runner runner   4096 Dec 21 12:47 components
-rw-r--r--  1 runner runner  11194 Dec 21 12:47 db.txt
-rw-r--r--  1 runner runner    465 Dec 21 12:47 eslint.config.mjs
drwxr-xr-x  2 runner runner   4096 Dec 21 12:47 hooks
drwxr-xr-x  3 runner runner   4096 Dec 21 12:47 lib
-rw-r--r--  1 runner runner    156 Dec 21 12:47 next.config.ts
-rw-r--r--  1 runner runner 303028 Dec 21 12:47 package-lock.json
-rw-r--r--  1 runner runner   1204 Dec 21 12:47 package.json
-rw-r--r--  1 runner runner     82 Dec 21 12:47 postcss.config.js
drwxr-xr-x  3 runner runner   4096 Dec 21 12:47 public
drwxr-xr-x  2 runner runner   4096 Dec 21 12:47 snapshots
-rw-r--r--  1 runner runner   1734 Dec 21 12:47 tailwind.config.js
-rw-r--r--  1 runner runner    666 Dec 21 12:47 tsconfig.json

app/
app/api/resolve-email/route.ts
app/api/check-email/route.ts
app/admin/miejsca/page.tsx
app/admin/turniej/page.tsx
app/admin/layout.tsx
app/admin/partie/page.tsx
app/admin/users/page.tsx
app/admin/page.tsx
app/globals.css
app/turniej/new/page.tsx
app/turniej/create/route.ts
app/turniej/page.tsx
app/organizer/dashboard/page.tsx
app/organizer/layout.tsx
app/auth/signout/route.ts
app/auth/login/route.ts
app/auth/signin/page.tsx
app/auth/signup/page.tsx
app/profile/update/route.ts
app/profile/page.tsx
app/layout.tsx
app/mapa/page.tsx
app/onboarding/username-form.tsx
app/onboarding/page.tsx
app/favicon.ico
app/page.tsx

components/
components/DeleteMiejsceButton.tsx
components/admin/AdminSidebar.tsx
components/admin/NowaPartiaForm.tsx
components/MiejsceForm.tsx
components/DeletePartia.tsx
components/MapPicker.tsx
components/AddTurniej.tsx
components/LoadGoogleMaps.tsx
components/organizer/OrganizerSidebar.tsx
components/DeleteTurniej.tsx
components/SheetPicker.tsx
components/TournamentModal.tsx
components/PartieClient.tsx
components/Navbar.tsx
components/AutoHide.tsx
components/TournamentList.client.tsx

lib/
lib/utils.ts
lib/eloCalculator.ts
lib/supabase/browser.ts
lib/supabase/server-mutable.ts
lib/supabase/server.ts
lib/supabase/admin.ts
lib/supabase/client.ts
```

## Files

### app/admin/gracz/add/route.ts

```
// app/admin/gracz/add/route.ts
import { NextRequest, NextResponse } from 'next/server'
import { createSupabaseServerMutable } from '@/lib/supabase/server-mutable'

export async function POST(req: NextRequest) {
  const origin = req.nextUrl.origin
  const supabase = await createSupabaseServerMutable()

  const { data: { user } } = await supabase.auth.getUser()
  const { data: isAdmin } = await supabase.rpc('is_admin')
  if (!user || !isAdmin) {
    return NextResponse.redirect(new URL('/', origin), { status: 303 })
  }

  const fd = await req.formData()
  const imie = String(fd.get('imie') || '').trim()
  const nazwisko = String(fd.get('nazwisko') || '').trim()
  const back = String(fd.get('back') || '/admin') // gdzie wracamy po akcji

  if (!imie || !nazwisko) {
    return NextResponse.redirect(new URL(`${back}?e=add_invalid`, origin), { status: 303 })
  }

  const { error } = await supabase
    .from('gracz')
    .upsert({ imie, nazwisko }, { onConflict: 'fullname_norm' })

  const url = new URL(back, origin)
  if (error) url.searchParams.set('e', 'add_failed')
  else url.searchParams.set('ok', '1')
  return NextResponse.redirect(url, { status: 303 })
}
```

### app/admin/layout.tsx

```
// elo-arena/app/admin/layout.tsx
import { redirect } from 'next/navigation'
import { createSupabaseServer } from '@/lib/supabase/server'
import AdminSidebar from '@/components/admin/AdminSidebar'

export const dynamic = 'force-dynamic'
export const revalidate = 0

export default async function AdminLayout({
  children,
}: {
  children: React.ReactNode
}) {
  const supabase = await createSupabaseServer()

  // Sprawdzenie czy u≈ºytkownik jest zalogowany
  const { data: { user } } = await supabase.auth.getUser()
  if (!user) {
    redirect('/auth/signin')
  }

  // Sprawdzenie roli admin
  const { data: isAdmin } = await supabase.rpc('is_admin')
  if (!isAdmin) {
    redirect('/')
  }

  return (
    <div className="min-h-screen">
      <div className="flex">
        <AdminSidebar user={user} />
        <div className="flex-1">
          {children}
        </div>
      </div>
    </div>
  )
}```

### app/admin/miejsca/[id]/edit/page.tsx

```
// app/admin/miejsca/[id]/edit/page.tsx
import { redirect } from 'next/navigation'
import { createSupabaseServer } from '@/lib/supabase/server'
import MiejsceForm from '@/components/MiejsceForm'

export const dynamic = 'force-dynamic'
export const revalidate = 0

interface EditMiejscePageProps {
  params: Promise<{
    id: string
  }>
}

export default async function EditMiejscePage(props: EditMiejscePageProps) {
  const params = await props.params
  const supabase = await createSupabaseServer()

  // Sprawd≈∫ autoryzacjƒô
  const { data: { user } } = await supabase.auth.getUser()
  if (!user) redirect('/auth/signin')

  const { data: isAdmin } = await supabase.rpc('is_admin')
  if (!isAdmin) redirect('/')

  // Sprawd≈∫ czy params.id istnieje
  if (!params.id) {
    console.error('Brak ID w parametrach')
    redirect('/admin/miejsca')
  }

  // Pobierz istniejƒÖce miejsce
  const { data: miejsce, error } = await supabase
    .from('miejsce_turnieju')
    .select('*')
    .eq('id', params.id)
    .single()

  if (error || !miejsce) {
    console.error('Error fetching miejsce:', error)
    redirect('/admin/miejsca')
  }

  return (
    <main className="flex min-h-[calc(100vh-4rem)] items-center justify-center px-4 py-8">
      <div className="w-full max-w-3xl">
        <MiejsceForm mode="edit" initial={miejsce} />
      </div>
    </main>
  )
}```

### app/admin/miejsca/new/page.tsx

```
// app/admin/miejsca/new/page.tsx
import { redirect } from 'next/navigation'
import { createSupabaseServer } from '@/lib/supabase/server'
import MiejsceForm from '@/components/MiejsceForm'

export const dynamic = 'force-dynamic'
export const revalidate = 0

export default async function NewMiejscePage() {
  const supabase = await createSupabaseServer()

  const { data: { user } } = await supabase.auth.getUser()
  if (!user) redirect('/auth/signin')

  const { data: isAdmin } = await supabase.rpc('is_admin')
  if (!isAdmin) redirect('/')

  return (
    <main className="flex min-h-[calc(100vh-4rem)] items-center justify-center px-4 py-8">
      <div className="w-full max-w-3xl">
        <MiejsceForm mode="new" initial={null} />
      </div>
    </main>
  )
}```

### app/admin/miejsca/page.tsx

```
// app/admin/miejsca/page.tsx
import Link from 'next/link'
import { redirect } from 'next/navigation'
import { createSupabaseServer } from '@/lib/supabase/server'
import DeleteMiejsceButton from '@/components/DeleteMiejsceButton'

export const dynamic = 'force-dynamic'
export const revalidate = 0

type Row = {
  id: string
  nazwa: string
  miasto: string
  wojewodztwo: string | null
  adres: string | null
  latitude: number
  longitude: number
  created_at: string | null
  liczba_turniejow?: number
}

export default async function AdminMiejscaList() {
  const supabase = await createSupabaseServer()

  // wymagane logowanie
  const {
    data: { user },
  } = await supabase.auth.getUser()
  if (!user) redirect('/auth/signin')

  // wymagany admin (tak jak w innych stronach panelu)
  const { data: isAdmin } = await supabase.rpc('is_admin')
  if (!isAdmin) redirect('/')

  // pobierz miejsca
  const { data: rows, error } = await supabase
    .from('miejsce_turnieju')
    .select(
      'id, nazwa, miasto, wojewodztwo, adres, latitude, longitude, created_at'
    )
    .order('miasto', { ascending: true })
    .order('nazwa', { ascending: true })

  if (error) {
    return (
      <main className="flex min-h-[calc(100vh-4rem)] items-center justify-center px-4 py-8">
        <div className="w-full max-w-6xl rounded-2xl bg-slate-800/95 border border-slate-700 shadow-[0_14px_40px_rgba(0,0,0,0.8)] p-6">
          <h1 className="text-2xl font-semibold text-sky-50 mb-4">
            Miejsca turniej√≥w - Panel admina
          </h1>
          <div className="rounded-md border border-red-400/50 bg-red-500/10 px-4 py-3 text-red-200">
            Nie uda≈Ço siƒô pobraƒá danych miejsc.
          </div>
        </div>
      </main>
    )
  }

  // Pobierz liczbƒô turniej√≥w dla ka≈ºdego miejsca
  const miejscaZTurniejami = await Promise.all(
    (rows || []).map(async (miejsce) => {
      const { count, error: countError } = await supabase
        .from('turniej')
        .select('id', { count: 'exact', head: true })
        .eq('miejsce_id', miejsce.id)

      if (countError) {
        console.error(`B≈ÇƒÖd pobierania turniej√≥w dla miejsca ${miejsce.id}:`, countError)
      }

      return {
        ...miejsce,
        liczba_turniejow: count || 0
      }
    })
  )

  return (
    <main className="flex min-h-[calc(100vh-4rem)] items-center justify-center px-4 py-8">
      <div className="w-full max-w-6xl rounded-2xl bg-slate-800/95 border border-slate-700 shadow-[0_14px_40px_rgba(0,0,0,0.8)] p-6 space-y-6">
        <div className="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
          <div>
            <h1 className="text-2xl font-semibold text-sky-50">
              Miejsca turniej√≥w
            </h1>
            <p className="mt-1 text-sm text-slate-400">
              Lista wszystkich zdefiniowanych lokalizacji, kt√≥re mo≈ºesz podpiƒÖƒá
              pod turnieje.
            </p>
          </div>
          <Link
            href="/admin/miejsca/new"
            className="rounded-full bg-sky-600 hover:bg-sky-500 px-6 py-2 text-sm font-semibold text-white transition flex items-center gap-2"
          >
            <svg
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              strokeWidth="2"
            >
              <path d="M12 5v14M5 12h14" />
            </svg>
            Dodaj miejsce
          </Link>
        </div>

        <div className="overflow-x-auto rounded-lg border border-slate-600">
          <table className="min-w-full text-sm">
            <thead className="bg-slate-700/50">
              <tr>
                <th className="px-4 py-3 text-left text-sky-100 font-medium text-xs uppercase tracking-wider">
                  Miasto
                </th>
                <th className="px-4 py-3 text-left text-sky-100 font-medium text-xs uppercase tracking-wider">
                  Nazwa miejsca
                </th>
                <th className="px-4 py-3 text-left text-sky-100 font-medium text-xs uppercase tracking-wider">
                  Wojew√≥dztwo
                </th>
                <th className="px-4 py-3 text-left text-sky-100 font-medium text-xs uppercase tracking-wider">
                  Adres
                </th>
                <th className="px-4 py-3 text-left text-sky-100 font-medium text-xs uppercase tracking-wider">
                  Wsp√≥≈Çrzƒôdne
                </th>
                <th className="px-4 py-3 text-left text-sky-100 font-medium text-xs uppercase tracking-wider">
                  Turnieje
                </th>
                <th className="px-4 py-3 text-left text-sky-100 font-medium text-xs uppercase tracking-wider">
                  Utworzono
                </th>
                <th className="px-4 py-3 text-left text-sky-100 font-medium text-xs uppercase tracking-wider">
                  Akcje
                </th>
              </tr>
            </thead>
            <tbody className="divide-y divide-slate-600">
              {miejscaZTurniejami?.map((miejsce) => {
                const r = miejsce as Row
                return (
                  <tr
                    key={r.id}
                    className="hover:bg-slate-700/30 transition"
                  >
                    <td className="px-4 py-3 text-sky-100">
                      {r.miasto || '‚Äî'}
                    </td>
                    <td className="px-4 py-3">
                      <Link
                        href={`/admin/miejsca/${r.id}/edit`}
                        className="text-sky-100 hover:text-sky-200 font-medium hover:underline"
                      >
                        {r.nazwa}
                      </Link>
                    </td>
                    <td className="px-4 py-3 text-slate-200 text-xs">
                      {r.wojewodztwo || '‚Äî'}
                    </td>
                    <td className="px-4 py-3 text-slate-200 text-xs max-w-xs truncate">
                      {r.adres || '‚Äî'}
                    </td>
                    <td className="px-4 py-3 text-slate-200 text-xs">
                      {r.latitude?.toFixed(4)}, {r.longitude?.toFixed(4)}
                    </td>
                    <td className="px-4 py-3">
                      <div className="flex items-center justify-center">
                        <span className={`inline-flex items-center justify-center w-8 h-8 rounded-full text-sm font-bold ${
                          r.liczba_turniejow && r.liczba_turniejow > 0 
                            ? 'bg-green-500/20 text-green-300' 
                            : 'bg-slate-700/50 text-slate-300'
                        }`}>
                          {r.liczba_turniejow || 0}
                        </span>
                      </div>
                    </td>
                    <td className="px-4 py-3 text-slate-200 text-xs">
                      {r.created_at
                        ? new Date(r.created_at).toLocaleDateString('pl-PL')
                        : '‚Äî'}
                    </td>
                    <td className="px-4 py-3">
                      <div className="flex items-center gap-2">
                        <Link
                          href={`/admin/miejsca/${r.id}/edit`}
                          className="inline-flex items-center gap-1 rounded bg-sky-600 hover:bg-sky-500 px-3 py-1 text-xs font-medium text-white transition"
                        >
                          <svg
                            width="12"
                            height="12"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            strokeWidth="2"
                          >
                            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" />
                            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z" />
                          </svg>
                          Edytuj
                        </Link>
                        <DeleteMiejsceButton id={r.id} nazwa={r.nazwa} />
                      </div>
                    </td>
                  </tr>
                )
              })}

              {!miejscaZTurniejami?.length && (
                <tr>
                  <td
                    className="px-4 py-8 text-center text-slate-400 text-sm"
                    colSpan={8}
                  >
                    <div className="flex flex-col items-center gap-2">
                      <svg
                        width="48"
                        height="48"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        strokeWidth="1"
                        className="text-slate-600"
                      >
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
                        <polyline points="14,2 14,8 20,8" />
                        <line x1="16" y1="13" x2="8" y2="13" />
                        <line x1="16" y1="17" x2="8" y2="17" />
                        <polyline points="10,9 9,9 8,9" />
                      </svg>
                      <p>Brak zdefiniowanych miejsc turniej√≥w</p>
                      <Link
                        href="/admin/miejsca/new"
                        className="text-sky-400 hover:text-sky-300 text-sm underline"
                      >
                        Dodaj pierwsze miejsce
                      </Link>
                    </div>
                  </td>
                </tr>
              )}
            </tbody>
          </table>
        </div>

        {miejscaZTurniejami && miejscaZTurniejami.length > 0 && (
          <div className="text-sm text-slate-400 text-center">
            Znaleziono {miejscaZTurniejami.length} miejsc
            {miejscaZTurniejami.length === 1
              ? 'e'
              : miejscaZTurniejami.length > 1 && miejscaZTurniejami.length < 5
              ? 'a'
              : ''}
          </div>
        )}
      </div>
    </main>
  )
}```

### app/admin/page.tsx

```
// elo-arena/app/admin/page.tsx
import { createSupabaseServer } from '@/lib/supabase/server'
import { 
  Users, 
  Trophy, 
  UserPlus, 
  BarChart3,
  Calendar,
  MapPin,
  Settings
} from 'lucide-react'
import Link from 'next/link'

export const dynamic = 'force-dynamic'
export const revalidate = 0

export default async function AdminPage() {
  const supabase = await createSupabaseServer()

  // Pobieranie statystyk
  const [turnieje, gracze, uzytkownicy, ostatnieTurnieje] = await Promise.all([
    supabase.from('turniej').select('id', { count: 'exact', head: true }),
    supabase.from('gracz').select('id', { count: 'exact', head: true }),
    supabase.from('profiles').select('id', { count: 'exact', head: true }),
    supabase.from('turniej')
      .select('nazwa, data')
      .order('data', { ascending: false })
      .limit(3)
  ])

  const cntTurnieje = turnieje.count ?? 0
  const cntGracze = gracze.count ?? 0
  const cntUsers = uzytkownicy.count ?? 0

  return (
    <main className="p-8">
      {/* Welcome Section */}
      <div className="mb-8">
        <h1 className="text-3xl font-bold text-white mb-2">
          Witaj w panelu administratora
        </h1>
        <p className="text-slate-400">
          ZarzƒÖdzaj u≈ºytkownikami, turniejami i ustawieniami systemu
        </p>
      </div>

      {/* Statistics Grid */}
      <div className="grid grid-cols-1 gap-6 mb-8 sm:grid-cols-2 lg:grid-cols-4">
        <div className="rounded-2xl bg-slate-800/50 p-6 border border-slate-700 backdrop-blur-sm">
          <div className="flex items-center">
            <div className="rounded-lg bg-blue-500/20 p-3">
              <Trophy className="h-6 w-6 text-blue-400" />
            </div>
            <div className="ml-4">
              <p className="text-sm font-medium text-slate-400">Turnieje</p>
              <p className="text-2xl font-bold text-white">{cntTurnieje}</p>
            </div>
          </div>
        </div>

        <div className="rounded-2xl bg-slate-800/50 p-6 border border-slate-700 backdrop-blur-sm">
          <div className="flex items-center">
            <div className="rounded-lg bg-green-500/20 p-3">
              <Users className="h-6 w-6 text-green-400" />
            </div>
            <div className="ml-4">
              <p className="text-sm font-medium text-slate-400">Gracze</p>
              <p className="text-2xl font-bold text-white">{cntGracze}</p>
            </div>
          </div>
        </div>

        <div className="rounded-2xl bg-slate-800/50 p-6 border border-slate-700 backdrop-blur-sm">
          <div className="flex items-center">
            <div className="rounded-lg bg-purple-500/20 p-3">
              <UserPlus className="h-6 w-6 text-purple-400" />
            </div>
            <div className="ml-4">
              <p className="text-sm font-medium text-slate-400">U≈ºytkownicy</p>
              <p className="text-2xl font-bold text-white">{cntUsers}</p>
            </div>
          </div>
        </div>

        <div className="rounded-2xl bg-slate-800/50 p-6 border border-slate-700 backdrop-blur-sm">
          <div className="flex items-center">
            <div className="rounded-lg bg-orange-500/20 p-3">
              <BarChart3 className="h-6 w-6 text-orange-400" />
            </div>
            <div className="ml-4">
              <p className="text-sm font-medium text-slate-400">Aktywno≈õƒá</p>
              <p className="text-2xl font-bold text-white">24h</p>
            </div>
          </div>
        </div>
      </div>

      <div className="grid grid-cols-1 gap-8 lg:grid-cols-3">
        {/* Quick Actions */}
        <div className="lg:col-span-2">
          <h2 className="text-xl font-bold text-white mb-6">Szybkie akcje</h2>
          <div className="grid grid-cols-1 gap-4 sm:grid-cols-2">
            <Link
              href="/admin/users"
              className="group relative rounded-2xl bg-slate-800/50 p-6 border border-slate-700 backdrop-blur-sm transition-all hover:border-sky-400 hover:bg-slate-800 hover:transform hover:-translate-y-1"
            >
              <div className="flex items-start justify-between">
                <div>
                  <div className="rounded-lg bg-blue-500/20 p-3 inline-block">
                    <Users className="h-6 w-6 text-blue-400" />
                  </div>
                  <h3 className="mt-4 text-lg font-semibold text-white">
                    ZarzƒÖdzaj u≈ºytkownikami
                  </h3>
                  <p className="mt-2 text-sm text-slate-400">
                    PrzeglƒÖdaj konta, zmieniaj role i uprawnienia
                  </p>
                </div>
                <div className="text-sky-400 transition-transform group-hover:translate-x-1">
                  ‚Üí
                </div>
              </div>
            </Link>

            <Link
              href="/admin/turniej"
              className="group relative rounded-2xl bg-slate-800/50 p-6 border border-slate-700 backdrop-blur-sm transition-all hover:border-green-400 hover:bg-slate-800 hover:transform hover:-translate-y-1"
            >
              <div className="flex items-start justify-between">
                <div>
                  <div className="rounded-lg bg-green-500/20 p-3 inline-block">
                    <Trophy className="h-6 w-6 text-green-400" />
                  </div>
                  <h3 className="mt-4 text-lg font-semibold text-white">
                    ZarzƒÖdzaj turniejami
                  </h3>
                  <p className="mt-2 text-sm text-slate-400">
                    Edytuj turnieje, importuj dane, zarzƒÖdzaj uczestnikami
                  </p>
                </div>
                <div className="text-green-400 transition-transform group-hover:translate-x-1">
                  ‚Üí
                </div>
              </div>
            </Link>

            <Link
              href="/turniej/new"
              className="group relative rounded-2xl bg-gradient-to-r from-sky-600 to-blue-600 p-6 border border-sky-500 backdrop-blur-sm transition-all hover:transform hover:-translate-y-1 hover:shadow-xl"
            >
              <div className="flex items-start justify-between">
                <div>
                  <div className="rounded-lg bg-white/20 p-3 inline-block">
                    <Calendar className="h-6 w-6 text-white" />
                  </div>
                  <h3 className="mt-4 text-lg font-semibold text-white">
                    Nowy turniej
                  </h3>
                  <p className="mt-2 text-sm text-sky-100">
                    Utw√≥rz nowy turniej z pe≈ÇnƒÖ konfiguracjƒÖ
                  </p>
                </div>
                <div className="text-white transition-transform group-hover:translate-x-1">
                  +
                </div>
              </div>
            </Link>

            <Link
              href="/admin/miejsca"
              className="group relative rounded-2xl bg-slate-800/50 p-6 border border-slate-700 backdrop-blur-sm transition-all hover:border-orange-400 hover:bg-slate-800 hover:transform hover:-translate-y-1"
            >
              <div className="flex items-start justify-between">
                <div>
                  <div className="rounded-lg bg-orange-500/20 p-3 inline-block">
                    <MapPin className="h-6 w-6 text-orange-400" />
                  </div>
                  <h3 className="mt-4 text-lg font-semibold text-white">
                    Miejsca turniej√≥w
                  </h3>
                  <p className="mt-2 text-sm text-slate-400">
                    ZarzƒÖdzaj lokalizacjami i mapƒÖ turniej√≥w
                  </p>
                </div>
                <div className="text-orange-400 transition-transform group-hover:translate-x-1">
                  ‚Üí
                </div>
              </div>
            </Link>
          </div>
        </div>

        {/* Sidebar - Ostatnie turnieje i dodatkowe opcje */}
        <div className="space-y-6">
          {/* Ostatnie turnieje */}
          <div className="rounded-2xl bg-slate-800/50 p-6 border border-slate-700 backdrop-blur-sm">
            <h3 className="text-lg font-semibold text-white mb-4">
              Ostatnie turnieje
            </h3>
            <div className="space-y-3">
              {ostatnieTurnieje.data?.map((turniej, index) => (
                <div key={index} className="flex items-center space-x-3 p-3 rounded-lg bg-slate-700/50">
                  <Trophy className="h-4 w-4 text-yellow-400" />
                  <div className="flex-1 min-w-0">
                    <p className="text-sm font-medium text-white truncate">
                      {turniej.nazwa}
                    </p>
                    <p className="text-xs text-slate-400">
                      {new Date(turniej.data).toLocaleDateString('pl-PL')}
                    </p>
                  </div>
                </div>
              ))}
              {(!ostatnieTurnieje.data || ostatnieTurnieje.data.length === 0) && (
                <p className="text-sm text-slate-400 text-center py-4">
                  Brak turniej√≥w
                </p>
              )}
            </div>
          </div>

          {/* Dodatkowe narzƒôdzia */}
          <div className="rounded-2xl bg-slate-800/50 p-6 border border-slate-700 backdrop-blur-sm">
            <h3 className="text-lg font-semibold text-white mb-4">
              Narzƒôdzia systemowe
            </h3>
            <div className="space-y-3">
              <Link
                href="/admin/backup"
                className="flex items-center space-x-3 p-3 rounded-lg bg-slate-700/50 hover:bg-slate-700 transition-colors"
              >
                <Settings className="h-4 w-4 text-slate-400" />
                <span className="text-sm text-white">Kopia zapasowa</span>
              </Link>
              <Link
                href="/admin/logs"
                className="flex items-center space-x-3 p-3 rounded-lg bg-slate-700/50 hover:bg-slate-700 transition-colors"
              >
                <BarChart3 className="h-4 w-4 text-slate-400" />
                <span className="text-sm text-white">Logi systemowe</span>
              </Link>
              <Link
                href="/admin/settings"
                className="flex items-center space-x-3 p-3 rounded-lg bg-slate-700/50 hover:bg-slate-700 transition-colors"
              >
                <Settings className="h-4 w-4 text-slate-400" />
                <span className="text-sm text-white">Ustawienia</span>
              </Link>
            </div>
          </div>
        </div>
      </div>
    </main>
  )
}```

### app/admin/partie/page.tsx

```
// app/admin/partie/page.tsx
import { redirect } from 'next/navigation'
import Link from 'next/link'
import { createSupabaseServer } from '@/lib/supabase/server'
import { 
  ArrowLeft,
  Calendar,
  Users,
  Trophy,
  Eye,
  Trash2
} from 'lucide-react'
import PartieClient from '@/components/PartieClient'

export const dynamic = 'force-dynamic'
export const revalidate = 0

interface Gracz {
  id: string
  imie: string
  nazwisko: string
}

interface PartiaZGraczami {
  id: string
  numer_partii: number
  data_rozgrywki: string
  liczba_graczy: number
  duzy_punkt_gracz_id: string
  turniej_id: string
  turniej: {
    id: string
    nazwa: string
  }
  gracze: Gracz[]
}

export default async function AdminPartiePage() {
  const supabase = await createSupabaseServer()

  // WYMAGANE LOGOWANIE
  const { data: { user } } = await supabase.auth.getUser()
  if (!user) redirect('/auth/signin')

  // WYMAGANY ADMIN
  const { data: isAdmin } = await supabase.rpc('is_admin')
  if (!isAdmin) redirect('/')

  try {
    // Pobierz wszystkie partie z informacjami o turnieju
    const { data: partie, error } = await supabase
      .from('wyniki_partii')
      .select(`
        *,
        turniej:turniej_id(id, nazwa)
      `)
      .order('data_rozgrywki', { ascending: false })

    if (error) {
      console.error('B≈ÇƒÖd pobierania partii:', error)
      throw error
    }

    // Dla ka≈ºdej partii pobierz graczy
    const partieZGraczami: PartiaZGraczami[] = await Promise.all(
      (partie || []).map(async (partia) => {
        const graczeIds: string[] = []
        for (let i = 1; i <= partia.liczba_graczy; i++) {
          const graczId = partia[`gracz${i}_id`]
          if (graczId) graczeIds.push(graczId)
        }

        const { data: gracze } = await supabase
          .from('gracz')
          .select('id, imie, nazwisko')
          .in('id', graczeIds)

        return {
          ...partia,
          gracze: gracze || []
        }
      })
    )

    return (
      <main className="flex min-h-[calc(100vh-4rem)] items-center justify-center px-4 py-8">
        <div className="w-full max-w-6xl rounded-2xl bg-slate-800/95 border border-slate-700 shadow-[0_14px_40px_rgba(0,0,0,0.8)] p-6 space-y-6">
          {/* Nag≈Ç√≥wek */}
          <div className="flex items-center justify-between">
            <div className="flex items-center space-x-4">
              <Link
                href="/admin"
                className="inline-flex items-center text-sm text-slate-400 hover:text-white"
              >
                <ArrowLeft className="h-4 w-4 mr-2" />
                Powr√≥t do panelu
              </Link>
              <div>
                <h1 className="text-2xl font-semibold text-sky-50">Wszystkie partie</h1>
                <p className="mt-1 text-sm text-slate-400">ZarzƒÖdzanie partiami w systemie</p>
              </div>
            </div>
          </div>

          {/* Komponent kliencki z partiami */}
          <PartieClient partie={partieZGraczami} />
        </div>
      </main>
    )

  } catch (error) {
    console.error('B≈ÇƒÖd:', error)
    return (
      <main className="flex min-h-[calc(100vh-4rem)] items-center justify-center px-4 py-8">
        <div className="w-full max-w-6xl rounded-2xl bg-slate-800/95 border border-slate-700 shadow-[0_14px_40px_rgba(0,0,0,0.8)] p-6">
          <h1 className="text-2xl font-semibold text-sky-50 mb-4">Wszystkie partie - Panel admina</h1>
          <div className="rounded-md border border-red-400/50 bg-red-500/10 px-4 py-3 text-red-200">
            Nie uda≈Ço siƒô pobraƒá danych partii.
          </div>
          <Link
            href="/admin"
            className="inline-flex items-center text-sky-400 hover:text-sky-300 mt-4"
          >
            <ArrowLeft className="h-4 w-4 mr-2" />
            Powr√≥t do panelu admina
          </Link>
        </div>
      </main>
    )
  }
}```

### app/admin/turniej/[id]/delete/route.ts

```
// app/admin/turniej/[id]/delete/route.ts
import { NextRequest, NextResponse } from 'next/server'
import { createSupabaseServerMutable } from '@/lib/supabase/server-mutable'

const UUID_RE = /^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i

export async function POST(req: NextRequest, ctx: { params: Promise<{ id: string }> }) {
  const origin = req.nextUrl.origin
  const { id } = await ctx.params
  
  if (!id || !UUID_RE.test(id)) {
    return NextResponse.redirect(new URL('/admin/turniej?e=invalid_id', origin), { status: 303 })
  }

  const supabase = await createSupabaseServerMutable()
  const { data: { user } } = await supabase.auth.getUser()
  if (!user) return NextResponse.redirect(new URL('/auth/signin', origin), { status: 303 })
  
  const { data: isAdmin } = await supabase.rpc('is_admin')
  if (!isAdmin) return NextResponse.redirect(new URL('/', origin), { status: 303 })

  const { error } = await supabase
    .from('turniej')
    .delete()
    .eq('id', id)

  if (error) {
    console.error('Delete turniej error', error)
    return NextResponse.redirect(new URL('/admin/turniej?e=delete_failed', origin), { status: 303 })
  }

  return NextResponse.redirect(new URL('/admin/turniej?ok=1', origin), { status: 303 })
}```

### app/admin/turniej/[id]/edit/page.tsx

```
// elo-arena/app/admin/turniej/[id]/edit/page.tsx
import { redirect } from 'next/navigation'
import { createSupabaseServer } from '@/lib/supabase/server'
import AutoHide from '@/components/AutoHide'
import {
  MapPin,
  Clock,
  CalendarDays,
  Trophy,
  Link as LinkIcon,
  Sheet as SheetIcon,
  Hash,
  Users,
} from 'lucide-react'

export const dynamic = 'force-dynamic'
export const revalidate = 0

interface EditTurniejPageProps {
  params: Promise<{ id: string }>
  searchParams?: Promise<{ [key: string]: string | string[] | undefined }>
}

type MiejsceRow = {
  id: string
  nazwa: string
  miasto: string
  wojewodztwo: string | null
}

/** value MUSI odpowiadaƒá temu, co jest w kolumnie `gra` (enum) */
const GAME_VARIANTS = [
  { value: 'rummikub_standard', label: 'Rummikub ‚Äì Standard' },
  { value: 'rummikub_twist', label: 'Rummikub ‚Äì Twist' },
  { value: 'qwirkle', label: 'Qwirkle' },
] as const

export default async function EditTurniejPage(props: EditTurniejPageProps) {
  const params = await props.params
  const searchParams = await props.searchParams
  const supabase = await createSupabaseServer()

  // üîê AUTORYZACJA
  const {
    data: { user },
  } = await supabase.auth.getUser()
  if (!user) redirect('/auth/signin')

  const { data: isAdmin } = await supabase.rpc('is_admin')
  if (!isAdmin) redirect('/')

  // üìç MIEJSCA
  const { data: miejsca } = await supabase
    .from('miejsce_turnieju')
    .select('id, nazwa, miasto, wojewodztwo')
    .order('nazwa', { ascending: true })

  // üèÜ TURNIEJ
  const { data: turniej } = await supabase
    .from('turniej')
    .select('*')
    .eq('id', params.id)
    .single()

  if (!turniej) redirect('/admin?error=turniej_not_found')

  // komunikaty b≈Çƒôd√≥w (pasujƒÖ do route.ts)
  const errorMessages: Record<string, string> = {
    invalid_input: 'Wype≈Çnij wszystkie wymagane pola',
    date_time_required: 'Podaj datƒô i godzinƒô wydarzenia',
    invalid_game: 'Wybrano nieprawid≈ÇowƒÖ grƒô / wariant',
    invalid_location_id: 'Nieprawid≈Çowy identyfikator miejsca',
    place_not_found: 'Wybrane miejsce nie istnieje',
    sheet_col_invalid: 'Kolumna nazwisk musi byƒá pojedynczƒÖ literƒÖ (A‚ÄìZ)',
    number_invalid: 'Wprowad≈∫ poprawnƒÖ liczbƒô',
    url_invalid: 'Wprowad≈∫ poprawny URL',
    save_failed: 'Zapis nie powi√≥d≈Ç siƒô. Spr√≥buj ponownie.',
    server_error: 'B≈ÇƒÖd serwera. Spr√≥buj ponownie.',
    invalid_id: 'Nieprawid≈Çowy identyfikator turnieju.',
    game_required: 'Wybierz grƒô / wariant',
    gra_locked: 'Nie mo≈ºna zmieniƒá gry po dodaniu pierwszej partii',
  }

  const error = (searchParams?.e as string) || ''
  const success = (searchParams?.ok as string) || ''

  const currentGame: string = (turniej as any).gra || ''
  const currentGameLabel =
    GAME_VARIANTS.find((v) => v.value === currentGame)?.label || '‚Äî nie ustawiono ‚Äî'

  return (
    <main className="flex min-h-[calc(100vh-4rem)] items-start justify-center px-6 sm:px-8 py-12 sm:py-16">
      <div className="w-full max-w-3xl rounded-2xl bg-slate-800/95 border border-slate-700 shadow-[0_14px_40px_rgba(0,0,0,0.8)] p-6 space-y-6">
        <h1 className="text-4xl font-bold text-sky-50 text-center">Edytuj turniej</h1>

        {error && (
          <div className="rounded-md border border-red-400/50 bg-red-500/10 px-4 py-3 text-sm text-red-200">
            ‚ùå {errorMessages[error] || 'WystƒÖpi≈Ç nieznany b≈ÇƒÖd'}
          </div>
        )}

        {success && (
          <AutoHide ms={5000}>
            <div className="rounded-md border border-green-400/50 bg-green-500/10 px-4 py-3 text-sm text-green-200">
              ‚úÖ Turniej zosta≈Ç zaktualizowany
            </div>
          </AutoHide>
        )}

        <form action={`/admin/turniej/${params.id}/update`} method="post" className="space-y-6">
          {/* NAZWA */}
          <div>
            <label className="flex items-center gap-2 text-sm text-sky-100">
              <Trophy size={18} /> Nazwa turnieju
            </label>
            <input
              name="nazwa"
              required
              defaultValue={(turniej as any).nazwa ?? ''}
              className="mt-1 w-full rounded-xl border border-slate-600 bg-slate-900 px-3 py-2 text-sky-100"
            />
          </div>

          {/* GRA / WARIANT */}
          <div>
            <label className="flex items-center gap-2 text-sm text-sky-100">
              <Trophy size={18} /> Gra / wariant
            </label>

            <div className="mt-1 rounded-xl border border-slate-600 bg-slate-900/60 px-3 py-2 text-sky-100">
              <span className="text-slate-400 text-sm mr-2">Aktualnie:</span>
              <span className="font-semibold">{currentGameLabel}</span>
              <span className="ml-2 text-xs text-slate-400">({currentGame || 'brak'})</span>
            </div>

            <select
              name="gra"
              required
              defaultValue={currentGame}
              className="mt-2 w-full rounded-xl border border-slate-600 bg-slate-900 px-3 py-2 text-sky-100"
            >
              <option value="">‚Äî wybierz z listy ‚Äî</option>
              {GAME_VARIANTS.map((opt) => (
                <option key={opt.value} value={opt.value}>
                  {opt.label}
                </option>
              ))}
            </select>

            <p className="mt-1 text-xs text-slate-400">
              Uwaga: po dodaniu pierwszej partii zmiana gry mo≈ºe byƒá zablokowana.
            </p>
          </div>

          {/* DATA / GODZINY */}
          <div className="grid grid-cols-1 sm:grid-cols-3 gap-4">
            <div>
              <label className="flex items-center gap-2 text-sm text-sky-100">
                <CalendarDays size={18} /> Data
              </label>
              <input
                type="date"
                name="data_turnieju"
                required
                defaultValue={(turniej as any).data_turnieju || ''}
                className="mt-1 w-full rounded-xl border border-slate-600 bg-slate-900 px-3 py-2 text-sky-100"
              />
            </div>

            <div>
              <label className="flex items-center gap-2 text-sm text-sky-100">
                <Clock size={18} /> Start
              </label>
              <input
                type="time"
                name="godzina_turnieju"
                required
                defaultValue={(turniej as any).godzina_turnieju || ''}
                className="mt-1 w-full rounded-xl border border-slate-600 bg-slate-900 px-3 py-2 text-sky-100"
              />
            </div>

            <div>
              <label className="flex items-center gap-2 text-sm text-sky-100">
                <Clock size={18} /> Koniec
              </label>
              <input
                type="time"
                name="zakonczenie_turnieju"
                defaultValue={(turniej as any).zakonczenie_turnieju || ''}
                className="mt-1 w-full rounded-xl border border-slate-600 bg-slate-900 px-3 py-2 text-sky-100"
              />
            </div>
          </div>

          {/* LIMIT GRACZY */}
          <div>
            <label className="flex items-center gap-2 text-sm text-sky-100">
              <Users size={18} /> Limit graczy (opcjonalnie)
            </label>
            <input
              type="number"
              name="limit_graczy"
              min={1}
              placeholder="np. 32"
              defaultValue={(turniej as any).limit_graczy ?? ''}
              className="mt-1 w-full rounded-xl border border-slate-600 bg-slate-900 px-3 py-2 text-sky-100"
            />
            <p className="mt-1 text-xs text-slate-400">Puste = brak limitu.</p>
          </div>

          {/* MIEJSCE */}
          <div>
            <label className="flex items-center gap-2 text-sm text-sky-100">
              <MapPin size={18} /> Miejsce (opcjonalnie)
            </label>
            <select
              name="miejsce_id"
              defaultValue={(turniej as any).miejsce_id || ''}
              className="mt-1 w-full rounded-xl border border-slate-600 bg-slate-900 px-3 py-2 text-sky-100"
            >
              <option value="">‚Äî brak / nie ustawiono ‚Äî</option>
              {(miejsca as MiejsceRow[] | null)?.map((m) => (
                <option key={m.id} value={m.id}>
                  {m.nazwa} ‚Äì {m.miasto}
                  {m.wojewodztwo && `, ${m.wojewodztwo}`}
                </option>
              ))}
            </select>
          </div>

          {/* GOOGLE SHEETS */}
          <div className="rounded-2xl border border-slate-700 bg-slate-900/30 p-4 space-y-4">
            <div className="flex items-center gap-2 text-sky-100">
              <SheetIcon size={18} />
              <h2 className="font-semibold">Import z Google Sheets (opcjonalnie)</h2>
            </div>

            <div>
              <label className="flex items-center gap-2 text-sm text-sky-100">
                <LinkIcon size={18} /> Link do arkusza (gsheet_url)
              </label>
              <input
                name="gsheet_url"
                placeholder="https://..."
                defaultValue={(turniej as any).gsheet_url || ''}
                className="mt-1 w-full rounded-xl border border-slate-600 bg-slate-900 px-3 py-2 text-sky-100"
              />
            </div>

            <div className="grid grid-cols-1 sm:grid-cols-3 gap-4">
              <div className="sm:col-span-2">
                <label className="flex items-center gap-2 text-sm text-sky-100">
                  <SheetIcon size={18} /> Nazwa arkusza (arkusz_nazwa)
                </label>
                <input
                  name="arkusz_nazwa"
                  placeholder="np. Sheet1"
                  defaultValue={(turniej as any).arkusz_nazwa || ''}
                  className="mt-1 w-full rounded-xl border border-slate-600 bg-slate-900 px-3 py-2 text-sky-100"
                />
              </div>

              <div>
                <label className="flex items-center gap-2 text-sm text-sky-100">
                  <Hash size={18} /> Kolumna nazwisk (A‚ÄìZ)
                </label>
                <input
                  name="kolumna_nazwisk"
                  placeholder="np. A"
                  maxLength={1}
                  defaultValue={(turniej as any).kolumna_nazwisk || ''}
                  className="mt-1 w-full rounded-xl border border-slate-600 bg-slate-900 px-3 py-2 text-sky-100 uppercase"
                />
              </div>
            </div>

            <div>
              <label className="flex items-center gap-2 text-sm text-sky-100">
                <Hash size={18} /> Pierwszy wiersz z nazwiskiem
              </label>
              <input
                type="number"
                name="pierwszy_wiersz_z_nazwiskiem"
                min={1}
                placeholder="np. 2"
                defaultValue={(turniej as any).pierwszy_wiersz_z_nazwiskiem ?? ''}
                className="mt-1 w-full rounded-xl border border-slate-600 bg-slate-900 px-3 py-2 text-sky-100"
              />
            </div>
          </div>

          {/* AKCJE */}
          <div className="flex gap-3 pt-2">
            <button
              type="submit"
              className="w-full rounded-full bg-sky-600 hover:bg-sky-500 py-3 text-white font-semibold"
            >
              Zapisz zmiany
            </button>
            <a
              href="/admin"
              className="w-full rounded-full bg-red-600 hover:bg-red-500 py-3 text-white font-semibold text-center"
            >
              Anuluj
            </a>
          </div>
        </form>
      </div>
    </main>
  )
}
```

### app/admin/turniej/[id]/import/preview/route.ts

```
// elo-arena/app/admin/turniej/[id]/import/preview/route.ts
import { NextRequest, NextResponse } from 'next/server'
import { createSupabaseServer } from '@/lib/supabase/server'

// pomocnicze funkcje (te same co w imporcie)
function buildCsvUrl(sheetUrl: string, sheetName?: string | null) {
  const m = sheetUrl.match(/spreadsheets\/d\/([a-zA-Z0-9-_]+)/)
  const id = m?.[1]; if (!id) return null
  if (sheetName && !/^\d+$/.test(sheetName)) {
    return `https://docs.google.com/spreadsheets/d/${id}/gviz/tq?tqx=out:csv&sheet=${encodeURIComponent(sheetName)}`
  }
  const gidMatch = sheetUrl.match(/[?&]gid=(\d+)/)
  const gid = gidMatch?.[1]
  if (gid) return `https://docs.google.com/spreadsheets/d/${id}/export?format=csv&gid=${gid}`
  return `https://docs.google.com/spreadsheets/d/${id}/export?format=csv`
}

function colLetterToIndex(letter: string) {
  const l = letter.trim().toUpperCase()
  if (!/^[A-Z]+$/.test(l)) return null
  let idx = 0
  for (let i = 0; i < l.length; i++) idx = idx * 26 + (l.charCodeAt(i) - 64)
  return idx - 1
}

function parseCsv(text: string): string[][] {
  const firstLine = text.split(/\r?\n/)[0] ?? ''
  const sep = (firstLine.match(/;/g)?.length ?? 0) > (firstLine.match(/,/g)?.length ?? 0) ? ';' : ','
  const rows: string[][] = []
  let i = 0, field = '', row: string[] = [], inQuotes = false
  while (i < text.length) {
    const ch = text[i]
    if (inQuotes) {
      if (ch === '"') { if (text[i + 1] === '"') { field += '"'; i += 2; continue } inQuotes = false; i++; continue }
      field += ch; i++; continue
    } else {
      if (ch === '"') { inQuotes = true; i++; continue }
      if (ch === sep) { row.push(field); field = ''; i++; continue }
      if (ch === '\n') { row.push(field); rows.push(row); row = []; field = ''; i++; continue }
      if (ch === '\r') { i++; continue }
      field += ch; i++
    }
  }
  row.push(field); rows.push(row)
  return rows
}

export async function GET(req: NextRequest, ctx: { params: Promise<{ id: string }> }) {
  const { id } = await ctx.params
  const supabase = await createSupabaseServer()

  // auth + admin
  const { data: { user } } = await supabase.auth.getUser()
  const { data: isAdmin } = await supabase.rpc('is_admin')
  if (!user || !isAdmin) {
    return new NextResponse('Unauthorized', { status: 401 })
  }

  // turniej
  const { data: t, error } = await supabase
    .from('turniej')
    .select('nazwa, gsheet_url, arkusz_nazwa, kolumna_nazwisk, pierwszy_wiersz_z_nazwiskiem')
    .eq('id', id)
    .maybeSingle()
  if (error || !t) return new NextResponse('Turniej nie znaleziony', { status: 404 })

  if (!t.gsheet_url || !t.kolumna_nazwisk || !t.pierwszy_wiersz_z_nazwiskiem) {
    return new NextResponse('Brak konfiguracji arkusza (url/kolumna/pierwszy wiersz)', { status: 400 })
  }

  const csvUrl = buildCsvUrl(t.gsheet_url, t.arkusz_nazwa)
  if (!csvUrl) return new NextResponse('Z≈Çy link do arkusza', { status: 400 })

  let csv = ''
  try {
    const r = await fetch(csvUrl, { headers: { 'cache-control': 'no-cache' } })
    if (!r.ok) return new NextResponse(`Nie mo≈ºna pobraƒá CSV (${r.status})`, { status: 400 })
    csv = await r.text()
  } catch {
    return new NextResponse('B≈ÇƒÖd pobierania CSV', { status: 400 })
  }

  const colIdx = colLetterToIndex(t.kolumna_nazwisk)
  if (colIdx == null) return new NextResponse('Nieprawid≈Çowa kolumna', { status: 400 })

  const rows = parseCsv(csv)
  const startAt = Math.max(1, t.pierwszy_wiersz_z_nazwiskiem || 1)
  const names = rows.slice(startAt - 1).map(r => (r[colIdx] || '').trim()).filter(Boolean)

  // prosty HTML ‚Äì lista tylko z podanej kolumny
  const html = `<!doctype html>
<html lang="pl">
<meta charset="utf-8" />
<title>PodglƒÖd: ${t.nazwa ?? 'Turniej'}</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<style>
  body { font-family: ui-sans-serif, system-ui, sans-serif; padding: 16px; }
  h1 { font-size: 18px; margin: 0 0 12px; }
  ol { padding-left: 20px; }
  li { padding: 4px 0; border-bottom: 1px solid #eee; }
  .meta { color:#6b7280; font-size:12px; margin: 6px 0 12px; }
</style>
<h1>PodglƒÖd kolumny nazwisk</h1>
<div class="meta">
≈πr√≥d≈Ço: ${t.gsheet_url ? `<a href="${t.gsheet_url}" target="_blank" rel="noreferrer">Arkusz</a>` : '‚Äî'}
 ‚Ä¢ kolumna: <b>${t.kolumna_nazwisk}</b>
 ‚Ä¢ od wiersza: <b>${startAt}</b>
</div>
<ol>
  ${names.map(n => `<li>${n.replace(/</g, '&lt;')}</li>`).join('\n')}
</ol>
</html>`
  return new NextResponse(html, { status: 200, headers: { 'content-type': 'text/html; charset=utf-8' } })
}
```

### app/admin/turniej/[id]/import/route.ts

```
// app/admin/turniej/[id]/import/route.ts
import { NextRequest, NextResponse } from 'next/server'
import { createSupabaseServerMutable } from '@/lib/supabase/server-mutable'

type TurniejRow = {
  id: string
  nazwa: string | null
  gsheet_url: string | null
  arkusz_nazwa: string | null
  kolumna_nazwisk: string | null
  pierwszy_wiersz_z_nazwiskiem: number | null
}

/** Buduje URL CSV z gsheet_url i (opcjonalnie) nazwƒÖ karty. */
function buildCsvUrl(sheetUrl: string, sheetName?: string | null) {
  const m = sheetUrl.match(/spreadsheets\/d\/([a-zA-Z0-9-_]+)/)
  const id = m?.[1]
  if (!id) return null

  // Je≈õli jest nazwa karty ‚Äì u≈ºyj gviz CSV
  if (sheetName && !/^\d+$/.test(sheetName)) {
    return `https://docs.google.com/spreadsheets/d/${id}/gviz/tq?tqx=out:csv&sheet=${encodeURIComponent(sheetName)}`
  }

  // Je≈õli w URL jest gid ‚Äì u≈ºyj go
  const gidMatch = sheetUrl.match(/[?&]gid=(\d+)/)
  const gid = gidMatch?.[1]
  if (gid) return `https://docs.google.com/spreadsheets/d/${id}/export?format=csv&gid=${gid}`

  // Domy≈õlnie: pierwsza karta
  return `https://docs.google.com/spreadsheets/d/${id}/export?format=csv`
}

/** Zamienia literƒô kolumny (np. "B") na indeks 0-based. */
function colLetterToIndex(letter: string) {
  const l = letter.trim().toUpperCase()
  if (!/^[A-Z]+$/.test(l)) return null
  let idx = 0
  for (let i = 0; i < l.length; i++) {
    idx = idx * 26 + (l.charCodeAt(i) - 64)
  }
  return idx - 1
}

/** Prosty parser CSV: wspiera cudzys≈Çowy i separator , lub ; */
function parseCsv(text: string): string[][] {
  const firstLine = text.split(/\r?\n/)[0] ?? ''
  const sep = (firstLine.match(/;/g)?.length ?? 0) > (firstLine.match(/,/g)?.length ?? 0) ? ';' : ','
  const rows: string[][] = []
  let i = 0, field = '', row: string[] = [], inQuotes = false
  while (i < text.length) {
    const ch = text[i]
    if (inQuotes) {
      if (ch === '"') {
        if (text[i + 1] === '"') { field += '"'; i += 2; continue }
        inQuotes = false; i++; continue
      } else { field += ch; i++; continue }
    } else {
      if (ch === '"') { inQuotes = true; i++; continue }
      if (ch === sep) { row.push(field); field = ''; i++; continue }
      if (ch === '\n') { row.push(field); rows.push(row); row = []; field = ''; i++; continue }
      if (ch === '\r') { i++; continue }
      field += ch; i++
    }
  }
  row.push(field); rows.push(row)
  return rows
}

/** Rozbija ‚ÄûImiƒô Nazwisko‚Äù na { imie, nazwisko }. Ostatnie s≈Çowo = nazwisko. */
function splitFullName(full: string) {
  const clean = full.replace(/\s+/g, ' ').trim()
  if (!clean) return null
  const parts = clean.split(' ')
  const nazwisko = parts.pop()!
  const imie = parts.join(' ')
  if (!imie || !nazwisko) return null
  return { imie, nazwisko }
}

export async function POST(req: NextRequest, ctx: { params: Promise<{ id: string }> }) {
  const { id } = await ctx.params
  const origin = req.nextUrl.origin
  const supabase = await createSupabaseServerMutable()

  // auth + admin
  const { data: { user } } = await supabase.auth.getUser()
  if (!user) return NextResponse.redirect(new URL('/auth/signin', origin), { status: 303 })
  const { data: isAdmin } = await supabase.rpc('is_admin')
  if (!isAdmin) return NextResponse.redirect(new URL('/', origin), { status: 303 })

  // pobierz konfiguracjƒô turnieju
  const { data: t, error: terr } = await supabase
    .from('turniej')
    .select('id, nazwa, gsheet_url, arkusz_nazwa, kolumna_nazwisk, pierwszy_wiersz_z_nazwiskiem')
    .eq('id', id)
    .single<TurniejRow>()

  if (terr || !t) {
    console.error('[import] no_tournament', terr)
    return NextResponse.redirect(new URL(`/admin/turniej/${id}/edit?e=no_tournament`, origin), { status: 303 })
  }
  if (!t.gsheet_url || !t.kolumna_nazwisk || !t.pierwszy_wiersz_z_nazwiskiem) {
    return NextResponse.redirect(new URL(`/admin/turniej/${id}/edit?e=missing_sheet_cfg`, origin), { status: 303 })
  }

  const csvUrl = buildCsvUrl(t.gsheet_url, t.arkusz_nazwa)
  if (!csvUrl) {
    return NextResponse.redirect(new URL(`/admin/turniej/${id}/edit?e=bad_sheet_url`, origin), { status: 303 })
  }

  // pobierz CSV
  let csvText = ''
  try {
    const resp = await fetch(csvUrl, { headers: { 'cache-control': 'no-cache' } })
    if (!resp.ok) {
      console.error('[import] fetch_failed', resp.status, await resp.text().catch(() => ''))
      return NextResponse.redirect(new URL(`/admin/turniej/${id}/edit?e=fetch_failed&s=${resp.status}`, origin), { status: 303 })
    }
    csvText = await resp.text()
  } catch (e) {
    console.error('[import] fetch_error', e)
    return NextResponse.redirect(new URL(`/admin/turniej/${id}/edit?e=fetch_failed`, origin), { status: 303 })
  }

  // CSV -> rows -> wyb√≥r kolumny
  const rows = parseCsv(csvText)
  const colIdx = colLetterToIndex(t.kolumna_nazwisk!)
  if (colIdx == null) {
    return NextResponse.redirect(new URL(`/admin/turniej/${id}/edit?e=col_invalid`, origin), { status: 303 })
  }

  const startAt = Math.max(1, t.pierwszy_wiersz_z_nazwiskiem || 1) // 1-based
  const picked = rows.slice(startAt - 1).map(r => (r[colIdx] || '').trim()).filter(Boolean)
  if (!picked.length) {
    console.warn('[import] empty_after_parse', { startAt, colIdx, totalRows: rows.length })
    return NextResponse.redirect(new URL(`/admin/turniej/${id}/edit?e=empty_after_parse`, origin), { status: 303 })
  }

  // przygotuj payload graczy
  const grPayload: { imie: string; nazwisko: string }[] = []
  for (const full of picked) {
    const s = splitFullName(full)
    if (!s) continue
    grPayload.push({ imie: s.imie, nazwisko: s.nazwisko })
  }
  if (!grPayload.length) {
    return NextResponse.redirect(new URL(`/admin/turniej/${id}/edit?e=empty_after_parse`, origin), { status: 303 })
  }

  // upsert graczy po kolumnie unikatowej (fullname_norm)
  const { data: inserted, error: gerr } = await supabase
    .from('gracz')
    .upsert(grPayload, { onConflict: 'fullname_norm' }) // <- poprawka
    .select('id')

  if (gerr) {
    console.error('[import] gracz_upsert_failed', gerr)
    return NextResponse.redirect(new URL(`/admin/turniej/${id}/edit?e=gracz_upsert_failed`, origin), { status: 303 })
  }

  // zbuduj payload do wyniki (unikat: turniej_id, gracz_id)
  const ids = new Set<string>()
  inserted?.forEach(r => ids.add(r.id))

  const wynikiPayload = Array.from(ids).map(gracz_id => ({ turniej_id: id, gracz_id }))
  if (wynikiPayload.length) {
    const { error: werr } = await supabase
      .from('wyniki')
      .upsert(wynikiPayload, { onConflict: 'turniej_id,gracz_id' })
    if (werr) {
      console.error('[import] wyniki_upsert_failed', werr)
      return NextResponse.redirect(new URL(`/admin/turniej/${id}/edit?e=wyniki_upsert_failed`, origin), { status: 303 })
    }
  }

  return NextResponse.redirect(new URL(`/admin/turniej/${id}/edit?ok=1`, origin), { status: 303 })
}
```

### app/admin/turniej/[id]/partie/[partiaId]/delete/route.ts

```
// app/admin/turniej/[id]/partie/[partiaId]/delete/route.ts
import { createSupabaseServer } from '@/lib/supabase/server'
import { NextRequest } from 'next/server'

export async function DELETE(
  request: NextRequest,
  { params }: { params: Promise<{ id: string; partiaId: string }> }
) {
  const supabase = await createSupabaseServer()
  
  // RozwiƒÖzanie Promise params
  const { id, partiaId } = await params

  try {
    // Sprawd≈∫ uprawnienia
    const { data: { user } } = await supabase.auth.getUser()
    if (!user) {
      return new Response(JSON.stringify({ error: 'Unauthorized' }), { status: 401 })
    }

    const { data: isAdmin } = await supabase.rpc('is_admin')
    if (!isAdmin) {
      return new Response(JSON.stringify({ error: 'Forbidden' }), { status: 403 })
    }

    // Sprawd≈∫ czy partia istnieje i nale≈ºy do turnieju
    const { data: partia, error: partiaError } = await supabase
      .from('wyniki_partii')
      .select('*')
      .eq('id', partiaId)
      .eq('turniej_id', id)
      .single()

    if (partiaError || !partia) {
      return new Response(JSON.stringify({ error: 'Partia nie znaleziona' }), { status: 404 })
    }

    // Usu≈Ñ partiƒô
    const { error: deleteError } = await supabase
      .from('wyniki_partii')
      .delete()
      .eq('id', partiaId)

    if (deleteError) {
      return new Response(JSON.stringify({ error: 'B≈ÇƒÖd usuwania partii' }), { status: 500 })
    }

    return new Response(JSON.stringify({ success: true }), { status: 200 })

  } catch (error) {
    console.error('B≈ÇƒÖd usuwania partii:', error)
    return new Response(JSON.stringify({ error: 'Wewnƒôtrzny b≈ÇƒÖd serwera' }), { status: 500 })
  }
}```

### app/admin/turniej/[id]/partie/[partiaId]/page.tsx

```
// elo-arena/app/admin/turniej/[id]/partie/[partiaId]/page.tsx
'use client'

import Link from 'next/link'
import { useRouter } from 'next/navigation'
import { 
  ArrowLeft, 
  Trophy, 
  Users, 
  Calendar,
  TrendingUp,
  TrendingDown,
  Trash2
} from 'lucide-react'
import { useState, useEffect } from 'react'

interface GraczWPartii {
  id: string
  imie: string
  nazwisko: string
  male_punkty: number
  elo_przed: number
  elo_po: number
  zmiana_elo: number
}

interface Partia {
  id: string
  numer_partii: number
  data_rozgrywki: string
  liczba_graczy: number
  duzy_punkt_gracz_id: string
  turniej: {
    id: string
    nazwa: string
  }
}

interface PartiaDetailPageProps {
  params: Promise<{
    id: string
    partiaId: string
  }>
}

export default function PartiaDetailPage({ params }: PartiaDetailPageProps) {
  const router = useRouter()
  const [partia, setPartia] = useState<Partia | null>(null)
  const [graczeWPartii, setGraczeWPartii] = useState<GraczWPartii[]>([])
  const [loading, setLoading] = useState(true)
  const [deleting, setDeleting] = useState(false)
  const [turniejId, setTurniejId] = useState<string>('')
  const [partiaId, setPartiaId] = useState<string>('')

  // Pobierz parametry i dane partii
  useEffect(() => {
    const fetchData = async () => {
      const resolvedParams = await params
      const { id: turniejId, partiaId } = resolvedParams
      
      setTurniejId(turniejId)
      setPartiaId(partiaId)
      
      try {
        // Pobierz dane partii
        const response = await fetch(`/api/partie/${partiaId}?turniejId=${turniejId}`)
        if (response.ok) {
          const data = await response.json()
          setPartia(data.partia)
          setGraczeWPartii(data.graczeWPartii)
        }
      } catch (error) {
        console.error('B≈ÇƒÖd pobierania danych partii:', error)
      } finally {
        setLoading(false)
      }
    }

    fetchData()
  }, [params])

  // Funkcja do kasowania partii
  const handleDelete = async () => {
    if (!confirm('Czy na pewno chcesz usunƒÖƒá tƒô partiƒô? Ta operacja jest nieodwracalna i wymaga przeliczenia rankingu.')) {
      return
    }

    setDeleting(true)
    try {
      const response = await fetch(`/admin/turniej/${turniejId}/partie/${partiaId}`, {
        method: 'DELETE',
      })

      if (response.ok) {
        // Przekieruj do listy partii
        router.push(`/admin/turniej/${turniejId}/partie`)
        router.refresh()
      } else {
        const error = await response.json()
        alert(`B≈ÇƒÖd: ${error.errors?.join(', ') || 'WystƒÖpi≈Ç nieznany b≈ÇƒÖd'}`)
      }
    } catch (error) {
      console.error('B≈ÇƒÖd podczas usuwania partii:', error)
      alert('WystƒÖpi≈Ç b≈ÇƒÖd podczas usuwania partii')
    } finally {
      setDeleting(false)
    }
  }

  if (loading) {
    return (
      <div className="p-8 max-w-4xl mx-auto">
        <div className="text-center">
          <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-sky-500 mx-auto"></div>
          <p className="text-slate-400 mt-4">≈Åadowanie danych partii...</p>
        </div>
      </div>
    )
  }

  if (!partia) {
    return (
      <div className="p-8 max-w-4xl mx-auto">
        <div className="text-center">
          <h1 className="text-2xl font-bold text-white mb-4">Partia nie znaleziona</h1>
          <p className="text-slate-400 mb-6">
            Partia nie istnieje lub nie nale≈ºy do tego turnieju
          </p>
          <Link
            href={`/admin/turniej/${turniejId}/partie`}
            className="text-sky-500 hover:text-sky-400"
          >
            Powr√≥t do listy partii
          </Link>
        </div>
      </div>
    )
  }

  const zwyciezca = graczeWPartii.find(g => g.id === partia.duzy_punkt_gracz_id)

  return (
    <div className="p-8 max-w-4xl mx-auto">
      {/* Nag≈Ç√≥wek */}
      <div className="flex items-center justify-between mb-8">
        <div className="flex items-center space-x-4">
          <Link
            href={`/admin/turniej/${turniejId}/partie`}
            className="inline-flex items-center text-sm text-slate-400 hover:text-white"
          >
            <ArrowLeft className="h-4 w-4 mr-2" />
            Powr√≥t do partii
          </Link>
          <div>
            <h1 className="text-3xl font-bold text-white">Partia #{partia.numer_partii}</h1>
            <p className="text-slate-400 mt-1">
              {partia.turniej?.nazwa}
            </p>
          </div>
        </div>

        {/* Przycisk usuwania w szczeg√≥≈Çach */}
        <button
          onClick={handleDelete}
          disabled={deleting}
          className="bg-red-500 hover:bg-red-600 disabled:bg-red-400 text-white px-4 py-2 rounded-lg flex items-center transition-colors"
        >
          <Trash2 className="h-4 w-4 mr-2" />
          {deleting ? 'Usuwanie...' : 'Usu≈Ñ partiƒô'}
        </button>
      </div>

      {/* Informacje o partii */}
      <div className="bg-slate-800/50 rounded-xl border border-slate-700 p-6 mb-6">
        <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
          <div className="flex items-center space-x-3">
            <div className="bg-slate-700 rounded-lg p-2">
              <Calendar className="h-6 w-6 text-slate-300" />
            </div>
            <div>
              <p className="text-slate-400 text-sm">Data rozgrywki</p>
              <p className="text-white font-semibold">
                {new Date(partia.data_rozgrywki).toLocaleDateString('pl-PL')}
              </p>
            </div>
          </div>
          
          <div className="flex items-center space-x-3">
            <div className="bg-slate-700 rounded-lg p-2">
              <Users className="h-6 w-6 text-slate-300" />
            </div>
            <div>
              <p className="text-slate-400 text-sm">Liczba graczy</p>
              <p className="text-white font-semibold">{partia.liczba_graczy}</p>
            </div>
          </div>
          
          <div className="flex items-center space-x-3">
            <div className="bg-yellow-500/20 rounded-lg p-2">
              <Trophy className="h-6 w-6 text-yellow-500" />
            </div>
            <div>
              <p className="text-slate-400 text-sm">Zwyciƒôzca</p>
              <p className="text-white font-semibold">
                {zwyciezca ? `${zwyciezca.imie} ${zwyciezca.nazwisko}` : 'Nieznany'}
              </p>
            </div>
          </div>
        </div>
      </div>

      {/* Wyniki graczy */}
      <div className="bg-slate-800/50 rounded-xl border border-slate-700">
        <div className="p-6 border-b border-slate-700">
          <h2 className="text-xl font-bold text-white">Wyniki graczy</h2>
        </div>
        
        <div className="divide-y divide-slate-700">
          {graczeWPartii
            .sort((a, b) => (b.id === partia.duzy_punkt_gracz_id ? 1 : 0) - (a.id === partia.duzy_punkt_gracz_id ? 1 : 0))
            .map((gracz) => (
              <div key={gracz.id} className="p-6">
                <div className="flex items-center justify-between">
                  <div className="flex items-center space-x-4">
                    {gracz.id === partia.duzy_punkt_gracz_id && (
                      <div className="bg-yellow-500 rounded-full p-2">
                        <Trophy className="h-5 w-5 text-yellow-900" />
                      </div>
                    )}
                    <div>
                      <h3 className="text-lg font-semibold text-white">
                        {gracz.imie} {gracz.nazwisko}
                        {gracz.id === partia.duzy_punkt_gracz_id && (
                          <span className="ml-2 text-yellow-400 text-sm">üéØ ZWYCIƒòZCA</span>
                        )}
                      </h3>
                      <p className="text-slate-400">
                        Ma≈Çe punkty: <span className="text-white font-medium">{gracz.male_punkty}</span>
                      </p>
                    </div>
                  </div>
                  
                  <div className="text-right">
                    <div className="flex items-center justify-end space-x-4 mb-2">
                      <div className="text-slate-400">
                        <span className="text-sm">ELO przed:</span>
                        <span className="text-white font-bold ml-2">{Math.round(gracz.elo_przed)}</span>
                      </div>
                      <div className="text-slate-400">
                        <span className="text-sm">ELO po:</span>
                        <span className="text-white font-bold ml-2">{Math.round(gracz.elo_po)}</span>
                      </div>
                    </div>
                    <div className={`flex items-center justify-end space-x-2 text-lg font-bold ${
                      gracz.zmiana_elo > 0 ? 'text-green-400' : 'text-red-400'
                    }`}>
                      {gracz.zmiana_elo > 0 ? (
                        <TrendingUp className="h-5 w-5" />
                      ) : (
                        <TrendingDown className="h-5 w-5" />
                      )}
                      <span>
                        {gracz.zmiana_elo > 0 ? '+' : ''}{Math.round(gracz.zmiana_elo)} punkt√≥w
                      </span>
                    </div>
                  </div>
                </div>
              </div>
            ))}
        </div>
      </div>

      {/* Podsumowanie zmian */}
      <div className="mt-6 p-4 bg-slate-700/30 rounded-lg border border-slate-600">
        <h4 className="text-sm font-semibold text-slate-300 mb-2">Podsumowanie zmian ELO:</h4>
        <ul className="text-sm text-slate-400 space-y-1">
          <li>‚Ä¢ <strong>Zwyciƒôzca zyskuje punkty ELO</strong> od ka≈ºdego przegranego</li>
          <li>‚Ä¢ <strong>Przegrani tracƒÖ punkty ELO</strong> tylko w konfrontacji ze zwyciƒôzcƒÖ</li>
          <li>‚Ä¢ <strong>Wsp√≥≈Çczynnik K</strong> zale≈ºy od aktualnego rankingu i liczby rozegranych partii</li>
          <li>‚Ä¢ <strong>Ma≈Çe punkty</strong> nie wp≈ÇywajƒÖ na ELO - s≈Çu≈ºƒÖ tylko do statystyk</li>
        </ul>
      </div>
    </div>
  )
}```

### app/admin/turniej/[id]/partie/nowa/action/route.ts

```
// elo-arena/app/admin/turniej/[id]/partie/nowa/action/route.ts
import { createSupabaseServer } from '@/lib/supabase/server'
import { calculateEloChanges, validatePartia } from '@/lib/eloCalculator'
import { revalidatePath } from 'next/cache'

interface RequestBody {
  turniej_id: string
  numer_partii_start: number
  liczba_partii: number
  gracze: string[]
  partie: Array<{
    duzyPunkt: string
    malePunkty: number[]
  }>
}

interface ZmianaElo {
  gracz_id: string
  imie: string
  nazwisko: string
  elo_przed: number
  elo_po: number
  zmiana_elo: number
  male_punkty: number
  duzy_punkt: boolean
}

export async function POST(request: Request) {
  const supabase = await createSupabaseServer()

  // Sprawdzenie uprawnie≈Ñ
  const { data: { user } } = await supabase.auth.getUser()
  if (!user) {
    return new Response(JSON.stringify({ errors: ['Unauthorized'] }), { status: 401 })
  }

  const { data: isAdmin } = await supabase.rpc('is_admin')
  if (!isAdmin) {
    return new Response(JSON.stringify({ errors: ['Forbidden'] }), { status: 403 })
  }

  const body: RequestBody = await request.json()
  const { turniej_id, numer_partii_start, liczba_partii, gracze, partie } = body

  // Walidacja podstawowa
  if (!gracze || gracze.length < 2 || gracze.length > 4) {
    return new Response(JSON.stringify({ errors: ['Nieprawid≈Çowa liczba graczy'] }), { status: 400 })
  }

  if (!partie || partie.length !== liczba_partii) {
    return new Response(JSON.stringify({ errors: ['Nieprawid≈Çowa liczba partii'] }), { status: 400 })
  }

  const wszystkieZmiany: ZmianaElo[][] = []

  try {
    // Pobierz aktualne dane graczy (raz na poczƒÖtku)
    const { data: aktualneElo } = await supabase
      .from('gracz')
      .select('id, imie, nazwisko, aktualny_elo, liczba_partii, suma_malych_punktow, liczba_duzych_punktow')
      .in('id', gracze)

    if (!aktualneElo || aktualneElo.length !== gracze.length) {
      return new Response(JSON.stringify({ errors: ['B≈ÇƒÖd pobierania rankingu graczy'] }), { status: 400 })
    }

    // Pobierz konfiguracjƒô Elo
    const { data: config } = await supabase
      .from('elo_config')
      .select('*')
      .single()

    // Przygotuj poczƒÖtkowy stan graczy
    let stanGraczy = aktualneElo.map(gracz => ({
      id: gracz.id,
      imie: gracz.imie,
      nazwisko: gracz.nazwisko,
      aktualny_elo: gracz.aktualny_elo,
      liczba_partii: gracz.liczba_partii,
      suma_malych_punktow: gracz.suma_malych_punktow,
      liczba_duzych_punktow: gracz.liczba_duzych_punktow
    }))

    // Przetwarzaj ka≈ºdƒÖ partiƒô sekwencyjnie
    for (let partiaIndex = 0; partiaIndex < liczba_partii; partiaIndex++) {
      const partiaData = partie[partiaIndex]
      const numerBiezacejPartii = numer_partii_start + partiaIndex

      // Przygotuj dane graczy dla walidacji
      const wybraniGracze = gracze.map((graczId, index) => ({
        id: graczId,
        duzy_punkt: partiaData.duzyPunkt === graczId,
        male_punkty: partiaData.malePunkty[index] || 0
      }))

      // Walidacja partii
      const errors = validatePartia(wybraniGracze.map(g => ({ id: g.id, duzy_punkt: g.duzy_punkt })))
      if (errors.length > 0) {
        console.error('B≈Çƒôdy walidacji partii:', partiaIndex, errors)
        return new Response(JSON.stringify({ errors }), { status: 400 })
      }

      // Przygotuj dane do obliczenia Elo
      const graczeDoObliczen = wybraniGracze.map(g => {
        const graczStan = stanGraczy.find(s => s.id === g.id)
        return {
          id: g.id,
          elo_przed: graczStan?.aktualny_elo || 1200,
          liczba_partii: graczStan?.liczba_partii || 0,
          duzy_punkt: g.duzy_punkt
        }
      })

      // Oblicz nowe Elo
      const noweElo = calculateEloChanges(graczeDoObliczen, config || {
        k_factor_nowy_gracz: 40,
        k_factor_staly_gracz: 20,
        prog_staly_gracz: 30
      })

      // Stw√≥rz partiƒô
      const partiaDoZapisu: any = {
        turniej_id: turniej_id,
        numer_partii: numerBiezacejPartii,
        liczba_graczy: gracze.length,
        data_rozgrywki: new Date().toISOString(),
        duzy_punkt_gracz_id: partiaData.duzyPunkt
      }

      // Uzupe≈Çnij dane dla ka≈ºdego gracza
      gracze.forEach((graczId, index) => {
        const graczStan = stanGraczy.find(s => s.id === graczId)
        const elo = noweElo.find(e => e.id === graczId)
        
        partiaDoZapisu[`gracz${index+1}_id`] = graczId
        partiaDoZapisu[`male_punkty${index+1}`] = partiaData.malePunkty[index] || 0
        partiaDoZapisu[`elo_przed${index+1}`] = graczStan?.aktualny_elo || 1200
        partiaDoZapisu[`elo_po${index+1}`] = elo?.elo_po
        partiaDoZapisu[`zmiana_elo${index+1}`] = elo?.zmiana_elo
      })

      // Wstaw partiƒô do bazy
      const { data: nowaPartia, error: errorPartia } = await supabase
        .from('wyniki_partii')
        .insert(partiaDoZapisu)
        .select()
        .single()

      if (errorPartia) {
        console.error('B≈ÇƒÖd przy tworzeniu partii:', errorPartia)
        return new Response(JSON.stringify({ errors: ['B≈ÇƒÖd przy tworzeniu partii'] }), { status: 500 })
      }

      // Aktualizuj stan graczy dla nastƒôpnej partii
      stanGraczy = stanGraczy.map(gracz => {
        const elo = noweElo.find(e => e.id === gracz.id)
        const wybranyGracz = wybraniGracze.find(g => g.id === gracz.id)
        
        return {
          ...gracz,
          aktualny_elo: elo?.elo_po || gracz.aktualny_elo,
          liczba_partii: gracz.liczba_partii + 1,
          suma_malych_punktow: gracz.suma_malych_punktow + (wybranyGracz?.male_punkty || 0),
          liczba_duzych_punktow: gracz.liczba_duzych_punktow + (wybranyGracz?.duzy_punkt ? 1 : 0)
        }
      })

      // Przygotuj dane do podsumowania
      const zmiany = wybraniGracze.map(g => {
        const graczStan = stanGraczy.find(s => s.id === g.id)
        const elo = noweElo.find(e => e.id === g.id)
        
        return {
          gracz_id: g.id,
          imie: graczStan?.imie || '',
          nazwisko: graczStan?.nazwisko || '',
          elo_przed: graczeDoObliczen.find(d => d.id === g.id)?.elo_przed || 1200,
          elo_po: elo?.elo_po || 1200,
          zmiana_elo: elo?.zmiana_elo || 0,
          male_punkty: g.male_punkty,
          duzy_punkt: g.duzy_punkt
        }
      })

      wszystkieZmiany.push(zmiany)
    }

    // Na koniec zaktualizuj graczy w bazie danych
    for (const gracz of stanGraczy) {
      const { error: errorUpdate } = await supabase
        .from('gracz')
        .update({
          aktualny_elo: gracz.aktualny_elo,
          liczba_partii: gracz.liczba_partii,
          suma_malych_punktow: gracz.suma_malych_punktow,
          liczba_duzych_punktow: gracz.liczba_duzych_punktow,
          ostatnia_aktualizacja: new Date().toISOString()
        })
        .eq('id', gracz.id)

      if (errorUpdate) {
        console.error('B≈ÇƒÖd aktualizacji rankingu gracza:', errorUpdate)
      }
    }

    // Revalidate path
    revalidatePath(`/admin/turniej/${turniej_id}/partie`)

    return new Response(JSON.stringify({ 
      success: true,
      zmiany: wszystkieZmiany
    }), {
      status: 200,
      headers: {
        'Content-Type': 'application/json',
      },
    })

  } catch (error) {
    console.error('B≈ÇƒÖd podczas zapisywania partii:', error)
    return new Response(JSON.stringify({ errors: ['Wewnƒôtrzny b≈ÇƒÖd serwera'] }), { status: 500 })
  }
}```

### app/admin/turniej/[id]/partie/nowa/page.tsx

```
// elo-arena/app/admin/turniej/[id]/partie/nowa/page.tsx
import { createSupabaseServer } from '@/lib/supabase/server'
import { redirect } from 'next/navigation'
import NowaPartiaForm from '@/components/admin/NowaPartiaForm'

interface PageProps {
  params: Promise<{ id: string }>
}

export default async function NowaPartiaPage({ params }: PageProps) {
  const { id } = await params
  const supabase = await createSupabaseServer()

  const { data: { user } } = await supabase.auth.getUser()
  if (!user) redirect('/auth/signin')
  const { data: isAdmin } = await supabase.rpc('is_admin')
  if (!isAdmin) redirect('/')

  // Pobranie danych turnieju
  const { data: turniej } = await supabase
    .from('turniej')
    .select('*')
    .eq('id', id)
    .single()

  if (!turniej) {
    redirect('/admin/turniej')
  }

  // Pobranie WSZYSTKICH graczy z tabeli gracz
  const { data: gracze } = await supabase
    .from('gracz')
    .select('*')
    .order('nazwisko')

  // Pobranie kolejnego numeru partii
  const { data: ostatniaPartia } = await supabase
    .from('wyniki_partii')
    .select('numer_partii')
    .eq('turniej_id', id)
    .order('numer_partii', { ascending: false })
    .limit(1)
    .single()

  const kolejnyNumer = (ostatniaPartia?.numer_partii || 0) + 1

  return (
    <NowaPartiaForm 
      turniej={turniej}
      gracze={gracze || []}
      kolejnyNumer={kolejnyNumer}
      turniejId={id}
    />
  )
}```

### app/admin/turniej/[id]/partie/page.tsx

```
// elo-arena/app/admin/turniej/[id]/partie/page.tsx
import Link from 'next/link'
import { createSupabaseServer } from '@/lib/supabase/server'
import { 
  Plus, 
  Users, 
  Trophy, 
  Calendar,
  ArrowLeft,
  Eye,
  TrendingUp,
  TrendingDown,
  Trash2,
  AlertTriangle
} from 'lucide-react'

interface GraczWPartii {
  id: string
  imie: string
  nazwisko: string
  elo_przed: number
  elo_po: number
  zmiana_elo: number
  male_punkty: number
}

interface Partia {
  id: string
  numer_partii: number
  data_rozgrywki: string
  liczba_graczy: number
  duzy_punkt_gracz_id: string
  gracze: GraczWPartii[]
}

interface Turniej {
  id: string
  nazwa: string
}

export default async function PartieTurniejuPage({
  params
}: {
  params: Promise<{ id: string }>
}) {
  // Oczekujemy na params
  const { id: turniejId } = await params;
  const supabase = await createSupabaseServer()

  // Pobierz dane turnieju
  const { data: turniej, error: turniejError } = await supabase
    .from('turniej')
    .select('id, nazwa')
    .eq('id', turniejId)
    .single()

  if (turniejError) {
    console.error('B≈ÇƒÖd pobierania turnieju:', turniejError)
    return (
      <div className="p-8 max-w-4xl mx-auto">
        <div className="text-center">
          <h1 className="text-2xl font-bold text-white mb-4">B≈ÇƒÖd</h1>
          <p className="text-slate-400 mb-6">Nie uda≈Ço siƒô za≈Çadowaƒá turnieju</p>
          <Link
            href="/admin/turniej"
            className="text-sky-500 hover:text-sky-400"
          >
            Powr√≥t do listy turniej√≥w
          </Link>
        </div>
      </div>
    )
  }

  // Pobierz partie TYLKO z tego turnieju
  const { data: partie, error: partieError } = await supabase
    .from('wyniki_partii')
    .select(`
      id,
      numer_partii,
      data_rozgrywki,
      liczba_graczy,
      duzy_punkt_gracz_id,
      gracz1_id,
      gracz2_id,
      gracz3_id,
      gracz4_id,
      male_punkty1,
      male_punkty2,
      male_punkty3,
      male_punkty4,
      elo_przed1,
      elo_przed2,
      elo_przed3,
      elo_przed4,
      elo_po1,
      elo_po2,
      elo_po3,
      elo_po4,
      zmiana_elo1,
      zmiana_elo2,
      zmiana_elo3,
      zmiana_elo4
    `)
    .eq('turniej_id', turniejId)
    .order('numer_partii', { ascending: true })

  if (partieError) {
    console.error('B≈ÇƒÖd pobierania partii:', partieError)
  }

  console.log(`Pobrano ${partie?.length || 0} partii dla turnieju ${turniejId}`)

  // Zbierz wszystkie ID graczy wystƒôpujƒÖcych w partiach
  const graczeIds = new Set<string>()
  partie?.forEach(partia => {
    for (let i = 1; i <= 4; i++) {
      const graczId = partia[`gracz${i}_id` as keyof typeof partia] as string
      if (graczId) graczeIds.add(graczId)
    }
  })

  // Pobierz dane graczy
  const { data: gracze, error: graczeError } = await supabase
    .from('gracz')
    .select('id, imie, nazwisko')
    .in('id', Array.from(graczeIds))

  if (graczeError) {
    console.error('B≈ÇƒÖd pobierania graczy:', graczeError)
  }

  // Przygotuj dane partii z informacjami o graczach
  const partieZGraczami: Partia[] = partie?.map(partia => {
    const graczePartii: GraczWPartii[] = []
    
    for (let i = 1; i <= partia.liczba_graczy; i++) {
      const graczId = partia[`gracz${i}_id` as keyof typeof partia] as string
      const gracz = gracze?.find(g => g.id === graczId)
      
      if (gracz) {
        graczePartii.push({
          id: gracz.id,
          imie: gracz.imie,
          nazwisko: gracz.nazwisko,
          elo_przed: partia[`elo_przed${i}` as keyof typeof partia] as number || 1200,
          elo_po: partia[`elo_po${i}` as keyof typeof partia] as number || 1200,
          zmiana_elo: partia[`zmiana_elo${i}` as keyof typeof partia] as number || 0,
          male_punkty: partia[`male_punkty${i}` as keyof typeof partia] as number || 0
        })
      }
    }

    return {
      id: partia.id,
      numer_partii: partia.numer_partii,
      data_rozgrywki: partia.data_rozgrywki,
      liczba_graczy: partia.liczba_graczy,
      duzy_punkt_gracz_id: partia.duzy_punkt_gracz_id,
      gracze: graczePartii
    }
  }) || []

  // Oblicz nastƒôpny numer partii
  const kolejnyNumer = partie && partie.length > 0 
    ? Math.max(...partie.map(p => p.numer_partii)) + 1 
    : 1

  return (
    <div className="p-8 max-w-7xl mx-auto">
      {/* Nag≈Ç√≥wek */}
      <div className="flex items-center justify-between mb-8">
        <div className="flex items-center space-x-4">
          <Link
            href="/admin/turniej"
            className="inline-flex items-center text-sm text-slate-400 hover:text-white"
          >
            <ArrowLeft className="h-4 w-4 mr-2" />
            Powr√≥t do turniej√≥w
          </Link>
          <div>
            <h1 className="text-3xl font-bold text-white">Partie turnieju</h1>
            <p className="text-slate-400 mt-1">
              {turniej?.nazwa} ‚Ä¢ {partieZGraczami.length} partii
            </p>
          </div>
        </div>
        
        <div className="flex space-x-3">
          <Link
            href={`/admin/turniej/${turniejId}/partie/nowa`}
            className="bg-sky-500 hover:bg-sky-600 text-white px-4 py-2 rounded-lg flex items-center"
          >
            <Plus className="h-4 w-4 mr-2" />
            Nowa partia
          </Link>
        </div>
      </div>

      {/* Statystyki */}
      <div className="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
        <div className="bg-slate-800/50 rounded-xl border border-slate-700 p-4">
          <div className="flex items-center justify-between">
            <div>
              <p className="text-slate-400 text-sm">≈ÅƒÖcznie partii</p>
              <p className="text-2xl font-bold text-white">{partieZGraczami.length}</p>
            </div>
            <Users className="h-8 w-8 text-slate-400" />
          </div>
        </div>
        
        <div className="bg-slate-800/50 rounded-xl border border-slate-700 p-4">
          <div className="flex items-center justify-between">
            <div>
              <p className="text-slate-400 text-sm">Nastƒôpna partia</p>
              <p className="text-2xl font-bold text-white">#{kolejnyNumer}</p>
            </div>
            <Plus className="h-8 w-8 text-slate-400" />
          </div>
        </div>
        
        <div className="bg-slate-800/50 rounded-xl border border-slate-700 p-4">
          <div className="flex items-center justify-between">
            <div>
              <p className="text-slate-400 text-sm">≈örednio graczy</p>
              <p className="text-2xl font-bold text-white">
                {partieZGraczami.length > 0 
                  ? Math.round(partieZGraczami.reduce((acc, p) => acc + p.liczba_graczy, 0) / partieZGraczami.length * 10) / 10 
                  : 0}
              </p>
            </div>
            <Users className="h-8 w-8 text-slate-400" />
          </div>
        </div>
        
        <div className="bg-slate-800/50 rounded-xl border border-slate-700 p-4">
          <div className="flex items-center justify-between">
            <div>
              <p className="text-slate-400 text-sm">Ostatnia partia</p>
              <p className="text-sm font-bold text-white">
                {partieZGraczami.length > 0 
                  ? new Date(partieZGraczami[partieZGraczami.length - 1].data_rozgrywki).toLocaleDateString('pl-PL')
                  : 'Brak'}
              </p>
            </div>
            <Calendar className="h-8 w-8 text-slate-400" />
          </div>
        </div>
      </div>

      {/* Lista partii */}
      <div className="bg-slate-800/50 rounded-xl border border-slate-700">
        <div className="p-6 border-b border-slate-700">
          <h2 className="text-xl font-bold text-white flex items-center">
            <Trophy className="h-5 w-5 mr-2" />
            Lista partii - {turniej?.nazwa}
          </h2>
          <p className="text-slate-400 text-sm mt-1">
            Partie przypisane do tego turnieju
          </p>
        </div>

        {partieZGraczami.length === 0 ? (
          <div className="p-12 text-center">
            <Trophy className="h-12 w-12 text-slate-400 mx-auto mb-4" />
            <h3 className="text-lg font-semibold text-white mb-2">Brak partii w tym turnieju</h3>
            <p className="text-slate-400 mb-6">Stw√≥rz pierwszƒÖ partiƒô dla tego turnieju</p>
            <Link
              href={`/admin/turniej/${turniejId}/partie/nowa`}
              className="bg-sky-500 hover:bg-sky-600 text-white px-6 py-2 rounded-lg inline-flex items-center"
            >
              <Plus className="h-4 w-4 mr-2" />
              Stw√≥rz pierwszƒÖ partiƒô
            </Link>
          </div>
        ) : (
          <div className="divide-y divide-slate-700">
            {partieZGraczami.map((partia) => (
              <PartiaCard 
                key={partia.id} 
                partia={partia} 
                turniejId={turniejId}
              />
            ))}
          </div>
        )}
      </div>
    </div>
  )
}

// Komponent karty partii
function PartiaCard({ partia, turniejId }: { partia: Partia, turniejId: string }) {
  const zwyciezca = partia.gracze.find(g => g.id === partia.duzy_punkt_gracz_id)
  
  return (
    <div className="p-6 hover:bg-slate-700/30 transition-colors">
      <div className="flex items-center justify-between mb-4">
        <div className="flex items-center space-x-4">
          <div className="bg-slate-700 rounded-lg px-3 py-1">
            <span className="text-white font-semibold">#{partia.numer_partii}</span>
          </div>
          <div className="text-slate-400 text-sm">
            <Calendar className="h-4 w-4 inline mr-1" />
            {new Date(partia.data_rozgrywki).toLocaleDateString('pl-PL')}
          </div>
          <div className="text-slate-400 text-sm">
            <Users className="h-4 w-4 inline mr-1" />
            {partia.liczba_graczy} graczy
          </div>
        </div>
        
        <Link
          href={`/admin/turniej/${turniejId}/partie/${partia.id}`}
          className="text-slate-400 hover:text-white flex items-center"
        >
          <Eye className="h-4 w-4 mr-1" />
          Szczeg√≥≈Çy
        </Link>
      </div>

      {/* Gracze */}
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
        {partia.gracze.map((gracz) => (
          <div 
            key={gracz.id}
            className={`p-4 rounded-lg border ${
              gracz.id === partia.duzy_punkt_gracz_id
                ? 'bg-yellow-500/10 border-yellow-500/30'
                : 'bg-slate-700/30 border-slate-600'
            }`}
          >
            <div className="flex justify-between items-start mb-2">
              <div>
                <h4 className="font-semibold text-white">
                  {gracz.imie} {gracz.nazwisko}
                  {gracz.id === partia.duzy_punkt_gracz_id && (
                    <Trophy className="h-4 w-4 text-yellow-500 inline ml-2" />
                  )}
                </h4>
                <p className="text-slate-400 text-sm">
                  Ma≈Çe punkty: {gracz.male_punkty}
                </p>
              </div>
              
              <div className={`flex items-center space-x-1 ${
                gracz.zmiana_elo > 0 ? 'text-green-400' : 'text-red-400'
              }`}>
                {gracz.zmiana_elo > 0 ? (
                  <TrendingUp className="h-4 w-4" />
                ) : (
                  <TrendingDown className="h-4 w-4" />
                )}
                <span className="text-sm font-medium">
                  {gracz.zmiana_elo > 0 ? '+' : ''}{Math.round(gracz.zmiana_elo)}
                </span>
              </div>
            </div>
            
            <div className="flex justify-between text-sm">
              <span className="text-slate-400">
                ELO: {Math.round(gracz.elo_przed)} ‚Üí {Math.round(gracz.elo_po)}
              </span>
            </div>
          </div>
        ))}
      </div>
    </div>
  )
}```

### app/admin/turniej/[id]/update/route.ts

```
// elo-arena/app/admin/turniej/[id]/update/route.ts
import { NextRequest, NextResponse } from 'next/server'
import { createSupabaseServerMutable } from '@/lib/supabase/server-mutable'

const urlRe = /^https?:\/\/\S+$/i
const sheetColRe = /^[A-Za-z]$/
const UUID_RE =
  /^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i

const GAME_VALUES = new Set(['rummikub_standard', 'rummikub_twist', 'qwirkle'])

function toNullIfEmpty(v: unknown): string | null {
  const s = String(v ?? '').trim()
  return s === '' ? null : s
}

function toIntOrNull(v: unknown): number | null {
  const s = String(v ?? '').trim()
  if (s === '') return null
  const n = Number(s)
  return Number.isFinite(n) ? n : NaN
}

export async function POST(
  req: NextRequest,
  context: { params: Promise<{ id: string }> }
) {
  try {
    const params = await context.params
    const origin = req.nextUrl.origin
    const { id } = params

    if (!id || !UUID_RE.test(id)) {
      return NextResponse.redirect(new URL(`/admin/turniej/${id}/edit?e=invalid_id`, origin), {
        status: 303,
      })
    }

    const supabase = await createSupabaseServerMutable()

    // üîê Autoryzacja
    const {
      data: { user },
    } = await supabase.auth.getUser()

    if (!user) {
      return NextResponse.redirect(new URL('/auth/signin', origin), { status: 303 })
    }

    const { data: isAdmin } = await supabase.rpc('is_admin')
    if (!isAdmin) {
      return NextResponse.redirect(new URL('/', origin), { status: 303 })
    }

    const fd = await req.formData()

    // wymagane
    const nazwa = String(fd.get('nazwa') || '').trim()
    const gra = String(fd.get('gra') || '').trim()
    const data_turnieju = String(fd.get('data_turnieju') || '').trim()
    const godzina_turnieju = String(fd.get('godzina_turnieju') || '').trim()

    // opcjonalne
    const zakonczenie_turnieju = toNullIfEmpty(fd.get('zakonczenie_turnieju'))
    const gsheet_url = toNullIfEmpty(fd.get('gsheet_url'))
    const arkusz_nazwa = toNullIfEmpty(fd.get('arkusz_nazwa'))

    const kolumna_nazwisk_raw = toNullIfEmpty(fd.get('kolumna_nazwisk'))
    const kolumna_nazwisk = kolumna_nazwisk_raw ? kolumna_nazwisk_raw.toUpperCase() : null

    const pierwszy_wiersz_z_nazwiskiem = toIntOrNull(fd.get('pierwszy_wiersz_z_nazwiskiem'))
    const limit_graczy = toIntOrNull(fd.get('limit_graczy'))

    const miejsce_id = toNullIfEmpty(fd.get('miejsce_id'))

    // ‚úÖ Walidacje wymaganych
    if (!nazwa || !gra || !data_turnieju || !godzina_turnieju) {
      return NextResponse.redirect(new URL(`/admin/turniej/${id}/edit?e=invalid_input`, origin), {
        status: 303,
      })
    }

    if (!GAME_VALUES.has(gra)) {
      return NextResponse.redirect(new URL(`/admin/turniej/${id}/edit?e=invalid_game`, origin), {
        status: 303,
      })
    }

    // ‚úÖ Walidacje opcjonalnych
    if (kolumna_nazwisk && !sheetColRe.test(kolumna_nazwisk)) {
      return NextResponse.redirect(
        new URL(`/admin/turniej/${id}/edit?e=sheet_col_invalid`, origin),
        { status: 303 }
      )
    }

    if (gsheet_url && !urlRe.test(gsheet_url)) {
      return NextResponse.redirect(new URL(`/admin/turniej/${id}/edit?e=url_invalid`, origin), {
        status: 303,
      })
    }

    if (
      pierwszy_wiersz_z_nazwiskiem !== null &&
      (Number.isNaN(pierwszy_wiersz_z_nazwiskiem) || pierwszy_wiersz_z_nazwiskiem < 1)
    ) {
      return NextResponse.redirect(new URL(`/admin/turniej/${id}/edit?e=number_invalid`, origin), {
        status: 303,
      })
    }

    if (limit_graczy !== null && (Number.isNaN(limit_graczy) || limit_graczy < 1)) {
      return NextResponse.redirect(new URL(`/admin/turniej/${id}/edit?e=number_invalid`, origin), {
        status: 303,
      })
    }

    // ‚úÖ Walidacja miejsca (je≈õli podane)
    if (miejsce_id) {
      if (!UUID_RE.test(miejsce_id)) {
        return NextResponse.redirect(
          new URL(`/admin/turniej/${id}/edit?e=invalid_location_id`, origin),
          { status: 303 }
        )
      }

      const { data: miejsce, error: miejsceError } = await supabase
        .from('miejsce_turnieju')
        .select('id')
        .eq('id', miejsce_id)
        .single()

      if (miejsceError || !miejsce) {
        return NextResponse.redirect(
          new URL(`/admin/turniej/${id}/edit?e=place_not_found`, origin),
          { status: 303 }
        )
      }
    }

    // ‚úÖ Pobierz aktualny turniej (do blokady zmiany gry)
    const { data: existing, error: existingErr } = await supabase
      .from('turniej')
      .select('id, gra')
      .eq('id', id)
      .single()

    if (existingErr || !existing) {
      return NextResponse.redirect(new URL(`/admin/turniej/${id}/edit?e=save_failed`, origin), {
        status: 303,
      })
    }

    const oldGra = String((existing as any).gra || '').trim()

    // ‚úÖ BLOKADA: je≈õli zmiana gry i sƒÖ wyniki w wyniki_partii -> stop
    if (oldGra && gra !== oldGra) {
      const { count, error: countErr } = await supabase
        .from('wyniki_partii')
        .select('id', { head: true, count: 'exact' })
        .eq('turniej_id', id)

      if (countErr) {
        return NextResponse.redirect(new URL(`/admin/turniej/${id}/edit?e=save_failed`, origin), {
          status: 303,
        })
      }

      if ((count ?? 0) > 0) {
        return NextResponse.redirect(new URL(`/admin/turniej/${id}/edit?e=gra_locked`, origin), {
          status: 303,
        })
      }
    }

    // ‚úÖ Aktualizacja (wszystkie pola z tabeli kt√≥re edytujesz)
    const updates: Record<string, any> = {
      nazwa,
      gra,
      data_turnieju,
      godzina_turnieju,
      zakonczenie_turnieju,
      limit_graczy,
      miejsce_id, // null je≈õli puste
      gsheet_url,
      arkusz_nazwa,
      kolumna_nazwisk,
      pierwszy_wiersz_z_nazwiskiem,
    }

    const { error } = await supabase.from('turniej').update(updates).eq('id', id)

    if (error) {
      console.error('‚ùå Database error:', error)
      return NextResponse.redirect(new URL(`/admin/turniej/${id}/edit?e=save_failed`, origin), {
        status: 303,
      })
    }

    return NextResponse.redirect(new URL(`/admin/turniej/${id}/edit?ok=1`, origin), {
      status: 303,
    })
  } catch (error) {
    console.error('üí• Unexpected error in route:', error)
    const params = await context.params
    return NextResponse.redirect(
      new URL(`/admin/turniej/${params.id}/edit?e=server_error`, req.nextUrl.origin),
      { status: 303 }
    )
  }
}
```

### app/admin/turniej/page.tsx

```
// app/admin/turniej/page.tsx
import { redirect } from 'next/navigation'
import Link from 'next/link'
import { createSupabaseServer } from '@/lib/supabase/server'
import DeleteTurniej from '@/components/DeleteTurniej'
import { Users, Plus, Calendar, Clock, UserCheck, FileText } from 'lucide-react'

export const dynamic = 'force-dynamic'
export const revalidate = 0

type Row = {
  id: string
  nazwa: string
  data_turnieju: string | null
  godzina_turnieju: string | null
  zakonczenie_turnieju: string | null
  limit_graczy: number | null
  created_at: string | null
}

// ≈ÇƒÖczenie daty + godziny w Date
function joinDateTime(d: string | null, t: string | null): Date | null {
  if (!d) return null
  const hhmm = (t ?? '00:00').slice(0, 5)
  return new Date(`${d}T${hhmm}`)
}

// pierwsza litera wielka
function capitalizeFirst(str: string): string {
  if (!str) return str
  return str.charAt(0).toUpperCase() + str.slice(1)
}

// data po polsku, z ≈Çadnym formatem
function formatDatePL(d: Date) {
  const formatted = d.toLocaleDateString('pl-PL', {
    weekday: 'long',
    year: '2-digit',
    month: 'numeric',
    day: 'numeric',
  })
  return capitalizeFirst(formatted)
}

// zawsze HH:MM
function formatTimeHHMM(raw: string | null) {
  if (!raw) return '00:00'
  return raw.slice(0, 5)
}

export default async function AdminTurniejList() {
  const supabase = await createSupabaseServer()

  // wymagane logowanie
  const { data: { user } } = await supabase.auth.getUser()
  if (!user) redirect('/auth/signin')

  // wymagany admin
  const { data: isAdmin } = await supabase.rpc('is_admin')
  if (!isAdmin) redirect('/')

  // lista turniej√≥w
  const { data: rows, error } = await supabase
    .from('turniej')
    .select(
      'id, nazwa, data_turnieju, godzina_turnieju, zakonczenie_turnieju, limit_graczy, created_at'
    )
    .order('created_at', { ascending: false })
    .limit(200)

  // Pobierz liczbƒô partii dla ka≈ºdego turnieju
  const turniejeZPartiami = await Promise.all(
    rows?.map(async (turniej) => {
      const { count } = await supabase
        .from('wyniki_partii')
        .select('*', { count: 'exact', head: true })
        .eq('turniej_id', turniej.id)

      return {
        ...turniej,
        liczba_partii: count || 0
      }
    }) || []
  )

  if (error) {
    return (
      <main className="flex min-h-[calc(100vh-4rem)] items-center justify-center px-4 py-8">
        <div className="w-full max-w-6xl rounded-2xl bg-slate-800/95 border border-slate-700 shadow-[0_14px_40px_rgba(0,0,0,0.8)] p-6">
          <h1 className="text-2xl font-semibold text-sky-50 mb-4">Turnieje - Panel admina</h1>
          <div className="rounded-md border border-red-400/50 bg-red-500/10 px-4 py-3 text-red-200">
            Nie uda≈Ço siƒô pobraƒá danych.
          </div>
        </div>
      </main>
    )
  }

  return (
    <main className="flex min-h-[calc(100vh-4rem)] items-center justify-center px-4 py-8">
      <div className="w-full max-w-6xl rounded-2xl bg-slate-800/95 border border-slate-700 shadow-[0_14px_40px_rgba(0,0,0,0.8)] p-6 space-y-6">
        <div className="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
          <div>
            <h1 className="text-2xl font-semibold text-sky-50">ZarzƒÖdzanie turniejami</h1>
            <p className="mt-1 text-sm text-slate-400">Lista wszystkich turniej√≥w w systemie</p>
          </div>
          <Link
            href="/turniej/new"
            className="rounded-full bg-sky-600 hover:bg-sky-500 px-6 py-2 text-sm font-semibold text-white transition flex items-center gap-2"
          >
            <Plus className="h-4 w-4" />
            Dodaj turniej
          </Link>
        </div>

        <div className="overflow-x-auto rounded-lg border border-slate-600">
          <table className="min-w-full text-sm">
            <thead className="bg-slate-700/50">
              <tr>
                <th className="px-4 py-3 text-left text-sky-100 font-medium text-xs uppercase tracking-wider">
                  Nazwa turnieju
                </th>
                <th className="px-4 py-3 text-left text-sky-100 font-medium text-xs uppercase tracking-wider">
                  Termin
                </th>
                <th className="px-4 py-3 text-left text-sky-100 font-medium text-xs uppercase tracking-wider">
                  Limit graczy
                </th>
                <th className="px-4 py-3 text-left text-sky-100 font-medium text-xs uppercase tracking-wider">
                  Partie
                </th>
                <th className="px-4 py-3 text-left text-sky-100 font-medium text-xs uppercase tracking-wider">
                  Utworzono
                </th>
                <th className="px-4 py-3 text-right text-sky-100 font-medium text-xs uppercase tracking-wider">
                  Akcje
                </th>
              </tr>
            </thead>
            <tbody className="divide-y divide-slate-600">
              {turniejeZPartiami?.map((raw) => {
                const r = raw as Row & { liczba_partii: number }
                const start = joinDateTime(r.data_turnieju, r.godzina_turnieju)

                return (
                  <tr key={r.id} className="hover:bg-slate-700/30 transition">
                    <td className="px-4 py-3">
                      <div className="space-y-1">
                        <Link
                          href={`/admin/turniej/${r.id}/edit`}
                          className="text-sky-100 hover:text-sky-200 font-medium hover:underline block"
                        >
                          {r.nazwa}
                        </Link>
                        <div className="flex gap-2">
                          <Link
                            href={`/admin/turniej/${r.id}/partie`}
                            className="inline-flex items-center gap-1 text-xs text-slate-400 hover:text-slate-300 transition"
                          >
                            <Users className="h-3 w-3" />
                            ZarzƒÖdzaj
                          </Link>
                          <Link
                            href={`/admin/turniej/${r.id}/partie/nowa`}
                            className="inline-flex items-center gap-1 text-xs text-sky-400 hover:text-sky-300 transition"
                          >
                            <Plus className="h-3 w-3" />
                            Dodaj partiƒô
                          </Link>
                        </div>
                      </div>
                    </td>

                    <td className="px-4 py-3">
                      <div className="space-y-1">
                        {r.data_turnieju ? (
                          <div className="flex items-center gap-2 text-sky-100">
                            <Calendar className="h-3 w-3 text-slate-400" />
                            <span className="text-sm">
                              {start ? formatDatePL(start) : r.data_turnieju}
                            </span>
                          </div>
                        ) : (
                          <span className="text-slate-500 text-sm">‚Äî</span>
                        )}
                        
                        <div className="flex items-center gap-3 text-xs">
                          {r.godzina_turnieju && (
                            <div className="flex items-center gap-1 text-slate-300">
                              <Clock className="h-3 w-3" />
                              <span>Start: {formatTimeHHMM(r.godzina_turnieju)}</span>
                            </div>
                          )}
                          
                          {r.zakonczenie_turnieju && (
                            <div className="flex items-center gap-1 text-slate-300">
                              <Clock className="h-3 w-3" />
                              <span>Koniec: {formatTimeHHMM(r.zakonczenie_turnieju)}</span>
                            </div>
                          )}
                        </div>
                      </div>
                    </td>

                    <td className="px-4 py-3">
                      {r.limit_graczy ? (
                        <div className="flex items-center gap-2 text-sky-100">
                          <UserCheck className="h-4 w-4" />
                          <span className="font-medium">{r.limit_graczy}</span>
                          <span className="text-xs text-slate-400">graczy</span>
                        </div>
                      ) : (
                        <span className="text-slate-500 text-sm">Bez limitu</span>
                      )}
                    </td>

                    <td className="px-4 py-3">
                      <div className="flex items-center gap-2">
                        <div className="flex items-center gap-1 text-sky-100">
                          <FileText className="h-4 w-4" />
                          <span className="font-medium">{r.liczba_partii}</span>
                        </div>
                        {r.liczba_partii > 0 && (
                          <Link
                            href={`/admin/turniej/${r.id}/partie`}
                            className="text-xs text-slate-400 hover:text-slate-300 underline"
                          >
                            zobacz
                          </Link>
                        )}
                      </div>
                    </td>

                    <td className="px-4 py-3">
                      <div className="text-sky-100 text-sm">
                        {r.created_at
                          ? new Date(r.created_at).toLocaleDateString('pl-PL')
                          : '‚Äî'}
                      </div>
                      {r.created_at && (
                        <div className="text-xs text-slate-400">
                          {new Date(r.created_at).toLocaleTimeString('pl-PL', {
                            hour: '2-digit',
                            minute: '2-digit'
                          })}
                        </div>
                      )}
                    </td>

                    <td className="px-4 py-3">
                      <div className="flex justify-end gap-2">
                        <Link
                          href={`/admin/turniej/${r.id}/edit`}
                          className="inline-flex items-center gap-1 rounded-md bg-slate-700 hover:bg-slate-600 px-3 py-1.5 text-xs font-medium text-sky-100 transition border border-slate-600"
                        >
                          <svg
                            width="12"
                            height="12"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            strokeWidth="2"
                          >
                            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" />
                            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z" />
                          </svg>
                          Edytuj
                        </Link>
                        <DeleteTurniej id={r.id} nazwa={r.nazwa} />
                      </div>
                    </td>
                  </tr>
                )
              })}

              {!turniejeZPartiami?.length && (
                <tr>
                  <td
                    className="px-4 py-8 text-center text-slate-400 text-sm"
                    colSpan={6}
                  >
                    <div className="flex flex-col items-center gap-2">
                      <svg
                        width="48"
                        height="48"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        strokeWidth="1"
                        className="text-slate-600"
                      >
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
                        <polyline points="14,2 14,8 20,8" />
                        <line x1="16" y1="13" x2="8" y2="13" />
                        <line x1="16" y1="17" x2="8" y2="17" />
                        <polyline points="10,9 9,9 8,9" />
                      </svg>
                      <p>Brak turniej√≥w w systemie</p>
                      <Link
                        href="/turniej/new"
                        className="text-sky-400 hover:text-sky-300 text-sm underline"
                      >
                        Dodaj pierwszy turniej
                      </Link>
                    </div>
                  </td>
                </tr>
              )}
            </tbody>
          </table>
        </div>

        {turniejeZPartiami && turniejeZPartiami.length > 0 && (
          <div className="flex justify-between items-center text-sm text-slate-400">
            <div>
              Znaleziono {turniejeZPartiami.length} turniej
              {turniejeZPartiami.length === 1
                ? ''
                : turniejeZPartiami.length > 1 && turniejeZPartiami.length < 5
                ? 'e'
                : 'y'}
            </div>
            <div className="text-xs">
              Ostatnie turnieje na g√≥rze
            </div>
          </div>
        )}
      </div>
    </main>
  )
}```

### app/admin/users/[id]/role/route.ts

```
// app/admin/users/[id]/role/route.ts
import { NextRequest, NextResponse } from 'next/server'
import { createSupabaseServerMutable } from '@/lib/supabase/server-mutable'

// Prosty regex do walidacji UUID v4
const UUID_RE = /^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i

export async function POST(
  req: NextRequest,
  ctx: { params: Promise<{ id: string }> }
) {
  const supabase = await createSupabaseServerMutable()
  const origin = req.nextUrl.origin

  // rozpakowanie params
  const { id: targetId } = await ctx.params

  // walidacja UUID
  if (!targetId || !UUID_RE.test(targetId)) {
    return NextResponse.redirect(new URL('/admin/users?e=invalid_id', origin), { status: 303 })
  }

  // kto wykonuje?
  const { data: { user } } = await supabase.auth.getUser()
  if (!user) {
    return NextResponse.redirect(new URL('/auth/signin', origin), { status: 303 })
  }

  // tylko admin mo≈ºe zmieniaƒá role
  const { data: isAdmin } = await supabase.rpc('is_admin')
  if (!isAdmin) {
    return NextResponse.redirect(new URL('/', origin), { status: 303 })
  }

  // rola z formularza
  const form = await req.formData()
  const roleRaw = form.get('role')
  const role = typeof roleRaw === 'string' ? roleRaw.trim() : ''

  // ‚¨áÔ∏è TYLKO TE trzy sƒÖ dozwolone
  const ALLOWED_ROLES = ['user', 'organizer', 'admin'] as const
  if (!ALLOWED_ROLES.includes(role as any)) {
    console.error('invalid role value from form:', roleRaw)
    return NextResponse.redirect(new URL('/admin/users?e=invalid_role', origin), { status: 303 })
  }

  // (opcjonalnie) admin nie mo≈ºe zabraƒá admina samemu sobie
  if (targetId === user.id && role !== 'admin') {
    return NextResponse.redirect(new URL('/admin/users?e=cannot_downgrade_self', origin), { status: 303 })
  }

  const { error } = await supabase
    .from('profiles')
    .update({ role })
    .eq('id', targetId)

  if (error) {
    console.error('role update error', error)
    return NextResponse.redirect(new URL('/admin/users?e=update_failed', origin), { status: 303 })
  }

  return NextResponse.redirect(new URL('/admin/users?ok=1', origin), { status: 303 })
}
```

### app/admin/users/page.tsx

```
// app/admin/users/page.tsx
import { redirect } from 'next/navigation'
import Link from 'next/link'
import { createSupabaseServer } from '@/lib/supabase/server'

export const dynamic = 'force-dynamic'
export const revalidate = 0

type SearchParams = Promise<Record<string, string | string[] | undefined>>

type ProfileRow = {
  id: string
  username: string | null
  email: string | null
  role: 'user' | 'organizer' | 'admin' | null
  created_at: string | null
}

export default async function AdminUsersPage({
  searchParams,
}: {
  searchParams: SearchParams
}) {
  const sp = await searchParams
  const ok = sp.ok === '1'
  const err = typeof sp.e === 'string' ? sp.e : undefined

  const supabase = await createSupabaseServer()

  // kto jest zalogowany?
  const { data: { user } } = await supabase.auth.getUser()
  if (!user) {
    redirect('/auth/signin')
  }

  // czy admin?
  const { data: isAdmin } = await supabase.rpc('is_admin')
  if (!isAdmin) {
    redirect('/')
  }

  // pobranie profili
  const { data: profiles } = await supabase
    .from('profiles')
    .select('id, username, email, role, created_at')
    .order('created_at', { ascending: false })
    .returns<ProfileRow[]>()

  return (
    <main className="flex min-h-[calc(100vh-4rem)] items-center justify-center px-4 py-8">
      {/* KARTA ‚Äì nowy brand jak layout/signup/turnieje */}
      <div className="w-full max-w-4xl rounded-2xl bg-slate-800/95 border border-slate-700 shadow-[0_14px_40px_rgba(0,0,0,0.8)] p-6 space-y-5">
        <header className="flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between">
          <div>
            <h1 className="text-2xl font-semibold text-sky-50">
              U≈ºytkownicy ‚Äì role
            </h1>
            <p className="text-sm text-sky-200/80">
              Zmieniaj role: <span className="font-semibold">user</span>,{' '}
              <span className="font-semibold">organizer</span>,{' '}
              <span className="font-semibold">admin</span>.
            </p>
          </div>
          <Link
            href="/admin"
            className="text-xs text-sky-200 hover:text-sky-100 underline-offset-2 hover:underline"
          >
            ‚Üê Powr√≥t do panelu
          </Link>
        </header>

        {/* komunikaty */}
        {ok && (
          <div className="rounded-md border border-emerald-500/70 bg-emerald-900/40 px-3 py-2 text-xs text-emerald-100">
            Zapisano zmianƒô roli.
          </div>
        )}
        {err && (
          <div className="rounded-md border border-red-500/70 bg-red-900/40 px-3 py-2 text-xs text-red-100">
            {err === 'invalid_id' && 'Nieprawid≈Çowe ID u≈ºytkownika.'}
            {err === 'invalid_role' && 'Nieprawid≈Çowa rola.'}
            {err === 'cannot_downgrade_self' && 'Nie mo≈ºesz odebraƒá sobie roli admin.'}
            {err === 'update_failed' && 'Nie uda≈Ço siƒô zaktualizowaƒá roli.'}
            {!['invalid_id','invalid_role','cannot_downgrade_self','update_failed'].includes(err) &&
              'WystƒÖpi≈Ç b≈ÇƒÖd.'}
          </div>
        )}

        {/* tabela u≈ºytkownik√≥w */}
        <div className="overflow-x-auto rounded-xl border border-slate-700 bg-slate-900/80">
          <table className="min-w-full border-collapse text-sm">
            <thead className="bg-slate-900/90">
              <tr>
                <th className="px-3 py-2 text-left text-xs font-semibold text-slate-200">ID</th>
                <th className="px-3 py-2 text-left text-xs font-semibold text-slate-200">Email</th>
                <th className="px-3 py-2 text-left text-xs font-semibold text-slate-200">Login</th>
                <th className="px-3 py-2 text-left text-xs font-semibold text-slate-200">Rola</th>
                <th className="px-3 py-2 text-left text-xs font-semibold text-slate-200">Zmie≈Ñ rolƒô</th>
              </tr>
            </thead>
            <tbody>
              {profiles?.map((p) => (
                <tr
                  key={p.id}
                  className="border-t border-slate-700/70 last:border-b last:border-slate-700/70"
                >
                  <td className="px-3 py-2 align-middle text-[11px] text-slate-300 max-w-[160px] truncate">
                    {p.id}
                  </td>
                  <td className="px-3 py-2 align-middle text-xs text-sky-100 truncate max-w-[200px]">
                    {p.email ?? '‚Äî'}
                  </td>
                  <td className="px-3 py-2 align-middle text-xs text-slate-200">
                    {p.username ?? <span className="opacity-60">brak</span>}
                  </td>
                  <td className="px-3 py-2 align-middle text-xs">
                    <span
                      className={[
                        'inline-flex rounded-full px-2 py-0.5 text-[11px] font-medium',
                        p.role === 'admin'
                          ? 'bg-red-600/80 text-white'
                          : p.role === 'organizer'
                          ? 'bg-sky-600/80 text-white'
                          : 'bg-slate-700 text-slate-100',
                      ].join(' ')}
                    >
                      {p.role ?? 'user'}
                    </span>
                  </td>
                  <td className="px-3 py-2 align-middle">
                    {/* formularz zmiany roli */}
                    <form
                      action={`/admin/users/${p.id}/role`}
                      method="post"
                      className="flex items-center gap-2"
                    >
                      <select
                        name="role"
                        defaultValue={p.role ?? 'user'}
                        className="rounded-md border border-slate-600 bg-slate-900/80 px-2 py-1 text-xs text-sky-50 focus:outline-none focus:ring-1 focus:ring-sky-400"
                      >
                        <option value="user">user</option>
                        <option value="organizer">organizer</option>
                        <option value="admin">admin</option>
                      </select>
                      <button
                        type="submit"
                        className="rounded-full bg-sky-500/90 px-3 py-1 text-[11px] font-semibold text-white shadow-sm hover:bg-sky-400 transition"
                      >
                        Zapisz
                      </button>
                    </form>
                  </td>
                </tr>
              ))}

              {!profiles?.length && (
                <tr>
                  <td
                    colSpan={5}
                    className="px-3 py-6 text-center text-xs text-slate-300"
                  >
                    Brak u≈ºytkownik√≥w.
                  </td>
                </tr>
              )}
            </tbody>
          </table>
        </div>
      </div>
    </main>
  )
}
```

### app/api/admin/partie/[partiaId]/route.ts

```
// app/api/admin/partie/[partiaId]/route.ts
import { createSupabaseServer } from '@/lib/supabase/server'
import { NextRequest } from 'next/server'

export async function DELETE(
  request: NextRequest,
  { params }: { params: Promise<{ partiaId: string }> }
) {
  const supabase = await createSupabaseServer()
  const { searchParams } = new URL(request.url)
  const turniejId = searchParams.get('turniejId')

  const resolvedParams = await params
  const partiaId = resolvedParams.partiaId

  try {
    // Sprawd≈∫ uprawnienia
    const { data: { user } } = await supabase.auth.getUser()
    if (!user) {
      return new Response(JSON.stringify({ error: 'Unauthorized' }), { status: 401 })
    }

    const { data: isAdmin } = await supabase.rpc('is_admin')
    if (!isAdmin) {
      return new Response(JSON.stringify({ error: 'Forbidden' }), { status: 403 })
    }

    // Pobierz pe≈Çne dane partii
    const { data: partia, error: partiaError } = await supabase
      .from('wyniki_partii')
      .select('*')
      .eq('id', partiaId)
      .single()

    if (partiaError || !partia) {
      return new Response(JSON.stringify({ error: 'Partia nie znaleziona' }), { status: 404 })
    }

    // Sprawd≈∫ czy partia nale≈ºy do turnieju (je≈õli podano turniejId)
    if (turniejId && partia.turniej_id !== turniejId) {
      return new Response(JSON.stringify({ error: 'Partia nie nale≈ºy do tego turnieju' }), { status: 400 })
    }

    // Przygotuj dane graczy do aktualizacji
    const graczeAktualizacje = []
    const zwyciezcaId = partia.duzy_punkt_gracz_id

    for (let i = 1; i <= partia.liczba_graczy; i++) {
      const graczId = partia[`gracz${i}_id`]
      if (graczId) {
        const eloPrzed = partia[`elo_przed${i}`] || 1200
        const zmianaElo = partia[`zmiana_elo${i}`] || 0
        const czyWygral = graczId === zwyciezcaId

        graczeAktualizacje.push({
          id: graczId,
          eloPrzed,
          zmianaElo,
          czyWygral
        })
      }
    }

    // Wykonaj wszystkie aktualizacje w transakcji
    for (const gracz of graczeAktualizacje) {
      // Pobierz aktualne dane gracza
      const { data: aktualnyGracz, error: graczError } = await supabase
        .from('gracz')
        .select('ranking, games_played, wins')
        .eq('id', gracz.id)
        .single()

      if (graczError) {
        console.error(`B≈ÇƒÖd pobierania gracza ${gracz.id}:`, graczError)
        continue
      }

      // Przygotuj nowe warto≈õci
      const nowyRanking = gracz.eloPrzed // Przywr√≥ƒá ELO sprzed partii
      const noweGamesPlayed = Math.max(0, (aktualnyGracz.games_played || 0) - 1)
      const noweWins = gracz.czyWygral 
        ? Math.max(0, (aktualnyGracz.wins || 0) - 1)
        : (aktualnyGracz.wins || 0)

      // Zaktualizuj gracza
      const { error: updateError } = await supabase
        .from('gracz')
        .update({
          ranking: nowyRanking,
          games_played: noweGamesPlayed,
          wins: noweWins,
          updated_at: new Date().toISOString()
        })
        .eq('id', gracz.id)

      if (updateError) {
        console.error(`B≈ÇƒÖd aktualizacji gracza ${gracz.id}:`, updateError)
        // Kontynuuj mimo b≈Çƒôdu - nie przerywaj ca≈Çej operacji
      }
    }

    // Usu≈Ñ partiƒô
    const { error: deleteError } = await supabase
      .from('wyniki_partii')
      .delete()
      .eq('id', partiaId)

    if (deleteError) {
      return new Response(JSON.stringify({ error: 'B≈ÇƒÖd usuwania partii' }), { status: 500 })
    }

    return new Response(JSON.stringify({ 
      success: true,
      message: `Partia usuniƒôta. Przywr√≥cono rankingi ${graczeAktualizacje.length} graczy.`
    }), { status: 200 })

  } catch (error) {
    console.error('B≈ÇƒÖd usuwania partii:', error)
    return new Response(JSON.stringify({ error: 'Wewnƒôtrzny b≈ÇƒÖd serwera' }), { status: 500 })
  }
}```

### app/api/admin/partie/route.ts

```
// app/api/admin/partie/route.ts
import { createSupabaseServer } from '@/lib/supabase/server'
import { NextRequest } from 'next/server'

export async function GET(request: NextRequest) {
  const supabase = await createSupabaseServer()

  try {
    // Pobierz wszystkie partie z informacjami o turnieju
    const { data: partie, error } = await supabase
      .from('wyniki_partii')
      .select(`
        *,
        turniej:turniej_id(id, nazwa)
      `)
      .order('data_rozgrywki', { ascending: false })

    if (error) {
      console.error('B≈ÇƒÖd pobierania partii:', error)
      return new Response(JSON.stringify({ error: error.message }), { status: 500 })
    }

    // Dla ka≈ºdej partii pobierz graczy
    const partieZGraczami = await Promise.all(
      partie.map(async (partia) => {
        // Pobierz ID graczy z partii
        const graczeIds = []
        for (let i = 1; i <= partia.liczba_graczy; i++) {
          const graczId = partia[`gracz${i}_id`]
          if (graczId) graczeIds.push(graczId)
        }

        // Pobierz dane graczy
        const { data: gracze } = await supabase
          .from('gracz')
          .select('id, imie, nazwisko')
          .in('id', graczeIds)

        return {
          ...partia,
          gracze: gracze || []
        }
      })
    )

    return new Response(JSON.stringify({ partie: partieZGraczami }), { status: 200 })

  } catch (error) {
    console.error('B≈ÇƒÖd pobierania partii:', error)
    return new Response(JSON.stringify({ error: 'Wewnƒôtrzny b≈ÇƒÖd serwera' }), { status: 500 })
  }
}```

### app/api/check-email/route.ts

```
import { NextRequest, NextResponse } from 'next/server'
import { createClient } from '@supabase/supabase-js'

export async function POST(request: NextRequest) {
  try {
    const { email } = await request.json()

    if (!email) {
      return NextResponse.json(
        { error: 'Email jest wymagany' },
        { status: 400 }
      )
    }

    // Walidacja formatu emaila
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/
    if (!emailRegex.test(email)) {
      return NextResponse.json(
        { error: 'Nieprawid≈Çowy format email' },
        { status: 400 }
      )
    }

    // Sprawd≈∫ czy klucz serwisowy jest ustawiony
    const serviceRoleKey = process.env.SUPABASE_SERVICE_ROLE_KEY
    const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL

    if (!serviceRoleKey || !supabaseUrl) {
      console.error('Brak klucza serwisowego lub URL Supabase')
      return NextResponse.json(
        { error: 'Konfiguracja serwera niekompletna' },
        { status: 500 }
      )
    }

    // Utw√≥rz klienta z kluczem serwisowym
    const supabaseAdmin = createClient(supabaseUrl, serviceRoleKey, {
      auth: {
        autoRefreshToken: false,
        persistSession: false
      }
    })

    // Metoda 1: Spr√≥buj u≈ºyƒá admin API
    try {
      const { data, error } = await supabaseAdmin.auth.admin.listUsers({
        page: 1,
        perPage: 1000
      })

      if (error) {
        console.error('B≈ÇƒÖd listUsers:', error)
        throw error
      }

      const userExists = data.users?.some(
        user => user.email?.toLowerCase() === email.toLowerCase()
      ) || false

      return NextResponse.json({ exists: userExists })
    } catch (adminError) {
      console.error('Admin API nie dzia≈Ça, u≈ºywam fallback:', adminError)
      
      // Metoda 2: Fallback - sprawd≈∫ przez pr√≥bƒô resetowania has≈Ça
      // (bez klucza serwisowego nie mo≈ºemy bezpo≈õrednio sprawdziƒá)
      const { error: resetError } = await supabaseAdmin.auth.resetPasswordForEmail(email, {
        redirectTo: `${process.env.NEXT_PUBLIC_SITE_URL || 'http://localhost:3000'}/auth/reset-password`
      })

      // Je≈õli nie ma b≈Çƒôdu lub b≈ÇƒÖd jest zwiƒÖzany z ratelimit, to znaczy ≈ºe u≈ºytkownik mo≈ºe istnieƒá
      // To jest przybli≈ºona metoda - dok≈Çadna wymaga klucza serwisowego
      return NextResponse.json({ 
        exists: !resetError || resetError.message?.includes('rate limit') 
      })
    }

  } catch (error: any) {
    console.error('B≈ÇƒÖd w endpointcie check-email:', error)
    return NextResponse.json(
      { error: 'Wewnƒôtrzny b≈ÇƒÖd serwera' },
      { status: 500 }
    )
  }
}```

### app/api/resolve-email/gsheets/list/route.ts

```
// app/api/gsheets/list/route.ts
import { NextRequest, NextResponse } from 'next/server'

function extractSheetId(url: string) {
  const m = url.match(/spreadsheets\/d\/([a-zA-Z0-9-_]+)/)
  return m?.[1] ?? null
}

export async function GET(req: NextRequest) {
  const url = req.nextUrl.searchParams.get('url') || ''
  const sheetId = extractSheetId(url)
  if (!sheetId) {
    return NextResponse.json({ error: 'invalid_url' }, { status: 400 })
  }

  // Publiczny feed z listƒÖ arkuszy (wymaga publikacji/udostƒôpnienia linkiem)
  const feed = `https://spreadsheets.google.com/feeds/worksheets/${sheetId}/public/full?alt=json`

  try {
    const r = await fetch(feed, { cache: 'no-store' })
    if (!r.ok) {
      return NextResponse.json({ error: 'fetch_failed', status: r.status }, { status: 400 })
    }
    const j = await r.json() as any
    const entries: any[] = j?.feed?.entry || []

    const sheets = entries.map((e) => {
      const name: string = e?.title?.$t ?? ''
      const linkHref: string = e?.link?.[0]?.href ?? ''
      // spr√≥buj wyciƒÖgnƒÖƒá gid z href
      const gidMatch = linkHref.match(/[?&]gid=(\d+)/)
      const gid = gidMatch?.[1] ?? null
      return { name, gid }
    }).filter(s => s.name)

    return NextResponse.json({ sheets }, { status: 200 })
  } catch (e) {
    return NextResponse.json({ error: 'exception' }, { status: 500 })
  }
}
```

### app/api/resolve-email/gsheets/sheets/route.ts

```
// elo-arena/app/api/resolve-email/gsheets/sheets/route.ts
import { NextRequest, NextResponse } from 'next/server'

function extractSpreadsheetId(url: string) {
  // wspiera: .../spreadsheets/d/{ID}/...  (link udostƒôpniony)
  const m = url.match(/spreadsheets\/d\/([a-zA-Z0-9-_]+)/)
  return m?.[1] || null
}

export async function GET(req: NextRequest) {
  try {
    const url = req.nextUrl.searchParams.get('url') || ''
    const idFromUrl = extractSpreadsheetId(url)
    const id = idFromUrl || url.trim() // pozw√≥l te≈º wkleiƒá samo ID

    if (!id) {
      return NextResponse.json({ error: 'missing_id' }, { status: 400 })
    }
    const key = process.env.GOOGLE_SHEETS_API_KEY
    if (!key) {
      return NextResponse.json({ error: 'missing_api_key' }, { status: 500 })
    }

    // pobieramy tylko tytu≈Çy kart (bez danych)
    const api = `https://sheets.googleapis.com/v4/spreadsheets/${id}?fields=sheets(properties(title))&key=${key}`
    const res = await fetch(api, { cache: 'no-store' })
    if (!res.ok) {
      const txt = await res.text()
      return NextResponse.json({ error: 'fetch_failed', details: txt }, { status: 502 })
    }

    const json = await res.json()
    const titles: string[] =
      json?.sheets?.map((s: any) => s?.properties?.title).filter(Boolean) ?? []

    return NextResponse.json({ spreadsheetId: id, sheets: titles })
  } catch (e: any) {
    return NextResponse.json({ error: 'exception', message: e?.message }, { status: 500 })
  }
}
```

### app/api/resolve-email/route.ts

```
// elo-arena/app/api/resolve-email/route.ts
import { NextResponse } from 'next/server'
import { supabaseAdmin } from '@/lib/supabase/admin'

export async function POST(req: Request) {
  const { identifier } = await req.json() as { identifier: string }
  const input = identifier.trim().toLowerCase()

  // je≈õli to e-mail, nie ma co rozwiƒÖzywaƒá
  if (input.includes('@')) {
    return NextResponse.json({ email: input })
  }

  // login -> email (tylko na serwerze, przez Service Role)
  const { data, error } = await supabaseAdmin
    .from('profiles')
    .select('email')
    .eq('username', input)
    .single()

  if (error || !data?.email) {
    return NextResponse.json({ error: 'Nie znaleziono u≈ºytkownika o takim loginie.' }, { status: 404 })
  }

  return NextResponse.json({ email: data.email.toLowerCase() })
}
```

### app/auth/login/route.ts

```
import { NextRequest, NextResponse } from 'next/server'
import { createSupabaseServer } from '@/lib/supabase/server'
import { createClient } from '@supabase/supabase-js'

export async function POST(req: NextRequest) {
  const formData = await req.formData()
  let identifier = String(formData.get('identifier') || '').trim().toLowerCase()
  const password = String(formData.get('password') || '')

  const origin = req.nextUrl.origin

  // 1) Sprawd≈∫ czy to email czy username
  if (!identifier.includes('@')) {
    // To jest username - znajd≈∫ email
    try {
      const supabaseAdmin = createClient(
        process.env.NEXT_PUBLIC_SUPABASE_URL!,
        process.env.SUPABASE_SERVICE_ROLE_KEY!
      )
      
      const { data, error } = await supabaseAdmin
        .from('profiles')
        .select('email')
        .eq('username', identifier)
        .single()

      if (error || !data?.email) {
        return NextResponse.redirect(
          new URL('/auth/signin?e=notfound', origin), 
          { status: 303 }
        )
      }
      identifier = data.email.toLowerCase()
    } catch (error) {
      console.error('B≈ÇƒÖd konwersji username:', error)
      return NextResponse.redirect(
        new URL('/auth/signin?e=notfound', origin), 
        { status: 303 }
      )
    }
  }

  // 2) Logowanie
  try {
    const supabase = await createSupabaseServer()
    const { error } = await supabase.auth.signInWithPassword({
      email: identifier,
      password,
    })

    if (error) {
      console.error('B≈ÇƒÖd logowania:', error)
      return NextResponse.redirect(
        new URL('/auth/signin?e=invalid', origin), 
        { status: 303 }
      )
    }

    // 3) Sukces
    return NextResponse.redirect(new URL('/', origin), { status: 303 })

  } catch (error) {
    console.error('B≈ÇƒÖd serwera:', error)
    return NextResponse.redirect(
      new URL('/auth/signin?e=invalid', origin), 
      { status: 303 }
    )
  }
}```

### app/auth/signin/page.tsx

```
// app/auth/signin/page.tsx
'use client'

import { useEffect, useMemo, useState } from 'react'
import { useSearchParams } from 'next/navigation'
import Link from 'next/link'
import { Eye, EyeOff, Mail, Lock, AlertCircle, Loader2 } from 'lucide-react'

export default function SignIn() {
  const [formData, setFormData] = useState({
    identifier: '',
    password: ''
  })
  const [loading, setLoading] = useState(false)
  const [showPassword, setShowPassword] = useState(false)
  
  const searchParams = useSearchParams()
  
  // Obs≈Çuga b≈Çƒôd√≥w z query params
  const errorFromParams = useMemo(() => {
    const e = searchParams.get('e')
    if (e === 'notfound') return 'Nie znaleziono u≈ºytkownika o takim loginie.'
    if (e === 'invalid') return 'Nieprawid≈Çowy email/login lub has≈Ço.'
    return null
  }, [searchParams])

  // Reset query params po pierwszym renderze
  useEffect(() => { 
    if (errorFromParams && typeof window !== 'undefined') {
      const newUrl = window.location.pathname
      window.history.replaceState(null, '', newUrl)
    }
  }, [errorFromParams])

  const isFormValid = () => {
    return formData.identifier.trim().length > 0 && 
           formData.password.length >= 6
  }

  const handleSubmit = (e: React.FormEvent) => {
    e.preventDefault()
    
    if (!isFormValid()) {
      return
    }
    
    setLoading(true)
    
    // Tworzymy formularz i wysy≈Çamy go - tak jak to robi navbar
    const form = document.createElement('form')
    form.method = 'POST'
    form.action = '/auth/signin/submit'
    form.style.display = 'none'
    
    const identifierInput = document.createElement('input')
    identifierInput.name = 'identifier'
    identifierInput.value = formData.identifier
    form.appendChild(identifierInput)
    
    const passwordInput = document.createElement('input')
    passwordInput.name = 'password'
    passwordInput.value = formData.password
    form.appendChild(passwordInput)
    
    document.body.appendChild(form)
    form.submit()
  }

  const handleChange = (field: keyof typeof formData) => (
    e: React.ChangeEvent<HTMLInputElement>
  ) => {
    setFormData(prev => ({ ...prev, [field]: e.target.value }))
  }

  return (
    <div className="py-8 px-4">
      <main className="flex min-h-[calc(100vh-4rem)] items-start justify-center px-4 py-8">
        <div className="w-full max-w-md">
          {/* Karta formularza */}
          <div className="rounded-2xl bg-slate-800/95 border border-slate-700 shadow-[0_14px_40px_rgba(0,0,0,0.8)] p-8">
            
            {/* Nag≈Ç√≥wek "Logowanie" wewnƒÖtrz karty */}
            <div className="mb-8 text-center">
              <h1 className="text-4xl font-bold text-sky-50 mb-2">
                Logowanie
              </h1>
            </div>

            {/* U≈ºywamy onSUBMIT z JavaScript, nie action w form */}
            <form 
              onSubmit={handleSubmit}
              className="space-y-6" 
              autoComplete="off"
            >
              {/* Pole Email/Login */}
              <div>
                <label className="block text-sm font-medium text-slate-300 mb-2">
                  <div className="flex items-center gap-2">
                    <Mail size={16} />
                    Email lub nazwa u≈ºytkownika
                  </div>
                </label>
                <input
                  className="w-full rounded-lg border border-slate-600 bg-slate-900/70 px-4 py-3 text-sky-50 placeholder:text-slate-400 focus:outline-none focus:border-sky-400 focus:ring-2 focus:ring-sky-400/20 transition-all"
                  type="text"
                  placeholder="twoj@email.pl lub nazwa u≈ºytkownika"
                  value={formData.identifier}
                  onChange={handleChange('identifier')}
                  required
                  disabled={loading}
                  autoComplete="username"
                />
              </div>

              {/* Pole Has≈Ça */}
              <div>
                <label className="block text-sm font-medium text-slate-300 mb-2">
                  <div className="flex items-center gap-2">
                    <Lock size={16} />
                    Has≈Ço
                  </div>
                </label>
                <div className="relative">
                  <input
                    className="w-full rounded-lg border border-slate-600 bg-slate-900/70 px-4 py-3 text-sky-50 placeholder:text-slate-400 focus:outline-none focus:border-sky-400 focus:ring-2 focus:ring-sky-400/20 transition-all pr-12"
                    type={showPassword ? 'text' : 'password'}
                    placeholder="Wprowad≈∫ has≈Ço"
                    value={formData.password}
                    onChange={handleChange('password')}
                    minLength={6}
                    required
                    disabled={loading}
                    autoComplete="current-password"
                  />
                  <button
                    type="button"
                    onClick={() => setShowPassword(!showPassword)}
                    className="absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 hover:text-slate-300 transition-colors p-1"
                    disabled={loading}
                  >
                    {showPassword ? <EyeOff size={20} /> : <Eye size={20} />}
                  </button>
                </div>
              </div>

              {/* Komunikat b≈Çƒôdu z URL */}
              {errorFromParams && (
                <div className="rounded-lg p-4 bg-red-900/30 border border-red-800">
                  <div className="flex items-start gap-3">
                    <AlertCircle className="text-red-400 mt-0.5 flex-shrink-0" size={20} />
                    <p className="text-sm text-red-300">
                      {errorFromParams}
                    </p>
                  </div>
                </div>
              )}

              {/* Przycisk submit */}
              <button
                className="w-full rounded-full bg-gradient-to-r from-sky-500 to-sky-600 px-4 py-3 text-lg font-semibold text-white shadow-[0_10px_25px_rgba(15,23,42,0.9)] transition-all hover:from-sky-400 hover:to-sky-500 hover:shadow-[0_14px_35px_rgba(15,23,42,1)] active:scale-[0.98] disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:from-sky-500 disabled:hover:to-sky-600 disabled:hover:shadow-[0_10px_25px_rgba(15,23,42,0.9)]"
                type="submit"
                disabled={!isFormValid() || loading}
              >
                {loading ? (
                  <span className="flex items-center justify-center gap-2">
                    <Loader2 className="animate-spin" size={18} />
                    Logowanie...
                  </span>
                ) : (
                  'Zaloguj siƒô'
                )}
              </button>
            </form>

            {/* Linki do rejestracji i resetowania has≈Ça */}
            <div className="mt-8 pt-6 border-t border-slate-700 text-center space-y-3">
              <p className="text-slate-400 text-sm">
                Nie masz jeszcze konta?{' '}
                <Link
                  href="/auth/signup"
                  className="text-sky-400 hover:text-sky-300 font-medium transition-colors"
                >
                  Zarejestruj siƒô
                </Link>
              </p>
              
              <p className="text-slate-400 text-sm">
                Zapomnia≈Çe≈õ has≈Ça?{' '}
                <Link
                  href="/auth/reset-password"
                  className="text-sky-400 hover:text-sky-300 font-medium transition-colors"
                >
                  Zresetuj has≈Ço
                </Link>
              </p>
            </div>
          </div>
        </div>
      </main>
    </div>
  )
}```

### app/auth/signin/submit/route.ts

```
// elo-arena/app/auth/signin/submit/route.ts
import { NextRequest, NextResponse } from 'next/server'
import { createSupabaseServerMutable } from '@/lib/supabase/server-mutable'
import { supabaseAdmin } from '@/lib/supabase/admin'

export async function POST(req: NextRequest) {
  const origin = req.nextUrl.origin
  const form = await req.formData()
  let identifier = String(form.get('identifier') || '').trim().toLowerCase()
  const password = String(form.get('password') || '')

  if (identifier && !identifier.includes('@')) {
    const { data, error } = await supabaseAdmin
      .from('profiles')
      .select('email')
      .eq('username', identifier)
      .maybeSingle()

    if (error || !data?.email) {
      return NextResponse.redirect(new URL('/auth/signin?e=notfound', origin), { status: 303 })
    }
    identifier = data.email.toLowerCase()
  }

  const supabase = await createSupabaseServerMutable()
  const { error } = await supabase.auth.signInWithPassword({ email: identifier, password })

  if (error) {
    return NextResponse.redirect(new URL('/auth/signin?e=invalid', origin), { status: 303 })
  }

  return NextResponse.redirect(new URL('/', origin), { status: 303 })
}
```

### app/auth/signout/route.ts

```
// elo-arena/app/auth/signout/route.ts
import { NextResponse } from 'next/server'
import { createSupabaseServerMutable } from '@/lib/supabase/server-mutable'

export async function POST(request: Request) {
  const supabase = await createSupabaseServerMutable();
  await supabase.auth.signOut();
  
  // U≈ºyj URL z requestu i zmie≈Ñ tylko ≈õcie≈ºkƒô
  const url = new URL(request.url);
  url.pathname = '/'; // Przekieruj na stronƒô g≈Ç√≥wnƒÖ
  url.search = ''; // Wyczy≈õƒá query params je≈õli sƒÖ
  
  return NextResponse.redirect(url);
}
```

### app/auth/signup/page.tsx

```
'use client'

import { useState, useEffect } from 'react'
import { supabase } from '@/lib/supabase/client'
import Link from 'next/link'
import { Eye, EyeOff, Mail, Lock, AlertCircle, CheckCircle, Loader2 } from 'lucide-react'

export default function SignUp() {
  const [formData, setFormData] = useState({
    email: '',
    password: '',
    confirmPassword: ''
  })
  const [loading, setLoading] = useState(false)
  const [message, setMessage] = useState<{ type: 'success' | 'error', text: string } | null>(null)
  const [showPassword, setShowPassword] = useState(false)
  const [showConfirmPassword, setShowConfirmPassword] = useState(false)
  const [validation, setValidation] = useState({
    email: { valid: true, message: '' },
    password: { valid: true, message: '' },
    confirmPassword: { valid: true, message: '' }
  })
  const [checkingEmail, setCheckingEmail] = useState(false)
  const [emailExists, setEmailExists] = useState(false)

  // Debounce dla sprawdzania emaila
  useEffect(() => {
    const checkEmailExists = async () => {
      const email = formData.email.trim()
      
      if (!email || !isValidEmail(email)) {
        setEmailExists(false)
        setValidation(prev => ({
          ...prev,
          email: { valid: true, message: '' }
        }))
        return
      }

      setCheckingEmail(true)
      
      try {
        const response = await fetch('/api/check-email', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ email }),
        })

        if (response.ok) {
          const data = await response.json()
          
          if (data.exists) {
            setEmailExists(true)
            setValidation(prev => ({
              ...prev,
              email: {
                valid: false,
                message: 'Ten email jest ju≈º zarejestrowany'
              }
            }))
          } else {
            setEmailExists(false)
            setValidation(prev => ({
              ...prev,
              email: { valid: true, message: '' }
            }))
          }
        } else {
          // Je≈õli endpoint zwr√≥ci b≈ÇƒÖd, nie zmieniamy stanu - uznajemy, ≈ºe nie wiemy
          console.error('B≈ÇƒÖd z endpointu check-email:', await response.text())
        }
      } catch (error: any) {
        console.error('B≈ÇƒÖd podczas sprawdzania emaila:', error)
        // W przypadku b≈Çƒôdu sieciowego, nie zmieniamy statusu
      } finally {
        setCheckingEmail(false)
      }
    }

    // Debounce 800ms
    const timer = setTimeout(checkEmailExists, 800)
    
    return () => clearTimeout(timer)
  }, [formData.email])

  const isValidEmail = (email: string) => {
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/
    return emailRegex.test(email)
  }

  const validateForm = () => {
    const newValidation = { ...validation }

    // Walidacja email
    if (!formData.email) {
      newValidation.email = { valid: false, message: 'Email jest wymagany' }
    } else if (!isValidEmail(formData.email)) {
      newValidation.email = { valid: false, message: 'Nieprawid≈Çowy format email' }
    } else if (emailExists) {
      newValidation.email = { valid: false, message: 'Ten email jest ju≈º zarejestrowany' }
    } else {
      newValidation.email = { valid: true, message: '' }
    }

    // Walidacja has≈Ça
    if (!formData.password) {
      newValidation.password = { valid: false, message: 'Has≈Ço jest wymagane' }
    } else if (formData.password.length < 6) {
      newValidation.password = { valid: false, message: 'Has≈Ço musi mieƒá co najmniej 6 znak√≥w' }
    } else {
      newValidation.password = { valid: true, message: '' }
    }

    // Walidacja potwierdzenia has≈Ça
    if (!formData.confirmPassword) {
      newValidation.confirmPassword = { valid: false, message: 'Potwierdzenie has≈Ça jest wymagane' }
    } else if (formData.password !== formData.confirmPassword) {
      newValidation.confirmPassword = { valid: false, message: 'Has≈Ça nie sƒÖ identyczne' }
    } else {
      newValidation.confirmPassword = { valid: true, message: '' }
    }

    setValidation(newValidation)
  }

  const isFormValid = () => {
    return validation.email.valid && 
           validation.password.valid && 
           validation.confirmPassword.valid &&
           formData.email && 
           formData.password && 
           formData.confirmPassword &&
           !emailExists
  }

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault()
    setMessage(null)

    // Walidacja przed wys≈Çaniem
    validateForm()

    if (!isFormValid()) {
      setMessage({ 
        type: 'error', 
        text: 'Popraw b≈Çƒôdy w formularzu przed wys≈Çaniem' 
      })
      return
    }

    setLoading(true)
    try {
      const { error } = await supabase.auth.signUp({
        email: formData.email.trim(),
        password: formData.password,
        options: {
          emailRedirectTo: `${window.location.origin}/auth/callback`,
          data: {
            created_at: new Date().toISOString()
          }
        }
      })

      if (error) {
        // Sprawd≈∫ specyficzne b≈Çƒôdy
        if (error.message.includes('User already registered') || 
            error.message.includes('already exists') ||
            error.message.toLowerCase().includes('already') ||
            error.message.includes('user_exists')) {
          setEmailExists(true)
          setValidation(prev => ({
            ...prev,
            email: {
              valid: false,
              message: 'Ten email jest ju≈º zarejestrowany'
            }
          }))
          throw new Error('EMAIL_EXISTS')
        }
        throw error
      }

      // Uda≈Ço siƒô - wyczy≈õƒá formularz
      setMessage({
        type: 'success',
        text: 'Konto zosta≈Ço utworzone! Sprawd≈∫ swojƒÖ skrzynkƒô pocztowƒÖ i kliknij link aktywacyjny. Sprawd≈∫ te≈º folder spam.'
      })

      // Reset formularza
      setFormData({
        email: '',
        password: '',
        confirmPassword: ''
      })
      setEmailExists(false)

      // Auto-hide message after 15 seconds
      setTimeout(() => setMessage(null), 15000)

    } catch (error: any) {
      console.error('B≈ÇƒÖd rejestracji:', error)
      
      let errorMessage = 'Nie uda≈Ço siƒô utworzyƒá konta'
      
      if (error.message === 'EMAIL_EXISTS') {
        errorMessage = 'Ten adres email jest ju≈º zarejestrowany. U≈ºyj innego emaila lub skorzystaj z opcji resetowania has≈Ça.'
      } else if (error.message.includes('password')) {
        errorMessage = 'Has≈Ço jest zbyt s≈Çabe. U≈ºyj co najmniej 6 znak√≥w'
      } else if (error.message.includes('email')) {
        errorMessage = 'Nieprawid≈Çowy adres email'
      } else if (error.message.includes('rate limit') || error.message.includes('too many')) {
        errorMessage = 'Zbyt wiele pr√≥b rejestracji. Spr√≥buj za chwilƒô.'
      }

      setMessage({ 
        type: 'error', 
        text: errorMessage 
      })
    } finally {
      setLoading(false)
    }
  }

  const handleChange = (field: keyof typeof formData) => (
    e: React.ChangeEvent<HTMLInputElement>
  ) => {
    const value = e.target.value
    setFormData(prev => ({ ...prev, [field]: value }))
    
    // Resetuj stan istniejƒÖcego emaila przy zmianie
    if (field === 'email') {
      setEmailExists(false)
      setValidation(prev => ({
        ...prev,
        email: { valid: true, message: '' }
      }))
    }
  }

  return (
    <div className="py-8 px-4">
      <main className="flex min-h-[calc(100vh-4rem)] items-start justify-center px-4 py-4">
        <div className="w-full max-w-md">
          {/* Karta formularza - teraz zawiera nag≈Ç√≥wek wewnƒÖtrz */}
          <div className="rounded-2xl bg-slate-800/95 border border-slate-700 shadow-[0_14px_40px_rgba(0,0,0,0.8)] p-8">
            
            {/* Nag≈Ç√≥wek "Rejestracja" wewnƒÖtrz karty */}
            <div className="mb-8 text-center">
              <h1 className="text-4xl font-bold text-sky-50 mb-2">
                Rejestracja
              </h1>
            </div>

            <form onSubmit={handleSubmit} className="space-y-6" autoComplete="off">
              {/* Pole Email */}
              <div>
                <label className="block text-sm font-medium text-slate-300 mb-2">
                  <div className="flex items-center gap-2">
                    <Mail size={16} />
                    Adres email
                    {checkingEmail && (
                      <Loader2 className="ml-2 animate-spin text-slate-400" size={14} />
                    )}
                    {emailExists && !checkingEmail && (
                      <span className="ml-2 text-xs text-red-400 flex items-center gap-1">
                        <AlertCircle size={12} />
                        Zajƒôty
                      </span>
                    )}
                    {formData.email && isValidEmail(formData.email) && !checkingEmail && !emailExists && (
                      <span className="ml-2 text-xs text-emerald-400 flex items-center gap-1">
                        <CheckCircle size={12} />
                        Dostƒôpny
                      </span>
                    )}
                  </div>
                </label>
                <input
                  className={`w-full rounded-lg border px-4 py-3 text-sky-50 placeholder:text-slate-400 focus:outline-none focus:ring-2 transition-all ${
                    emailExists
                      ? 'border-red-500 bg-red-900/20 focus:border-red-400 focus:ring-red-400/20'
                      : checkingEmail
                      ? 'border-slate-600 bg-slate-900/70 focus:border-sky-400 focus:ring-sky-400/20'
                      : formData.email && isValidEmail(formData.email)
                      ? 'border-emerald-500/50 bg-slate-900/70 focus:border-emerald-400 focus:ring-emerald-400/20'
                      : 'border-slate-600 bg-slate-900/70 focus:border-sky-400 focus:ring-sky-400/20'
                  }`}
                  type="email"
                  placeholder=""
                  value={formData.email}
                  onChange={handleChange('email')}
                  required
                  disabled={loading}
                  autoComplete="email"
                />
                {validation.email.message && (
                  <p className="mt-1 text-sm text-red-400 flex items-center gap-1">
                    <AlertCircle size={14} />
                    {validation.email.message}
                  </p>
                )}
              </div>

              {/* Pole Has≈Ça */}
              <div>
                <label className="block text-sm font-medium text-slate-300 mb-2">
                  <div className="flex items-center gap-2">
                    <Lock size={16} />
                    Has≈Ço
                  </div>
                </label>
                <div className="relative">
                  <input
                    className={`w-full rounded-lg border px-4 py-3 text-sky-50 placeholder:text-slate-400 focus:outline-none focus:ring-2 transition-all pr-12 ${
                      validation.password.valid || !formData.password
                        ? 'border-slate-600 bg-slate-900/70 focus:border-sky-400 focus:ring-sky-400/20'
                        : 'border-red-500 bg-red-900/20 focus:border-red-400 focus:ring-red-400/20'
                    }`}
                    type={showPassword ? 'text' : 'password'}
                    placeholder=""
                    value={formData.password}
                    onChange={handleChange('password')}
                    minLength={6}
                    required
                    disabled={loading}
                    autoComplete="new-password"
                  />
                  <button
                    type="button"
                    onClick={() => setShowPassword(!showPassword)}
                    className="absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 hover:text-slate-300 transition-colors p-1"
                    disabled={loading}
                  >
                    {showPassword ? <EyeOff size={20} /> : <Eye size={20} />}
                  </button>
                </div>
                
                {validation.password.message && (
                  <p className="mt-1 text-sm text-red-400 flex items-center gap-1">
                    <AlertCircle size={14} />
                    {validation.password.message}
                  </p>
                )}
              </div>

              {/* Pole Potwierdzenia Has≈Ça */}
              <div>
                <label className="block text-sm font-medium text-slate-300 mb-2">
                  <div className="flex items-center gap-2">
                    <Lock size={16} />
                    Has≈Ço
                  </div>
                </label>
                <div className="relative">
                  <input
                    className={`w-full rounded-lg border px-4 py-3 text-sky-50 placeholder:text-slate-400 focus:outline-none focus:ring-2 transition-all pr-12 ${
                      validation.confirmPassword.valid || !formData.confirmPassword
                        ? 'border-slate-600 bg-slate-900/70 focus:border-sky-400 focus:ring-sky-400/20'
                        : 'border-red-500 bg-red-900/20 focus:border-red-400 focus:ring-red-400/20'
                    }`}
                    type={showConfirmPassword ? 'text' : 'password'}
                    placeholder=""
                    value={formData.confirmPassword}
                    onChange={handleChange('confirmPassword')}
                    minLength={6}
                    required
                    disabled={loading}
                    autoComplete="new-password"
                  />
                  <button
                    type="button"
                    onClick={() => setShowConfirmPassword(!showConfirmPassword)}
                    className="absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 hover:text-slate-300 transition-colors p-1"
                    disabled={loading}
                  >
                    {showConfirmPassword ? <EyeOff size={20} /> : <Eye size={20} />}
                  </button>
                </div>
                {validation.confirmPassword.message && (
                  <p className="mt-1 text-sm text-red-400 flex items-center gap-1">
                    <AlertCircle size={14} />
                    {validation.confirmPassword.message}
                  </p>
                )}
              </div>

              {/* Komunikaty */}
              {message && (
                <div className={`rounded-lg p-4 ${message.type === 'success' ? 'bg-emerald-900/30 border border-emerald-800' : 'bg-red-900/30 border border-red-800'}`}>
                  <div className="flex items-start gap-3">
                    {message.type === 'success' ? (
                      <CheckCircle className="text-emerald-400 mt-0.5 flex-shrink-0" size={20} />
                    ) : (
                      <AlertCircle className="text-red-400 mt-0.5 flex-shrink-0" size={20} />
                    )}
                    <p className={`text-sm ${message.type === 'success' ? 'text-emerald-300' : 'text-red-300'}`}>
                      {message.text}
                    </p>
```

### app/favicon.ico

```
         (  F          (  n  00     (-  ñ         ç  æF  (                                                           $   ]   ∫   ∫   ]   $                                       †   Ú   ˇ   ˇ   ˇ   ˇ   Ú   †                           8   ‡   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ‡   8                  ‚   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ‚              °   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   °       #   Ù   ˇ   ˇOOOˇÆÆÆˇ´´´ˇ´´´ˇ´´´ˇ´´´ˇ≠≠≠ˇgggˇ   ˇ   ˇ   Ù   #   Y   ˇ   ˇ   ˇˇÌÌÌˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇ˝˝˝ˇ555ˇ   ˇ   ˇ   ˇ   Y   ª   ˇ   ˇ   ˇ   ˇkkkˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇéééˇ   ˇ   ˇ   ˇ   ˇ   ª   ª   ˇ   ˇ   ˇ   ˇ			ˇÕÕÕˇˇˇˇˇˇˇˇˇ‰‰‰ˇˇ   ˇ   ˇ   ˇ   ˇ   ª   Y   ˇ   ˇ   ˇ   ˇ   ˇJJJˇ˝˝˝ˇˇˇˇˇkkkˇ   ˇ   ˇ   ˇ   ˇ   ˇ   Y   #   Ù   ˇ   ˇ   ˇ   ˇˇ∂∂∂ˇ’’’ˇ			ˇ   ˇ   ˇ   ˇ   ˇ   Ù   #       °   ˇ   ˇ   ˇ   ˇ   ˇ111ˇDDDˇ   ˇ   ˇ   ˇ   ˇ   ˇ   °              ‚   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ‚                  8   ‡   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ‡   8                           †   Ú   ˇ   ˇ   ˇ   ˇ   Ú   †                                       $   ]   ∫   ∫   ]   $                                                                                                                                                                                                                                                                                    (       @                                                                               ,   U   Å   Ë   Ë   Å   U   ,                                                                                      *   Ö   “   ˘   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˘   “   Ö   *                                                                      ñ   Û   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   Û   ñ                                                          Q   ·   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ·   Q                                               r   ˚   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˚   r                                       r   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   r                               O   ˚   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˚   O                          ‰   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   „                      ó   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ó               (   ı   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   Ù   '           Ü   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ888ˇãããˇàààˇàààˇàààˇàààˇàààˇàààˇàààˇàààˇàààˇàààˇàààˇàààˇâââˇ___ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   Ü          ‘   ˇ   ˇ   ˇ   ˇ   ˇ   ˇˇÓÓÓˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇSSSˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ‘      +   ˙   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇhhhˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇÆÆÆˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˙   +   T   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇˇÀÀÀˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇÙÙÙˇ,,,ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   T   Ç   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇGGGˇ˝˝˝ˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇçççˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   Å   È   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ≠≠≠ˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇ‰‰‰ˇˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   È   È   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ+++ˇÛÛÛˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇjjjˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   È   Å   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇãããˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇÃÃÃˇˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   Ç   T   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇˇ„„„ˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇ˝˝˝ˇIIIˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   T   +   ˙   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇhhhˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇØØØˇˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˙   +      ‘   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇˇÀÀÀˇˇˇˇˇˇˇˇˇÙÙÙˇ,,,ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ‘          Ü   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇGGGˇ˝˝˝ˇˇˇˇˇçççˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   Ü           '   Ù   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ±±±ˇÏÏÏˇˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ı   (               ó   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ333ˇ___ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ó                      „   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ‰                          O   ˚   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˚   O                               r   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   r                                       r   ˚   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˚   r                                               Q   ·   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ·   Q                                                          ñ   Û   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   Û   ñ                                                                      *   Ö   “   ˘   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˘   “   Ö   *                                                                                      ,   U   Å   Ë   Ë   Å   U   ,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               (   0   `           -                                                                                             	   (   L   j   ≥   ¯   ˜   ≥   j   K   (   	                                                                                                                                          V   †   ÿ   ¯   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ¯   ÿ   †   U                                                                                                                      %   ã   ·   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ·   ã   &                                                                                                      ã   Ô   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   Ô   ã                                                                                          Q   ‹   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ‹   R                                                                              ä   ˛   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˛   ä                                                                     ≠   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ≠                                                             ∏   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ∏                                                     Æ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   Æ                                              ä   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ä                                       P   ˝   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˝   O                                  ﬂ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ﬂ                              ã   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ã                       #   Ò   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   Ò   #                   å   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ã                  ‰   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ$$$ˇhhhˇeeeˇeeeˇeeeˇeeeˇeeeˇeeeˇeeeˇeeeˇeeeˇeeeˇeeeˇeeeˇeeeˇeeeˇeeeˇeeeˇeeeˇeeeˇeeeˇeeeˇeeeˇPPPˇˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ‰              U   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇˇÎÎÎˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇsssˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   U           °   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇeeeˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇÃÃÃˇˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   °       	   ⁄   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇˇ………ˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇ˝˝˝ˇHHHˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ⁄   	   (   ˘   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇEEEˇ¸¸¸ˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇÆÆÆˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ¯   (   K   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ™™™ˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇÙÙÙˇ,,,ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   L   j   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ)))ˇÚÚÚˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇåååˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   j   ¥   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇàààˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇ„„„ˇˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ≥   ¯   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇˇ···ˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇiiiˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ¯   ¯   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇeeeˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇÀÀÀˇˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ¯   ≥   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇˇ………ˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇ˝˝˝ˇHHHˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ¥   j   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇEEEˇ¸¸¸ˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇÆÆÆˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   j   L   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ™™™ˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇÙÙÙˇ,,,ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   K   (   ¯   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ)))ˇÚÚÚˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇåååˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˘   (   	   ⁄   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇàààˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇ„„„ˇˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ⁄   	       °   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇˇ···ˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇiiiˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   °           U   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇeeeˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇÃÃÃˇˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   U              ‰   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇˇ………ˇˇˇˇˇˇˇˇˇ˝˝˝ˇHHHˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ‰                  ã   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇEEEˇ¸¸¸ˇˇˇˇˇÆÆÆˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   å                   #   Ò   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ¨¨¨ˇ˚˚˚ˇ,,,ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   Ò   #                       ã   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ222ˇ}}}ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ã                              ﬂ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ﬂ                                  O   ˝   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˝   P                                       ä   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ä                                              Æ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   Æ                                                     ∏   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ∏                                                             ≠   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ≠                                                                     ä   ˛   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˛   ä                                                                              R   ‹   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ‹   Q                                                                                          ã   Ô   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   Ô   ã                                                                                                      &   ã   ·   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ·   ã   %                                                                                                                      U   †   ÿ   ¯   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ¯   ÿ   †   V                                                                                                                                          	   (   K   j   ≥   ˜   ¯   ≥   j   L   (   	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        âPNG

   IHDR         \r®f   sRGB ÆŒÈ   8eXIfMM *    ái            †       †           D"8s  IDATxÌ]	∞’ônî]<QVAñËƒh$	 Nåé13*àq∞¬d™ƒç©I°àòDìL2ì™(Œ(‘ò2÷ƒô—G	ã¡q_@Â±à‡Üäx»õÔª–èæè{o˜ΩΩù”˝˝Uﬂ{}ªOüÂ;Áˇ˚Ù˘œ9›¬ëdÅÅÆ(Dg†–8	ËÙN ∫]ÄÓ@†hx•?v ¿N‡3‡=`;6.&∞‡u‚‡  ±î6âPÅ©–ΩÄ¡@ˇ√†R” P˘iZq ^DN„‡Äwpºÿº–X–h–òHg@¿Ã
:Ÿ‚|5` p"@¿'º…≤ôs{Îp¸*2¿ﬁçÖƒ d “Øåñ»|(0¯
0 ‡ì>KÚ
≥xX¨6 IJ» §C|?$KENÿ}œì|ä¬Úµ·‡ˆh $	2 êŸ|/ß¬è . Nz í#ºè√WÄe¿
‡5Ä„íêàè‹∂à˙‡;¿y ïæ Òg‡s©h^  Iƒ» DL(¢;∏8†“HjgÄcH|x†1†ÀR"åaÄÔÙ”Åï G¡Ÿ@ÖË9`/`%0ËHƒ@jΩ~,∞†€K
ü,t).ŒËIëàÅDËÅT¶O˚)~∫∞VÏÅu$b Ë™õ–U%•7ìÉç®õ˘ _…$b 8AÁ◊¿Äﬂ¯Jˆ3` 510wQÒ?§¯vr—·:¸2˛Kƒ@ §¯v*{%#ÌÇAÅZÄÂíÅ^(ıœ=Ò≥g \„¿WÉ€çÄ…!:‡ﬂ,`‡6˝œ643Å:@íc.FŸü§˘‰Äu?–<êê'·›ÄÉÄî_‹èvp: …8Qæõ
IÒ≈Å∑p{3ŒÛ–kH»¢åG°ûºïÆcÒ—º<ç62&ã
ê◊2uC¡ˇ‡⁄ÚÊï≠ﬂ‚§T¯3⁄
ΩÍÄõÖ;Óºî™dù/~mÄΩ.¯íX∆@{‰w.∞´d]Gï⁄ {lK‹‡Ebúˇ˝(P©RuM¸T€Cõ“⁄√¿d‰Ô])øå_Lm‡=ƒ˚=@búÕ˜KÄ€GUkŸ^úU”ÿ∆ÿ÷¯ö)1ÄÅ»ªg’T¢¬äØ∞m`9⁄\⁄Æ≥¿Q˛Õ@ÿ ‘˝‚∞ñ6:⁄û’^õw¨ùÚÔ∏EóD§¡ Á	¸5∞‡∫ÎƒF–,ﬂ‹
X"“dÄm<ÄnB~ÚÏ@¥∏˜µt◊tèxãª¸;⁄fﬁ>Òì™ÌI8µàªø8”∏C1€™$B∏ïßeÜ©›+˛íjl´‹EZ√«& © S:‚:ä6∞mˆÎ¥ˇ\G1•Á`¢®≈!ìnlªl√∆ä…^ÄQ`Ì∑@OcŸS∆ƒ@e∏Õ∑∫πÁ§qb™pïˇ„SÜƒ@upö∫±F¿D@Âø–ìø∫Ü¶–Ê2@#¿π∆ıL3 £Aíî$H2« _hû∂FH#rq(ÌˇO‡DÉÚ§¨àÅ®‡runGOWaÍbä &ñSgDÒ3¿EDÁtoß*«§ö˙°ƒ9kä›~)øï°,$¬ xøRü1òv‡K ·¿9ÄD‰çÅU(wÆ&LE“‰Í©ªÄS)πÈ3–Y8x8 $.iÄ(ÌåƒK¨≈ÄYúéÏa»]≠ó¥¿4îÙ«Ä	câìÆ≈@3∏f‡ÄÛï4∆ ∆¢Ñˇ–/*b‡¸˛ «˛ò$!IÄ~áÿ7…B*-1`	o ü ∫	ë$ª‡«°DãÅæâîLâà˚‡Úﬂ ÍJ"í‰¿OQ¢À)ïˆ2@#–x4â"$e ®¯∑Iˆ8í‡OiàÅ8¯"› ºG‰ﬁ8[xƒt<Ò.¥¥7&Çm&ÿéRç^ã≥tq˜ ÿï·.æß≈Y≈-2» Ωdß ˚„*_‹‡&d|j\ôWºb „ÙG˘ˆ´‚*gúØ £ëÈáÅƒF4„"IÒäÅÿÉ¥/ b1qÄN»„¿YÄDàÅpºå€9ÅÓ„p—}w\Ø Ûë‘§£ì”1 j`ÄËO˚üÓ≠xK=Ä—HÒ˜ ˜Aìà1ü#æ
D:U8j¿ı˝t˘©Î$b bûA||ÿUºQø¸26%™Ã)1 äËÖ_¿Í¢≥!~DŸ‡∫Êï ø‡+b >A¥‹:]—E$à£50êÚGDhR—tË–¡È›ªwR…)ùP« ëËn$ë 3‹÷Î@bSßNuñ,Y‚¥j’ ≤úÁ:ª°Ù‹;¿·¿ﬂÛ@£`«|„ñ-[)ì'OV˝Ÿ’Ü©sFx⁄Æì‚€•¯n}Õõ7Ø†¸¸≥~˝˙∆∫∫:ªå¿Qó©J_§ŒUKj8ñq0x‡∆;v4 Ãû=[ıhW=æ	›Î	§&∑!e5À8h—¢E„›wﬂ]§¸¸Ò·á6ˆÔﬂ_ıiW}˛SZ⁄?	ø/`ü;vl„æ}˚é2 <±h—" ª¿ß–AÓπë∏‹Å’X,„†m€∂ç+V¨(©¸<πwÔﬁ∆#F®^Ì™◊;ì÷˛aHc ˚‡î)S *ø{a˘ÚÂçp ÿc89(—^Äû˛ˆ4é&E¶€o√ÜÆûW¸/∑†u∆=±^Äû˛*?{k^∑_EÌ«≈˙˙zπÌ™gˆÜ UI-ãÅË{WU*
ú:p˚9.t⁄∑o(/›∫us>˚Ï3Áâ'û^ÅRgÄﬂ‰⁄ûG‚ÃI_DÆëªûçÂ‹~~Ω π≠{¯˙Ÿ?N0ë7ΩSÍÿ.∆ç◊∏ˇ~?}/y]nA;Íÿ£ã≥„2 ]ÒFOB2C?∑_I≠˜úî[–:∞:⁄=#¿OzKÈ-„ à€œ£Ô%Â¥Æ›?j–˛I¿ÆÜPç€Ø§Ê{N -hU›ˇtï:ôúÉò¯Åı ,‚†∑üG◊K -hU€Á¢cÉhP7 ˇŒ°¬ò¡@µn?ø\”-∏k◊.π˝à2„:ı˙ `Ÿ·FÑ€=˝-·†V∑_…GøÁ§‹ÇVÈ ›ı}¢0 WI˘≠™¯F∫˝ ≠ˆÛËsMárZ’8pJ∏Q‹*@OK8ÎˆÛ≥
rZ•‘›ña, ﬂ˚wÀ ÿSÈW^y•üáæ.∑†5Ìat7‘ÿ›è§¸÷Tv#›~7n≠‡A"∏¸ÚÀ’+¥£W¯ËpM¬≈/™hK8à“ÌÁg‰¥F/^Ñ∑´≈å¿M{e Ï®ËRõ|˙)qÿÎ7›tìÊ?8'‡µÄK˘ÌP~∫˝ÓπÁû∞˙\ı˝r⁄—>†«∑Uk ÿeP˜ﬂ|Î^x«ÈˆÛ≥
ã/V/¿¸vÚÙôØÙÅÂÑ‰¢*◊p‚v˚˘ π≠–æ ü]J˚À}êÛàk8(ïàŒ≈«¿ƒâù—£G«óÄOÃm⁄¥q,X†o˙îÚe.‚ò^ °Qx–”ﬂpít˚˘ı‰4^_ÉNó{‡Üæ¯≈yƒ2 Üsê§€œœ –-ÿπsgµs€Ã–iÍvëîZ8
!~PJ?åcÄ´˝Ó∫ÎÆ¿õ|∆] Æ‹Ω{∑≥zıÍ∏ìR¸µ1pn„‘‡zÔÌ•∫ºtlp˚9≥fÕr∫vÌjTÊÆø˛zﬂ4*O L„ã~ï¯—Áû‘ï3òÉ4›~~Ør≠;‘mÍxYå+¸¿ÄÄ°§ÌˆÛ3 r≠;‘mÍxì4‡˜≈:7]’ÅqLö4)U∑ü!r˙1îÍuÍ6øÏ’$Õ¿7õÆË¿8∫wÔÓÃô3«∏|5œ>?Ó\zÈ•ÕOÎ∑úÎÕÜ◊ ¯,ÔEõ≈¿å3úÅöï©2ππÂñ[ú∫∫∫2Wu:EæÇ¥õº^p.H1cJ∫t˚]}ı’BòuÈ‘SOuÆ∫äª…IcÄOêû•Úƒ%É  ∆AZ´˝¸¸¸Ækµ†ë∫D?«5 ﬁ@Q◊¿†ˇÈ3¿wÍ+Æ∏"˝åTôŒS¿ûUﬁ•‡13¿Ó?˚‚5 M'›ã˙ü>p˚˛Zµjï~fj»◊àÅ◊°‘êÇn©ÅÅ¶±>◊ ˇi5D§[bf Ì’~aã'∑`Xcπü„ -º1Ûk¢õΩˇƒÅI´˝¸ﬁ˜˝Ækµ†Q∫≈Ø|ÛkﬂMÀÈ(92»@ít∞…ÌÁ«›ÇX-ËL◊ìaÄ˙N4Äìq‹û'$f0@∑@VÑnAõ‹òY·ΩL9:‚|/^s« ˙ó	®”)0`Íjø∞T\w›uZ-ñƒËÓ¬®\†	@—:¶±cÌt˚˘ú{»-Ë«Rb◊˚1%◊ ÙI,Y%Të€›~áãr˙1îÿı¬CüÄ,º$ñ¥*ÀÄÈ´˝ f<‡π0z˛é•Ëh’F¸Ñ˚¶ ∑ü´˝|‚ÄØ8Z-ËCR¸óπùTg◊ –HRfÄãglYÌñ™πsÁ -ñƒp˜”'+é√ËÓ∂mµ_ÿígÕÕñèÓÁCø{ Ù	Ú√íî»™€œèŒô3g -ËGR|◊π7`GÄﬁÒ•°òÉ0êU∑ü_ŸµZ–è°ÿØüD†)¿±Û\>Å¨ª˝ ó¸–π˝äız Nñ§ƒ@÷›~~¥ -Ë«P¨◊{rsÄø¥@¨<óéúõ|.]∫‘∏|îŒm|g˚ıÎÁ¨_øﬁyÂïW‚KD1ób‡MΩî¢%°s\ì∑ü•r˙1ÀınÏ\ñ∆íÑ"-… ›`.4Ê€~%3ô‡I}[0A≤è$µì= -“>BH"GÆ€èç^rÑ≠<¬EBG›i ⁄%îòí9Ã@^›~~@´˝ä¸˙1‹ÏÄÜ@í t˚-[∂ÃËœ{%@CŸ$mAg¸¯ÒŒö5k Ü—Ö»¯úä/ÂèåOˇàlﬂ‰”øÑ·B–@.X∞¿±u‰p•O¸Ó6úóx≤9MPnø`ﬂ∑o_ßææ^n¡`tÖ
•ß(˙™ªôÉ\r˚˘s∆A“yÛÊÈ€Ç˛TÖ°@h
ÉE0lÿ0ÁŒ;Ôt⁄µ”òk∆∏N†°°¡YµjUê‡
S#Ï|^„Ω∫- |¢›p√Nó.Ö≠ÿﬁ•`◊^{≠zLÒ6ÉÉ4 üƒõÜbÁ®ˆeó]&"™dÄsŒú9Uﬁ•‡U0!¿¡*nP–*`óˇÊõo÷®vïºπ¡i8GçÂ˛‘ˇhh†ÿmúäÕÀ¿‰…ìùsœ=◊{J«U0¿’ÇÛÁœwZ∑Ê˛íà¯îÉÄÏõˆç8bEzÙË·,Y≤DÔ˛![Cü>}úç7:k◊Æìno∆¿fˆ >jvR?#bÄÉXà(∂¸F√ATæF’’iÛÍà[¡{Ï∞zvƒÁ>∫°Cá Ìa+ê[0B2èDµú=ÄÌG~Î(
¯ƒ∫Ò∆’ıèÇLO◊\sç‹Ç>"8|ã`[)
&Lp8¯'âñˆ‰åî”Ì4 oGeŒ#£€è¿lŸí_\ìDÕÄ‹Çë2Zÿl¢‹i¥9éåt‰»ë9f ﬁ¢À-øúºã=ÄùáYÃyçàn?uQ„Ø}XÕ¨ÕsAÔi >=å–1Ê=R…Ì+‡ +≠‹Ç°∏.2 öäKÏ´∑ﬂÙÈ”C∆¢€É20h– áÀ´%53¿5@ÖMAπ%ò¶◊Ã£„»ÌÇº∑j[ı‰9Œ;∏˚ _(Ø˙ßøµ0¿’~r˚’¬\∏{Ùm¡P¸‹ˇÆx#TT9æôn?æè ÌóN#†·ï◊•&Ó}◊ ¨Ø)
›TçVLØ!∏ﬂ‘j¡™Î`Ôp ﬂ8@Rr˚UAVåAÂ¨ö‹=∏„-ﬁÂÄ˜pLH™`@nø*»ä1®‹ÇUìÀı?}w ]ÏH2@∑ﬂ¥i”ÜV∞∏†[êÀØ%Å‡ÙˇÇÎﬂ5 ç8±)–≠
T`Äõ|rZbZ-∏.÷!da+@◊ ŒÁﬂûÛÄZÌgfê[0pΩºÊÜÙ û‰§ I¥…gr∏$∑†o%P«_rCy¿Vú|ﬂΩ†ˇ•‡"mÚYöŒ -Ë[ l⁄ƒk xA„ ¯ì€Ø9]¢[p“§IÂ»®¨pPì«œk ä∫FeŸêÃ»ÌgHE¯dÉnAm"Zñ$éı5}ÑõÇzÂ8¸êÈÙ2r¯Xõ|ñ ≈‡S‹ªwØ≥rÂJÉsôJ÷~ÅTõf˛z{ ÃÕ´ ˜êx–j?jµ‡QïE›nÚ js¿˘¡|Gêx–∑˝<dXt(∑‡QïE›.¨pØ47 ‹)˜¢˛;Öœysµ_´V≠DáÖ»-XTi‘Ì¢˝?õ Ü~ºËñúˇê€œÓ ∑`Q˝=VÙ?öÚ˙^‡
ÄÇπ∫˝ñ.]™|Xﬁ
Ùm¡B~Äø?ä∆¯Jı ﬁD†ó∑‰¸è‹~Ÿh rÍëÛˇ©€ER™¿ÖA›ÄÛäBÊÏ›~w‹qá”æ}˚úï<õ≈ï[–π5˚dÛ⁄-’`ò5 ?êKq›~l4íÏ0@∑‡)ßúíù/IÇÆ(ºú‡áÿã¸Ö•nŒÍ9π˝≤Y≥4Ëú!òCŸà2◊ó*w9¿Å¿GK›êısÓ&ür˚e≥¶s˙È∂?†6Ÿ8J  |(ÚuwO‰¥Åd∞&K)ánAæ ?Röç“n@7,∑∫8¡=ëıˇr˚eΩÜïèn¡Mõ69k◊ÚM7Û¬È˝∑Jï¥RÄ]Üe•n Í9π˝≤Z≥≈Â‚ /?·ûìo>å“Ûïæ§îrzr“¿ ÛÛ`ÂˆÛV{ˆèªuÎÊ4448´V≠ ra˜†p≥ ÓıQRZî<{‰dK.F9ïΩ#~T‚æ˚Ós.æ¯‚ÏN%*À ¿·√ùuÎ8G&ì≤•Ï/W:*x%·{√}@¶ ªÇlıııNc#ÁAIÚ¿¿±«õıiﬁ˜£À*?ÎÿØ¿0}ÄgÄ„˘C"ƒÄp€Ø≥Ääﬂ˚®4Ëñí“è(b¿8Ä_Q˘Yî Ä·Ór7'Äóà`∑ˇÓ ˘j ∏6‡Ö *å©3¿WˆgÉ‰"®‡l¢°¬à1ê:Ï±Sg}%» †	π•P?˜Ñ˛ã1`õê£Ø…Y– „‚é"ãÇD™0b@§∆ ›ˆÅîü9¨¶¿˝æ[t·âF1¿áÙp`k–\U”`ú‹R¯∑A#W81 e`)R€ZMä’ˆ ˜Ä[uÊâF0	rq.¿’Å•⁄ #^=C"ƒÄ9P'´R~fΩñ Ô
pnÄzdC"“e†¶ß?≥\KÄ˜Ω®@&$b }jz˙3€µˆ x/{Ëƒ1 RaÄ#ˇ|˜Á∆üUK≠= &ƒ^ÄÊTMπnë2¿9ˇ5)?s¶¿˚{O'ÛáDàÅD‡íﬂo [kM’oK0øxˇå ‹TdÇ_@]b rÊ ∆G√ƒ∂¿¥; ´ÄØÚáDàÅD‡Í‹1¿gaR€`⁄‹'`0à¬† â>\çÎ/˘ÑÒΩf–˘É¯Òê˜Ñé≈ÄàçÅﬂ!fn˜Z¢|büÜ‹U†.tÆÅÂ‡§ü—¿⁄r™9≈+Äõ˝ë≠Ä±Ó	˝b rnEåDkî= ÊÈ8‡è¿Ÿ¸!b RûCl„ÄPﬁEŸ`º‹åêKÜ'~ﬂ@â†À}*∞!`¯@¡¢6 LÙ†;¿ç	$b@D√¿?#ö»gﬁF˝
‡µVîà1év˝«;√EsÙ›Qπõ«Ã=…Æˆ4ø†ﬂb@T≈¿nÑ˛!πÚ3qº0^ VÄ„ c âµ1‹∂¥∂[˝ÔäÎ¿Mπ=8Ià›â’1@è⁄Ö@Cu∑∑`N∏o¿„ WJƒÄ∆ W˙—Â«e˜±IúØ n¶πN‡m‡ØÄ∏∆‹¥Ù_dÅÅ(ƒ4`E‹ÖI¬ ∞Øú"ÃµÀ1 *3+\˛EÂ —\M‚¿Õ)g	r¡ê¶
ªåËø8ö>ıøpÙ?vI“ ∞0Ä«Ä~¸!b†àÅ≠¯≈$'”%"IøìøéR˝¿iç1 é0∞á? S~&ù‘ ”rÖ‰í∆Ä§{ nÙ_òƒ¿»ÃL‡?íŒTÄe‰‘∆é¿7˘C"rŒ¿OQ~"qIÀ ∞†O 8ù?$b ß‹ãrˇ#@◊_‚ívºJÃôÇ£/πÈ3'd·/Å»÷˜W[§§õÁo'N¸lÛ˙-2Œ €¸Â@j O~”Ó0îÅ¿2` Hƒ@∆ÿÑÚù–+ñ™§›pOBÆ ﬁuOËø»(l„SÄ‘ïü¸¶9»ÙΩÚ~cﬂ:x/ËXdÑ.˘∞∆îÚòd »…V‡y@F $H2≈ ïüÔ¸+M*ïiÄ‹l8O@F $H2¡ ïüÂÆ2≠4& r¥PO¿¥÷¢¸‘¬Ä˚‰7N˘YS Û∂†¯¿YÉ1`„;ˇJS3n≤ g[Å'Åë@W@"la`32 n?'˚HB2p
ÓhƒÅmÄmu âêÅì◊j@F@ò‹V†ç≤≠Z!¶øxI‰î…ˇHÆyô—±)¸˘>¿ÂZ!6 ∫‡îaŒ`‰˛Ç¶ÃdDV$9fÄÎ˘	pMø6ªI®!LG:\LdrwPyÀ~˝P·ß%‘ÊïL3∆·7ÁTK—ƒAmÄmo|≥6©ü	3–È-“h J3øº?é67 ·∂yr∂çî"Ä˚˛‡g»Œ4. $±1¿˜˝_º[*ä∏&∏§òS/ıdq¥ŒÏ„‰â¡Cﬁ‚h ä3øº>ä6≈∂%±ÄÅ∂»„\Ä#¥RZq¶=lK|≈îX∆¿X‰WSàe j5 /°˝–”$±òÅ:‰˝v@ΩÇ†ÜÄŒ8–◊êdÑÅ1(áz2~F‡)¥˘ˆ3¢ÙÕã¡ﬁ¿lÄÆCøÜ†Î˘‚Ë#¥âõÌ=≤.\Lt? %— N$9b†% :‡˛É2˘‰Äu	 …1|-ò	ldÚ¡˜úút $b†¿@?¸•∑@Ü ªF‡c‘ÔœÅ^ÄDîdÄ[9˝‡†êzŸ‡Ääœ:
Hƒ@ æåP2v )~†¶Æ@ï‡¸Ôüz5∞«|Ä˙“øR´÷µ™‡¡|`#†W39ÿÇ∫·<Ó"-±0¿Ô\<Ïd“ÂÄu¿oGLz 1êúGp∞‡óçeíÂÄØdã .¯jHƒ@jÙF 3Äï@ c{s<ˇ˘J&	…@ãê˜Îˆb∏Ÿ¿wÅã  ≤ß ©ùn¡µ‡vú≤˚< âàÄàà,M;ú˚*p>p!0hH¸‡{=ïûª¸x‡]Iƒ» DLhôË⁄‚<'°åh8«@V ¡#Ô„òJˇ∞‡f˚ Iå» ƒHnÖ®˚„Wü}‡N∆t[uÚ$ü¢∞õÅßÅÂ ˛@í 2 	í]&)éÜ #Ä3àìÅ,	=%ØTÙ’¿k¿&‡  IâÄîà˜I∂Æ”≥ Ÿ[8	Ë	¥Lñ]»]tÔTgÅı¿6‡-@b2 UÜOV∫„: A?ÄØ} .iÓ|	‡xCú¬˜rvﬂw; Œ¿#Í>Èi 8_b82 ÜWPÄÏ—ıË Åé {'nØ·”8z;Ä∆§y›ésü ú√@•¶ºP°∑o|¬S˘ih $3ˇ@ﬂπjÏä·    IENDÆB`Ç```

### app/globals.css

```
@tailwind base;
@tailwind components;
@tailwind utilities;




:root {
    --color-bg-dark: #361999;
    --color-bg-light: #78fff1;
}

* {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
}

/* Fix dla autouzupe≈Çniania - ciemne t≈Ço */
input:-webkit-autofill,
input:-webkit-autofill:hover,
input:-webkit-autofill:focus,
input:-webkit-autofill:active {
  -webkit-background-clip: text;
  -webkit-text-fill-color: #f0f9ff !important; /* text-sky-50 */
  box-shadow: 0 0 0px 1000px rgba(15, 23, 42, 0.7) inset !important; /* bg-slate-900/70 */
  transition: background-color 5000s ease-in-out 0s !important;
  caret-color: #f0f9ff !important;
}







@layer components {
  .btn {
    @apply inline-flex items-center justify-center gap-2 px-5 py-2.5 text-sm font-semibold
      rounded-full cursor-pointer select-none
      transition-all duration-150
      focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2;
  }

  .btn--primary {
    @apply text-white bg-gradient-to-b from-sky-500 to-sky-600
      shadow-[0_6px_14px_rgba(56,189,248,0.35)]
      focus-visible:ring-sky-400 focus-visible:ring-offset-slate-950;
  }

  .btn--primary:hover {
    @apply from-sky-400 to-sky-500 shadow-[0_8px_18px_rgba(56,189,248,0.45)] -translate-y-0.5;
  }

  .btn--primary:active {
    @apply from-sky-600 to-sky-700 shadow-[0_4px_10px_rgba(15,23,42,0.6)] translate-y-0;
  }

  .btn--secondary {
    @apply text-sky-100 border border-sky-500/70 bg-slate-900/60
      shadow-[0_4px_10px_rgba(15,23,42,0.7)]
      focus-visible:ring-sky-400 focus-visible:ring-offset-slate-950;
  }

  .btn--secondary:hover {
    @apply bg-slate-800/80 border-sky-300 shadow-[0_6px_14px_rgba(15,23,42,0.85)] -translate-y-0.5;
  }

  .btn--secondary:active {
    @apply bg-slate-900 border-sky-500 shadow-[0_3px_8px_rgba(15,23,42,0.8)] translate-y-0;
  }

  .btn__icon {
    @apply inline-flex h-5 w-5 items-center justify-center rounded-full border text-[10px];
  }

  .btn__icon--light {
    @apply border-sky-100/80 text-sky-50 bg-sky-900/40;
  }

  .btn__icon--dark {
    @apply border-sky-400/80 text-sky-100 bg-sky-900/40;
  }
}
```

### app/layout.tsx

```
import './globals.css'
import type { Metadata } from 'next'
import LoadGoogleMaps from '@/components/LoadGoogleMaps'
import { createSupabaseServer } from '@/lib/supabase/server'
import Navbar from '@/components/Navbar'

export const dynamic = 'force-dynamic'
export const revalidate = 0

export const metadata: Metadata = {
  title: 'elo-arena',
  description: 'Next.js + Supabase',
}

export default async function RootLayout({ children }: { children: React.ReactNode }) {
  const supabase = await createSupabaseServer()
  const { data: { user } } = await supabase.auth.getUser()

  let role: 'admin' | 'organizer' | 'user' | null = null

  if (user) {
    // 1) najpewniejsze: rpc('is_admin')
    const { data: isAdmin, error: rpcError } = await supabase.rpc('is_admin')

    if (!rpcError && typeof isAdmin === 'boolean') {
      // Je≈õli rpc zwr√≥ci≈Ço true - admin, je≈õli false - musimy sprawdziƒá czy organizer czy user
      if (isAdmin) {
        role = 'admin'
      } else {
        // Sprawdzamy bezpo≈õrednio w profiles, czy u≈ºytkownik jest organizatorem
        const { data: profile, error: profError } = await supabase
          .from('profiles')
          .select('role')
          .eq('id', user.id)
          .maybeSingle()

        if (profError) {
          console.error('[auth] profiles select error:', profError)
        }
        
        // Ustawiamy rolƒô: admin ju≈º obs≈Çu≈ºony, sprawdzamy organizer, domy≈õlnie user
        role = profile?.role === 'organizer' ? 'organizer' : 'user'
      }
    } else {
      // 2) fallback: czytaj role bezpo≈õrednio z profiles
      const { data: profile, error: profError } = await supabase
        .from('profiles')
        .select('role')
        .eq('id', user.id)
        .maybeSingle()

      if (profError) {
        console.error('[auth] profiles select error:', profError)
      }
      
      // Uwzglƒôdniamy wszystkie trzy role
      if (profile?.role === 'admin') {
        role = 'admin'
      } else if (profile?.role === 'organizer') {
        role = 'organizer'
      } else {
        role = 'user'
      }
    }
  }

  // Tymczasowy log diagnostyczny ‚Äì usu≈Ñ po potwierdzeniu
  console.log('[auth]', { id: user?.id, email: user?.email, role })

  return (
    <html lang="pl">
      {/* DODAJ GRADIENT TUTAJ - zmodyfikuj klasƒô body */}
      <body className="min-h-dvh antialiased bg-gradient-to-br from-blue-900 via-blue-800 to-blue-700">
        <Navbar user={user ? { id: user.id, email: user.email } : null} role={role} />
        {children}
        <LoadGoogleMaps />
      </body>
    </html>
  )
}```

### app/mapa/page.tsx

```
// app/mapa/page.tsx
'use client'

import 'leaflet/dist/leaflet.css' // ‚úÖ DODAJ TO (statycznie, top-level)

import { useEffect, useState, useRef, useCallback } from 'react'
import { GeoJsonObject } from 'geojson'
import { supabase } from '@/lib/supabase/client'
import {
  MapPin,
  Filter,
  ZoomIn,
  ZoomOut,
  Navigation,
  RefreshCw,
} from 'lucide-react'

// Typy
type Miejsce = {
  id: string
  nazwa: string
  miasto: string
  wojewodztwo: string | null
  adres: string | null
  latitude: number | null
  longitude: number | null
  opis?: string | null
  liczba_turniejow?: number
}

// Proste granice Polski jako fallback
const SIMPLE_POLAND_BORDER: [number, number][] = [
  [54.835, 14.25],
  [54.453, 18.0],
  [54.366, 22.5],
  [52.167, 23.2],
  [50.334, 24.15],
  [49.0, 22.9],
  [49.0, 17.0],
  [49.0, 15.0],
  [51.0, 14.0],
  [54.835, 14.25],
]

export default function MapaPage() {
  const [loading, setLoading] = useState(true)
  const [loadingMiejsca, setLoadingMiejsca] = useState(true)
  const [error, setError] = useState<string | null>(null)
  const [miejsca, setMiejsca] = useState<Miejsce[]>([])
  const [selectedWojewodztwo, setSelectedWojewodztwo] = useState<string | null>(
    null
  )

  const mapContainerRef = useRef<HTMLDivElement>(null)
  const mapRef = useRef<any>(null)
  const geoJsonLayerRef = useRef<any>(null)
  const markersRef = useRef<any[]>([])
  const leafletRef = useRef<any>(null)

  const defaultCenter: [number, number] = [52.0, 19.0]
  const defaultZoom = 6

  // Pobierz miejsca turniej√≥w z Supabase
  const fetchMiejsca = useCallback(async () => {
    try {
      setLoadingMiejsca(true)

      const { data, error } = await supabase
        .from('miejsce_turnieju')
        .select(
          `
          *,
          turniej (id)
        `
        )
        .not('latitude', 'is', null)
        .not('longitude', 'is', null)
        .order('miasto', { ascending: true })

      if (error) throw error

      const miejscaZTurniejami = (data || []).map((miejsce) => ({
        ...miejsce,
        liczba_turniejow: Array.isArray((miejsce as any).turniej)
          ? (miejsce as any).turniej.length
          : 0,
      }))

      setMiejsca(miejscaZTurniejami)
    } catch (err: any) {
      console.error('‚ùå B≈ÇƒÖd pobierania miejsc:', err)
      setError(
        `B≈ÇƒÖd pobierania danych miejsc: ${err.message || 'Nieznany b≈ÇƒÖd'}`
      )
    } finally {
      setLoadingMiejsca(false)
    }
  }, [])

  // Dodaj markery miejsc do mapy
  const addMarkersToMap = useCallback(
    (miejsca: Miejsce[], map: any, L: any) => {
      if (!map || !L) return

      // Wyczy≈õƒá stare markery
      markersRef.current.forEach((marker) => {
        marker.remove()
      })
      markersRef.current = []

      if (miejsca.length === 0) return

      miejsca.forEach((miejsce) => {
        if (!miejsce.latitude || !miejsce.longitude) return

        const marker = L.marker([miejsce.latitude, miejsce.longitude], {
          icon: L.icon({
            iconUrl:
              'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png',
            iconRetinaUrl:
              'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x.png',
            shadowUrl:
              'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png',
            iconSize: [30, 46],
            iconAnchor: [15, 46],
            popupAnchor: [0, -46],
          }),
          title: `${miejsce.nazwa}`,
        })

        // Tre≈õƒá popupu
        const popupContent = `
        <div class="p-4 min-w-[300px] bg-slate-800 border border-slate-700 rounded-xl shadow-xl">
          <h3 class="font-bold text-lg text-white mb-3">${miejsce.nazwa}</h3>
          <div class="space-y-3">
            <div class="flex items-start">
              <div class="rounded-lg bg-slate-700 p-2 mr-3">
                <svg class="w-4 h-4 text-sky-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
                </svg>
              </div>
              <div>
                <div class="font-medium text-sky-100">${miejsce.miasto}</div>
                ${
                  miejsce.wojewodztwo
                    ? `<div class="text-sm text-slate-300">${miejsce.wojewodztwo}</div>`
                    : ''
                }
              </div>
            </div>
            ${
              miejsce.adres
                ? `
              <div class="flex items-start pt-3 border-t border-slate-700">
                <div class="rounded-lg bg-slate-700 p-2 mr-3">
                  <svg class="w-4 h-4 text-emerald-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/>
                  </svg>
                </div>
                <div class="text-sm text-slate-300">${miejsce.adres}</div>
              </div>
            `
                : ''
            }
            <div class="flex items-center justify-between pt-3 border-t border-slate-700">
              <div class="flex items-center">
                <div class="rounded-lg bg-slate-700 p-2 mr-3">
                  <svg class="w-4 h-4 text-amber-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"/>
                  </svg>
                </div>
                <div>
                  <div class="text-lg font-bold text-amber-300">${
                    miejsce.liczba_turniejow || 0
                  }</div>
                  <div class="text-xs text-slate-400">turniej√≥w</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      `

        marker.bindPopup(popupContent)
        marker.addTo(map)
        markersRef.current.push(marker)
      })
    },
    []
  )

  // Za≈Çaduj granice Polski
  const loadPolandBorders = useCallback((map: any, L: any) => {
    if (!map || !L) return

    fetch('/data/poland/poland.geojson')
      .then((response) => {
        if (!response.ok) {
          throw new Error(`HTTP ${response.status}: ${response.statusText}`)
        }
        return response.json()
      })
      .then((data) => {
        const geoJsonData = data as GeoJsonObject

        if (geoJsonLayerRef.current) {
          map.removeLayer(geoJsonLayerRef.current)
        }

        geoJsonLayerRef.current = L.geoJSON(geoJsonData, {
          style: {
            fillColor: 'transparent',
            color: '#0000ff',
            weight: 5,
            opacity: 0.7,
            fillOpacity: 0.1,
          },
        }).addTo(map)
      })
      .catch(() => {
        L.polygon(SIMPLE_POLAND_BORDER, {
          fillColor: 'transparent',
          color: '#38bdf8',
          weight: 5,
          opacity: 0.8,
          fillOpacity: 0.1,
        }).addTo(map)
      })
  }, [])

  // Inicjalizacja mapy - tylko po stronie klienta
  useEffect(() => {
    if (typeof window === 'undefined' || !mapContainerRef.current || mapRef.current) {
      return
    }

    const initMap = async () => {
      try {
        setLoading(true)

        // Dynamiczny import Leaflet tylko po stronie klienta
        const L = await import('leaflet')

        // ‚ùå USUNIƒòTE:
        // import('leaflet/dist/leaflet.css')
        //   .catch((err) => console.warn('B≈ÇƒÖd ≈Çadowania CSS Leaflet:', err))

        leafletRef.current = L

        // Utw√≥rz mapƒô
        const map = L.map(mapContainerRef.current!).setView(defaultCenter, defaultZoom)
        mapRef.current = map

        // Dodaj warstwƒô OpenStreetMap
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
          attribution:
            '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
          maxZoom: 19,
        }).addTo(map)

        // Za≈Çaduj granice Polski
        loadPolandBorders(map, L)

        // Pobierz miejsca turniej√≥w
        await fetchMiejsca()

        setLoading(false)
      } catch (err: any) {
        console.error('‚ùå B≈ÇƒÖd inicjalizacji mapy:', err)
        setError(`B≈ÇƒÖd tworzenia mapy: ${err.message || 'Nieznany b≈ÇƒÖd'}`)
        setLoading(false)
      }
    }

    initMap()

    // Cleanup
    return () => {
      if (mapRef.current) {
        mapRef.current.remove()
        mapRef.current = null
        geoJsonLayerRef.current = null
        markersRef.current = []
        leafletRef.current = null
      }
    }
  }, [fetchMiejsca, loadPolandBorders])

  // Dodaj markery gdy zostanƒÖ za≈Çadowane miejsca i mapa jest gotowa
  useEffect(() => {
    if (mapRef.current && leafletRef.current && miejsca.length > 0) {
      addMarkersToMap(miejsca, mapRef.current, leafletRef.current)
    }
  }, [miejsca, addMarkersToMap])

  // Filtruj miejsca po wojew√≥dztwie
  const wojewodztwa = Array.from(
    new Set(miejsca.map((m) => m.wojewodztwo).filter(Boolean))
  )
  const filteredMiejsca = selectedWojewodztwo
    ? miejsca.filter((m) => m.wojewodztwo === selectedWojewodztwo)
    : miejsca

  // Kontrolki mapy
  const resetMapView = () => {
    if (mapRef.current) {
      mapRef.current.setView(defaultCenter, defaultZoom)
      setSelectedWojewodztwo(null)

      markersRef.current.forEach((marker) => {
        marker.closePopup()
      })
    }
  }

  const showAllPlaces = () => {
    if (mapRef.current && miejsca.length > 0) {
      const bounds = leafletRef.current?.latLngBounds(
        miejsca
          .filter((m) => m.latitude && m.longitude)
          .map((m) => [m.latitude!, m.longitude!] as [number, number])
      )

      if (bounds && bounds.isValid()) {
        mapRef.current.fitBounds(bounds, { padding: [50, 50] })
      }
    }
  }

  const zoomIn = () => {
    if (mapRef.current) {
      mapRef.current.zoomIn()
    }
  }

  const zoomOut = () => {
    if (mapRef.current) {
      mapRef.current.zoomOut()
    }
  }

  const handleWojewodztwoSelect = (wojewodztwo: string | null) => {
    setSelectedWojewodztwo(wojewodztwo)

    if (!mapRef.current || !leafletRef.current) return

    const L = leafletRef.current

    if (wojewodztwo) {
      const miejscaWoj = miejsca.filter((m) => m.wojewodztwo === wojewodztwo)

      // Zaktualizuj widoczno≈õƒá marker√≥w
      markersRef.current.forEach((marker) => {
        const latLng = marker.getLatLng()
        const isVisible = miejscaWoj.some(
          (m) => m.latitude === latLng.lat && m.longitude === latLng.lng
        )

        if (isVisible) {
          marker.setOpacity(1)
          marker.setZIndexOffset(1000)
        } else {
          marker.setOpacity(0.3)
          marker.setZIndexOffset(0)
        }
      })

      if (miejscaWoj.length > 0) {
        const bounds = L.latLngBounds(
          miejscaWoj
            .filter((m) => m.latitude && m.longitude)
            .map((m) => [m.latitude!, m.longitude!] as [number, number])
        )

        if (bounds.isValid()) {
          mapRef.current.fitBounds(bounds, { padding: [50, 50] })
        }
      }
    } else {
      // Poka≈º wszystkie markery
      markersRef.current.forEach((marker) => {
        marker.setOpacity(1)
        marker.setZIndexOffset(0)
      })
    }
  }

  return (
    <div className="py-8 px-4">
      <main className="flex min-h-[calc(100vh-4rem)] items-start justify-center px-4 py-4">
        <div className="w-full max-w-7xl">
          <div className="rounded-2xl bg-slate-800/95 border border-slate-700 shadow-[0_14px_40px_rgba(0,0,0,0.8)] p-8">
            <div className="mb-8 text-center">
              <h1 className="text-4xl font-bold text-sky-50 mb-2 flex items-center justify-center gap-3">
                <MapPin className="h-8 w-8" />
                Mapa miejsc turniej√≥w
              </h1>
            </div>

```

### app/onboarding/page.tsx

```
// elo-arena/app/onboarding/page.tsx
import { createSupabaseServer } from '@/lib/supabase/server'
import { redirect } from 'next/navigation'
import UsernameForm from './username-form'

export default async function OnboardingPage() {
  const supabase = await createSupabaseServer()
  const { data: { user } } = await supabase.auth.getUser()
  if (!user) redirect('/auth/signin')

  const { data: profile } = await supabase
    .from('profiles')
    .select('username')
    .eq('id', user.id)
    .single()

  if (profile?.username) redirect('/')

  return (
    <main className="mx-auto max-w-md p-6">
      <h1 className="text-2xl font-semibold mb-4">Ustaw sw√≥j login</h1>
      <UsernameForm />
    </main>
  )
}
```

### app/onboarding/username-form.tsx

```
// elo-arena/app/onboarding/username-form.tsx
'use client'

import { useState } from 'react'
import { supabase } from '@/lib/supabase/client'
import { useRouter } from 'next/navigation'

export default function UsernameForm() {
  const [username, setUsername] = useState('')
  const [err, setErr] = useState<string | null>(null)
  const [saving, setSaving] = useState(false)
  const router = useRouter()

  const save = async () => {
    setErr(null); setSaving(true)
    try {
      const clean = username.replace(/\s+/g,'').toLowerCase()
      if (clean.length < 3) { setErr('Login musi mieƒá co najmniej 3 znaki.'); setSaving(false); return }

      const { data: { user } } = await supabase.auth.getUser()
      if (!user) { setErr('Brak sesji. Zaloguj siƒô.'); setSaving(false); return }

      const { error } = await supabase
        .from('profiles')
        .update({ username: clean })
        .eq('id', user.id)

      // 23505 = duplicate key
      if (error && ((error as any).code === '23505' || (error.message||'').includes('duplicate'))) {
        setErr('Ten login jest ju≈º zajƒôty.'); setSaving(false); return
      }
      if (error) { setErr(error.message); setSaving(false); return }

      router.push('/')
    } catch (e:any) {
      setErr(e?.message ?? 'Nie uda≈Ço siƒô zapisaƒá loginu.')
    } finally {
      setSaving(false)
    }
  }

  return (
    <div className="space-y-3">
      <input
        className="w-full rounded border px-3 py-2"
        placeholder="np. michal123"
        value={username}
        onChange={e=>setUsername(e.target.value)}
      />
      {err && <p className="text-sm text-red-600">{err}</p>}
      <button onClick={save} className="rounded bg-black px-4 py-2 text-white disabled:opacity-50" disabled={saving}>
        {saving ? 'Zapisujƒô‚Ä¶' : 'Zapisz login'}
      </button>
    </div>
  )
}
```

### app/organizer/dashboard/page.tsx

```
// app/organizer/dashboard/page.tsx
import { createSupabaseServer } from '@/lib/supabase/server'
import { redirect } from 'next/navigation'
import { Trophy, MapPin, Calendar, Users } from 'lucide-react'

export default async function OrganizerDashboardPage() {
  const supabase = await createSupabaseServer()
  const { data: { user } } = await supabase.auth.getUser()
  
  if (!user) {
    redirect('/login')
  }

  const { data: profile } = await supabase
    .from('profiles')
    .select('role')
    .eq('id', user.id)
    .single()

  if (profile?.role !== 'organizer' && profile?.role !== 'admin') {
    redirect('/')
  }

  // Pobierz statystyki organizatora
  const [tournamentsResult, locationsResult] = await Promise.all([
    supabase
      .from('turniej')
      .select('*', { count: 'exact' })
      .eq('created_by', user.id),
    
    supabase
      .from('miejsce_turnieju')
      .select('*', { count: 'exact' })
      .eq('created_by', user.id)
  ])

  const tournamentCount = tournamentsResult.count || 0
  const locationCount = locationsResult.count || 0

  return (
    <div className="space-y-6">
      {/* Nag≈Ç√≥wek */}
      <div className="flex items-center justify-between">
        <div>
          <h1 className="text-2xl font-bold text-white">Dashboard Organizatora</h1>
          <p className="text-slate-400">
            Witaj w panelu zarzƒÖdzania turniejami i miejscami
          </p>
        </div>
        <div className="px-4 py-2 bg-emerald-900/30 border border-emerald-700/50 rounded-lg">
          <span className="text-emerald-300 font-medium">
            {profile?.role === 'admin' ? 'Administrator/Organizer' : 'Organizer'}
          </span>
        </div>
      </div>

      {/* Statystyki */}
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
        <div className="bg-slate-800/50 border border-slate-700 rounded-xl p-6">
          <div className="flex items-center justify-between">
            <div>
              <p className="text-sm text-slate-400">Moje turnieje</p>
              <p className="text-2xl font-bold text-white mt-2">{tournamentCount}</p>
            </div>
            <div className="p-3 bg-emerald-900/30 rounded-lg">
              <Trophy className="h-6 w-6 text-emerald-400" />
            </div>
          </div>
        </div>

        <div className="bg-slate-800/50 border border-slate-700 rounded-xl p-6">
          <div className="flex items-center justify-between">
            <div>
              <p className="text-sm text-slate-400">Moje miejsca</p>
              <p className="text-2xl font-bold text-white mt-2">{locationCount}</p>
            </div>
            <div className="p-3 bg-blue-900/30 rounded-lg">
              <MapPin className="h-6 w-6 text-blue-400" />
            </div>
          </div>
        </div>

        <div className="bg-slate-800/50 border border-slate-700 rounded-xl p-6">
          <div className="flex items-center justify-between">
            <div>
              <p className="text-sm text-slate-400">NadchodzƒÖce</p>
              <p className="text-2xl font-bold text-white mt-2">0</p>
            </div>
            <div className="p-3 bg-purple-900/30 rounded-lg">
              <Calendar className="h-6 w-6 text-purple-400" />
            </div>
          </div>
        </div>

        <div className="bg-slate-800/50 border border-slate-700 rounded-xl p-6">
          <div className="flex items-center justify-between">
            <div>
              <p className="text-sm text-slate-400">Zako≈Ñczone</p>
              <p className="text-2xl font-bold text-white mt-2">0</p>
            </div>
            <div className="p-3 bg-rose-900/30 rounded-lg">
              <Users className="h-6 w-6 text-rose-400" />
            </div>
          </div>
        </div>
      </div>

      {/* Szybkie akcje */}
      <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <div className="bg-slate-800/50 border border-slate-700 rounded-xl p-6">
          <h2 className="text-lg font-semibold text-white mb-4">Szybkie akcje</h2>
          <div className="space-y-3">
            <a
              href="/turniej/nowy"
              className="flex items-center justify-between p-4 bg-emerald-900/20 border border-emerald-800/30 rounded-lg hover:bg-emerald-900/30 transition"
            >
              <div className="flex items-center space-x-3">
                <div className="p-2 bg-emerald-900/40 rounded-lg">
                  <Trophy className="h-5 w-5 text-emerald-400" />
                </div>
                <div>
                  <p className="font-medium text-white">Utw√≥rz nowy turniej</p>
                  <p className="text-sm text-slate-400">Dodaj nowy turniej do systemu</p>
                </div>
              </div>
              <span className="text-emerald-400">‚Üí</span>
            </a>

            <a
              href="/miejsce/nowe"
              className="flex items-center justify-between p-4 bg-blue-900/20 border border-blue-800/30 rounded-lg hover:bg-blue-900/30 transition"
            >
              <div className="flex items-center space-x-3">
                <div className="p-2 bg-blue-900/40 rounded-lg">
                  <MapPin className="h-5 w-5 text-blue-400" />
                </div>
                <div>
                  <p className="font-medium text-white">Dodaj nowe miejsce</p>
                  <p className="text-sm text-slate-400">Zarejestruj nowe miejsce turniej√≥w</p>
                </div>
              </div>
              <span className="text-blue-400">‚Üí</span>
            </a>
          </div>
        </div>

        <div className="bg-slate-800/50 border border-slate-700 rounded-xl p-6">
          <h2 className="text-lg font-semibold text-white mb-4">Ostatnie turnieje</h2>
          <div className="space-y-3">
            {tournamentsResult.data && tournamentsResult.data.length > 0 ? (
              tournamentsResult.data.slice(0, 3).map((tournament) => (
                <div
                  key={tournament.id}
                  className="p-4 bg-slate-900/30 border border-slate-700 rounded-lg"
                >
                  <div className="flex justify-between items-start">
                    <div>
                      <p className="font-medium text-white">{tournament.nazwa}</p>
                      <p className="text-sm text-slate-400">
                        {tournament.data_turnieju 
                          ? new Date(tournament.data_turnieju).toLocaleDateString('pl-PL')
                          : 'Brak daty'
                        }
                      </p>
                    </div>
                    <span className="px-2 py-1 text-xs rounded-full bg-slate-700 text-slate-300">
                      {tournament.limit_graczy ? `${tournament.limit_graczy} os√≥b` : 'Bez limitu'}
                    </span>
                  </div>
                </div>
              ))
            ) : (
              <div className="p-4 bg-slate-900/30 border border-slate-700 rounded-lg text-center">
                <p className="text-slate-400">Brak utworzonych turniej√≥w</p>
                <a href="/turniej/nowy" className="text-emerald-400 hover:underline text-sm">
                  Utw√≥rz pierwszy turniej
                </a>
              </div>
            )}
          </div>
        </div>
      </div>
    </div>
  )
}```

### app/organizer/layout.tsx

```
// app/organizer/layout.tsx
import { createSupabaseServer } from '@/lib/supabase/server'
import { redirect } from 'next/navigation'
import OrganizerSidebar from '@/components/organizer/OrganizerSidebar'

export default async function OrganizerLayout({
  children,
}: {
  children: React.ReactNode
}) {
  const supabase = await createSupabaseServer()
  const { data: { user } } = await supabase.auth.getUser()
  
  if (!user) {
    redirect('/login')
  }

  // Pobierz rolƒô u≈ºytkownika
  const { data: profile } = await supabase
    .from('profiles')
    .select('role')
    .eq('id', user.id)
    .single()

  // Sprawd≈∫ uprawnienia - tylko organizer i admin
  if (profile?.role !== 'organizer' && profile?.role !== 'admin') {
    redirect('/')
  }

  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 flex">
      <OrganizerSidebar 
        user={{ id: user.id, email: user.email }} 
        role={profile?.role} 
      />
      
      {/* G≈Ç√≥wna zawarto≈õƒá z marginesem dla sidebaru */}
      <main className="flex-1 ml-64 min-h-screen">
        <div className="p-6">
          {children}
        </div>
      </main>
    </div>
  )
}```

### app/page.tsx

```
// app/page.tsx
import Link from 'next/link'
import { createSupabaseServer } from '@/lib/supabase/server'

export const dynamic = 'force-dynamic'
export const revalidate = 0

export default async function HomePage() {
  const supabase = await createSupabaseServer()
  
  // Pobierz najbli≈ºsze turnieje
  const { data: upcomingTournaments } = await supabase
    .from('turniej')
    .select('id, nazwa, data_turnieju, godzina_turnieju, limit_graczy')
    .gte('data_turnieju', new Date().toISOString().split('T')[0])
    .order('data_turnieju', { ascending: true })
    .limit(3)

  // Pobierz statystyki
  const [
    { count: tournamentsCount },
    { count: playersCount },
    { data: usersCount, error: usersError }
  ] = await Promise.all([
    supabase.from('turniej').select('*', { count: 'exact', head: true }),
    supabase.from('gracz').select('*', { count: 'exact', head: true }),
    supabase.rpc('get_users_count')
  ])

  // Obs≈Çuga b≈Çƒôd√≥w dla liczby u≈ºytkownik√≥w
  const totalUsers = usersError ? 0 : (usersCount || 0)

  return (
    <main className="flex flex-col min-h-[calc(100vh-4rem)]">
      {/* Hero Section */}
      <section className="flex-1 flex items-center justify-center px-4 py-12">
        <div className="w-full max-w-6xl text-center space-y-8">
          {/* Nag≈Ç√≥wek */}
          <div className="space-y-4">
            <h1 className="text-4xl md:text-6xl font-bold text-sky-50">
              Witaj w <span className="text-sky-400">ELO Arena</span>
            </h1>
            <p className="text-xl md:text-2xl text-slate-300 max-w-3xl mx-auto">
              Platforma do organizacji i ≈õledzenia turniej√≥w rankingowych
            </p>
          </div>

          {/* Statystyki */}
          <div className="grid grid-cols-1 md:grid-cols-3 gap-6 max-w-2xl mx-auto">
            <div className="rounded-2xl bg-slate-800/80 border border-slate-700 p-6 text-center">
              <div className="text-3xl font-bold text-sky-400">{tournamentsCount || 0}</div>
              <div className="text-sm text-slate-400 mt-2">Turniej√≥w</div>
            </div>
            <div className="rounded-2xl bg-slate-800/80 border border-slate-700 p-6 text-center">
              <div className="text-3xl font-bold text-sky-400">{playersCount || 0}</div>
              <div className="text-sm text-slate-400 mt-2">Graczy</div>
            </div>
            <div className="rounded-2xl bg-slate-800/80 border border-slate-700 p-6 text-center">
              <div className="text-3xl font-bold text-sky-400">{totalUsers}</div>
              <div className="text-sm text-slate-400 mt-2">U≈ºytkownik√≥w</div>
            </div>
          </div>

          {/* Przyciski akcji */}
          <div className="flex flex-col sm:flex-row gap-4 justify-center items-center pt-8">
            <Link
              href="/turniej"
              className="inline-flex items-center gap-2 rounded-full bg-gradient-to-r from-sky-500 to-sky-600 px-8 py-4 text-lg font-semibold text-white shadow-[0_10px_25px_rgba(15,23,42,0.9)] transition hover:from-sky-400 hover:to-sky-500 hover:shadow-[0_14px_35px_rgba(15,23,42,1)]"
            >
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M8 6h13M8 12h13M8 18h13M3 6h.01M3 12h.01M3 18h.01"/>
              </svg>
              PrzeglƒÖdaj turnieje
            </Link>
            
            <Link
              href="/auth/signin"
              className="inline-flex items-center gap-2 rounded-full border border-slate-500 bg-slate-800/80 px-8 py-4 text-lg font-semibold text-sky-100 hover:bg-slate-700 hover:border-sky-400 transition"
            >
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4M10 17l5-5-5-5M13.5 12H3"/>
              </svg>
              Zaloguj siƒô
            </Link>
          </div>
        </div>
      </section>

      {/* NadchodzƒÖce turnieje */}
      {upcomingTournaments && upcomingTournaments.length > 0 && (
        <section className="px-4 py-12">
          <div className="w-full max-w-6xl mx-auto">
            <h2 className="text-2xl md:text-3xl font-bold text-sky-50 text-center mb-8">
              NadchodzƒÖce turnieje
            </h2>
            
            <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
              {upcomingTournaments.map((tournament) => (
                <Link
                  key={tournament.id}
                  href={`/turniej`}
                  className="group rounded-2xl bg-slate-800/80 border border-slate-700 p-6 hover:border-sky-400/70 hover:bg-slate-800 transition-all duration-300"
                >
                  <div className="space-y-3">
                    <h3 className="text-lg font-semibold text-sky-100 group-hover:text-sky-50">
                      {tournament.nazwa}
                    </h3>
                    
                    <div className="space-y-2 text-sm text-slate-300">
                      <div className="flex items-center gap-2">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                          <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                          <line x1="16" y1="2" x2="16" y2="6"/>
                          <line x1="8" y1="2" x2="8" y2="6"/>
                          <line x1="3" y1="10" x2="21" y2="10"/>
                        </svg>
                        <span>
                          {new Date(tournament.data_turnieju!).toLocaleDateString('pl-PL', {
                            weekday: 'long',
                            year: 'numeric',
                            month: 'long',
                            day: 'numeric'
                          })}
                        </span>
                      </div>
                      
                      {tournament.godzina_turnieju && (
                        <div className="flex items-center gap-2">
                          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                            <circle cx="12" cy="12" r="10"/>
                            <polyline points="12 6 12 12 16 14"/>
                          </svg>
                          <span>Godzina: {tournament.godzina_turnieju.slice(0, 5)}</span>
                        </div>
                      )}
                      
                      {tournament.limit_graczy && (
                        <div className="flex items-center gap-2">
                          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                            <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/>
                            <circle cx="9" cy="7" r="4"/>
                          </svg>
                          <span>Limit: {tournament.limit_graczy} graczy</span>
                        </div>
                      )}
                    </div>
                    
                    <div className="pt-2">
                      <span className="inline-flex items-center gap-1 text-sky-400 text-sm font-medium group-hover:gap-2 transition-all">
                        Zobacz szczeg√≥≈Çy
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                          <path d="M5 12h14M12 5l7 7-7 7"/>
                        </svg>
                      </span>
                    </div>
                  </div>
                </Link>
              ))}
            </div>
            
            <div className="text-center mt-8">
              <Link
                href="/turniej"
                className="inline-flex items-center gap-2 rounded-full border border-slate-500 bg-slate-800/80 px-6 py-3 text-sm font-semibold text-sky-100 hover:bg-slate-700 hover:border-sky-400 transition"
              >
                Zobacz wszystkie turnieje
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                  <path d="M5 12h14M12 5l7 7-7 7"/>
                </svg>
              </Link>
            </div>
          </div>
        </section>
      )}

      {/* Features Section */}
      <section className="px-4 py-12">
        <div className="w-full max-w-6xl mx-auto">
          <h2 className="text-2xl md:text-3xl font-bold text-sky-50 text-center mb-12">
            Dlaczego ELO Arena?
          </h2>
          
          <div className="grid grid-cols-1 md:grid-cols-3 gap-8">
            <div className="text-center space-y-4">
              <div className="inline-flex items-center justify-center w-16 h-16 rounded-2xl bg-sky-500/20 border border-sky-400/30">
                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                  <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/>
                  <circle cx="9" cy="7" r="4"/>
                </svg>
              </div>
              <h3 className="text-xl font-semibold text-sky-100">Ranking ELO</h3>
              <p className="text-slate-300">
                ≈öled≈∫ swoje postƒôpy w rankingach ELO i rywalizuj z innymi graczami
              </p>
            </div>
            
            <div className="text-center space-y-4">
              <div className="inline-flex items-center justify-center w-16 h-16 rounded-2xl bg-emerald-500/20 border border-emerald-400/30">
                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                  <path d="M8 6h13M8 12h13M8 18h13M3 6h.01M3 12h.01M3 18h.01"/>
                </svg>
              </div>
              <h3 className="text-xl font-semibold text-sky-100">≈Åatwa organizacja</h3>
              <p className="text-slate-300">
                Tw√≥rz i zarzƒÖdzaj turniejami w prosty i intuicyjny spos√≥b
              </p>
            </div>
            
            <div className="text-center space-y-4">
              <div className="inline-flex items-center justify-center w-16 h-16 rounded-2xl bg-amber-500/20 border border-amber-400/30">
                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                  <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                </svg>
              </div>
              <h3 className="text-xl font-semibold text-sky-100">Statystyki</h3>
              <p className="text-slate-300">
                Analizuj swoje wyniki i por√≥wnuj siƒô z innymi zawodnikami
              </p>
            </div>
          </div>
        </div>
      </section>
    </main>
  )
}```

### app/profile/page.tsx

```
// elo-arena/app/profile/page.tsx
import { redirect } from 'next/navigation'
import { createSupabaseServer } from '@/lib/supabase/server'

// Next 15+: searchParams jest Promisem
type SearchParams = Promise<Record<string, string | string[] | undefined>>

// Dok≈Çadnie te same warto≈õci, co w ENUM w bazie:
const VOIVODESHIPS = [
  'Dolno≈õlƒÖskie',
  'Kujawsko-Pomorskie',
  'Lubelskie',
  'Lubuskie',
  '≈Å√≥dzkie',
  'Ma≈Çopolskie',
  'Mazowieckie',
  'Opolskie',
  'Podkarpackie',
  'Podlaskie',
  'Pomorskie',
  '≈ölƒÖskie',
  '≈öwiƒôtokrzyskie',
  'Warmi≈Ñsko-Mazurskie',
  'Wielkopolskie',
  'Zachodniopomorskie',
] as const

export default async function ProfilePage({
  searchParams,
}: {
  searchParams: SearchParams
}) {
  const sp = await searchParams
  const ok = sp.ok === '1'
  const err = typeof sp.e === 'string' ? sp.e : undefined

  const supabase = await createSupabaseServer()
  const {
    data: { user },
  } = await supabase.auth.getUser()
  if (!user) redirect('/auth/signin')

  const { data: profile } = await supabase
    .from('profiles')
    .select(
      'username, first_name, last_name, birthdate, city, voivodeship, role, email'
    )
    .eq('id', user.id)
    .single()

  const bday = profile?.birthdate ? String(profile.birthdate).slice(0, 10) : ''

  const inputClass =
    'w-full rounded-lg border border-slate-600 bg-slate-900/70 px-3 py-2 ' +
    'text-sm text-sky-50 placeholder:text-slate-400 ' +
    'focus:border-sky-400 focus:outline-none focus:ring-1 focus:ring-sky-400'

  const selectClass =
    'w-full rounded-lg border border-slate-600 bg-slate-900/70 px-3 py-2 ' +
    'text-sm text-sky-50 focus:border-sky-400 focus:outline-none focus:ring-1 focus:ring-sky-400'

  const primaryBtn =
    'inline-flex items-center justify-center rounded-full bg-gradient-to-r ' +
    'from-sky-500 to-sky-600 px-4 py-2 text-sm font-semibold text-white ' +
    'shadow-[0_10px_25px_rgba(15,23,42,0.9)] transition ' +
    'hover:from-sky-400 hover:to-sky-500 hover:shadow-[0_14px_35px_rgba(15,23,42,1)] ' +
    'disabled:opacity-50 disabled:hover:shadow-none'

  const secondaryBtn =
    'inline-flex items-center justify-center rounded-full border border-slate-500 ' +
    'bg-slate-800/80 px-4 py-2 text-sm font-semibold text-sky-100 shadow-sm ' +
    'hover:bg-slate-700 hover:border-sky-400 transition'

  return (
    // Dodano ciemne t≈Ço gradientowe do ca≈Çej strony
    <div className="min-h-screen">
      <main className="flex min-h-[calc(100vh-4rem)] items-center justify-center px-4 py-8">
        {/* KARTA PROFILU */}
        <div className="w-full max-w-xl rounded-2xl bg-slate-800/95 border border-slate-700 shadow-[0_14px_40px_rgba(0,0,0,0.8)] p-6 space-y-5">
          <h1 className="text-2xl font-semibold text-sky-50 text-center">
            Tw√≥j profil
          </h1>

          {ok && (
            <div className="rounded-md border border-emerald-300/70 bg-emerald-900/30 px-3 py-2 text-sm text-emerald-200">
              Zapisano zmiany.
            </div>
          )}

          {err && (
            <div className="rounded-md border border-red-400/80 bg-red-900/40 px-3 py-2 text-sm text-red-100">
              {err === 'username_taken'
                ? 'Login zajƒôty.'
                : err === 'voiv_required'
                ? 'Wybierz wojew√≥dztwo.'
                : err === 'voiv_invalid'
                ? 'Nieprawid≈Çowa warto≈õƒá wojew√≥dztwa.'
                : 'Nie uda≈Ço siƒô zapisaƒá. Spr√≥buj ponownie.'}
            </div>
          )}

          <form action="/profile/update" method="post" className="space-y-4">
            <div>
              <label className="block text-sm font-medium text-sky-100">
                Login (username)
              </label>
              <input
                name="username"
                defaultValue={profile?.username ?? ''}
                className={inputClass}
                maxLength={32}
                placeholder="np. m_kowalski"
              />
              <p className="mt-1 text-xs text-slate-300/80">
                Musi byƒá unikalny.
              </p>
            </div>

            <div className="grid grid-cols-1 gap-4 sm:grid-cols-2">
              <div>
                <label className="block text-sm font-medium text-sky-100">
                  Imiƒô
                </label>
                <input
                  name="first_name"
                  defaultValue={profile?.first_name ?? ''}
                  className={inputClass}
                />
              </div>
              <div>
                <label className="block text-sm font-medium text-sky-100">
                  Nazwisko
                </label>
                <input
                  name="last_name"
                  defaultValue={profile?.last_name ?? ''}
                  className={inputClass}
                />
              </div>
            </div>

            <div>
              <label className="block text-sm font-medium text-sky-100">
                Data urodzenia
              </label>
              <input
                type="date"
                name="birthdate"
                defaultValue={bday}
                className={inputClass}
              />
            </div>

            <div className="grid grid-cols-1 gap-4 sm:grid-cols-2">
              <div>
                <label className="block text-sm font-medium text-sky-100">
                  Miasto
                </label>
                <input
                  name="city"
                  defaultValue={profile?.city ?? ''}
                  className={inputClass}
                />
              </div>

              <div>
                <label className="block text-sm font-medium text-sky-100">
                  Wojew√≥dztwo
                </label>
                <select
                  name="voivodeship"
                  defaultValue={profile?.voivodeship ?? ''}
                  className={selectClass}
                  required
                >
                  <option value="" disabled>
                    ‚Äî wybierz ‚Äî
                  </option>
                  {VOIVODESHIPS.map((v) => (
                    <option key={v} value={v}>
                      {v}
                    </option>
                  ))}
                </select>
              </div>
            </div>

            <div className="text-sm text-sky-100/80">
              <span className="opacity-70">Rola:</span>{' '}
              <span
                className={
                  profile?.role === 'admin'
                    ? 'font-semibold text-red-300'
                    : 'font-medium'
                }
              >
                {profile?.role ?? 'user'}
              </span>{' '}
              ‚Ä¢ <span className="opacity-70">Email:</span>{' '}
              {profile?.email ?? user.email}
            </div>

            <div className="flex flex-wrap gap-2 pt-2 justify-end">
              <button className={primaryBtn} type="submit">
                Zapisz zmiany
              </button>
              <a href="/" className={secondaryBtn}>
                Anuluj
              </a>
            </div>
          </form>
        </div>
      </main>
    </div>
  )
}```

### app/profile/update/route.ts

```
// elo-arena/app/profile/update/route.ts
import { NextRequest, NextResponse } from 'next/server'
import { createSupabaseServerMutable } from '@/lib/supabase/server-mutable'

// Ta lista musi byƒá identyczna jak warto≈õci ENUM w bazie:
const VOIVODESHIPS = [
  'Dolno≈õlƒÖskie','Kujawsko-Pomorskie','Lubelskie','Lubuskie','≈Å√≥dzkie','Ma≈Çopolskie',
  'Mazowieckie','Opolskie','Podkarpackie','Podlaskie','Pomorskie','≈ölƒÖskie',
  '≈öwiƒôtokrzyskie','Warmi≈Ñsko-Mazurskie','Wielkopolskie','Zachodniopomorskie',
] as const
type Voiv = typeof VOIVODESHIPS[number]

export async function POST(req: NextRequest) {
  const supabase = await createSupabaseServerMutable()
  const { data: { user } } = await supabase.auth.getUser()
  const origin = req.nextUrl.origin

  if (!user) {
    return NextResponse.redirect(new URL('/auth/signin', origin), { status: 303 })
  }

  const form = await req.formData()
  const username = String(form.get('username') || '').trim() || null
  const first_name = String(form.get('first_name') || '').trim() || null
  const last_name = String(form.get('last_name') || '').trim() || null
  const birthdateRaw = String(form.get('birthdate') || '')
  const city = String(form.get('city') || '').trim() || null

  // Wojew√≥dztwo: wymagane i tylko z listy
  const vRaw = String(form.get('voivodeship') || '')
  if (!vRaw) {
    return NextResponse.redirect(new URL('/profile?e=voiv_required', origin), { status: 303 })
  }
  const voivodeship = VOIVODESHIPS.includes(vRaw as Voiv) ? (vRaw as Voiv) : null
  if (!voivodeship) {
    return NextResponse.redirect(new URL('/profile?e=voiv_invalid', origin), { status: 303 })
  }

  const birthdate = birthdateRaw ? birthdateRaw : null // YYYY-MM-DD

  const updates: Record<string, any> = {
    username, first_name, last_name, birthdate, city, voivodeship,
  }

  const { error } = await supabase
    .from('profiles')
    .update(updates)
    .eq('id', user.id)

  if (error) {
    // 23505: unique_violation (np. username), 22P02: invalid input (ENUM), 23514: check_violation
    const code = (error as any).code
    const reason =
      code === '23505' ? 'username_taken' :
      code === '22P02' ? 'voiv_invalid' :
      code === '23514' ? 'voiv_invalid' :
      'save_failed'
    return NextResponse.redirect(new URL(`/profile?e=${reason}`, origin), { status: 303 })
  }

  return NextResponse.redirect(new URL('/profile?ok=1', origin), { status: 303 })
}
```

### app/turniej/create/route.ts

```
// elo-arena/app/turniej/create/route.ts
import { NextRequest, NextResponse } from 'next/server'
import { createSupabaseServerMutable } from '@/lib/supabase/server-mutable'

const urlRe = /^https?:\/\/\S+$/i
const sheetColRe = /^[A-Za-z]$/
const uuidRe = /^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i

// ‚úÖ Dozwolone warto≈õci ENUM (muszƒÖ siƒô zgadzaƒá z public.game_enum)
const ALLOWED_GAMES = new Set(['rummikub_standard', 'rummikub_twist', 'qwirkle'])

export async function POST(req: NextRequest) {
  const origin = req.nextUrl.origin
  const supabase = await createSupabaseServerMutable()

  const {
    data: { user },
  } = await supabase.auth.getUser()

  if (!user) return NextResponse.redirect(new URL('/auth/signin', origin), { status: 303 })

  const { data: isAdmin } = await supabase.rpc('is_admin')
  if (!isAdmin) return NextResponse.redirect(new URL('/', origin), { status: 303 })

  const fd = await req.formData()

  // Tournament data
  const nazwa = String(fd.get('nazwa') || '').trim()

  // ‚úÖ GRA / WARIANT
  const gra = String(fd.get('gra') || '').trim()

  const data_turnieju = String(fd.get('data_turnieju') || '').trim()
  const godzina_turnieju = String(fd.get('godzina_turnieju') || '').trim()
  const zakonczenie_turnieju = String(fd.get('zakonczenie_turnieju') || '').trim() || null

  const gsheet_url = String(fd.get('gsheet_url') || '').trim() || null
  const arkusz_nazwa = String(fd.get('arkusz_nazwa') || '').trim() || null

  const kolumna_nazwisk_raw = String(fd.get('kolumna_nazwisk') || '').trim()
  const kolumna_nazwisk = kolumna_nazwisk_raw ? kolumna_nazwisk_raw.toUpperCase() : null

  const pierwszy_wiersz_z_nazwiskiem_raw = fd.get('pierwszy_wiersz_z_nazwiskiem')
  const pierwszy_wiersz_z_nazwiskiem =
    pierwszy_wiersz_z_nazwiskiem_raw ? Number(pierwszy_wiersz_z_nazwiskiem_raw) : null

  const limit_graczy_raw = fd.get('limit_graczy')
  const limit_graczy = limit_graczy_raw ? Number(limit_graczy_raw) : null

  // Location ID
  const miejsce_id = String(fd.get('miejsce_id') || '').trim()

  console.log('Form data received:', {
    nazwa,
    gra,
    data_turnieju,
    godzina_turnieju,
    miejsce_id,
    wszystkieFields: Array.from(fd.keys()),
  })

  // ‚úÖ Validations
  if (!nazwa) {
    return NextResponse.redirect(new URL('/turniej/new?e=invalid_input', origin), { status: 303 })
  }

  // ‚úÖ gra required + must match enum values
  if (!gra || !ALLOWED_GAMES.has(gra)) {
    return NextResponse.redirect(new URL('/turniej/new?e=game_required', origin), { status: 303 })
  }

  if (!data_turnieju || !godzina_turnieju) {
    return NextResponse.redirect(new URL('/turniej/new?e=date_time_required', origin), { status: 303 })
  }

  if (!miejsce_id) {
    return NextResponse.redirect(new URL('/turniej/new?e=location_required', origin), { status: 303 })
  }

  if (!uuidRe.test(miejsce_id)) {
    return NextResponse.redirect(new URL('/turniej/new?e=invalid_location_id', origin), { status: 303 })
  }

  if (kolumna_nazwisk && !sheetColRe.test(kolumna_nazwisk)) {
    return NextResponse.redirect(new URL('/turniej/new?e=sheet_col_invalid', origin), { status: 303 })
  }

  if (
    pierwszy_wiersz_z_nazwiskiem !== null &&
    (!Number.isFinite(pierwszy_wiersz_z_nazwiskiem) || pierwszy_wiersz_z_nazwiskiem < 1)
  ) {
    return NextResponse.redirect(new URL('/turniej/new?e=number_invalid', origin), { status: 303 })
  }

  if (limit_graczy !== null && (!Number.isFinite(limit_graczy) || limit_graczy < 1)) {
    return NextResponse.redirect(new URL('/turniej/new?e=number_invalid', origin), { status: 303 })
  }

  if (gsheet_url && !urlRe.test(gsheet_url)) {
    return NextResponse.redirect(new URL('/turniej/new?e=url_invalid', origin), { status: 303 })
  }

  // Verify location exists
  const { data: location, error: locationError } = await supabase
    .from('miejsce_turnieju')
    .select('id, nazwa, miasto')
    .eq('id', miejsce_id)
    .single()

  if (locationError || !location) {
    console.error('Location not found:', miejsce_id, locationError)
    return NextResponse.redirect(new URL('/turniej/new?e=location_not_found', origin), { status: 303 })
  }

  // ‚úÖ Payload (gra must be included)
  const payload = {
    nazwa,
    gra, // ‚úÖ TO BY≈ÅO KLUCZOWE
    data_turnieju,
    godzina_turnieju,
    zakonczenie_turnieju,
    gsheet_url,
    arkusz_nazwa,
    kolumna_nazwisk,
    pierwszy_wiersz_z_nazwiskiem,
    limit_graczy,
    miejsce_id,
    created_by: user.id,
  }

  console.log('Inserting tournament with payload:', payload)

  const { error } = await supabase.from('turniej').insert(payload)
  if (error) {
    console.error('insert turniej error', error)
    return NextResponse.redirect(new URL('/turniej/new?e=database_error', origin), { status: 303 })
  }

  // success
  return NextResponse.redirect(new URL('/admin?ok=1', origin), { status: 303 })
}
```

### app/turniej/new/page.tsx

```
// elo-arena/app/turniej/new/page.tsx
'use client'

import { redirect } from 'next/navigation'
import { createSupabaseBrowser } from '@/lib/supabase/browser'
import { useEffect, useState } from 'react'
import {
  MapPin,
  Clock,
  CalendarDays,
  Trophy,
  Dices,
  ChevronDown,
  ChevronUp,
} from 'lucide-react'
import AutoHide from '@/components/AutoHide'
import AddTurniej from '@/components/AddTurniej'

interface Miejsce {
  id: string
  nazwa: string
  miasto: string
  wojewodztwo: string | null
  adres: string | null
}

interface FormData {
  nazwa: string
  gra: string
  data_turnieju: string
  godzina_turnieju: string
  zakonczenie_turnieju: string
  gsheet_url: string
  arkusz_nazwa: string
  kolumna_nazwisk: string
  pierwszy_wiersz_z_nazwiskiem: string
  limit_graczy: string
  miejsce_id: string
}

export default function NewTurniejPage() {
  const [miejsca, setMiejsca] = useState<Miejsce[]>([])
  const [isLoading, setIsLoading] = useState(true)
  const [showConfirmModal, setShowConfirmModal] = useState(false)
  const [showMoreDetails, setShowMoreDetails] = useState(false) // ‚úÖ NOWE
  const [formData, setFormData] = useState<FormData>({
    nazwa: '',
    gra: '',
    data_turnieju: '',
    godzina_turnieju: '',
    zakonczenie_turnieju: '',
    gsheet_url: '',
    arkusz_nazwa: '',
    kolumna_nazwisk: '',
    pierwszy_wiersz_z_nazwiskiem: '',
    limit_graczy: '',
    miejsce_id: '',
  })
  const [error, setError] = useState<string | null>(null)
  const [isSubmitting, setIsSubmitting] = useState(false)

  const supabase = createSupabaseBrowser()

  useEffect(() => {
    const fetchMiejsca = async () => {
      try {
        const {
          data: { user },
        } = await supabase.auth.getUser()
        if (!user) {
          redirect('/auth/signin')
          return
        }

        const { data: isAdmin } = await supabase.rpc('is_admin')
        if (!isAdmin) {
          redirect('/')
          return
        }

        const { data: miejscaData, error } = await supabase
          .from('miejsce_turnieju')
          .select('id, nazwa, miasto, wojewodztwo, adres')
          .order('nazwa', { ascending: true })

        if (error) {
          console.error('Error fetching miejsca:', error)
        } else {
          setMiejsca(miejscaData || [])
        }
      } catch (error) {
        console.error('Error:', error)
      } finally {
        setIsLoading(false)
      }
    }

    fetchMiejsca()
  }, [supabase])

  const handleInputChange = (
    e: React.ChangeEvent<HTMLInputElement | HTMLSelectElement>
  ) => {
    const { name, value } = e.target
    setFormData((prev) => ({
      ...prev,
      [name]: value,
    }))
  }

  const handleSubmit = (e: React.FormEvent) => {
    e.preventDefault()

    if (
      !formData.nazwa ||
      !formData.gra ||
      !formData.data_turnieju ||
      !formData.godzina_turnieju ||
      !formData.miejsce_id
    ) {
      setError('Wype≈Çnij wszystkie wymagane pola')
      return
    }

    setError(null)
    setShowConfirmModal(true)
  }

  const handleConfirm = async () => {
    setIsSubmitting(true)
    try {
      const formDataToSend = new FormData()
      formDataToSend.append('nazwa', formData.nazwa)
      formDataToSend.append('gra', formData.gra)
      formDataToSend.append('data_turnieju', formData.data_turnieju)
      formDataToSend.append('godzina_turnieju', formData.godzina_turnieju)
      formDataToSend.append('zakonczenie_turnieju', formData.zakonczenie_turnieju)
      formDataToSend.append('gsheet_url', formData.gsheet_url)
      formDataToSend.append('arkusz_nazwa', formData.arkusz_nazwa)
      formDataToSend.append('kolumna_nazwisk', formData.kolumna_nazwisk)
      formDataToSend.append(
        'pierwszy_wiersz_z_nazwiskiem',
        formData.pierwszy_wiersz_z_nazwiskiem.toString()
      )
      formDataToSend.append('limit_graczy', formData.limit_graczy)
      formDataToSend.append('miejsce_id', formData.miejsce_id)

      const response = await fetch('/turniej/create', {
        method: 'POST',
        body: formDataToSend,
      })

      if (response.ok) {
        window.location.href = '/admin?ok=1'
      } else {
        const url = new URL(response.url)
        const errorParam = url.searchParams.get('e')
        setError(getErrorMessage(errorParam))
      }
    } catch (err) {
      console.error('Error:', err)
      setError('WystƒÖpi≈Ç b≈ÇƒÖd podczas zapisywania turnieju')
    } finally {
      setIsSubmitting(false)
      setShowConfirmModal(false)
    }
  }

  const getErrorMessage = (errorCode: string | null) => {
    const errorMessages: { [key: string]: string } = {
      invalid_input: 'Nieprawid≈Çowe dane formularza.',
      date_time_required: 'Podaj datƒô i godzinƒô wydarzenia.',
      sheet_col_invalid: 'Kolumna nazwisk musi byƒá literƒÖ (A‚ÄìZ).',
      number_invalid: 'Nieprawid≈Çowa warto≈õƒá liczbowa.',
      url_invalid: 'Link musi zaczynaƒá siƒô od http(s)://',
      location_required: 'Wybierz miejsce turnieju.',
      invalid_location_id: 'Nieprawid≈Çowy identyfikator miejsca.',
      location_not_found: 'Wybrane miejsce nie istnieje.',
      database_error: 'B≈ÇƒÖd bazy danych podczas zapisywania.',
    }
    return errorMessages[errorCode || ''] || 'Nie uda≈Ço siƒô zapisaƒá.'
  }

  const getMiejsceNazwa = () => {
    const miejsce = miejsca.find((m) => m.id === formData.miejsce_id)
    return miejsce ? `${miejsce.nazwa} - ${miejsce.miasto}` : ''
  }

  if (isLoading) {
    return (
      <main className="flex min-h-[calc(100vh-4rem)] items-center justify-center px-4 py-8">
        <div className="w-full max-w-2xl rounded-2xl bg-slate-800/95 border border-slate-700 shadow-[0_14px_40px_rgba(0,0,0,0.8)] p-6 text-center">
          <div className="text-sky-100">≈Åadowanie...</div>
        </div>
      </main>
    )
  }

  return (
    <>
      <main className="flex min-h-[calc(100vh-4rem)] items-start justify-center px-8 py-16">
        <div className="w-full max-w-2xl rounded-2xl bg-slate-800/95 border border-slate-700 shadow-[0_14px_40px_rgba(0,0,0,0.8)] p-6 space-y-6">
          <h1 className="text-4xl font-bold text-sky-50 mb-2 text-center">
            Dodaj turniej
          </h1>

          {error && (
            <AutoHide>
              <div className="rounded-md border border-red-400/50 bg-red-500/10 px-4 py-3 text-sm text-red-200">
                {error}
              </div>
            </AutoHide>
          )}

          <form onSubmit={handleSubmit} className="space-y-5">
            {/* Nazwa turnieju */}
            <div>
              <label className="flex items-center gap-1.5 text-sm font-medium text-sky-100">
                <Trophy size={18} />
                <span>Nazwa turnieju:</span>
              </label>
              <input
                name="nazwa"
                required
                value={formData.nazwa}
                onChange={handleInputChange}
                className="mt-1 w-full rounded-2xl border border-slate-600 bg-slate-900/80 px-3 py-2 text-sky-100 placeholder:text-slate-500 focus:border-sky-500 focus:ring-1 focus:ring-sky-500"
                placeholder=""
              />
            </div>

            {/* Gra / wariant */}
            <div>
              <label className="flex items-center gap-1.5 text-sm font-medium text-sky-100">
                <Dices size={18} />
                <span>Gra / wariant</span>
              </label>

              <select
                name="gra"
                required
                value={formData.gra}
                onChange={handleInputChange}
                className="mt-1 w-full rounded-2xl border border-slate-600 bg-slate-900/80 px-3 py-2 text-sky-100 focus:border-sky-500 focus:ring-1 focus:ring-sky-500"
              >
                <option value="">‚Äî wybierz z listy ‚Äî</option>
                <option value="rummikub_standard">Rummikub ‚Äì Standard</option>
                <option value="rummikub_twist">Rummikub ‚Äì Twist</option>
                <option value="qwirkle">Qwirkle</option>
              </select>
            </div>

            {/* Data i godziny */}
            <div className="grid grid-cols-1 gap-4 sm:grid-cols-3">
              <div>
                <label className="flex items-center gap-1.5 text-sm font-medium text-sky-100">
                  <CalendarDays size={18} />
                  <span>Data turnieju:</span>
                </label>
                <input
                  type="date"
                  name="data_turnieju"
                  required
                  value={formData.data_turnieju}
                  onChange={handleInputChange}
                  className="mt-1 w-full rounded-2xl border border-slate-600 bg-slate-900/80 px-3 py-2 text-sky-100 focus:border-sky-500 focus:ring-1 focus:ring-sky-500"
                />
              </div>

              <div>
                <label className="flex items-center gap-1.5 text-sm font-medium text-sky-100">
                  <Clock size={18} />
                  <span>Godzina rozpoczƒôcia:</span>
                </label>
                <input
                  type="time"
                  name="godzina_turnieju"
                  required
                  value={formData.godzina_turnieju}
                  onChange={handleInputChange}
                  className="mt-1 w-full rounded-2xl border border-slate-600 bg-slate-900/80 px-3 py-2 text-sky-100 focus:border-sky-500 focus:ring-1 focus:ring-sky-500"
                />
              </div>

              <div>
                <label className="flex items-center gap-1.5 text-sm font-medium text-sky-100">
                  <Clock size={18} />
                  <span>Godzina zako≈Ñczenia: *</span>
                </label>

                <input
                  type="time"
                  name="zakonczenie_turnieju"
                  value={formData.zakonczenie_turnieju}
                  onChange={handleInputChange}
                  className="mt-1 w-full rounded-2xl border border-slate-600 bg-slate-900/80 px-3 py-2 text-sky-100 focus:border-sky-500 focus:ring-1 focus:ring-sky-500"
                />
              </div>
            </div>

            {/* ‚úÖ Miejsce turnieju + link poni≈ºej */}
            <div>
              <label className="flex items-center gap-1.5 text-sm font-medium text-sky-100">
                <MapPin size={18} />
                <span>Miejsce turnieju *</span>
              </label>

              <select
                name="miejsce_id"
                required
                value={formData.miejsce_id}
                onChange={handleInputChange}
                className="mt-1 w-full rounded-2xl border border-slate-600 bg-slate-900/80 px-3 py-2 text-sky-100 focus:border-sky-500 focus:ring-1 focus:ring-sky-500"
              >
                <option value="">‚Äî wybierz z listy ‚Äî</option>
                {miejsca.map((miejsce) => (
                  <option key={miejsce.id} value={miejsce.id}>
                    {miejsce.nazwa} - {miejsce.miasto}
                    {miejsce.wojewodztwo && `, ${miejsce.wojewodztwo}`}
                  </option>
                ))}
              </select>

              <div className="mt-2 flex justify-end items-center">
                <a
                  href="/admin/miejsca/new"
                  className="text-xs text-sky-400 hover:text-sky-300 hover:underline"
                  target="_blank"
                  rel="noopener noreferrer"
                >
                  Dodaj nowe miejsce ‚Üí
                </a>
              </div>
            </div>

            {/* ‚úÖ Wiƒôcej szczeg√≥≈Ç√≥w (accordion) */}
            <div className="pt-2">
              <button
                type="button"
                onClick={() => setShowMoreDetails((v) => !v)}
                className="w-full flex items-center justify-between rounded-2xl border border-slate-700 bg-slate-900/50 px-4 py-3 text-sky-100 hover:bg-slate-900/70 transition"
              >
                <span className="text-sm font-semibold">Wiƒôcej szczeg√≥≈Ç√≥w</span>
                {showMoreDetails ? (
                  <ChevronUp className="h-5 w-5 text-slate-300" />
                ) : (
                  <ChevronDown className="h-5 w-5 text-slate-300" />
                )}
              </button>

              {showMoreDetails && (
                <div className="mt-3 space-y-5 rounded-2xl border border-slate-700 bg-slate-900/30 p-4">
                  {/* Arkusz Google */}
                  <div>
                    <label className="block text-sm font-medium text-sky-100">
                      Link do arkusza Google (opcjonalnie)
                    </label>
                    <input
                      name="gsheet_url"
                      value={formData.gsheet_url}
                      onChange={handleInputChange}
                      className="mt-1 w-full rounded-2xl border border-slate-600 bg-slate-900/80 px-3 py-2 text-sky-100 placeholder:text-slate-500 focus:border-sky-500 focus:ring-1 focus:ring-sky-500"
                      placeholder="https://..."
                    />
                  </div>

                  {/* Szczeg√≥≈Çy arkusza */}
                  <div className="grid grid-cols-1 gap-4 sm:grid-cols-3">
                    <div>
                      <label className="block text-sm font-medium text-sky-100">
                        Nazwa karty (opcjonalnie)
                      </label>
                      <input
                        name="arkusz_nazwa"
                        value={formData.arkusz_nazwa}
                        onChange={handleInputChange}
                        className="mt-1 w-full rounded-2xl border border-slate-600 bg-slate-900/80 px-3 py-2 text-sky-100 placeholder:text-slate-500 focus:border-sky-500 focus:ring-1 focus:ring-sky-500"
                        placeholder=""
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-medium text-sky-100">
                        Kolumna z nazwiskami
                      </label>
                      <input
                        name="kolumna_nazwisk"
                        value={formData.kolumna_nazwisk}
                        onChange={handleInputChange}
                        className="mt-1 w-full rounded-2xl border border-slate-600 bg-slate-900/80 px-3 py-2 text-sky-100 placeholder:text-slate-500 focus:border-sky-500 focus:ring-1 focus:ring-sky-500"
                        placeholder=""
                        maxLength={2}
                      />
                      <p className="mt-1 text-xs text-slate-400">
                        Jedna litera A-Z.
                      </p>
                    </div>

                    <div>
                      <label className="block text-sm font-medium text-sky-100">
```

### app/turniej/page.tsx

```
// elo-arena/app/turniej/page.tsx
import { createSupabaseServer } from '@/lib/supabase/server'
import TournamentList from '@/components/TournamentList.client'

export const dynamic = 'force-dynamic'
export const revalidate = 0

type MiejsceTurnieju = {
  id: string
  nazwa: string
  miasto: string
  wojewodztwo: string | null
  adres: string | null
  latitude: number | null
  longitude: number | null
}

type TurniejRow = {
  id: string
  nazwa: string
  data_turnieju: string | null
  godzina_turnieju: string | null
  zakonczenie_turnieju: string | null
  gsheet_url: string | null
  limit_graczy: number | null
  miejsce_id: string | null
  miejsce_turnieju: MiejsceTurnieju | null
}

function safeMiejsceTurnieju(miejsce: any): MiejsceTurnieju | null {
  if (!miejsce || typeof miejsce !== 'object') return null
  
  return {
    id: String(miejsce.id || ''),
    nazwa: String(miejsce.nazwa || ''),
    miasto: String(miejsce.miasto || ''),
    wojewodztwo: miejsce.wojewodztwo ? String(miejsce.wojewodztwo) : null,
    adres: miejsce.adres ? String(miejsce.adres) : null,
    latitude: typeof miejsce.latitude === 'number' ? miejsce.latitude : null,
    longitude: typeof miejsce.longitude === 'number' ? miejsce.longitude : null
  }
}

export default async function TurniejListPage() {
  const supabase = await createSupabaseServer()
  
  const { data: rows, error } = await supabase
    .from('turniej')
    .select(`
      id,
      nazwa,
      data_turnieju,
      godzina_turnieju,
      zakonczenie_turnieju,
      gsheet_url,
      limit_graczy,
      miejsce_id,
      miejsce_turnieju (
        id,
        nazwa,
        miasto,
        wojewodztwo,
        adres,
        latitude,
        longitude
      )
    `)
    .order('data_turnieju', { ascending: false })
    .limit(200)

  if (error) {
    console.error('B≈ÇƒÖd pobierania danych:', error)
    return (
      <main className="min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 py-8 px-4">
        <div className="max-w-4xl mx-auto">
          <div className="rounded-2xl bg-slate-800/95 border border-slate-700 p-6">
            <div className="text-red-400 text-center">
              B≈ÇƒÖd podczas ≈Çadowania turniej√≥w: {error.message}
            </div>
          </div>
        </div>
      </main>
    )
  }

  const tournaments: TurniejRow[] = rows ? rows.map(row => {
    const miejsce = safeMiejsceTurnieju(row.miejsce_turnieju)
    
    return {
      id: String(row.id),
      nazwa: String(row.nazwa || ''),
      data_turnieju: row.data_turnieju ? String(row.data_turnieju) : null,
      godzina_turnieju: row.godzina_turnieju ? String(row.godzina_turnieju) : null,
      zakonczenie_turnieju: row.zakonczenie_turnieju ? String(row.zakonczenie_turnieju) : null,
      gsheet_url: row.gsheet_url ? String(row.gsheet_url) : null,
      limit_graczy: row.limit_graczy ? Number(row.limit_graczy) : null,
      miejsce_id: row.miejsce_id ? String(row.miejsce_id) : null,
      miejsce_turnieju: miejsce
    }
  }) : []

  return <TournamentList tournaments={tournaments} />
}```

### components/AddTurniej.tsx

```
'use client'

import { useRouter } from 'next/navigation'

interface AddTurniejProps {
  isOpen: boolean
  onClose: () => void
  onConfirm: () => void
  isSubmitting: boolean
  nazwa: string
  data: string
  miejsce: string
  gra: string // <-- NOWE
}

export default function AddTurniej({
  isOpen,
  onClose,
  onConfirm,
  isSubmitting,
  nazwa,
  data,
  miejsce,
  gra, // <-- NOWE
}: AddTurniejProps) {
  const router = useRouter()

  if (!isOpen) return null

  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/70 p-4">
      <div className="w-full max-w-md rounded-2xl bg-slate-800 border border-slate-600 shadow-2xl transform transition-all animate-in fade-in-zoom-in-95">
        {/* Nag≈Ç√≥wek */}
        <div className="flex items-center gap-3 border-b border-slate-600 px-6 py-4">
          <div className="flex h-10 w-10 items-center justify-center rounded-full bg-sky-500/20">
            <svg className="h-6 w-6 text-sky-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
            </svg>
          </div>
          <div>
            <h3 className="text-lg font-semibold text-sky-100">Potwierd≈∫ utworzenie turnieju</h3>
            <p className="text-sm text-slate-400">Sprawd≈∫ poprawno≈õƒá danych przed zapisem</p>
          </div>
        </div>

        {/* Tre≈õƒá */}
        <div className="px-6 py-4">
          <p className="text-sky-100 mb-4">Czy na pewno chcesz utworzyƒá nastƒôpujƒÖcy turniej?</p>

          <div className="space-y-3 bg-slate-700/30 rounded-lg p-4 border border-slate-600/50">
            {/* Nazwa */}
            <div className="flex items-center gap-3">
              <div className="flex h-8 w-8 items-center justify-center rounded-full bg-sky-500/20">
                <svg className="h-4 w-4 text-sky-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 10V3L4 14h7v7l9-11h-7z" />
                </svg>
              </div>
              <div>
                <p className="text-sm font-medium text-sky-100">{nazwa}</p>
                <p className="text-xs text-slate-400">Nazwa turnieju</p>
              </div>
            </div>

            {/* Gra (NOWE) */}
            <div className="flex items-center gap-3">
              <div className="flex h-8 w-8 items-center justify-center rounded-full bg-sky-500/20">
                <svg className="h-4 w-4 text-sky-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path
                    strokeLinecap="round"
                    strokeLinejoin="round"
                    strokeWidth={2}
                    d="M14 7a2 2 0 10-4 0v1a1 1 0 01-1 1H8a2 2 0 100 4h1a1 1 0 011 1v1a2 2 0 104 0v-1a1 1 0 011-1h1a2 2 0 100-4h-1a1 1 0 01-1-1V7z"
                  />
                </svg>
              </div>
              <div>
                <p className="text-sm font-medium text-sky-100">{gra}</p>
                <p className="text-xs text-slate-400">Gra / wariant</p>
              </div>
            </div>

            {/* Data */}
            <div className="flex items-center gap-3">
              <div className="flex h-8 w-8 items-center justify-center rounded-full bg-sky-500/20">
                <svg className="h-4 w-4 text-sky-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                </svg>
              </div>
              <div>
                <p className="text-sm font-medium text-sky-100">{data}</p>
                <p className="text-xs text-slate-400">Data turnieju</p>
              </div>
            </div>

            {/* Miejsce */}
            <div className="flex items-center gap-3">
              <div className="flex h-8 w-8 items-center justify-center rounded-full bg-sky-500/20">
                <svg className="h-4 w-4 text-sky-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                </svg>
              </div>
              <div>
                <p className="text-sm font-medium text-sky-100">{miejsce}</p>
                <p className="text-xs text-slate-400">Miejsce turnieju</p>
              </div>
            </div>
          </div>

          <div className="flex items-center gap-2 text-sm text-yellow-400 bg-yellow-500/10 rounded-lg px-3 py-2 mt-4">
            <svg className="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z" />
            </svg>
            <span>Turniej zostanie zapisany dopiero po klikniƒôciu "Tak, zapisz"</span>
          </div>
        </div>

        {/* Przyciski akcji */}
        <div className="flex justify-end gap-3 border-t border-slate-600 px-6 py-4">
          <button
            onClick={onClose}
            disabled={isSubmitting}
            className="rounded-full border border-slate-500 bg-slate-700 hover:bg-slate-600 px-6 py-2 text-sm font-medium text-sky-100 transition flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed"
          >
            <svg className="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
            </svg>
            Anuluj
          </button>

          <button
            onClick={onConfirm}
            disabled={isSubmitting}
            className="rounded-full bg-gradient-to-r from-green-600 to-green-500 hover:from-green-500 hover:to-green-400 px-6 py-2 text-sm font-medium text-white transition flex items-center gap-2 shadow-lg shadow-green-500/25 disabled:opacity-50 disabled:cursor-not-allowed"
          >
            {isSubmitting ? (
              <>
                <svg className="animate-spin h-4 w-4 text-white" fill="none" viewBox="0 0 24 24">
                  <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                  <path
                    className="opacity-75"
                    fill="currentColor"
                    d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
                  ></path>
                </svg>
                Zapisywanie...
              </>
            ) : (
              <>
                <svg className="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />
                </svg>
                Tak, zapisz
              </>
            )}
          </button>
        </div>
      </div>
    </div>
  )
}
```

### components/AutoHide.tsx

```
'use client'

import { useEffect, useState } from 'react'

export default function AutoHide({
  children,
  ms = 5000,
}: {
  children: React.ReactNode
  ms?: number
}) {
  const [show, setShow] = useState(true)
  useEffect(() => {
    const t = setTimeout(() => setShow(false), ms)
    return () => clearTimeout(t)
  }, [ms])
  if (!show) return null
  return <>{children}</>
}
```

### components/DeleteMiejsceButton.tsx

```
// components/DeleteMiejsceButton.tsx
'use client'

import { useState } from 'react'
import { useRouter } from 'next/navigation'
import { supabase } from '@/lib/supabase/client'

interface DeleteMiejsceButtonProps {
  id: string
  nazwa: string
}

interface ErrorModalProps {
  isOpen: boolean
  title: string
  message: string
  onClose: () => void
}

interface SuccessModalProps {
  isOpen: boolean
  message: string
  onClose: () => void
  onConfirm: () => void
}

const ErrorModal = ({ isOpen, title, message, onClose }: ErrorModalProps) => {
  if (!isOpen) return null

  return (
    <div className="fixed inset-0 z-60 flex items-center justify-center bg-black/70 p-4">
      <div className="w-full max-w-md rounded-2xl bg-slate-800 border border-red-600 shadow-2xl transform transition-all">
        {/* Nag≈Ç√≥wek */}
        <div className="flex items-center gap-3 border-b border-red-600 px-6 py-4">
          <div className="flex h-10 w-10 items-center justify-center rounded-full bg-red-500/20">
            <svg className="h-6 w-6 text-red-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z" />
            </svg>
          </div>
          <div>
            <h3 className="text-lg font-semibold text-red-100">{title}</h3>
            <p className="text-sm text-red-300">WystƒÖpi≈Ç b≈ÇƒÖd</p>
          </div>
        </div>

        {/* Tre≈õƒá */}
        <div className="px-6 py-4">
          <p className="text-slate-200 whitespace-pre-line">{message}</p>
        </div>

        {/* Przycisk zamkniƒôcia */}
        <div className="flex justify-end border-t border-red-600 px-6 py-4">
          <button
            onClick={onClose}
            className="rounded-full bg-red-600 hover:bg-red-500 px-6 py-2 text-sm font-medium text-white transition"
          >
            Zamknij
          </button>
        </div>
      </div>
    </div>
  )
}

const SuccessModal = ({ isOpen, message, onClose, onConfirm }: SuccessModalProps) => {
  if (!isOpen) return null

  const handleConfirm = () => {
    onConfirm()
    onClose()
  }

  return (
    <div className="fixed inset-0 z-60 flex items-center justify-center bg-black/70 p-4">
      <div className="w-full max-w-md rounded-2xl bg-slate-800 border border-green-600 shadow-2xl transform transition-all">
        {/* Nag≈Ç√≥wek */}
        <div className="flex items-center gap-3 border-b border-green-600 px-6 py-4">
          <div className="flex h-10 w-10 items-center justify-center rounded-full bg-green-500/20">
            <svg className="h-6 w-6 text-green-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
          </div>
          <div>
            <h3 className="text-lg font-semibold text-green-100">Sukces!</h3>
            <p className="text-sm text-green-300">Operacja zako≈Ñczona pomy≈õlnie</p>
          </div>
        </div>

        {/* Tre≈õƒá */}
        <div className="px-6 py-4">
          <p className="text-slate-200">{message}</p>
        </div>

        {/* Przycisk zamkniƒôcia */}
        <div className="flex justify-end border-t border-green-600 px-6 py-4">
          <button
            onClick={handleConfirm}
            className="rounded-full bg-green-600 hover:bg-green-500 px-6 py-2 text-sm font-medium text-white transition"
          >
            OK
          </button>
        </div>
      </div>
    </div>
  )
}

export default function DeleteMiejsceButton({ id, nazwa }: DeleteMiejsceButtonProps) {
  const router = useRouter()
  const [isOpen, setIsOpen] = useState(false)
  const [isDeleting, setIsDeleting] = useState(false)
  const [isDeleted, setIsDeleted] = useState(false)
  
  // Stany dla modal√≥w b≈Çƒôd√≥w i sukcesu
  const [errorModal, setErrorModal] = useState<{
    isOpen: boolean
    title: string
    message: string
  }>({
    isOpen: false,
    title: '',
    message: ''
  })
  
  const [successModal, setSuccessModal] = useState<{
    isOpen: boolean
    message: string
  }>({
    isOpen: false,
    message: ''
  })

  const handleDelete = async () => {
    // Sprawd≈∫ czy id jest dostƒôpne
    if (!id || id === 'undefined') {
      setErrorModal({
        isOpen: true,
        title: 'B≈ÇƒÖd walidacji',
        message: 'ID miejsca jest nieprawid≈Çowe. Spr√≥buj od≈õwie≈ºyƒá stronƒô i spr√≥bowaƒá ponownie.'
      })
      return
    }

    setIsDeleting(true)

    try {
      // Sprawd≈∫ czy miejsce nie jest u≈ºywane w ≈ºadnym turnieju
      const { data: turnieje, error: checkError } = await supabase
        .from('turniej')
        .select('id, nazwa')
        .eq('miejsce_id', id)

      if (checkError) {
        console.error('B≈ÇƒÖd podczas sprawdzania turniej√≥w:', checkError)
        setErrorModal({
          isOpen: true,
          title: 'B≈ÇƒÖd sprawdzania turniej√≥w',
          message: `Nie uda≈Ço siƒô sprawdziƒá turniej√≥w: ${checkError.message}`
        })
        setIsDeleting(false)
        return
      }

      if (turnieje && turnieje.length > 0) {
        const turniejNazwy = turnieje.map(t => `‚Ä¢ ${t.nazwa}`).join('\n')
        setIsOpen(false)
        setErrorModal({
          isOpen: true,
          title: 'Miejsce jest u≈ºywane w turniejach',
          message: `Nie mo≈ºna usunƒÖƒá tego miejsca, poniewa≈º jest przypisane do nastƒôpujƒÖcych turniej√≥w:\n\n${turniejNazwy}\n\nNajpierw usu≈Ñ lub zmie≈Ñ miejsce w tych turniejach.`
        })
        setIsDeleting(false)
        return
      }

      // Usu≈Ñ miejsce z tabeli miejsce_turnieju
      const { error: deleteError } = await supabase
        .from('miejsce_turnieju')
        .delete()
        .eq('id', id)

      if (deleteError) {
        console.error('B≈ÇƒÖd Supabase podczas usuwania:', deleteError)
        setErrorModal({
          isOpen: true,
          title: 'B≈ÇƒÖd bazy danych',
          message: `WystƒÖpi≈Ç b≈ÇƒÖd podczas usuwania miejsca: ${deleteError.message}`
        })
        setIsDeleting(false)
        return
      }

      // Ustaw flagƒô, ≈ºe miejsce zosta≈Ço usuniƒôte
      setIsDeleted(true)
      
      // Poka≈º modal sukcesu
      setIsOpen(false)
      setSuccessModal({
        isOpen: true,
        message: `Miejsce "${nazwa}" zosta≈Ço pomy≈õlnie usuniƒôte.`
      })
      
    } catch (error: any) {
      console.error('Pe≈Çny b≈ÇƒÖd podczas usuwania miejsca:', error)
      setErrorModal({
        isOpen: true,
        title: 'Nieoczekiwany b≈ÇƒÖd',
        message: `WystƒÖpi≈Ç nieoczekiwany b≈ÇƒÖd podczas usuwania miejsca:\n\n${error.message || 'Nieznany b≈ÇƒÖd'}`
      })
      setIsDeleting(false)
    }
  }

  const handleSuccessModalClose = () => {
    // Zamknij modal sukcesu i od≈õwie≈º stronƒô
    setSuccessModal({ ...successModal, isOpen: false })
    if (isDeleted) {
      router.refresh()
    }
  }

  const handleSuccessModalConfirm = () => {
    // Potwierdzenie zamkniƒôcia modala sukcesu
    setSuccessModal({ ...successModal, isOpen: false })
    if (isDeleted) {
      router.refresh()
    }
  }

  return (
    <>
      <button 
        onClick={() => setIsOpen(true)}
        className="inline-flex items-center gap-1 rounded bg-red-600 hover:bg-red-500 px-3 py-1 text-xs font-medium text-white transition"
        disabled={!id}
      >
        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
          <path d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
        </svg>
        Usu≈Ñ
      </button>

      {/* Modal potwierdzenia usuniƒôcia */}
      {isOpen && (
        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/70 p-4">
          <div className="w-full max-w-md rounded-2xl bg-slate-800 border border-slate-600 shadow-2xl transform transition-all">
            {/* Nag≈Ç√≥wek */}
            <div className="flex items-center gap-3 border-b border-slate-600 px-6 py-4">
              <div className="flex h-10 w-10 items-center justify-center rounded-full bg-red-500/20">
                <svg className="h-6 w-6 text-red-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z" />
                </svg>
              </div>
              <div>
                <h3 className="text-lg font-semibold text-sky-100">Potwierd≈∫ usuniƒôcie</h3>
                <p className="text-sm text-slate-400">Ta akcja jest nieodwracalna</p>
              </div>
            </div>

            {/* Tre≈õƒá */}
            <div className="px-6 py-4">
              <p className="text-sky-100 mb-2">
                Czy na pewno chcesz usunƒÖƒá miejsce turnieju:
              </p>
              <p className="text-lg font-semibold text-red-300 bg-red-500/10 border border-red-500/30 rounded-lg px-4 py-3 mb-4">
                "{nazwa || 'Nieznane miejsce'}"
              </p>
              <div className="space-y-2">
                <div className="flex items-center gap-2 text-sm text-slate-400 bg-slate-700/50 rounded-lg px-3 py-2">
                  <svg className="h-4 w-4 text-red-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                  </svg>
                  <span>Wszystkie dane zwiƒÖzane z miejscem zostanƒÖ trwale usuniƒôte</span>
                </div>
                <div className="flex items-center gap-2 text-sm text-slate-400 bg-blue-500/10 rounded-lg px-3 py-2">
                  <svg className="h-4 w-4 text-blue-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
                  </svg>
                  <span>System sprawdzi czy miejsce nie jest u≈ºywane w istniejƒÖcych turniejach</span>
                </div>
              </div>
            </div>

            {/* Przyciski akcji */}
            <div className="flex justify-end gap-3 border-t border-slate-600 px-6 py-4">
              <button
                onClick={() => setIsOpen(false)}
                disabled={isDeleting}
                className="rounded-full border border-slate-500 bg-slate-700 hover:bg-slate-600 px-6 py-2 text-sm font-medium text-sky-100 transition flex items-center gap-2 disabled:opacity-50"
              >
                <svg className="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                </svg>
                Anuluj
              </button>
              <button
                onClick={handleDelete}
                disabled={isDeleting || !id}
                className="rounded-full bg-gradient-to-r from-red-600 to-red-500 hover:from-red-500 hover:to-red-400 px-6 py-2 text-sm font-medium text-white transition flex items-center gap-2 shadow-lg shadow-red-500/25 disabled:opacity-50"
              >
                {isDeleting ? (
                  <>
                    <svg className="h-4 w-4 animate-spin" viewBox="0 0 24 24">
                      <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4" fill="none" />
                      <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z" />
                    </svg>
                    Usuwanie...
                  </>
                ) : (
                  <>
                    <svg className="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                    </svg>
                    {id ? 'Tak, usu≈Ñ miejsce' : 'B≈ÇƒÖd: brak ID miejsca'}
                  </>
                )}
              </button>
            </div>
          </div>
        </div>
      )}

      {/* Modal b≈Çƒôdu */}
      <ErrorModal
        isOpen={errorModal.isOpen}
        title={errorModal.title}
        message={errorModal.message}
        onClose={() => setErrorModal({ ...errorModal, isOpen: false })}
      />

      {/* Modal sukcesu */}
      <SuccessModal
        isOpen={successModal.isOpen}
        message={successModal.message}
        onClose={handleSuccessModalClose}
        onConfirm={handleSuccessModalConfirm}
      />
    </>
  )
}```

### components/DeletePartia.tsx

```
// components/DeletePartia.tsx
'use client'

import { useState } from 'react'
import { Trash2, X, AlertTriangle, RefreshCw } from 'lucide-react'

interface GraczDlaUsuwania {
  id: string
  imie: string
  nazwisko: string
  eloPrzed: number
  zmianaElo: number
}

interface DeletePartiaProps {
  partiaId: string
  turniejId: string
  numerPartii: number
  nazwaTurnieju: string
  gracze: GraczDlaUsuwania[]
  className?: string
  iconOnly?: boolean

}

export default function DeletePartia({ partiaId, turniejId, numerPartii, nazwaTurnieju, gracze }: DeletePartiaProps) {
  const [isOpen, setIsOpen] = useState(false)
  const [deleting, setDeleting] = useState(false)
  const [resultMessage, setResultMessage] = useState<string | null>(null)

  const handleDelete = async () => {
    setDeleting(true)
    setResultMessage(null)
    
    try {
      const response = await fetch(`/api/admin/partie/${partiaId}?turniejId=${turniejId}`, {
        method: 'DELETE',
      })

      const data = await response.json()

      if (response.ok) {
        setResultMessage(data.message || 'Partia zosta≈Ça pomy≈õlnie usuniƒôta')
        // Od≈õwie≈º stronƒô po 2 sekundach
        setTimeout(() => {
          window.location.reload()
        }, 2000)
      } else {
        setResultMessage(`B≈ÇƒÖd: ${data.error || 'WystƒÖpi≈Ç nieznany b≈ÇƒÖd'}`)
      }
    } catch (error) {
      console.error('B≈ÇƒÖd podczas usuwania partii:', error)
      setResultMessage('WystƒÖpi≈Ç b≈ÇƒÖd podczas usuwania partii')
    } finally {
      setDeleting(false)
    }
  }

  // Oblicz podsumowanie zmian
  const graczeZGracja = gracze.filter(g => g.zmianaElo !== 0)
  const graczeZObrazeniem = graczeZGracja.filter(g => g.zmianaElo < 0)
  const graczeZZyskiem = graczeZGracja.filter(g => g.zmianaElo > 0)

  return (
    <>
      <button
        onClick={() => setIsOpen(true)}
        className="inline-flex items-center gap-1 rounded bg-red-600 hover:bg-red-500 px-3 py-2 text-sm font-medium text-white transition"
      >
        <Trash2 className="h-4 w-4" />
        Usu≈Ñ
      </button>

      {isOpen && (
        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm">
          <div className="w-full max-w-2xl rounded-2xl bg-slate-800 border border-slate-700 shadow-2xl p-6 mx-4">
            {/* Nag≈Ç√≥wek */}
            <div className="flex items-center justify-between mb-4">
              <div className="flex items-center space-x-3">
                <div className="bg-red-500/20 rounded-lg p-2">
                  <AlertTriangle className="h-6 w-6 text-red-500" />
                </div>
                <h3 className="text-lg font-semibold text-white">
                  Usuwanie partii
                </h3>
              </div>
              <button
                onClick={() => setIsOpen(false)}
                className="rounded-lg p-2 text-slate-400 hover:text-white hover:bg-slate-700 transition"
                disabled={deleting}
              >
                <X className="h-5 w-5" />
              </button>
            </div>

            {/* Komunikat wyniku */}
            {resultMessage && (
              <div className={`mb-4 p-4 rounded-lg ${
                resultMessage.includes('B≈ÇƒÖd') 
                  ? 'bg-red-500/10 border border-red-500/20 text-red-400'
                  : 'bg-green-500/10 border border-green-500/20 text-green-400'
              }`}>
                <div className="flex items-center space-x-2">
                  {resultMessage.includes('B≈ÇƒÖd') ? (
                    <AlertTriangle className="h-5 w-5" />
                  ) : (
                    <RefreshCw className="h-5 w-5" />
                  )}
                  <span>{resultMessage}</span>
                </div>
                {!resultMessage.includes('B≈ÇƒÖd') && (
                  <p className="text-sm mt-2 text-green-300">
                    Strona zostanie od≈õwie≈ºona za chwilƒô...
                  </p>
                )}
              </div>
            )}

            {/* Tre≈õƒá */}
            <div className="space-y-4">
              <p className="text-slate-300">
                Czy na pewno chcesz usunƒÖƒá tƒô partiƒô? Ta operacja jest nieodwracalna.
              </p>
              
              <div className="bg-red-500/10 border border-red-500/20 rounded-lg p-4">
                <div className="text-red-400 font-semibold">
                  Partia #{numerPartii}
                </div>
                <div className="text-red-300 text-sm mt-1">
                  {nazwaTurnieju}
                </div>
              </div>

              {/* Szczeg√≥≈Çowe informacje o zmianach */}
              <div className="bg-slate-700/50 rounded-lg p-4">
                <h4 className="font-semibold text-slate-300 mb-3">
                  Zmiany, kt√≥re zostanƒÖ cofniƒôte:
                </h4>
                
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                  {/* Gracze z zyskiem ELO */}
                  {graczeZZyskiem.length > 0 && (
                    <div>
                      <div className="text-green-400 font-medium mb-2">
                        Gracze, kt√≥rzy stracƒÖ punkty ELO ({graczeZZyskiem.length}):
                      </div>
                      <div className="space-y-1">
                        {graczeZZyskiem.map(gracz => (
                          <div key={gracz.id} className="flex justify-between text-green-300">
                            <span>{gracz.imie} {gracz.nazwisko}</span>
                            <span>-{gracz.zmianaElo} ELO</span>
                          </div>
                        ))}
                      </div>
                    </div>
                  )}

                  {/* Gracze ze stratƒÖ ELO */}
                  {graczeZObrazeniem.length > 0 && (
                    <div>
                      <div className="text-red-400 font-medium mb-2">
                        Gracze, kt√≥rzy odzyskajƒÖ punkty ELO ({graczeZObrazeniem.length}):
                      </div>
                      <div className="space-y-1">
                        {graczeZObrazeniem.map(gracz => (
                          <div key={gracz.id} className="flex justify-between text-red-300">
                            <span>{gracz.imie} {gracz.nazwisko}</span>
                            <span>+{Math.abs(gracz.zmianaElo)} ELO</span>
                          </div>
                        ))}
                      </div>
                    </div>
                  )}
                </div>

                <div className="mt-4 p-3 bg-slate-600/30 rounded">
                  <p className="text-slate-400 text-sm">
                    <strong>Pe≈Çne przywracanie stanu:</strong> Ranking ELO, statystyki gier i liczba wygranych zostanƒÖ przywr√≥cone do stanu sprzed tej partii.
                  </p>
                </div>
              </div>
            </div>

            {/* Przyciski akcji */}
            <div className="flex items-center justify-end space-x-3 mt-6">
              <button
                onClick={() => setIsOpen(false)}
                disabled={deleting}
                className="px-4 py-2 text-sm font-medium text-slate-300 hover:text-white transition disabled:opacity-50"
              >
                Anuluj
              </button>
              <button
                onClick={handleDelete}
                disabled={deleting}
                className="inline-flex items-center gap-2 rounded-lg bg-red-600 hover:bg-red-500 disabled:bg-red-400 px-4 py-2 text-sm font-medium text-white transition"
              >
                {deleting ? (
                  <>
                    <div className="animate-spin rounded-full h-4 w-4 border-b-2 border-white"></div>
                    Usuwanie...
                  </>
                ) : (
                  <>
                    <Trash2 className="h-4 w-4" />
                    Usu≈Ñ partiƒô
                  </>
                )}
              </button>
            </div>
          </div>
        </div>
      )}
    </>
  )
}```

### components/DeleteTurniej.tsx

```
// components/DeleteTurniej.tsx
'use client'

import { useRouter } from 'next/navigation'
import { useState } from 'react'

interface DeleteTurniejProps {
  id: string
  nazwa: string
}

export default function DeleteTurniej({ id, nazwa }: DeleteTurniejProps) {
  const router = useRouter()
  const [isOpen, setIsOpen] = useState(false)

  const handleDelete = async () => {
    try {
      const response = await fetch(`/admin/turniej/${id}/delete`, {
        method: 'POST',
      })

      if (response.ok) {
        router.refresh()
      } else {
        alert('B≈ÇƒÖd podczas usuwania turnieju.')
      }
    } catch (err) {
      console.error('B≈ÇƒÖd usuwania:', err)
      alert('WystƒÖpi≈Ç b≈ÇƒÖd podczas usuwania turnieju.')
    } finally {
      setIsOpen(false)
    }
  }

  return (
    <>
      <button 
        onClick={() => setIsOpen(true)}
        className="inline-flex items-center gap-1 rounded bg-red-600 hover:bg-red-500 px-3 py-1 text-xs font-medium text-white transition"
      >
        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
          <path d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
        </svg>
        Usu≈Ñ
      </button>

      {/* Modal potwierdzenia */}
      {isOpen && (
        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/70 p-4">
          <div className="w-full max-w-md rounded-2xl bg-slate-800 border border-slate-600 shadow-2xl transform transition-all">
            {/* Nag≈Ç√≥wek */}
            <div className="flex items-center gap-3 border-b border-slate-600 px-6 py-4">
              <div className="flex h-10 w-10 items-center justify-center rounded-full bg-red-500/20">
                <svg className="h-6 w-6 text-red-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z" />
                </svg>
              </div>
              <div>
                <h3 className="text-lg font-semibold text-sky-100">Potwierd≈∫ usuniƒôcie</h3>
                <p className="text-sm text-slate-400">Ta akcja jest nieodwracalna</p>
              </div>
            </div>

            {/* Tre≈õƒá */}
            <div className="px-6 py-4">
              <p className="text-sky-100 mb-2">
                Czy na pewno chcesz usunƒÖƒá turniej:
              </p>
              <p className="text-lg font-semibold text-red-300 bg-red-500/10 border border-red-500/30 rounded-lg px-4 py-3 mb-4">
                "{nazwa}"
              </p>
              <div className="flex items-center gap-2 text-sm text-slate-400 bg-slate-700/50 rounded-lg px-3 py-2">
                <svg className="h-4 w-4 text-red-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                <span>Wszystkie dane zwiƒÖzane z turniejem zostanƒÖ trwale usuniƒôte</span>
              </div>
            </div>

            {/* Przyciski akcji */}
            <div className="flex justify-end gap-3 border-t border-slate-600 px-6 py-4">
              <button
                onClick={() => setIsOpen(false)}
                className="rounded-full border border-slate-500 bg-slate-700 hover:bg-slate-600 px-6 py-2 text-sm font-medium text-sky-100 transition flex items-center gap-2"
              >
                <svg className="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                </svg>
                Anuluj
              </button>
              <button
                onClick={handleDelete}
                className="rounded-full bg-gradient-to-r from-red-600 to-red-500 hover:from-red-500 hover:to-red-400 px-6 py-2 text-sm font-medium text-white transition flex items-center gap-2 shadow-lg shadow-red-500/25"
              >
                <svg className="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                </svg>
                Tak, usu≈Ñ turniej
              </button>
            </div>
          </div>
        </div>
      )}
    </>
  )
}```

### components/LoadGoogleMaps.tsx

```
'use client'

import Script from 'next/script'

export default function LoadGoogleMaps() {
  const apiKey = process.env.NEXT_PUBLIC_GOOGLE_MAPS_API_KEY
  if (!apiKey) return null

  return (
    <Script
      id="google-maps-sdk"
      src={`https://maps.googleapis.com/maps/api/js?key=${apiKey}`}
      strategy="afterInteractive"
    />
  )
}
```

### components/MapPicker.tsx

```
// components/MapPicker.tsx
'use client'

import { useEffect, useRef, useState } from 'react'

type Props = {
  targetLatId: string
  targetLngId: string
  lat?: number | null
  lng?: number | null
  buttonLabel?: string
  onLocationChange?: (lat: number, lng: number) => void // DODANE
}

function mapsReady() {
  return typeof window !== 'undefined' && !!(window as any).google?.maps
}

export default function MapPicker({
  targetLatId,
  targetLngId,
  lat,
  lng,
  buttonLabel = 'Ustaw pinezkƒô',
  onLocationChange, // DODANE
}: Props) {
  const [open, setOpen] = useState(false)
  const [ready, setReady] = useState(mapsReady())
  const [failed, setFailed] = useState(false)

  const mapRef = useRef<HTMLDivElement>(null)
  const markerRef = useRef<google.maps.Marker | null>(null)
  const gmapRef = useRef<google.maps.Map | null>(null)

  const defaultCenter = {
    lat: typeof lat === 'number' ? lat : 52.2297,
    lng: typeof lng === 'number' ? lng : 21.0122,
  }

  // Czekamy a≈º google.maps bƒôdzie dostƒôpne
  useEffect(() => {
    if (!open || ready) return
    let tries = 0
    const t = setInterval(() => {
      tries++
      const ok = mapsReady()
      setReady(ok)
      if (ok || tries > 50) {
        clearInterval(t)
        if (!ok) setFailed(true)
      }
    }, 100)
    return () => clearInterval(t)
  }, [open, ready])

  // Inicjalizacja mapy po otwarciu i ready
  useEffect(() => {
    if (!open || !ready || !mapRef.current) return
    
    const raf = requestAnimationFrame(() => {
      try {
        const map = new google.maps.Map(mapRef.current!, {
          center: defaultCenter,
          zoom: 12,
        })
        gmapRef.current = map

        const marker = new google.maps.Marker({
          position: defaultCenter,
          map,
          draggable: true,
        })
        markerRef.current = marker

        // DODANE: Wywo≈Çaj callback z poczƒÖtkowƒÖ lokalizacjƒÖ
        if (onLocationChange) {
          onLocationChange(defaultCenter.lat, defaultCenter.lng)
        }

        map.addListener('click', (e: google.maps.MapMouseEvent) => {
          const pos = e.latLng
          if (pos) {
            marker.setPosition(pos)
            // DODANE: Wywo≈Çaj callback gdy klikniƒôto na mapƒô
            if (onLocationChange) {
              onLocationChange(pos.lat(), pos.lng())
            }
          }
        })

        // DODANE: Obs≈Çuga przeciƒÖgania markera
        marker.addListener('dragend', () => {
          const pos = marker.getPosition()
          if (pos && onLocationChange) {
            onLocationChange(pos.lat(), pos.lng())
          }
        })
      } catch (e) {
        setFailed(true)
        console.error('Map init error', e)
      }
    })
    
    return () => {
      cancelAnimationFrame(raf)
      markerRef.current?.setMap(null)
      markerRef.current = null
      gmapRef.current = null
    }
  }, [open, ready])

  function confirmPick() {
    const pos = markerRef.current?.getPosition()
    if (pos) {
      const latEl = document.getElementById(targetLatId) as HTMLInputElement | null
      const lngEl = document.getElementById(targetLngId) as HTMLInputElement | null
      if (latEl) latEl.value = String(pos.lat())
      if (lngEl) lngEl.value = String(pos.lng())
      
      // DODANE: Wywo≈Çaj callback r√≥wnie≈º przy potwierdzeniu
      if (onLocationChange) {
        onLocationChange(pos.lat(), pos.lng())
      }
    }
    setOpen(false)
  }

  return (
    <>
      <button 
        type="button" 
        className="rounded bg-sky-600 hover:bg-sky-500 px-4 py-2 text-sm font-medium text-white transition"
        onClick={() => { setFailed(false); setOpen(true) }}
      >
        {buttonLabel}
      </button>

      {open && (
        <div className="fixed inset-0 z-[100] flex items-center justify-center bg-black/50 p-4">
          <div className="w-full max-w-3xl overflow-hidden rounded-lg bg-white shadow-xl">
            <div className="flex items-center justify-between border-b px-6 py-4">
              <h3 className="text-lg font-semibold text-gray-900">Wybierz lokalizacjƒô na mapie</h3>
              <button 
                type="button" 
                className="text-gray-400 hover:text-gray-500 text-xl"
                onClick={() => setOpen(false)}
              >
                √ó
              </button>
            </div>

            {!process.env.NEXT_PUBLIC_GOOGLE_MAPS_API_KEY && (
              <div className="p-6 text-center text-red-600">
                Brak klucza Google Maps API. Skontaktuj siƒô z administratorem.
              </div>
            )}

            {!ready && !failed && (
              <div className="flex h-96 w-full items-center justify-center text-gray-600">
                <div className="text-center">
                  <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-2"></div>
                  <p>≈Åadowanie mapy...</p>
                </div>
              </div>
            )}

            {failed && (
              <div className="flex h-96 w-full flex-col items-center justify-center gap-4 p-6 text-center text-red-600">
                <p>Nie uda≈Ço siƒô za≈Çadowaƒá mapy.</p>
                <button
                  type="button"
                  className="rounded bg-blue-600 hover:bg-blue-700 px-4 py-2 text-white text-sm font-medium transition"
                  onClick={() => { setReady(mapsReady()); setFailed(false) }}
                >
                  Spr√≥buj ponownie
                </button>
              </div>
            )}

            {ready && !failed && (
              <div className="h-96 w-full" ref={mapRef} />
            )}

            <div className="flex justify-between items-center border-t px-6 py-4">
              <div className="text-sm text-gray-500">
                Kliknij na mapie, aby ustawiƒá pinezkƒô
              </div>
              <div className="flex gap-3">
                <button 
                  type="button" 
                  className="rounded border border-gray-300 bg-white hover:bg-gray-50 px-4 py-2 text-gray-700 text-sm font-medium transition"
                  onClick={() => setOpen(false)}
                >
                  Anuluj
                </button>
                <button 
                  type="button" 
                  className="rounded bg-blue-600 hover:bg-blue-700 px-4 py-2 text-white text-sm font-medium transition disabled:opacity-50"
                  onClick={confirmPick} 
                  disabled={!ready || failed}
                >
                  Zapisz
                </button>
              </div>
            </div>
          </div>
        </div>
      )}
    </>
  )
}```

### components/MiejsceForm.tsx

```
// components/MiejsceForm.tsx
'use client'

import { useState, useEffect } from 'react'
import { useRouter } from 'next/navigation'
import { supabase } from '@/lib/supabase/client'

const WOJEWODZTWA = [
  'dolno≈õlƒÖskie',
  'kujawsko-pomorskie',
  'lubelskie',
  'lubuskie',
  '≈Ç√≥dzkie',
  'ma≈Çopolskie',
  'mazowieckie',
  'opolskie',
  'podkarpackie',
  'podlaskie',
  'pomorskie',
  '≈õlƒÖskie',
  '≈õwiƒôtokrzyskie',
  'warmi≈Ñsko-mazurskie',
  'wielkopolskie',
  'zachodniopomorskie',
]

type Miejsce = {
  id?: string
  nazwa: string
  miasto: string
  wojewodztwo: string | null
  adres: string | null
  latitude: number | null
  longitude: number | null
  created_by?: string | null
  updated_by?: string | null
}

type Props = {
  mode: 'new' | 'edit'
  initial: Miejsce | null
}

// Modal b≈Çƒôdu dla formularza
const ErrorModal = ({ 
  isOpen, 
  title, 
  message, 
  onClose 
}: { 
  isOpen: boolean; 
  title: string; 
  message: string; 
  onClose: () => void 
}) => {
  if (!isOpen) return null

  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/70 p-4">
      <div className="w-full max-w-md rounded-2xl bg-slate-800 border border-red-600 shadow-2xl transform transition-all">
        {/* Nag≈Ç√≥wek */}
        <div className="flex items-center gap-3 border-b border-red-600 px-6 py-4">
          <div className="flex h-10 w-10 items-center justify-center rounded-full bg-red-500/20">
            <svg className="h-6 w-6 text-red-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z" />
            </svg>
          </div>
          <div>
            <h3 className="text-lg font-semibold text-red-100">{title}</h3>
            <p className="text-sm text-red-300">WystƒÖpi≈Ç b≈ÇƒÖd</p>
          </div>
        </div>

        {/* Tre≈õƒá */}
        <div className="px-6 py-4">
          <p className="text-slate-200 whitespace-pre-line">{message}</p>
        </div>

        {/* Przycisk */}
        <div className="flex justify-end border-t border-red-600 px-6 py-4">
          <button
            onClick={onClose}
            className="rounded-full bg-red-600 hover:bg-red-500 px-6 py-2 text-sm font-medium text-white transition"
          >
            Zamknij
          </button>
        </div>
      </div>
    </div>
  )
}

export default function MiejsceForm({ mode, initial }: Props) {
  const router = useRouter()
  const [currentUserId, setCurrentUserId] = useState<string | null>(null)

  const [nazwa, setNazwa] = useState(initial?.nazwa ?? '')
  const [miasto, setMiasto] = useState(initial?.miasto ?? '')
  const [wojewodztwo, setWojewodztwo] = useState(initial?.wojewodztwo ?? '')
  const [adres, setAdres] = useState(initial?.adres ?? '')
  const [latitude, setLatitude] = useState<number | null>(initial?.latitude ?? null)
  const [longitude, setLongitude] = useState<number | null>(initial?.longitude ?? null)
  const [coordinatesInput, setCoordinatesInput] = useState('')

  const [saving, setSaving] = useState(false)
  const [error, setError] = useState<string | null>(null)
  const [showSuccessModal, setShowSuccessModal] = useState(false)
  const [showErrorModal, setShowErrorModal] = useState(false)
  const [errorModalDetails, setErrorModalDetails] = useState({
    title: '',
    message: ''
  })

  // Pobierz aktualnego u≈ºytkownika (UUID)
  useEffect(() => {
    async function getCurrentUser() {
      try {
        const { data: { user } } = await supabase.auth.getUser()
        if (user) {
          setCurrentUserId(user.id)
        } else {
          router.push('/auth/signin')
        }
      } catch (err) {
        console.error('B≈ÇƒÖd podczas pobierania u≈ºytkownika:', err)
        setErrorModalDetails({
          title: 'B≈ÇƒÖd autoryzacji',
          message: 'Nie uda≈Ço siƒô pobraƒá informacji o u≈ºytkowniku'
        })
        setShowErrorModal(true)
      }
    }
    
    getCurrentUser()
  }, [router])

  // Funkcja do parsowania wklejonych wsp√≥≈Çrzƒôdnych
  const handleCoordinatesPaste = () => {
    if (!coordinatesInput.trim()) return
    
    try {
      const cleanInput = coordinatesInput
        .replace(/[()"']/g, '') // usu≈Ñ nawiasy i cudzys≈Çowy
        .replace(/\s+/g, ' ') // zamie≈Ñ wiele spacji na jednƒÖ
        .trim()
      
      // Spr√≥buj rozpoznaƒá r√≥≈ºne formaty separator√≥w
      const separators = /[,;\s\t]+/
      const parts = cleanInput.split(separators).filter(part => part.trim() !== '')
      
      if (parts.length !== 2) {
        setErrorModalDetails({
          title: 'B≈ÇƒÖd wsp√≥≈Çrzƒôdnych',
          message: 'Proszƒô podaƒá dok≈Çadnie dwie wsp√≥≈Çrzƒôdne oddzielone przecinkiem, spacjƒÖ lub ≈õrednikiem'
        })
        setShowErrorModal(true)
        return
      }
      
      // Zamie≈Ñ przecinki na kropki dla poprawnego parsowania
      const lat = parseFloat(parts[0].replace(',', '.'))
      const lng = parseFloat(parts[1].replace(',', '.'))
      
      if (isNaN(lat) || isNaN(lng)) {
        setErrorModalDetails({
          title: 'B≈ÇƒÖd wsp√≥≈Çrzƒôdnych',
          message: 'Nieprawid≈Çowy format wsp√≥≈Çrzƒôdnych. Upewnij siƒô, ≈ºe poda≈Çe≈õ liczby'
        })
        setShowErrorModal(true)
        return
      }
      
      // Sprawd≈∫ tylko je≈õli obie wsp√≥≈Çrzƒôdne sƒÖ podane
      if (lat !== null && lng !== null) {
        if (lat < 49.0 || lat > 54.9 || lng < 14.0 || lng > 24.2) {
          setErrorModalDetails({
            title: 'B≈ÇƒÖd wsp√≥≈Çrzƒôdnych',
            message: 'Wsp√≥≈Çrzƒôdne znajdujƒÖ siƒô poza obszarem Polski. Czy na pewno sƒÖ poprawne?'
          })
          setShowErrorModal(true)
          return
        }
      }
      
      setLatitude(lat)
      setLongitude(lng)
      setCoordinatesInput('')
      setError(null)
    } catch (err) {
      setErrorModalDetails({
        title: 'B≈ÇƒÖd przetwarzania',
        message: 'WystƒÖpi≈Ç b≈ÇƒÖd podczas przetwarzania wsp√≥≈Çrzƒôdnych'
      })
      setShowErrorModal(true)
    }
  }

  function resetForm() {
    setNazwa('')
    setMiasto('')
    setWojewodztwo('')
    setAdres('')
    setLatitude(null)
    setLongitude(null)
    setCoordinatesInput('')
    setError(null)
  }

  async function handleSubmit(e: React.FormEvent) {
    e.preventDefault()
    
    if (!currentUserId) {
      setErrorModalDetails({
        title: 'B≈ÇƒÖd autoryzacji',
        message: 'Musisz byƒá zalogowany, aby zapisaƒá miejsce'
      })
      setShowErrorModal(true)
      return
    }
    
    // Walidacja podstawowych p√≥l
    if (!nazwa.trim() || !miasto.trim()) {
      setErrorModalDetails({
        title: 'B≈ÇƒÖd walidacji',
        message: 'Wype≈Çnij wszystkie wymagane pola (nazwa i miasto)'
      })
      setShowErrorModal(true)
      return
    }
    
    // Walidacja wsp√≥≈Çrzƒôdnych - tylko je≈õli sƒÖ podane
    if ((latitude !== null && longitude === null) || (latitude === null && longitude !== null)) {
      setErrorModalDetails({
        title: 'B≈ÇƒÖd wsp√≥≈Çrzƒôdnych',
        message: 'Proszƒô podaƒá obie wsp√≥≈Çrzƒôdne geograficzne lub pozostawiƒá oba pola puste'
      })
      setShowErrorModal(true)
      return
    }
    
    // Walidacja warto≈õci wsp√≥≈Çrzƒôdnych, je≈õli obie sƒÖ podane
    if (latitude !== null && longitude !== null) {
      if (isNaN(latitude) || isNaN(longitude)) {
        setErrorModalDetails({
          title: 'B≈ÇƒÖd wsp√≥≈Çrzƒôdnych',
          message: 'Wsp√≥≈Çrzƒôdne muszƒÖ byƒá prawid≈Çowymi liczbami'
        })
        setShowErrorModal(true)
        return
      }
      
      // Sprawd≈∫ czy wsp√≥≈Çrzƒôdne sƒÖ w Polsce (tylko je≈õli obie sƒÖ podane)
      if (latitude < 49.0 || latitude > 54.9 || longitude < 14.0 || longitude > 24.2) {
        setErrorModalDetails({
          title: 'B≈ÇƒÖd wsp√≥≈Çrzƒôdnych',
          message: 'Wsp√≥≈Çrzƒôdne znajdujƒÖ siƒô poza obszarem Polski. Czy na pewno sƒÖ poprawne?'
        })
        setShowErrorModal(true)
        return
      }
    }
    
    setSaving(true)
    setError(null)

    const payload: any = {
      nazwa: nazwa.trim(),
      miasto: miasto.trim(),
      wojewodztwo: wojewodztwo?.trim() || null,
      adres: adres?.trim() || null,
      latitude: latitude ?? null,
      longitude: longitude ?? null,
    }

    try {
      // Dla nowego miejsca dodaj UUID u≈ºytkownika
      if (mode === 'new') {
        payload.created_by = currentUserId
      } 
      // Dla edycji dodaj UUID u≈ºytkownika
      else {
        payload.updated_by = currentUserId
        payload.updated_at = new Date().toISOString()
      }

      const table = supabase.from('miejsce_turnieju')
      let resp
      
      if (mode === 'new') {
        resp = await table.insert(payload)
      } else {
        resp = await table.update(payload).eq('id', initial!.id)
      }

      if (resp.error) {
        console.error('B≈ÇƒÖd zapisu:', resp.error)
        setErrorModalDetails({
          title: 'B≈ÇƒÖd zapisu',
          message: resp.error.message || 'Nie uda≈Ço siƒô zapisaƒá miejsca turnieju.'
        })
        setShowErrorModal(true)
        setSaving(false)
        return
      }

      // Sukces - r√≥≈ºne zachowanie dla trybu new/edit
      if (mode === 'new') {
        // Najpierw resetuj formularz
        resetForm()
        // Potem poka≈º modal sukcesu
        setShowSuccessModal(true)
      } else {
        // Dla edycji przekieruj na listƒô
        router.push('/admin/miejsca')
        router.refresh()
      }
    } catch (err: any) {
      console.error(err)
      setErrorModalDetails({
        title: 'Nieoczekiwany b≈ÇƒÖd',
        message: 'WystƒÖpi≈Ç nieoczekiwany b≈ÇƒÖd podczas zapisywania.'
      })
      setShowErrorModal(true)
    } finally {
      setSaving(false)
    }
  }

  return (
    <>
      <form
        onSubmit={handleSubmit}
        className="space-y-6 rounded-2xl border border-slate-700 bg-slate-800/95 p-6 shadow-[0_14px_40px_rgba(0,0,0,0.8)]"
      >
        <h1 className="mb-2 text-2xl font-semibold text-sky-50">
          {mode === 'new' ? 'Dodaj miejsce turnieju' : 'Edytuj miejsce turnieju'}
        </h1>
        <p className="text-sm text-slate-400">
          Zdefiniuj lokalizacjƒô, kt√≥ra mo≈ºe byƒá wykorzystywana przez wiele turniej√≥w.
        </p>

        {/* Komunikat b≈Çƒôdu inline (je≈õli nie u≈ºyjemy modala) */}
        {error && (
          <div className="rounded-md border border-red-400/50 bg-red-500/10 px-4 py-3 text-sm text-red-200">
            {error}
          </div>
        )}

        {/* Nazwa */}
        <div className="space-y-1">
          <label className="text-sm font-medium text-slate-100">
            Nazwa miejsca *
          </label>
          <input
            className="w-full rounded-md border border-slate-600 bg-slate-900/60 px-3 py-2 text-sm text-sky-50"
            value={nazwa}
            onChange={(e) => setNazwa(e.target.value)}
            placeholder="np. SP 5 w Poznaniu, Klub X"
            required
          />
        </div>

        {/* Miasto + wojew√≥dztwo */}
        <div className="grid gap-4 md:grid-cols-2">
          <div className="space-y-1">
            <label className="text-sm font-medium text-slate-100">
              Miasto *
            </label>
            <input
              className="w-full rounded-md border border-slate-600 bg-slate-900/60 px-3 py-2 text-sm text-sky-50"
              value={miasto}
              onChange={(e) => setMiasto(e.target.value)}
              placeholder="np. Pozna≈Ñ"
              required
            />
          </div>

          <div className="space-y-1">
            <label className="text-sm font-medium text-slate-100">
              Wojew√≥dztwo
            </label>
            <select
              className="w-full rounded-md border border-slate-600 bg-slate-900/60 px-3 py-2 text-sm text-sky-50"
              value={wojewodztwo ?? ''}
              onChange={(e) => setWojewodztwo(e.target.value)}
            >
              <option value="">‚Äî wybierz wojew√≥dztwo (opcjonalne) ‚Äî</option>
              {WOJEWODZTWA.map((w) => (
                <option key={w} value={w}>
                  {w}
                </option>
              ))}
            </select>
          </div>
        </div>

        {/* Adres */}
        <div className="space-y-1">
          <label className="text-sm font-medium text-slate-100">
            Adres (opcjonalnie)
```

### components/Navbar.tsx

```
'use client'

import Link from 'next/link'
import { useEffect, useState } from 'react'
import { usePathname } from 'next/navigation'

// Prosty typ u≈ºytkownika przekazywany z serwera do navbaru
type UserLite = { 
  id: string
  email?: string | null 
} | null

// Dostƒôpne role w aplikacji
type Role = 'admin' | 'organizer' | 'user' | null

// Sta≈Çe dla ≈õcie≈ºek aplikacji - ≈Çatwiejsze zarzƒÖdzanie
const ROUTES = {
  HOME: '/',
  TOURNAMENTS: '/turniej',
  MAP: '/mapa',
  PROFILE: '/profile',
  ADMIN: '/admin',
  ORGANIZER: '/organizer/dashboard',
  SIGNUP: '/auth/signup',
  SIGNIN: '/auth/signin',
  SIGNOUT: '/auth/signout',
  SIGNIN_SUBMIT: '/auth/signin/submit',
} as const

// Komponent NavLink z memoizacjƒÖ dla lepszej wydajno≈õci
const NavLink = ({ 
  href, 
  children,
  currentPath,
  className = ''
}: { 
  href: string
  children: React.ReactNode
  currentPath: string
  className?: string
}) => {
  const isActive = currentPath === href
  
  return (
    <Link
      href={href}
      className={`
        relative px-3 py-1 text-sm font-medium transition
        text-sky-300/80 hover:text-sky-600
        ${isActive ? 'text-sky-300' : ''}
        ${className}
      `}
      aria-current={isActive ? 'page' : undefined}
    >
      {children}
      {isActive && (
        <span 
          className="absolute inset-x-2 -bottom-1 h-0.5 rounded-full bg-sky-600"
          aria-hidden="true"
        />
      )}
    </Link>
  )
}

// Komponent MobileMenu dla lepszej czytelno≈õci
const MobileMenu = ({ 
  isOpen, 
  user, 
  role, 
  currentPath,
  onClose
}: { 
  isOpen: boolean
  user: UserLite
  role: Role
  currentPath: string
  onClose: () => void
}) => {
  if (!isOpen) return null
  
  return (
    <>
      {/* Overlay - klikniƒôcie zamyka menu */}
      <div 
        className="md:hidden fixed inset-0 bg-black/40 z-40"
        onClick={onClose}
        aria-hidden="true"
      />
      
      {/* Menu mobilne - wy≈ºszy z-index ni≈º overlay */}
      <div 
        className="md:hidden border-t border-sky-700 bg-slate-900 px-4 py-3 space-y-2 relative z-50"
        role="menu"
        aria-label="Menu mobilne"
      >
        <NavLink href={ROUTES.TOURNAMENTS} currentPath={currentPath}>
          Turnieje
        </NavLink>
        
        <NavLink href={ROUTES.MAP} currentPath={currentPath}>
          Mapa
        </NavLink>
        
        {!user && (
          <NavLink href={ROUTES.SIGNUP} currentPath={currentPath}>
            Rejestracja
          </NavLink>
        )}
        
        {user && (
          <NavLink href={ROUTES.PROFILE} currentPath={currentPath}>
            Profil
          </NavLink>
        )}
        
        {/* Dla ADMINA */}
        {role === 'admin' && (
          <NavLink 
            href={ROUTES.ADMIN} 
            currentPath={currentPath}
            className="text-red-300 hover:text-red-100"
          >
            <span className="flex items-center gap-2">
              <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
              </svg>
              Admin
            </span>
          </NavLink>
        )}
        
        {/* Dla ORGANIZATORA */}
        {role === 'organizer' && (
          <NavLink 
            href={ROUTES.ORGANIZER} 
            currentPath={currentPath}
            className="text-emerald-300 hover:text-emerald-100"
          >
            <span className="flex items-center gap-2">
              <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
              </svg>
              Panel
            </span>
          </NavLink>
        )}

        <div className="border-t border-sky-700 my-3" aria-hidden="true" />

        {user ? (
          <form action={ROUTES.SIGNOUT} method="post" className="w-full">
            <button 
              type="submit"
              className="w-full inline-flex items-center justify-center h-9 rounded-full bg-gradient-to-r from-sky-500 to-sky-600 px-5 text-sm font-semibold text-white shadow-[0_5px_18px_rgba(15,23,42,0.8)] transition-all duration-200 hover:from-sky-400 hover:to-sky-500 hover:shadow-[0_7px_22px_rgba(15,23,42,1)] focus:outline-none focus:ring-2 focus:ring-sky-400 focus:ring-offset-2 focus:ring-offset-slate-900 disabled:opacity-50 disabled:cursor-not-allowed"
              role="menuitem"
              onClick={onClose}
            >
              Wyloguj
            </button>
          </form>
        ) : (
          <div className="w-full">
            <Link 
              href={ROUTES.SIGNIN} 
              className="w-full inline-flex items-center justify-center h-9 rounded-full bg-gradient-to-r from-sky-500 to-sky-600 px-5 text-sm font-semibold text-white shadow-[0_5px_18px_rgba(15,23,42,0.8)] transition-all duration-200 hover:from-sky-400 hover:to-sky-500 hover:shadow-[0_7px_22px_rgba(15,23,42,1)] focus:outline-none focus:ring-2 focus:ring-sky-400 focus:ring-offset-2 focus:ring-offset-slate-900 disabled:opacity-50 disabled:cursor-not-allowed"
              role="menuitem"
              onClick={onClose}
            >
              Zaloguj
            </Link>
          </div>
        )}
      </div>
    </>
  )
}

// G≈Ç√≥wny komponent Navbar
export default function Navbar({ user, role }: { user: UserLite; role: Role }) {
  const [isMenuOpen, setIsMenuOpen] = useState(false)
  const pathname = usePathname()

  // Zamknij menu przy zmianie ≈õcie≈ºki
  useEffect(() => {
    setIsMenuOpen(false)
  }, [pathname])

  // Zamknij menu po klikniƒôciu ESC
  useEffect(() => {
    const handleEscape = (e: KeyboardEvent) => {
      if (e.key === 'Escape') setIsMenuOpen(false)
    }
    
    window.addEventListener('keydown', handleEscape)
    return () => window.removeEventListener('keydown', handleEscape)
  }, [])

  // Style CSS jako sta≈Çe
  const INPUT_STYLE = `
    h-9 rounded-lg border border-slate-600 bg-slate-900/70 
    px-3 text-xs text-sky-50 placeholder:text-slate-400 
    shadow-sm focus:outline-none focus:ring-1 focus:ring-sky-400
    transition-colors duration-200
  `

  const BUTTON_PRIMARY = `
    inline-flex items-center justify-center h-9 rounded-full 
    bg-gradient-to-r from-sky-500 to-sky-600 px-5 text-sm 
    font-semibold text-white shadow-[0_5px_18px_rgba(15,23,42,0.8)] 
    transition-all duration-200 hover:from-sky-400 hover:to-sky-500 
    hover:shadow-[0_7px_22px_rgba(15,23,42,1)] 
    focus:outline-none focus:ring-2 focus:ring-sky-400 focus:ring-offset-2 focus:ring-offset-slate-900
    disabled:opacity-50 disabled:cursor-not-allowed
  `

  // Helper dla klas Tailwind
  const authButton = BUTTON_PRIMARY

  return (
    <header className="sticky top-0 z-50">
      {/* Top accent bar */}
      <div 
        className="h-1 w-full bg-gradient-to-r from-sky-500 via-sky-400 to-sky-500"
        aria-hidden="true"
      />

      <nav
        className="w-full bg-slate-900 border-b border-slate-700 shadow-[0_8px_25px_rgba(0,0,0,0.7)]"
        aria-label="G≈Ç√≥wne menu"
      >
        <div className="mx-auto max-w-7xl px-6 py-3">
          <div className="flex items-center justify-between">
            {/* Left side - Logo and desktop navigation */}
            <div className="flex items-center gap-4">
              <Link 
                href={ROUTES.HOME} 
                className="flex items-center gap-2 focus:outline-none focus:ring-2 focus:ring-sky-400 rounded-lg p-1"
                aria-label="Strona g≈Ç√≥wna"
              >
                <span
                  className="inline-flex h-8 w-8 items-center justify-center rounded-lg bg-sky-500 text-slate-900 font-bold shadow-md"
                  aria-hidden="true"
                >
                  EA
                </span>
                <span className="sr-only">Elo Arena</span>
              </Link>

              {/* Desktop navigation */}
              <div className="hidden md:flex items-center gap-3">
                <NavLink href={ROUTES.TOURNAMENTS} currentPath={pathname}>
                  Turnieje
                </NavLink>
                
                <NavLink href={ROUTES.MAP} currentPath={pathname}>
                  Mapa
                </NavLink>
                
                {!user && (
                  <NavLink href={ROUTES.SIGNUP} currentPath={pathname}>
                    Rejestracja
                  </NavLink>
                )}
                
                {user && (
                  <NavLink href={ROUTES.PROFILE} currentPath={pathname}>
                    Profil
                  </NavLink>
                )}
                
                {/* Dla ADMINA */}
                {role === 'admin' && (
                  <NavLink 
                    href={ROUTES.ADMIN} 
                    currentPath={pathname}
                    className="text-red-300 hover:text-red-100 flex items-center gap-2"
                  >
                    <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                    </svg>
                    Admin
                  </NavLink>
                )}
                
                {/* Dla ORGANIZATORA */}
                {role === 'organizer' && (
                  <NavLink 
                    href={ROUTES.ORGANIZER} 
                    currentPath={pathname}
                    className="text-emerald-300 hover:text-emerald-100 flex items-center gap-2"
                  >
                    <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
                    </svg>
                    Panel
                  </NavLink>
                )}
              </div>
            </div>

            {/* Right side - Auth/User info (desktop) */}
            <div className="hidden md:flex items-center gap-3">
              {user ? (
                <>
                  {/* Badge z rolƒÖ */}
                  <div className={`px-3 py-1 rounded-full text-xs font-semibold border ${
                    role === 'admin' 
                      ? 'bg-red-900/20 text-red-300 border-red-700/30' 
                      : role === 'organizer'
                      ? 'bg-emerald-900/20 text-emerald-300 border-emerald-700/30'
                      : 'bg-slate-800/40 text-sky-300 border-slate-700'
                  }`}>
                    {role === 'admin' ? 'Admin' : 
                     role === 'organizer' ? 'Organizator' : 
                     'U≈ºytkownik'}
                  </div>
                  
                  <span
                    className="inline-flex h-9 items-center truncate rounded-full border border-sky-600 bg-slate-800/70 px-4 text-xs font-medium text-sky-200 max-w-[200px]"
                    title={user.email || ''}
                  >
                    <span className="opacity-70">Zalogowano:</span>&nbsp;
                    <span className="truncate">{user.email}</span>
                  </span>

                  <form action={ROUTES.SIGNOUT} method="post">
                    <button 
                      type="submit"
                      className={authButton}
                      aria-label="Wyloguj siƒô"
                    >
                      Wyloguj
                    </button>
                  </form>
                </>
              ) : (
                <form
                  action={ROUTES.SIGNIN_SUBMIT}
                  method="post"
                  className="flex items-center gap-2"
                  autoComplete="on"
                >
                  {/* Auto-complete trick */}
                  <input type="text" autoComplete="username" className="hidden" aria-hidden="true" />
                  <input type="password" autoComplete="current-password" className="hidden" aria-hidden="true" />

                  <div className="flex flex-col gap-1">
                    <input
                      name="identifier"
                      placeholder="E-mail lub login"
                      autoComplete="email"
                      className={INPUT_STYLE}
                      required
                      aria-label="Email lub login"
                    />
                  </div>

                  <div className="flex flex-col gap-1">
                    <input
                      type="password"
                      name="password"
                      placeholder="Has≈Ço"
                      autoComplete="current-password"
                      className={INPUT_STYLE}
                      required
                      aria-label="Has≈Ço"
                    />
                  </div>

                  <button 
                    type="submit"
                    className={authButton}
                    aria-label="Zaloguj siƒô"
                  >
                    Zaloguj
                  </button>
                </form>
              )}
            </div>

            {/* Mobile menu button */}
            <button
              className="md:hidden inline-flex h-10 w-10 items-center justify-center rounded-md border border-sky-600 bg-slate-800/70 text-sky-200 hover:bg-slate-800 transition-colors focus:outline-none focus:ring-2 focus:ring-sky-400"
              onClick={() => setIsMenuOpen(!isMenuOpen)}
              aria-label={isMenuOpen ? "Zamknij menu" : "Otw√≥rz menu"}
              aria-expanded={isMenuOpen}
              aria-controls="mobile-menu"
            >
              <svg 
                width="22" 
                height="22" 
                viewBox="0 0 24 24" 
                stroke="currentColor" 
                className="transition-transform duration-200"
                style={{ transform: isMenuOpen ? 'rotate(90deg)' : 'none' }}
                aria-hidden="true"
              >
```

### components/PartieClient.tsx

```
// components/PartieClient.tsx - WERSJA Z TABELKƒÑ GRACZY
'use client'

import { useState } from 'react'
import Link from 'next/link'
import {
  Calendar,
  Users,
  Trophy,
  Eye,
  Search,
  Filter,
  ChevronDown,
  CheckCircle,
} from 'lucide-react'
import DeletePartia from './DeletePartia'

interface Gracz {
  id: string
  imie: string
  nazwisko: string
}

interface PartiaZGraczami {
  id: string
  numer_partii: number
  data_rozgrywki: string
  liczba_graczy: number
  duzy_punkt_gracz_id: string
  turniej_id: string
  turniej: {
    id: string
    nazwa: string
  }
  gracze: Gracz[]
  [key: string]: any
}

interface Turniej {
  id: string
  nazwa: string
}

interface PartieClientProps {
  partie: PartiaZGraczami[]
  turnieje?: Turniej[]
}

export default function PartieClient({ partie, turnieje = [] }: PartieClientProps) {
  const [searchTerm, setSearchTerm] = useState('')
  const [selectedTurniej, setSelectedTurniej] = useState('wszystkie')

  const filteredPartie = partie.filter((partia) => {
    const matchesSearch =
      searchTerm === '' ||
      partia.numer_partii.toString().includes(searchTerm) ||
      partia.gracze.some((g) =>
        `${g.imie} ${g.nazwisko}`.toLowerCase().includes(searchTerm.toLowerCase())
      ) ||
      partia.turniej.nazwa.toLowerCase().includes(searchTerm.toLowerCase())

    const matchesTurniej =
      selectedTurniej === 'wszystkie' || partia.turniej.id === selectedTurniej

    return matchesSearch && matchesTurniej
  })

  if (!partie || partie.length === 0) {
    return (
      <div className="text-center py-8">
        <Trophy className="h-12 w-12 text-muted-foreground mx-auto mb-4" />
        <h3 className="text-lg font-semibold text-foreground mb-2">Brak partii</h3>
        <p className="text-muted-foreground mb-4">Nie dodano jeszcze ≈ºadnych partii.</p>
        <Link
          href="/admin/partie/nowa"
          className="inline-flex items-center px-4 py-2 bg-primary hover:bg-primary/90 text-primary-foreground rounded-lg font-medium transition-colors"
        >
          Dodaj pierwszƒÖ partiƒô
        </Link>
      </div>
    )
  }

  return (
    <div className="space-y-4">
      {/* Filtry */}
      <div className="flex flex-col sm:flex-row gap-3">
        <div className="flex-1">
          <div className="relative">
            <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground" />
            <input
              type="text"
              placeholder="Szukaj partii..."
              value={searchTerm}
              onChange={(e) => setSearchTerm(e.target.value)}
              className="w-full pl-10 pr-4 py-2 bg-input border border-border rounded-lg text-foreground placeholder-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"
            />
          </div>
        </div>

        {turnieje.length > 0 && (
          <div className="relative min-w-[200px]">
            <Filter className="absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground" />
            <select
              value={selectedTurniej}
              onChange={(e) => setSelectedTurniej(e.target.value)}
              className="w-full pl-10 pr-8 py-2 bg-input border border-border rounded-lg text-foreground focus:outline-none focus:ring-2 focus:ring-primary appearance-none"
            >
              <option value="wszystkie">Wszystkie turnieje</option>
              {turnieje.map((turniej) => (
                <option key={turniej.id} value={turniej.id}>
                  {turniej.nazwa}
                </option>
              ))}
            </select>
            <ChevronDown className="absolute right-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground pointer-events-none" />
          </div>
        )}
      </div>

      {/* Liczba wynik√≥w */}
      {filteredPartie.length > 0 && (
        <div className="text-sm text-muted-foreground">
          Znaleziono: {filteredPartie.length} partii
        </div>
      )}

      {/* Lista partii */}
      <div className="space-y-4">
        {filteredPartie.map((partia) => {
          const duzyPunktGracz = partia.gracze.find(
            (g) => g.id === partia.duzy_punkt_gracz_id
          )

          // Przygotuj dane graczy dla komponentu DeletePartia
          const graczeDlaUsuwania = partia.gracze.map((gracz, index) => {
            const numerGracza = index + 1
            return {
              id: gracz.id,
              imie: gracz.imie,
              nazwisko: gracz.nazwisko,
              eloPrzed: partia[`elo_przed${numerGracza}`] ?? 1200,
              zmianaElo: partia[`zmiana_elo${numerGracza}`] ?? 0,
            }
          })

          return (
            <div key={partia.id} className="bg-secondary border border-border rounded-lg overflow-hidden">
              {/* Nag≈Ç√≥wek */}
              <div className="p-4 border-b border-border bg-secondary/50">
                <div className="flex flex-col sm:flex-row sm:items-center justify-between gap-3">
                  <div className="flex items-center gap-3">
                    <div className="bg-primary/10 text-primary font-medium px-3 py-1 rounded-md">
                      #{partia.numer_partii}
                    </div>
                    <div>
                      <h3 className="font-semibold text-foreground">{partia.turniej.nazwa}</h3>
                      <div className="flex items-center gap-3 text-xs text-muted-foreground mt-1">
                        <span className="flex items-center gap-1">
                          <Calendar className="h-3 w-3" />
                          {new Date(partia.data_rozgrywki).toLocaleDateString('pl-PL')}
                        </span>
                        <span className="flex items-center gap-1">
                          <Users className="h-3 w-3" />
                          {partia.liczba_graczy} graczy
                        </span>
                      </div>
                    </div>
                  </div>

                  <div className="flex items-center gap-2">
                    <Link
                      href={`/admin/turniej/${partia.turniej_id}/partie/${partia.id}`}
                      className="inline-flex items-center gap-1 px-3 py-1.5 bg-primary hover:bg-primary/90 text-primary-foreground rounded text-sm font-medium transition-colors"
                    >
                      <Eye className="h-3.5 w-3.5" />
                      Szczeg√≥≈Çy
                    </Link>

                    <DeletePartia
                      partiaId={partia.id}
                      turniejId={partia.turniej_id}
                      numerPartii={partia.numer_partii}
                      nazwaTurnieju={partia.turniej.nazwa}
                      gracze={graczeDlaUsuwania}
                      className="px-3 py-1.5 bg-destructive hover:bg-destructive/90 text-destructive-foreground rounded text-sm font-medium transition-colors"
                      iconOnly
                    />
                  </div>
                </div>
              </div>

              {/* Tabela graczy */}
              <div className="p-4">
                <div className="overflow-x-auto">
                  <table className="w-full">
                    <thead>
                      <tr className="text-xs text-muted-foreground border-b border-border">
                        <th className="text-left py-2 px-3 font-medium">Gracz</th>
                        <th className="text-left py-2 px-3 font-medium">Imiƒô i nazwisko</th>
                        <th className="text-left py-2 px-3 font-medium">Wynik</th>
                      </tr>
                    </thead>
                    <tbody>
                      {partia.gracze.map((gracz, index) => {
                        const isWinner = gracz.id === partia.duzy_punkt_gracz_id
                        const playerLetter = String.fromCharCode(65 + index) // A, B, C, D

                        return (
                          <tr
                            key={gracz.id}
                            className={`border-b border-border last:border-0 ${
                              isWinner ? 'bg-success/5' : ''
                            }`}
                          >
                            <td className="py-2 px-3">
                              <div
                                className={`font-medium ${
                                  isWinner ? 'text-success' : 'text-foreground'
                                }`}
                              >
                                {playerLetter}
                              </div>
                            </td>
                            <td className="py-2 px-3">
                              <div
                                className={`font-medium ${
                                  isWinner ? 'text-success' : 'text-foreground'
                                }`}
                              >
                                {gracz.imie} {gracz.nazwisko}
                              </div>
                            </td>
                            <td className="py-2 px-3">
                              {isWinner ? (
                                <div className="inline-flex items-center gap-1 bg-success/20 text-success px-2 py-1 rounded text-xs font-medium">
                                  <CheckCircle className="h-3 w-3" />
                                  Wygrany
                                </div>
                              ) : (
                                <span className="text-muted-foreground text-sm">-</span>
                              )}
                            </td>
                          </tr>
                        )
                      })}
                    </tbody>
                  </table>
                </div>

                {duzyPunktGracz && (
                  <div className="mt-4 pt-3 border-t border-border text-sm">
                    <span className="text-muted-foreground">Zwyciƒôzca partii: </span>
                    <span className="font-medium text-success">
                      {duzyPunktGracz.imie} {duzyPunktGracz.nazwisko}
                    </span>
                  </div>
                )}
              </div>
            </div>
          )
        })}
      </div>

      {/* Brak wynik√≥w */}
      {filteredPartie.length === 0 && (
        <div className="text-center py-12">
          <Search className="h-12 w-12 text-muted-foreground mx-auto mb-4" />
          <p className="text-muted-foreground mb-2">
            {searchTerm || selectedTurniej !== 'wszystkie'
              ? 'Nie znaleziono partii'
              : 'Brak partii do wy≈õwietlenia'}
          </p>
          {(searchTerm || selectedTurniej !== 'wszystkie') && (
            <button
              onClick={() => {
                setSearchTerm('')
                setSelectedTurniej('wszystkie')
              }}
              className="text-primary hover:text-primary/80 text-sm"
            >
              Wyczy≈õƒá filtry
            </button>
          )}
        </div>
      )}
    </div>
  )
}
```

### components/SheetPicker.tsx

```
'use client'

import { useState } from 'react'

type Props = {
  urlInputId: string        // id inputa z linkiem do Google Sheets
  sheetInputId: string      // id inputa, do kt√≥rego wpiszemy nazwƒô karty
  gidHiddenInputId?: string // (opcjonalnie) id ukrytego inputa na gid
}

export default function SheetPicker({ urlInputId, sheetInputId, gidHiddenInputId }: Props) {
  const [loading, setLoading] = useState(false)
  const [error, setError] = useState<string | null>(null)
  const [sheets, setSheets] = useState<{ name: string; gid: string | null }[]>([])
  const [selected, setSelected] = useState<string>('')

  async function fetchSheets() {
    setError(null)
    setSheets([])
    setSelected('')
    const urlEl = document.getElementById(urlInputId) as HTMLInputElement | null
    if (!urlEl || !urlEl.value) {
      setError('Wklej najpierw link do Google Sheets.')
      return
    }
    setLoading(true)
    try {
      const res = await fetch(`/api/gsheets/list?url=${encodeURIComponent(urlEl.value)}`, { cache: 'no-store' })
      const data = await res.json()
      if (!res.ok) throw new Error(data?.error || 'fetch_failed')
      setSheets(data.sheets || [])
      if ((data.sheets || []).length === 0) {
        setError('Nie znaleziono arkuszy. Upewnij siƒô, ≈ºe dokument jest publiczny/opublikowany.')
      }
    } catch (e: any) {
      setError('Nie uda≈Ço siƒô pobraƒá listy arkuszy.')
    } finally {
      setLoading(false)
    }
  }

  function applySelection(name: string) {
    setSelected(name)
    const sheetEl = document.getElementById(sheetInputId) as HTMLInputElement | null
    if (sheetEl) sheetEl.value = name
    // je≈õli mamy hidden na gid, ustaw go dla wygody (je≈õli wybrany ma gid)
    if (gidHiddenInputId) {
      const gidEl = document.getElementById(gidHiddenInputId) as HTMLInputElement | null
      const found = sheets.find(s => s.name === name)
      if (gidEl) gidEl.value = found?.gid ?? ''
    }
  }

  return (
    <div className="flex flex-col gap-2">
      <div className="flex items-center gap-2">
        <button type="button" className="pill pill--secondary" onClick={fetchSheets} disabled={loading}>
          {loading ? 'Pobieranie‚Ä¶' : 'Pobierz arkusze'}
        </button>
        {error && <span className="text-xs text-red-700">{error}</span>}
      </div>

      {sheets.length > 0 && (
        <div className="flex items-center gap-2">
          <select
            className="rounded border px-3 py-2"
            value={selected}
            onChange={(e) => applySelection(e.target.value)}
          >
            <option value="" disabled>‚Äî wybierz kartƒô ‚Äî</option>
            {sheets.map((s) => (
              <option key={`${s.name}-${s.gid ?? 'nogid'}`} value={s.name}>
                {s.name}{s.gid ? ` (gid: ${s.gid})` : ''}
              </option>
            ))}
          </select>
          <span className="text-xs text-slate-600">Zapisze nazwƒô do pola ‚ÄûNazwa karty‚Äù.</span>
        </div>
      )}
    </div>
  )
}
```

### components/TournamentList.client.tsx

```
'use client'

import { useState, useMemo } from 'react'
import TournamentModal from './TournamentModal'
import { formatDatePL, formatTimeHHMM, joinDateTime, statusBadge } from '@/lib/utils'

type MiejsceTurnieju = {
  id: string
  nazwa: string
  miasto: string
  wojewodztwo: string | null
  adres: string | null
  latitude: number | null
  longitude: number | null
}

type TurniejRow = {
  id: string
  nazwa: string
  data_turnieju: string | null
  godzina_turnieju: string | null
  zakonczenie_turnieju: string | null
  gsheet_url: string | null
  limit_graczy: number | null
  miejsce_id: string | null
  miejsce_turnieju: MiejsceTurnieju | null
}

// Klasy styl√≥w z profilu
const inputClass =
  'w-full rounded-lg border border-slate-600 bg-slate-900/70 px-3 py-2 ' +
  'text-sm text-sky-50 placeholder:text-slate-400 ' +
  'focus:border-sky-400 focus:outline-none focus:ring-1 focus:ring-sky-400'

const primaryBtn =
  'inline-flex items-center justify-center rounded-full bg-gradient-to-r ' +
  'from-sky-500 to-sky-600 px-4 py-2 text-sm font-semibold text-white ' +
  'shadow-[0_10px_25px_rgba(15,23,42,0.9)] transition ' +
  'hover:from-sky-400 hover:to-sky-500 hover:shadow-[0_14px_35px_rgba(15,23,42,1)] ' +
  'disabled:opacity-50 disabled:hover:shadow-none'

const secondaryBtn =
  'inline-flex items-center justify-center rounded-full border border-slate-500 ' +
  'bg-slate-800/80 px-4 py-2 text-sm font-semibold text-sky-100 shadow-sm ' +
  'hover:bg-slate-700 hover:border-sky-400 transition'

// Funkcja pomocnicza do okre≈õlania stylu na podstawie tekstu badge
function getBadgeStyle(text: string): React.CSSProperties {
  const baseStyle: React.CSSProperties = {
    display: 'inline-flex',
    alignItems: 'center',
    justifyContent: 'center',
    borderRadius: '9999px',
    padding: '0.5rem 1rem',
    fontSize: '0.75rem',
    fontWeight: 500,
    letterSpacing: '0.025em',
    transition: 'all 200ms',
    borderWidth: '1px',
    borderStyle: 'solid',
    // Cie≈Ñ podobny do reszty strony
    boxShadow: '0 4px 20px rgba(0, 0, 0, 0.4), 0 2px 8px rgba(0, 0, 0, 0.2)',
  }

  if (text === 'w trakcie') {
    return {
      ...baseStyle,
      backgroundColor: 'rgba(16, 185, 129, 0.25)',
      borderColor: 'rgba(52, 211, 153, 0.4)',
      color: '#ffffff',
      // Dodajemy kolorowy cie≈Ñ wewnƒôtrzny dla efektu g≈Çƒôbi
      boxShadow: `
        0 4px 20px rgba(0, 0, 0, 0.4),
        0 2px 8px rgba(0, 0, 0, 0.2),
        inset 0 1px 0 rgba(255, 255, 255, 0.1),
        inset 0 -1px 0 rgba(0, 0, 0, 0.2)
      `,
      textShadow: '0 1px 2px rgba(0, 0, 0, 0.3)',
    }
  } else if (text === 'zako≈Ñczony') {
    return {
      ...baseStyle,
      backgroundColor: 'rgba(239, 68, 68, 0.25)',
      borderColor: 'rgba(248, 113, 113, 0.4)',
      color: '#ffffff',
      // Czerwony cie≈Ñ z efektem g≈Çƒôbi
      boxShadow: `
        0 4px 20px rgba(0, 0, 0, 0.4),
        0 2px 8px rgba(0, 0, 0, 0.2),
        inset 0 1px 0 rgba(255, 255, 255, 0.1),
        inset 0 -1px 0 rgba(0, 0, 0, 0.2)
      `,
      textShadow: '0 1px 2px rgba(0, 0, 0, 0.3)',
    }
  } else {
    // Przysz≈Çe turnieje (za X dni, dzisiaj, jutro, pojutrze)
    return {
      ...baseStyle,
      backgroundColor: 'rgba(59, 130, 246, 0.25)',
      borderColor: 'rgba(96, 165, 250, 0.4)',
      color: '#ffffff',
      // Niebieski cie≈Ñ z efektem g≈Çƒôbi
      boxShadow: `
        0 4px 20px rgba(0, 0, 0, 0.4),
        0 2px 8px rgba(0, 0, 0, 0.2),
        inset 0 1px 0 rgba(255, 255, 255, 0.1),
        inset 0 -1px 0 rgba(0, 0, 0, 0.2)
      `,
      textShadow: '0 1px 2px rgba(0, 0, 0, 0.3)',
    }
  }
}

// Styl dla hover efektu (bƒôdzie u≈ºyty w className)
const badgeHoverClass = "hover:scale-[1.02] hover:shadow-[0_6px_24px_rgba(0,0,0,0.5)] transition-all duration-200"

function TournamentCard({ r, onCardClick }: { r: TurniejRow, onCardClick: (tournament: TurniejRow) => void }) {
  const start = joinDateTime(r.data_turnieju, r.godzina_turnieju)
  const end = r.zakonczenie_turnieju
    ? joinDateTime(r.data_turnieju, r.zakonczenie_turnieju)
    : null
  const badge = statusBadge(start, end)
  
  const miejsce = r.miejsce_turnieju

  return (
    <div 
      className="rounded-2xl border border-slate-700 bg-slate-800/95 p-6 shadow-[0_14px_40px_rgba(0,0,0,0.8)] hover:shadow-[0_18px_50px_rgba(0,0,0,0.9)] transition-all duration-300 cursor-pointer group"
      onClick={() => onCardClick(r)}
    >
      <div className="flex flex-col sm:flex-row sm:items-start justify-between gap-4">
        {/* Lewa strona - Informacje o turnieju */}
        <div className="flex-1 min-w-0">
          {/* Nazwa turnieju */}
          <h3 className="text-xl font-semibold text-sky-50 mb-3 group-hover:text-sky-100 transition-colors">
            {r.nazwa}
          </h3>
          
          {/* Data i godzina */}
          {start && (
            <div className="flex items-center gap-2 text-sm text-sky-200/80 mb-2 group-hover:text-sky-200 transition-colors">
              <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
              </svg>
              <span>
                {formatDatePL(start)} ‚Ä¢ {formatTimeHHMM(r.godzina_turnieju)}
                {end && ` - ${formatTimeHHMM(r.zakonczenie_turnieju)}`}
              </span>
            </div>
          )}

          {/* Miejsce i adres */}
          {miejsce ? (
            <div className="flex items-start gap-2 text-sm text-sky-200/80 group-hover:text-sky-200 transition-colors">
              <svg className="w-4 h-4 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
              </svg>
              <div>
                <div className="font-medium text-sky-100 group-hover:text-sky-50 transition-colors">{miejsce.nazwa}, {miejsce.miasto}</div>
                {miejsce.adres && (
                  <div className="text-sky-200/60 text-xs mt-0.5 group-hover:text-sky-200/70 transition-colors">
                    {miejsce.adres}
                  </div>
                )}
              </div>
            </div>
          ) : (
            <div className="flex items-start gap-2 text-sm text-red-400/80">
              <svg className="w-4 h-4 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.35 16.5c-.77.833.192 2.5 1.732 2.5z" />
              </svg>
              <div>
                <div>Brak danych miejsca</div>
              </div>
            </div>
          )}
        </div>

        {/* Prawa strona - Status */}
        {badge && (
          <div className={`shrink-0 ${badgeHoverClass}`}>
            <span style={getBadgeStyle(badge.text)}>
              {badge.text}
            </span>
          </div>
        )}
      </div>
    </div>
  )
}

export default function TournamentList({ tournaments }: { tournaments: TurniejRow[] }) {
  const [selectedTournament, setSelectedTournament] = useState<TurniejRow | null>(null)
  const [isModalOpen, setIsModalOpen] = useState(false)
  const [searchTerm, setSearchTerm] = useState('')

  const handleCardClick = (tournament: TurniejRow) => {
    setSelectedTournament(tournament)
    setIsModalOpen(true)
  }

  const handleCloseModal = () => {
    setIsModalOpen(false)
    setSelectedTournament(null)
  }

  // Filtrowanie turniej√≥w na podstawie wyszukiwania
  const filteredTournaments = useMemo(() => {
    if (!searchTerm.trim()) return tournaments

    const lowercasedSearch = searchTerm.toLowerCase().trim()
    return tournaments.filter(tournament =>
      tournament.nazwa.toLowerCase().includes(lowercasedSearch) ||
      (tournament.miejsce_turnieju?.nazwa.toLowerCase().includes(lowercasedSearch)) ||
      (tournament.miejsce_turnieju?.miasto.toLowerCase().includes(lowercasedSearch))
    )
  }, [tournaments, searchTerm])

  return (
    <>
      <div className="min-h-screen">
        <main className="flex min-h-[calc(100vh-4rem)] items-center justify-center px-4 py-8">
          <div className="w-full max-w-4xl rounded-2xl bg-slate-800/95 border border-slate-700 shadow-[0_14px_40px_rgba(0,0,0,0.8)] p-6 space-y-6">
            <h1 className="text-2xl font-semibold text-sky-50 text-center">
              Lista Turniej√≥w
            </h1>
            
            {/* Pole wyszukiwania */}
            <div className="space-y-2">
              <div className="relative">
                <input
                  type="text"
                  placeholder="Szukaj turnieju, miejsca lub miasta..."
                  value={searchTerm}
                  onChange={(e) => setSearchTerm(e.target.value)}
                  className={inputClass + " pl-10"}
                />
                <svg
                  className="absolute left-3 top-2.5 w-4 h-4 text-slate-400"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    strokeLinecap="round"
                    strokeLinejoin="round"
                    strokeWidth={2}
                    d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
                  />
                </svg>
                
                {/* Przycisk wyczy≈õƒá */}
                {searchTerm && (
                  <button
                    onClick={() => setSearchTerm('')}
                    className="absolute right-3 top-2.5 text-slate-400 hover:text-sky-100 transition"
                  >
                    <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                    </svg>
                  </button>
                )}
              </div>
              
              {/* Liczba wynik√≥w */}
              {searchTerm && (
                <div className="text-sm text-sky-200/60">
                  Znaleziono {filteredTournaments.length} turniej{filteredTournaments.length === 1 ? '' : filteredTournaments.length >= 2 && filteredTournaments.length <= 4 ? 'e' : 'y'}
                </div>
              )}
            </div>

            {filteredTournaments.length > 0 ? (
              <div className="space-y-4">
                {filteredTournaments.map((r) => (
                  <TournamentCard key={r.id} r={r} onCardClick={handleCardClick} />
                ))}
              </div>
            ) : (
              <div className="rounded-2xl border border-slate-700 bg-slate-800/95 p-8 text-center">
                {searchTerm ? (
                  <>
                    <div className="text-sky-100/80 text-lg mb-2">
                      Nie znaleziono turniej√≥w dla "{searchTerm}"
                    </div>
                    <div className="text-sky-200/60 text-sm">
                      Spr√≥buj zmieniƒá kryteria wyszukiwania
                    </div>
                  </>
                ) : (
                  <div className="text-sky-100/80 text-lg mb-2">Brak turniej√≥w</div>
                )}
              </div>
            )}
          </div>
        </main>
      </div>

      <TournamentModal 
        isOpen={isModalOpen} 
        onClose={handleCloseModal} 
        tournament={selectedTournament} 
      />
    </>
  )
}```

### components/TournamentModal.tsx

```
'use client'

import { useEffect } from 'react'
import { createGoogleCalendarUrl } from '@/lib/utils'

type MiejsceTurnieju = {
  id: string
  nazwa: string
  miasto: string
  wojewodztwo: string | null
  adres: string | null
  latitude: number | null
  longitude: number | null
}

type TurniejRow = {
  id: string
  nazwa: string
  data_turnieju: string | null
  godzina_turnieju: string | null
  zakonczenie_turnieju: string | null
  gsheet_url: string | null
  limit_graczy: number | null
  miejsce_id: string | null
  miejsce_turnieju: MiejsceTurnieju | null
}

interface TournamentModalProps {
  isOpen: boolean
  onClose: () => void
  tournament: TurniejRow | null
}

// Klasy styl√≥w z profilu
const primaryBtn =
  'inline-flex items-center justify-center rounded-full bg-gradient-to-r ' +
  'from-sky-500 to-sky-600 px-4 py-2 text-sm font-semibold text-white ' +
  'shadow-[0_10px_25px_rgba(15,23,42,0.9)] transition ' +
  'hover:from-sky-400 hover:to-sky-500 hover:shadow-[0_14px_35px_rgba(15,23,42,1)] ' +
  'disabled:opacity-50 disabled:hover:shadow-none'

const secondaryBtn =
  'inline-flex items-center justify-center rounded-full border border-slate-500 ' +
  'bg-slate-800/80 px-4 py-2 text-sm font-semibold text-sky-100 shadow-sm ' +
  'hover:bg-slate-700 hover:border-sky-400 transition'

function formatDatePL(d: Date) {
  const formatted = d.toLocaleDateString('pl-PL', {
    weekday: 'long',
    year: '2-digit',
    month: 'numeric',
    day: 'numeric',
  })
  return formatted.charAt(0).toUpperCase() + formatted.slice(1)
}

function formatTimeHHMM(raw: string | null) {
  if (!raw) return '00:00'
  return raw.slice(0, 5)
}

function joinDateTime(d: string | null, t: string | null): Date | null {
  if (!d) return null
  const hhmm = (t ?? '00:00').slice(0, 5)
  return new Date(`${d}T${hhmm}`)
}

export default function TournamentModal({ isOpen, onClose, tournament }: TournamentModalProps) {
  useEffect(() => {
    if (isOpen) {
      document.body.style.overflow = 'hidden'
    } else {
      document.body.style.overflow = 'unset'
    }

    return () => {
      document.body.style.overflow = 'unset'
    }
  }, [isOpen])

  if (!isOpen || !tournament) return null

  const start = joinDateTime(tournament.data_turnieju, tournament.godzina_turnieju)
  const end = tournament.zakonczenie_turnieju
    ? joinDateTime(tournament.data_turnieju, tournament.zakonczenie_turnieju)
    : null
  const calendarUrl = createGoogleCalendarUrl(tournament)
  const miejsce = tournament.miejsce_turnieju

  const hasValidCoordinates = miejsce?.latitude && miejsce?.longitude

  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/70 backdrop-blur-sm">
      <div 
        className="relative w-full max-w-4xl max-h-[90vh] overflow-y-auto rounded-2xl border border-slate-700 bg-slate-800/95 shadow-[0_14px_40px_rgba(0,0,0,0.8)]"
        onClick={(e) => e.stopPropagation()}
      >
        {/* Nag≈Ç√≥wek */}
        <div className="sticky top-0 z-10 flex items-center justify-between p-6 border-b border-slate-600 bg-slate-800/95 backdrop-blur-sm">
          <h2 className="text-2xl font-semibold text-sky-50">{tournament.nazwa}</h2>
          <button
            onClick={onClose}
            className="rounded-full p-2 text-slate-400 hover:text-slate-200 hover:bg-slate-700 transition"
          >
            <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
            </svg>
          </button>
        </div>

        {/* Zawarto≈õƒá */}
        <div className="p-6 space-y-6">
          {/* Podstawowe informacje */}
          <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div className="space-y-4">
              <h3 className="text-lg font-medium text-sky-100">Szczeg√≥≈Çy turnieju</h3>
              <div className="space-y-3 text-sm text-sky-100/90">
                <div className="flex justify-between">
                  <span className="opacity-70">Data:</span>
                  <span>{start ? formatDatePL(start) : '‚Äî'}</span>
                </div>
                <div className="flex justify-between">
                  <span className="opacity-70">Godzina rozpoczƒôcia:</span>
                  <span>{formatTimeHHMM(tournament.godzina_turnieju)}</span>
                </div>
                <div className="flex justify-between">
                  <span className="opacity-70">Godzina zako≈Ñczenia:</span>
                  <span>{tournament.zakonczenie_turnieju ? formatTimeHHMM(tournament.zakonczenie_turnieju) : 'nieustalona'}</span>
                </div>
                {tournament.limit_graczy && (
                  <div className="flex justify-between">
                    <span className="opacity-70">Limit graczy:</span>
                    <span>{tournament.limit_graczy}</span>
                  </div>
                )}
              </div>

              {/* Miejsce */}
              {miejsce && (
                <div className="space-y-2">
                  <h4 className="text-lg font-medium text-sky-100">Miejsce</h4>
                  <div className="space-y-2 text-sm text-sky-100/90">
                    <div className="font-medium">{miejsce.nazwa}</div>
                    <div>{miejsce.miasto}{miejsce.wojewodztwo && `, ${miejsce.wojewodztwo}`}</div>
                    {miejsce.adres && (
                      <div className="text-sky-200/60">{miejsce.adres}</div>
                    )}
                  </div>
                </div>
              )}
            </div>

            {/* Mapa */}
            <div className="space-y-4">
              <h3 className="text-lg font-medium text-sky-100">Lokalizacja</h3>
              {hasValidCoordinates ? (
                <div className="overflow-hidden rounded-lg border border-slate-600">
                  <div className="aspect-[4/3]">
                    <iframe
                      title={`Mapa ${tournament.nazwa}`}
                      src={`https://maps.google.com/maps?q=${miejsce.latitude},${miejsce.longitude}&z=15&output=embed`}
                      className="h-full w-full border-0"
                      loading="lazy"
                      referrerPolicy="no-referrer-when-downgrade"
                      allowFullScreen
                    />
                  </div>
                </div>
              ) : (
                <div className="aspect-[4/3] rounded-lg border border-slate-600 bg-slate-800/50 flex items-center justify-center">
                  <div className="text-center text-sky-200/50">
                    <svg className="w-12 h-12 mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={1} d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={1} d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                    </svg>
                    <div>Brak mapy</div>
                  </div>
                </div>
              )}
            </div>
          </div>

          {/* Przyciski akcji */}
          <div className="flex flex-wrap gap-3 pt-4 border-t border-slate-600">
            {/* Nawigacja */}
            {hasValidCoordinates && (
              <a
                href={`https://www.google.com/maps/dir/?api=1&destination=${miejsce.latitude},${miejsce.longitude}`}
                target="_blank"
                rel="noreferrer"
                className={primaryBtn}
              >
                <svg className="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7" />
                </svg>
                Nawiguj
              </a>
            )}

            {/* Kalendarz */}
            {calendarUrl && (
              <a
                href={calendarUrl}
                target="_blank"
                rel="noreferrer"
                className={primaryBtn}
              >
                <svg className="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <rect x="3" y="4" width="18" height="18" rx="2" ry="2" />
                  <line x1="16" y1="2" x2="16" y2="6" />
                  <line x1="8" y1="2" x2="8" y2="6" />
                  <line x1="3" y1="10" x2="21" y2="10" />
                </svg>
                Kalendarz
              </a>
            )}

            {/* Arkusz Google */}
            {tournament.gsheet_url && (
              <a
                href={tournament.gsheet_url}
                target="_blank"
                rel="noreferrer"
                className={secondaryBtn}
              >
                <svg className="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                </svg>
                Arkusz
              </a>
            )}

            {/* Otw√≥rz w Mapach Google */}
            {hasValidCoordinates && (
              <a
                href={`https://www.google.com/maps/search/?api=1&query=${miejsce.latitude},${miejsce.longitude}`}
                target="_blank"
                rel="noreferrer"
                className={secondaryBtn}
              >
                <svg className="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                </svg>
                Mapa
              </a>
            )}
          </div>
        </div>
      </div>
    </div>
  )
}```

### components/admin/AdminSidebar.tsx

```
import Link from 'next/link'
import { redirect } from 'next/navigation'
import { 
  Users, 
  Trophy, 
  Calendar, 
  MapPin, 
  Settings,
  Home,
  LogOut,
  Shield
} from 'lucide-react'
import { createSupabaseServer } from '@/lib/supabase/server'

async function SignOutButton() {
  const signOut = async () => {
    'use server'
    const supabase = await createSupabaseServer()
    await supabase.auth.signOut()
    redirect('/auth/signin')
  }

  return (
    <form action={signOut}>
      <button 
        type="submit"
        className="flex items-center space-x-3 w-full p-3 rounded-lg text-slate-400 hover:bg-slate-800 hover:text-white transition-colors text-sm"
      >
        <LogOut className="h-4 w-4" />
        <span>Wyloguj siƒô</span>
      </button>
    </form>
  )
}

interface AdminSidebarProps {
  user: {
    email?: string
  }
}

export default function AdminSidebar({ user }: AdminSidebarProps) {
  const navigationItems = [
    { href: '/admin', icon: Home, label: 'Dashboard' },
    { href: '/admin/users', icon: Users, label: 'U≈ºytkownicy' },
    { href: '/admin/turniej', icon: Trophy, label: 'Turnieje' },
    { href: '/admin/partie', icon: Trophy, label: 'Partie' },
    { href: '/turniej/new', icon: Calendar, label: 'Nowy Turniej' },
    { href: '/admin/miejsca', icon: MapPin, label: 'Miejsca' },
    { href: '/admin/ustawienia', icon: Settings, label: 'Ustawienia' },
  ]

  return (
    <div className="w-64 min-h-screen bg-slate-800/95 border-r border-slate-700 flex flex-col">
      <div className="p-6 flex-1">
        {/* Logo */}
        <div className="flex items-center space-x-3 mb-8">
          <div className="bg-sky-500 rounded-lg p-2">
            <Shield className="h-6 w-6 text-white" />
          </div>
          <div>
            <h1 className="text-lg font-bold text-white">Admin Panel</h1>
            <p className="text-xs text-sky-200/80">Tournament System</p>
          </div>
        </div>

        {/* User Info */}
        <div className="mb-8 p-4 rounded-lg bg-slate-900/70 border border-slate-700">
          <div className="flex items-center space-x-3">
            <div className="h-10 w-10 rounded-full bg-gradient-to-r from-sky-500 to-blue-600 flex items-center justify-center">
              <span className="text-sm font-bold text-white">
                {user.email?.[0]?.toUpperCase()}
              </span>
            </div>
            <div className="flex-1 min-w-0">
              <p className="text-sm font-medium text-white truncate">
                {user.email}
              </p>
              <p className="text-xs text-sky-300">Administrator</p>
            </div>
          </div>
        </div>

        {/* Navigation */}
        <nav className="space-y-2">
          {navigationItems.map((item) => {
            const Icon = item.icon
            return (
              <Link
                key={item.href}
                href={item.href}
                className="flex items-center space-x-3 p-3 rounded-lg text-sm font-medium text-slate-400 hover:bg-slate-700/50 hover:text-white transition-colors"
              >
                <Icon className="h-4 w-4" />
                <span>{item.label}</span>
              </Link>
            )
          })}
        </nav>
      </div>

      {/* Logout Button at bottom */}
      <div className="p-6 border-t border-slate-700">
        <SignOutButton />
      </div>
    </div>
  )
}```

### components/admin/NowaPartiaForm.tsx

```
'use client'

import { useState, useMemo } from 'react'
import Link from 'next/link'
import { useRouter } from 'next/navigation'
import { ArrowLeft, Save, Users, X, Trophy, TrendingUp, TrendingDown, Plus, Minus } from 'lucide-react'

interface Gracz {
  id: string
  imie: string
  nazwisko: string
  aktualny_elo: number
}

interface Turniej {
  id: string
  nazwa: string
}

interface NowaPartiaFormProps {
  turniej: Turniej
  gracze: Gracz[] | null
  kolejnyNumer: number
  turniejId: string
}

interface ZmianaElo {
  gracz_id: string
  imie: string
  nazwisko: string
  elo_przed: number
  elo_po: number
  zmiana_elo: number
  male_punkty: number
  duzy_punkt: boolean
}

interface PartiaData {
  duzyPunkt: string
  malePunkty: number[]
}

export default function NowaPartiaForm({ turniej, gracze, kolejnyNumer, turniejId }: NowaPartiaFormProps) {
  const router = useRouter()
  const [selectedGracze, setSelectedGracze] = useState<(string | null)[]>([null, null, null, null])
  const [searchValues, setSearchValues] = useState<string[]>(['', '', '', ''])
  const [liczbaPartii, setLiczbaPartii] = useState(1)
  const [partieDane, setPartieDane] = useState<PartiaData[]>([
    { duzyPunkt: '', malePunkty: [0, 0, 0, 0] }
  ])
  const [isSubmitting, setIsSubmitting] = useState(false)
  const [showSummary, setShowSummary] = useState(false)
  const [summaryData, setSummaryData] = useState<ZmianaElo[][]>([])

  // Przygotuj listƒô graczy do wy≈õwietlenia w datalist - z zabezpieczeniem przed undefined
  const graczeOptions = useMemo(() => {
    if (!gracze) return []
    
    return gracze.map(gracz => ({
      id: gracz.id,
      display: `${gracz.imie} ${gracz.nazwisko} (${Math.round(gracz.aktualny_elo || 1200)})`
    }))
  }, [gracze])

  // Funkcja do uzyskania dostƒôpnych graczy dla datalist
  const getAvailableGracze = (currentIndex: number) => {
    return graczeOptions.filter(option => 
      !selectedGracze.some((selected, index) => 
        index !== currentIndex && selected === option.id
      )
    )
  }

  // Funkcja do obs≈Çugi zmiany inputa
  const handleInputChange = (index: number, value: string) => {
    const newSearchValues = [...searchValues]
    newSearchValues[index] = value
    setSearchValues(newSearchValues)

    // Sprawd≈∫ czy warto≈õƒá pasuje do kt√≥rego≈õ gracza
    const foundGracz = graczeOptions.find(option => 
      option.display.toLowerCase() === value.toLowerCase()
    )

    const newSelected = [...selectedGracze]
    newSelected[index] = foundGracz ? foundGracz.id : null
    setSelectedGracze(newSelected)
  }

  // Funkcja do zmiany liczby partii
  const handleLiczbaPartiiChange = (newLiczba: number) => {
    if (newLiczba < 1) return
    
    if (newLiczba > liczbaPartii) {
      // Dodaj nowe partie
      const newPartieDane = [...partieDane]
      for (let i = liczbaPartii; i < newLiczba; i++) {
        newPartieDane.push({
          duzyPunkt: selectedGracze.find(g => g !== null) || '', // Domy≈õlnie pierwszy wybrany gracz
          malePunkty: selectedGracze.map(() => 0)
        })
      }
      setPartieDane(newPartieDane)
    } else {
      // Usu≈Ñ partie
      setPartieDane(partieDane.slice(0, newLiczba))
    }
    
    setLiczbaPartii(newLiczba)
  }

  // Funkcja do zmiany du≈ºego punktu w partii
  const handleDuzyPunktChange = (partiaIndex: number, graczId: string) => {
    const newPartieDane = [...partieDane]
    newPartieDane[partiaIndex] = {
      ...newPartieDane[partiaIndex],
      duzyPunkt: graczId
    }
    setPartieDane(newPartieDane)
  }

  // Funkcja do zmiany ma≈Çych punkt√≥w w partii
  const handleMalePunktyChange = (partiaIndex: number, graczIndex: number, value: number) => {
    const newPartieDane = [...partieDane]
    const newMalePunkty = [...newPartieDane[partiaIndex].malePunkty]
    newMalePunkty[graczIndex] = value
    newPartieDane[partiaIndex] = {
      ...newPartieDane[partiaIndex],
      malePunkty: newMalePunkty
    }
    setPartieDane(newPartieDane)
  }

  // Funkcja do czyszczenia pola
  const clearField = (index: number) => {
    const newSearchValues = [...searchValues]
    newSearchValues[index] = ''
    setSearchValues(newSearchValues)

    const newSelected = [...selectedGracze]
    newSelected[index] = null
    setSelectedGracze(newSelected)

    // Zaktualizuj partie dane - usu≈Ñ du≈ºe punkty dla usuniƒôtego gracza
    const newPartieDane = partieDane.map(partia => ({
      ...partia,
      duzyPunkt: partia.duzyPunkt === newSelected[index] ? '' : partia.duzyPunkt,
      malePunkty: partia.malePunkty.map((punkty, i) => i === index ? 0 : punkty)
    }))
    setPartieDane(newPartieDane)
  }

  // Funkcja do przesy≈Çania formularza
  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault()
    setIsSubmitting(true)

    try {
      const response = await fetch(`/admin/turniej/${turniejId}/partie/nowa/action`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          turniej_id: turniejId,
          numer_partii_start: kolejnyNumer,
          liczba_partii: liczbaPartii,
          gracze: selectedGracze.filter(g => g !== null),
          partie: partieDane
        }),
      })

      if (response.ok) {
        const result = await response.json()
        setSummaryData(result.zmiany)
        setShowSummary(true)
      } else {
        const error = await response.json()
        alert(`B≈ÇƒÖd: ${error.errors?.join(', ') || 'WystƒÖpi≈Ç nieznany b≈ÇƒÖd'}`)
      }
    } catch (error) {
      console.error('B≈ÇƒÖd podczas zapisywania partii:', error)
      alert('WystƒÖpi≈Ç b≈ÇƒÖd podczas zapisywania partii')
    } finally {
      setIsSubmitting(false)
    }
  }

  // Funkcja do zamkniƒôcia modala i przekierowania
  const handleCloseSummary = () => {
    setShowSummary(false)
    router.push(`/admin/turniej/${turniejId}/partie`)
    router.refresh()
  }

  const liczbaWybranychGraczy = selectedGracze.filter(g => g !== null).length
  const canSubmit = liczbaWybranychGraczy >= 2 && 
                   partieDane.every(partia => partia.duzyPunkt) &&
                   partieDane.every(partia => 
                     partia.malePunkty.slice(0, liczbaWybranychGraczy).every(punkt => !isNaN(punkt))
                   )

  // Je≈õli nie ma graczy, poka≈º komunikat
  if (!gracze || gracze.length === 0) {
    return (
      <div className="p-8 max-w-4xl mx-auto">
        <Link
          href={`/admin/turniej/${turniejId}/partie`}
          className="inline-flex items-center text-sm text-slate-400 hover:text-white mb-6"
        >
          <ArrowLeft className="h-4 w-4 mr-2" />
          Powr√≥t do partii
        </Link>

        <div className="bg-slate-800/50 rounded-xl border border-slate-700 p-6 text-center">
          <Users className="h-12 w-12 text-slate-400 mx-auto mb-4" />
          <h2 className="text-xl font-bold text-white mb-2">Brak graczy</h2>
          <p className="text-slate-400 mb-6">
            Nie ma dostƒôpnych graczy do wyboru. Dodaj graczy przed tworzeniem partii.
          </p>
          <Link
            href="/admin/gracze"
            className="bg-sky-500 hover:bg-sky-600 text-white px-4 py-2 rounded-lg inline-flex items-center"
          >
            <Plus className="h-4 w-4 mr-2" />
            ZarzƒÖdzaj graczami
          </Link>
        </div>
      </div>
    )
  }

  return (
    <div className="p-8 max-w-6xl mx-auto">
      <Link
        href={`/admin/turniej/${turniejId}/partie`}
        className="inline-flex items-center text-sm text-slate-400 hover:text-white mb-6"
      >
        <ArrowLeft className="h-4 w-4 mr-2" />
        Powr√≥t do partii
      </Link>

      <div className="bg-slate-800/50 rounded-xl border border-slate-700 p-6">
        <h1 className="text-2xl font-bold text-white mb-2">Nowe partie</h1>
        <p className="text-slate-400 mb-6">
          Turniej: {turniej.nazwa} ‚Ä¢ Partie #{kolejnyNumer}-{kolejnyNumer + liczbaPartii - 1}
        </p>

        <form onSubmit={handleSubmit}>
          {/* Wyb√≥r graczy */}
          <div className="mb-8">
            <h3 className="text-lg font-semibold text-white mb-4 flex items-center">
              <Users className="h-5 w-5 mr-2" />
              Wybierz graczy (2-4)
            </h3>
            
            <div className="space-y-4">
              {[0, 1, 2, 3].map((index) => (
                <div key={index} className="bg-slate-700/30 rounded-lg p-4">
                  <div className="flex items-center space-x-4">
                    <div className="flex-1">
                      <label className="block text-sm text-slate-400 mb-1">
                        Gracz {index + 1}
                      </label>
                      <div className="relative">
                        <input
                          type="text"
                          value={searchValues[index]}
                          onChange={(e) => handleInputChange(index, e.target.value)}
                          list={`gracze-list-${index}`}
                          className="w-full bg-slate-600 border border-slate-500 rounded px-3 py-2 text-white text-sm pr-8"
                          placeholder="Wpisz imiƒô i nazwisko..."
                          required={index < 2}
                          autoComplete="off"
                        />
                        {selectedGracze[index] && (
                          <button
                            type="button"
                            onClick={() => clearField(index)}
                            className="absolute right-2 top-1/2 transform -translate-y-1/2 text-slate-400 hover:text-white"
                          >
                            <X className="h-4 w-4" />
                          </button>
                        )}
                      </div>
                      
                      <datalist id={`gracze-list-${index}`}>
                        {getAvailableGracze(index).map((gracz) => (
                          <option key={gracz.id} value={gracz.display} />
                        ))}
                      </datalist>
                    </div>

                    {selectedGracze[index] && (
                      <div className="text-xs text-green-400 mt-6">
                        ‚úì Wybrano
                      </div>
                    )}
                  </div>
                </div>
              ))}
            </div>
          </div>

          {/* Wyb√≥r liczby partii */}
          <div className="mb-8">
            <h3 className="text-lg font-semibold text-white mb-4">Liczba partii do dodania</h3>
            <div className="flex items-center space-x-4 mb-4">
              <button
                type="button"
                onClick={() => handleLiczbaPartiiChange(liczbaPartii - 1)}
                disabled={liczbaPartii <= 1}
                className="p-2 rounded-lg bg-slate-700 hover:bg-slate-600 disabled:opacity-50 disabled:cursor-not-allowed"
              >
                <Minus className="h-4 w-4" />
              </button>
              
              <span className="text-white font-semibold text-lg min-w-8 text-center">
                {liczbaPartii}
              </span>
              
              <button
                type="button"
                onClick={() => handleLiczbaPartiiChange(liczbaPartii + 1)}
                disabled={liczbaPartii >= 10}
                className="p-2 rounded-lg bg-slate-700 hover:bg-slate-600 disabled:opacity-50 disabled:cursor-not-allowed"
              >
                <Plus className="h-4 w-4" />
              </button>
              
              <span className="text-slate-400 text-sm">
                Partie #{kolejnyNumer}-{kolejnyNumer + liczbaPartii - 1}
              </span>
            </div>
            <p className="text-slate-400 text-sm">
              Mo≈ºesz dodaƒá maksymalnie 10 partii na raz
            </p>
          </div>

          {/* Partie */}
          <div className="space-y-6 mb-8">
            {partieDane.map((partia, partiaIndex) => (
              <div key={partiaIndex} className="bg-slate-700/30 rounded-xl border border-slate-600 p-6">
                <h3 className="text-lg font-semibold text-white mb-4">
                  Partia #{kolejnyNumer + partiaIndex}
                </h3>
                
                <div className="space-y-3">
                  {selectedGracze.map((graczId, graczIndex) => 
                    graczId && (
                      <div key={graczIndex} className="flex items-center justify-between p-3 bg-slate-600/30 rounded-lg">
                        <div className="flex items-center space-x-3 flex-1">
                          <input
                            type="radio"
                            name={`duzyPunkt-${partiaIndex}`}
                            checked={partia.duzyPunkt === graczId}
                            onChange={() => handleDuzyPunktChange(partiaIndex, graczId)}
                            className="h-4 w-4 text-yellow-500 bg-slate-600 border-slate-500 focus:ring-yellow-500 focus:ring-2"
                          />
                          <span className="text-white font-medium">
                            {graczeOptions.find(g => g.id === graczId)?.display}
                          </span>
                          {partia.duzyPunkt === graczId && (
                            <span className="text-yellow-400 text-sm flex items-center">
                              <Trophy className="h-3 w-3 mr-1" />
                              Zwyciƒôzca
                            </span>
                          )}
                        </div>
                        
                        <div className="flex items-center space-x-2">
                          <label className="text-slate-400 text-sm whitespace-nowrap">Ma≈Çe punkty:</label>
                          <input
                            type="number"
                            value={partia.malePunkty[graczIndex]}
                            onChange={(e) => handleMalePunktyChange(partiaIndex, graczIndex, parseFloat(e.target.value) || 0)}
                            min="0"
                            step="0.1"
                            className="w-20 bg-slate-600 border border-slate-500 rounded px-2 py-1 text-white text-sm focus:border-sky-500 focus:ring-1 focus:ring-sky-500"
                          />
                        </div>
                      </div>
                    )
                  )}
                </div>
              </div>
            ))}
          </div>

          <div className="bg-blue-500/10 border border-blue-500/30 rounded-lg p-4 mb-6">
            <h4 className="text-sm font-semibold text-blue-300 mb-2">Jak to dzia≈Ça?</h4>
            <ul className="text-sm text-blue-200/80 space-y-1">
              <li>‚Ä¢ <strong>Wybierz sk≈Çad graczy</strong> (2-4 osoby) - ten sam dla wszystkich partii</li>
              <li>‚Ä¢ <strong>Okre≈õl liczbƒô partii</strong> - ile partii chcesz dodaƒá z tym sk≈Çadem</li>
              <li>‚Ä¢ <strong>Dla ka≈ºdej partii</strong> zaznacz zwyciƒôzcƒô i wprowad≈∫ ma≈Çe punkty</li>
              <li>‚Ä¢ <strong>System automatycznie</strong> obliczy zmiany ELO dla ka≈ºdej partii</li>
              <li>‚Ä¢ Partie zostanƒÖ zapisane z kolejnymi numerami</li>
            </ul>
          </div>

```

### components/organizer/OrganizerSidebar.tsx

```
// components/organizer/OrganizerSidebar.tsx
'use client'

import Link from 'next/link'
import { usePathname } from 'next/navigation'
import { 
  Trophy, 
  MapPin, 
  Home,
  CalendarPlus,
  List,
  PlusCircle,
  LogOut,
  User,
  BarChart3,
  Settings,
  Shield
} from 'lucide-react'

interface OrganizerSidebarProps {
  user: {
    id: string
    email?: string | null
  }
  role: string
}

export default function OrganizerSidebar({ user, role }: OrganizerSidebarProps) {
  const pathname = usePathname()

  const menuItems = [
    {
      title: 'Dashboard',
      href: '/organizer/dashboard',
      icon: <Home className="h-5 w-5" />,
      description: 'Panel organizatora'
    },
    {
      title: 'Moje turnieje',
      href: '/organizer/turnieje',
      icon: <List className="h-5 w-5" />,
      description: 'ZarzƒÖdzaj turniejami'
    },
    {
      title: 'Nowy turniej',
      href: '/turniej/new',
      icon: <PlusCircle className="h-5 w-5" />,
      description: 'Utw√≥rz nowy turniej'
    },
    {
      title: 'Moje miejsca',
      href: '/organizer/miejsca',
      icon: <MapPin className="h-5 w-5" />,
      description: 'Twoje miejsca turniej√≥w'
    },
    {
      title: 'Dodaj miejsce',
      href: '/miejsce/new',
      icon: <PlusCircle className="h-5 w-5" />,
      description: 'Dodaj nowe miejsce'
    },
    {
      title: 'Statystyki',
      href: '/organizer/statystyki',
      icon: <BarChart3 className="h-5 w-5" />,
      description: 'Statystyki organizatora'
    },
    {
      title: 'Ustawienia',
      href: '/organizer/ustawienia',
      icon: <Settings className="h-5 w-5" />,
      description: 'Ustawienia konta'
    }
  ]

  // Je≈õli jest te≈º adminem, dodaj link do panelu admina
  if (role === 'admin') {
    menuItems.push({
      title: 'Panel admina',
      href: '/admin',
      icon: <Shield className="h-5 w-5" />,
      description: 'Przejd≈∫ do panelu admina'
    })
  }

  const handleLogout = async () => {
    try {
      const response = await fetch('/auth/signout', { method: 'POST' })
      if (response.ok) {
        window.location.href = '/'
      }
    } catch (error) {
      console.error('Logout error:', error)
      window.location.href = '/'
    }
  }

  return (
    <div className="w-64 min-h-screen bg-slate-800/95 border-r border-slate-700 flex flex-col">
      {/* Logo */}
      <div className="p-6 border-b border-slate-700">
        <div className="flex items-center space-x-3">
          <div className="bg-emerald-500 rounded-lg p-2">
            <Trophy className="h-6 w-6 text-white" />
          </div>
          <div>
            <h1 className="text-lg font-bold text-white">Panel Organizatora</h1>
            <p className="text-xs text-emerald-200/80">Elo Arena</p>
          </div>
        </div>
      </div>

      {/* User Info */}
      <div className="p-6 border-b border-slate-700">
        <div className="flex items-center space-x-3">
          <div className="h-10 w-10 rounded-full bg-gradient-to-r from-emerald-500 to-green-600 flex items-center justify-center">
            <User className="h-5 w-5 text-white" />
          </div>
          <div className="flex-1 min-w-0">
            <p className="text-sm font-medium text-white truncate">
              {user.email || 'Organizer'}
            </p>
            <p className="text-xs text-emerald-300">
              {role === 'admin' ? 'Administrator/Organizer' : 'Organizer'}
            </p>
          </div>
        </div>
      </div>

      {/* Navigation */}
      <nav className="flex-1 p-4 space-y-1 overflow-y-auto">
        {menuItems.map((item) => {
          const isActive = pathname === item.href || pathname?.startsWith(`${item.href}/`)
          
          return (
            <Link
              key={item.href}
              href={item.href}
              className={`flex items-center space-x-3 p-3 rounded-lg transition-all ${
                isActive 
                  ? 'bg-emerald-900/40 text-emerald-100 border border-emerald-700/50' 
                  : 'text-slate-400 hover:bg-slate-700/50 hover:text-white'
              }`}
            >
              {item.icon}
              <div className="flex-1">
                <span className="text-sm font-medium">{item.title}</span>
                <p className="text-xs text-slate-500 mt-0.5">{item.description}</p>
              </div>
            </Link>
          )
        })}
      </nav>

      {/* Footer */}
      <div className="p-6 border-t border-slate-700 space-y-3">
        <Link
          href="/"
          className="flex items-center space-x-3 p-3 rounded-lg text-sm font-medium text-slate-400 hover:bg-slate-700/50 hover:text-white transition-colors"
        >
          <Home className="h-4 w-4" />
          <span>Strona g≈Ç√≥wna</span>
        </Link>
        
        <button
          onClick={handleLogout}
          className="flex items-center space-x-3 w-full p-3 rounded-lg text-sm font-medium text-slate-400 hover:bg-red-900/30 hover:text-red-300 transition-colors"
        >
          <LogOut className="h-4 w-4" />
          <span>Wyloguj siƒô</span>
        </button>
      </div>
    </div>
  )
}```

### eslint.config.mjs

```
import { defineConfig, globalIgnores } from "eslint/config";
import nextVitals from "eslint-config-next/core-web-vitals";
import nextTs from "eslint-config-next/typescript";

const eslintConfig = defineConfig([
  ...nextVitals,
  ...nextTs,
  // Override default ignores of eslint-config-next.
  globalIgnores([
    // Default ignores of eslint-config-next:
    ".next/**",
    "out/**",
    "build/**",
    "next-env.d.ts",
  ]),
]);

export default eslintConfig;
```

### hooks/useGoogleMaps.ts

```
// hooks/useGoogleMaps.ts
import { useState, useEffect, useCallback } from 'react'

declare global {
  interface Window {
    _googleMapsLoading?: Promise<void>
    _googleMapsLoaded?: boolean
  }
}

export const useGoogleMaps = (apiKey: string) => {
  const [isLoaded, setIsLoaded] = useState(false)
  const [error, setError] = useState<string | null>(null)

  const loadGoogleMaps = useCallback(async (): Promise<void> => {
    // Je≈õli ju≈º za≈Çadowany, zwr√≥ƒá
    if (window.google && window.google.maps) {
      setIsLoaded(true)
      return
    }

    // Je≈õli ju≈º ≈Çadowany, poczekaj
    if (window._googleMapsLoading) {
      await window._googleMapsLoading
      setIsLoaded(true)
      return
    }

    // Oznacz jako ju≈º za≈Çadowany globalnie
    if (window._googleMapsLoaded) {
      setIsLoaded(true)
      return
    }

    // Utw√≥rz promise dla ≈Çadowania
    window._googleMapsLoading = new Promise(async (resolve, reject) => {
      try {
        // Usu≈Ñ WSZYSTKIE istniejƒÖce skrypty Google Maps
        const existingScripts = document.querySelectorAll('script[src*="maps.googleapis.com"]')
        existingScripts.forEach(script => {
          script.remove()
        })

        // Usu≈Ñ stare style i elementy Google Maps
        const gmpElements = document.querySelectorAll('[class*="gmp-"], [id*="gmp-"]')
        gmpElements.forEach(el => el.remove())

        // Dodaj nowy skrypt
        const script = document.createElement('script')
        script.src = `https://maps.googleapis.com/maps/api/js?key=${apiKey}`
        script.async = true
        script.defer = true
        script.id = 'google-maps-script-global'

        script.onload = () => {
          console.log('‚úÖ Google Maps API za≈Çadowane globalnie')
          window._googleMapsLoaded = true
          setIsLoaded(true)
          resolve()
        }

        script.onerror = () => {
          console.error('‚ùå B≈ÇƒÖd ≈Çadowania Google Maps API')
          setError('Nie uda≈Ço siƒô za≈Çadowaƒá Google Maps API')
          reject()
        }

        document.head.appendChild(script)
      } catch (err) {
        console.error('‚ùå B≈ÇƒÖd w loadGoogleMaps:', err)
        setError('B≈ÇƒÖd podczas ≈Çadowania Google Maps')
        reject(err)
      }
    })

    await window._googleMapsLoading
  }, [apiKey])

  useEffect(() => {
    if (apiKey && !isLoaded && !error) {
      loadGoogleMaps()
    }
  }, [apiKey, isLoaded, error, loadGoogleMaps])

  return { isLoaded, error, loadGoogleMaps }
}```

### lib/eloCalculator.ts

```
// lib/eloCalculator.ts
export interface EloConfig {
  k_factor_nowy_gracz: number;
  k_factor_staly_gracz: number;
  prog_staly_gracz: number;
  k_factors: {
    below_1400: number;
    below_1800: number;
    below_2000: number;
    below_2200: number;
    above_2200: number;
  };
  games_for_new_player: number;
  bonus_k_for_new: number;
  max_k_for_new: number;
}

export interface GraczWPartii {
  id: string;
  elo_przed: number;
  liczba_partii: number;
  duzy_punkt: boolean;
}

export interface WynikElo {
  id: string;
  elo_po: number;
  zmiana_elo: number;
  k_factor: number;
}

// Dynamiczny wsp√≥≈Çczynnik K jak w Google Script
function getDynamicKFor(elo: number, games: number, config: EloConfig): number {
  let K: number;
  
  // Podstawowy K na podstawie ELO
  if (elo < 1400) K = config.k_factors.below_1400;
  else if (elo < 1800) K = config.k_factors.below_1800;
  else if (elo < 2000) K = config.k_factors.below_2000;
  else if (elo < 2200) K = config.k_factors.below_2200;
  else K = config.k_factors.above_2200;
  
  // Bonus dla nowych graczy
  if (games < config.games_for_new_player) {
    K = Math.min(config.max_k_for_new, K + config.bonus_k_for_new);
  }
  
  return K;
}

// U≈õrednianie K miƒôdzy graczami
function pairK(Kw: number, Kl: number): number {
  return (Kw > 0 && Kl > 0) ? (2 * Kw * Kl) / (Kw + Kl) : 0;
}

export function calculateEloChanges(
  gracze: GraczWPartii[],
  config: EloConfig
): WynikElo[] {
  const wyniki: WynikElo[] = [];
  const n = gracze.length;
  
  if (n < 2 || n > 4) {
    throw new Error(`Nieprawid≈Çowa liczba graczy: ${n}. Wymagane 2-4 graczy.`);
  }

  // Znajd≈∫ zwyciƒôzcƒô
  const zwyciezca = gracze.find(g => g.duzy_punkt);
  if (!zwyciezca) {
    throw new Error('Nie znaleziono gracza z du≈ºym punktem');
  }

  // Oblicz skalowanie jak w Google Script
  const scale = (n >= 3) ? (2 / (n - 1)) : 1;

  // Oblicz zmiany dla ka≈ºdego gracza
  for (const gracz of gracze) {
    let zmiana_elo = 0;
    const k_gracza = getDynamicKFor(gracz.elo_przed, gracz.liczba_partii, config);

    if (gracz.duzy_punkt) {
      // ZWYCIƒòZCA: Zyskuje od ka≈ºdego przegranego
      for (const przeciwnik of gracze) {
        if (przeciwnik.id !== gracz.id) {
          const k_przeciwnika = getDynamicKFor(przeciwnik.elo_przed, przeciwnik.liczba_partii, config);
          const k_efektywne = pairK(k_gracza, k_przeciwnika);
          
          const expected = 1 / (1 + Math.pow(10, (przeciwnik.elo_przed - gracz.elo_przed) / 400));
          const gain = k_efektywne * (1 - expected);
          
          zmiana_elo += gain;
        }
      }
    } else {
      // PRZEGRANY: Trac√≠ tylko ze zwyciƒôzcƒÖ
      const k_zwyciezcy = getDynamicKFor(zwyciezca.elo_przed, zwyciezca.liczba_partii, config);
      const k_efektywne = pairK(k_gracza, k_zwyciezcy);
      
      const expected = 1 / (1 + Math.pow(10, (zwyciezca.elo_przed - gracz.elo_przed) / 400));
      zmiana_elo = k_efektywne * (0 - expected);
    }

    // Zastosuj skalowanie
    zmiana_elo *= scale;

    const elo_po = gracz.elo_przed + zmiana_elo;

    wyniki.push({
      id: gracz.id,
      elo_po: Math.round(elo_po * 100) / 100,
      zmiana_elo: Math.round(zmiana_elo * 100) / 100,
      k_factor: k_gracza
    });
  }

  return wyniki;
}

export function validatePartia(gracze: { id: string, duzy_punkt: boolean }[]): string[] {
  const errors: string[] = [];
  const n = gracze.length;

  if (n < 2 || n > 4) {
    errors.push(`Nieprawid≈Çowa liczba graczy: ${n}. Wymagane 2-4 graczy.`);
    return errors;
  }

  // Sprawd≈∫ unikalno≈õƒá graczy
  const graczeIds = gracze.map(g => g.id);
  const unikalniGracze = [...new Set(graczeIds)];
  if (unikalniGracze.length !== n) {
    errors.push('Gracze muszƒÖ byƒá unikalni');
  }

  // Sprawd≈∫ czy jest dok≈Çadnie jeden zwyciƒôzca
  const zwyciezcy = gracze.filter(g => g.duzy_punkt);
  if (zwyciezcy.length !== 1) {
    errors.push('Musi byƒá dok≈Çadnie jeden zwyciƒôzca (du≈ºy punkt)');
  }

  return errors;
}

// Funkcja do przeliczania ca≈Çej historii od poczƒÖtku
export async function recalculateAllElo(supabase: any, turniej_id?: string) {
  console.log('Rozpoczynam przeliczanie ca≈Çej historii Elo...');
  
  // Resetuj ranking wszystkich graczy
  const { error: resetError } = await supabase
    .from('gracz')
    .update({
      aktualny_elo: 1200,
      liczba_partii: 0,
      suma_malych_punktow: 0,
      liczba_duzych_punktow: 0,
      ostatnia_aktualizacja: new Date().toISOString()
    });

  if (resetError) {
    console.error('B≈ÇƒÖd resetowania rankingu:', resetError);
    return;
  }

  // Pobierz wszystkie partie w kolejno≈õci chronologicznej
  let query = supabase
    .from('wyniki_partii')
    .select('*')
    .order('data_rozgrywki', { ascending: true })
    .order('numer_partii', { ascending: true });

  if (turniej_id) {
    query = query.eq('turniej_id', turniej_id);
  }

  const { data: wszystkiePartie, error } = await query;

  if (error) {
    console.error('B≈ÇƒÖd pobierania partii:', error);
    return;
  }

  console.log(`Znaleziono ${wszystkiePartie.length} partii do przeliczenia`);

  // Pobierz konfiguracjƒô Elo
  const { data: config } = await supabase
    .from('elo_config')
    .select('*')
    .single();

  // Domy≈õlna konfiguracja je≈õli brak w bazie
  const fullConfig: EloConfig = config || {
    k_factor_nowy_gracz: 40,
    k_factor_staly_gracz: 20,
    prog_staly_gracz: 30,
    k_factors: {
      below_1400: 32,
      below_1800: 28,
      below_2000: 24,
      below_2200: 18,
      above_2200: 12
    },
    games_for_new_player: 20,
    bonus_k_for_new: 8,
    max_k_for_new: 40
  };

  // Przelicz ka≈ºdƒÖ partiƒô od poczƒÖtku
  for (const partia of wszystkiePartie) {
    await recalculateSinglePartia(supabase, partia, fullConfig);
  }

  console.log('Przeliczanie zako≈Ñczone pomy≈õlnie');
}

async function recalculateSinglePartia(supabase: any, partia: any, config: EloConfig) {
  const gracze: GraczWPartii[] = [];
  
  // Przygotuj dane graczy do oblicze≈Ñ Elo
  for (let i = 1; i <= partia.liczba_graczy; i++) {
    const graczId = partia[`gracz${i}_id`];
    if (graczId) {
      // Pobierz aktualny stan gracza
      const { data: gracz } = await supabase
        .from('gracz')
        .select('*')
        .eq('id', graczId)
        .single();

      if (gracz) {
        gracze.push({
          id: graczId,
          elo_przed: gracz.aktualny_elo,
          liczba_partii: gracz.liczba_partii,
          duzy_punkt: partia.duzy_punkt_gracz_id === graczId
        });
      }
    }
  }

  // Oblicz nowe Elo
  const noweElo = calculateEloChanges(gracze, config);

  // Przygotuj dane do aktualizacji partii
  const updateData: any = {};
  for (let i = 0; i < gracze.length; i++) {
    const gracz = gracze[i];
    const elo = noweElo.find(e => e.id === gracz.id);
    
    updateData[`elo_przed${i+1}`] = gracz.elo_przed;
    updateData[`elo_po${i+1}`] = elo?.elo_po;
    updateData[`zmiana_elo${i+1}`] = elo?.zmiana_elo;
    updateData[`k_factor${i+1}`] = elo?.k_factor;
  }

  // Aktualizuj partiƒô
  await supabase
    .from('wyniki_partii')
    .update(updateData)
    .eq('id', partia.id);

  // Aktualizuj graczy
  for (const gracz of gracze) {
    const elo = noweElo.find(e => e.id === gracz.id);
    const index = gracze.findIndex(g => g.id === gracz.id) + 1;
    const malePunkty = partia[`male_punkty${index}`] || 0;
    const duzyPunkt = partia.duzy_punkt_gracz_id === gracz.id ? 1 : 0;

    // Pobierz aktualne warto≈õci przed aktualizacjƒÖ
    const { data: currentGracz } = await supabase
      .from('gracz')
      .select('suma_malych_punktow, liczba_duzych_punktow')
      .eq('id', gracz.id)
      .single();

    await supabase
      .from('gracz')
      .update({
        aktualny_elo: elo?.elo_po,
        liczba_partii: gracz.liczba_partii + 1,
        suma_malych_punktow: (currentGracz?.suma_malych_punktow || 0) + malePunkty,
        liczba_duzych_punktow: (currentGracz?.liczba_duzych_punktow || 0) + duzyPunkt,
        ostatnia_aktualizacja: new Date().toISOString()
      })
      .eq('id', gracz.id);
  }
}```

### lib/supabase/admin.ts

```
import { createClient } from '@supabase/supabase-js'

export const supabaseAdmin = createClient(
  process.env.NEXT_PUBLIC_SUPABASE_URL!,
  process.env.SUPABASE_SERVICE_ROLE_KEY!,   // tylko na serwerze!
  { auth: { persistSession: false, autoRefreshToken: false } }
)
```

### lib/supabase/browser.ts

```
// lib/supabase/browser.ts
import { createBrowserClient } from '@supabase/ssr'

export function createSupabaseBrowser() {
  return createBrowserClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!
  )
}```

### lib/supabase/client.ts

```
'use client'
import { createBrowserClient } from '@supabase/ssr'
export const supabase = createBrowserClient(
  process.env.NEXT_PUBLIC_SUPABASE_URL!,
  process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!
)
```

### lib/supabase/server-mutable.ts

```
// lib/supabase/server-mutable.ts
import { cookies } from 'next/headers'
import { createServerClient, type CookieOptions } from '@supabase/ssr'

export async function createSupabaseServerMutable() {
  const store = await cookies()

  return createServerClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,
    {
      cookies: {
        get(name: string) {
          return store.get(name)?.value
        },
        set(name: string, value: string, options?: CookieOptions) {
          store.set({ name, value, ...options })
        },
        remove(name: string, options?: CookieOptions) {
          store.set({ name, value: '', ...options, maxAge: 0 })
        },
      },
    }
  )
}
```

### lib/supabase/server.ts

```
// lib/supabase/server.ts
import { cookies } from 'next/headers'
import { createServerClient, type CookieOptions } from '@supabase/ssr'

export async function createSupabaseServer() {
  // NEXT 15: cookies() jest async
  const store = await cookies()

  return createServerClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,
    {
      cookies: {
        get(name: string) {
          return store.get(name)?.value
        },
        // w RSC nie modyfikujemy cookies
        set(_name: string, _value: string, _options?: CookieOptions) {},
        remove(_name: string, _options?: CookieOptions) {},
      },
    }
  )
}
```

### lib/utils.ts

```
import { styleText } from "util"

type MiejsceTurnieju = {
  id: string
  nazwa: string
  miasto: string
  wojewodztwo: string | null
  adres: string | null
  latitude: number | null
  longitude: number | null
}

type TurniejRow = {
  id: string
  nazwa: string
  data_turnieju: string | null
  godzina_turnieju: string | null
  zakonczenie_turnieju: string | null
  gsheet_url: string | null
  limit_graczy: number | null
  miejsce_id: string | null
  miejsce_turnieju: MiejsceTurnieju | null
}

export function joinDateTime(d: string | null, t: string | null): Date | null {
  if (!d) return null
  const hhmm = (t ?? '00:00').slice(0, 5)
  return new Date(`${d}T${hhmm}`)
}

export function capitalizeFirst(str: string): string {
  return str.charAt(0).toUpperCase() + str.slice(1)
}

export function formatDatePL(d: Date) {
  const formatted = d.toLocaleDateString('pl-PL', {
    weekday: 'long',
    year: 'numeric',
    month: 'long',
    day: 'numeric',
  })
  return capitalizeFirst(formatted)
}

export function formatTimeHHMM(raw: string | null) {
  if (!raw) return '00:00'
  return raw.slice(0, 5)
}

export function statusBadge(start: Date | null, end: Date | null) {
  
  if (!start) return null

  const now = new Date()
  const sixHours = 6 * 60 * 60 * 1000

  //
  //  BAZA = ‚ÄûBUTTON‚Äù (jak do logowania)
  //
  const base =
    'inline-flex items-center justify-center rounded-full px-3 py-1 ' +
    'text-xs font-semibold tracking-wide text-white shadow-sm ' +
    'transition-colors'

  //
  //  KOLORY:
  //  - przysz≈Çe: niebieski
  //  - w trakcie: zielony
  //  - zako≈Ñczony: czerwony
  //
  const futureStyle = `${base} bg-blue-600/90 hover:bg-blue-500`
  const activeStyle = `${base} bg-emerald-600/90 hover:bg-emerald-500`
  const finishedStyle = `${base} bg-rose-600/90 hover:bg-rose-500`

  // Ile dni do startu (pe≈Çne dni kalendarzowe)
  const getDiffDays = () => {
    const startDate = new Date(start.getFullYear(), start.getMonth(), start.getDate())
    const today = new Date(now.getFullYear(), now.getMonth(), now.getDate())
    const diffTime = startDate.getTime() - today.getTime()
    return Math.floor(diffTime / (1000 * 60 * 60 * 24))
  }

  //
  //  MAMY DATƒò KO≈ÉCA
  //
  if (end) {
    // JESZCZE SIƒò NIE ZACZƒÑ≈Å ‚Üí PRZYSZ≈ÅE (NIEBIESKI)
    if (now.getTime() < start.getTime()) {
      const diffDays = getDiffDays()

      if (diffDays === 0) return { text: 'dzisiaj', style: futureStyle }
      if (diffDays === 1) return { text: 'jutro', style: futureStyle }
      if (diffDays === 2) return { text: 'pojutrze', style: futureStyle }
      return { text: `za ${diffDays} dni`, style: futureStyle }
    }

    // W TRAKCIE ‚Üí ZIELONY
    if (now.getTime() >= start.getTime() && now.getTime() <= end.getTime()) {
      return {
        text: 'w trakcie',
        style: activeStyle,
      }
    }

    // PO ZAKO≈ÉCZENIU ‚Üí CZERWONY
    return {
      text: 'zako≈Ñczony',
      style: finishedStyle,
    }
  }

  //
  //  NIE MA DATY KO≈ÉCA ‚Äì TYLKO START
  //
  const ms = start.getTime() - now.getTime()
  if (ms > 0) {
    const diffDays = getDiffDays()

    if (diffDays === 0) return { text: 'dzisiaj', style: futureStyle }
    if (diffDays === 1) return { text: 'jutro', style: futureStyle }
    if (diffDays === 2) return { text: 'pojutrze', style: futureStyle }
    return { text: `za ${diffDays} dni`, style: futureStyle }
  } else {
    const since = now.getTime() - start.getTime()
    if (since <= sixHours) {
      return {
        text: 'w trakcie',
        style: activeStyle,
      }
    }
    return {
      text: 'zako≈Ñczony',
      style: finishedStyle,
    }
  }
}

export function createGoogleCalendarUrl(r: TurniejRow): string | null {
  if (!r.data_turnieju) return null

  const start = joinDateTime(r.data_turnieju, r.godzina_turnieju)
  if (!start) return null

  const formatDateForGoogle = (date: Date) =>
    date.toISOString().replace(/-|:|\.\d+/g, '').slice(0, 15) + 'Z'

  const startTime = formatDateForGoogle(start)

  let end: Date
  if (r.zakonczenie_turnieju) {
    const e = joinDateTime(r.data_turnieju, r.zakonczenie_turnieju)
    end = e ?? new Date(start.getTime() + 3 * 60 * 60 * 1000)
  } else {
    end = new Date(start.getTime() + 3 * 60 * 60 * 1000)
  }
  const endTime = formatDateForGoogle(end)

  const details: string[] = []
  if (r.limit_graczy) details.push(`Limit graczy: ${r.limit_graczy}`)
  if (r.gsheet_url) details.push(`Arkusz Google: ${r.gsheet_url}`)
  if (r.zakonczenie_turnieju) details.push(`Zako≈Ñczenie: ${formatTimeHHMM(r.zakonczenie_turnieju)}`)

  const miejsce = r.miejsce_turnieju
  if (miejsce) {
    details.push(`Miejsce: ${miejsce.nazwa}, ${miejsce.miasto}`)
  }

  const location =
    miejsce?.latitude && miejsce?.longitude
      ? `https://maps.google.com/?q=${miejsce.latitude},${miejsce.longitude}`
      : miejsce?.adres || ''

  const params = new URLSearchParams({
    action: 'TEMPLATE',
    text: r.nazwa,
    dates: `${startTime}/${endTime}`,
    details: details.join('\n'),
    location: location,
    ctz: 'Europe/Warsaw',
  })

  return `https://calendar.google.com/calendar/render?${params.toString()}`
}
```

### next.config.ts

```
import type { NextConfig } from "next";

const nextConfig: NextConfig = {
  /* config options here */
  reactCompiler: true,
};

export default nextConfig;
```

### package.json

```
{
  "name": "elo-arena",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "eslint"
  },
  "dependencies": {
    "@headlessui/react": "^2.2.9",
    "@heroicons/react": "^2.2.0",
    "@react-google-maps/api": "^2.20.7",
    "@supabase/ssr": "^0.7.0",
    "@supabase/supabase-js": "^2.80.0",
    "@vercel/analytics": "^1.5.0",
    "leaflet": "^1.9.4",
    "lucide-react": "^0.555.0",
    "next": "^16.0.8",
    "react": "19.2.0",
    "react-dom": "19.2.0",
    "react-leaflet": "^5.0.0"
  },
  "devDependencies": {
    "@tailwindcss/forms": "^0.5.10",
    "@types/geojson": "^7946.0.16",
    "@types/google.maps": "^3.58.1",
    "@types/leaflet": "^1.9.21",
    "@types/node": "^20",
    "@types/react": "^19",
    "@types/react-dom": "^19",
    "autoprefixer": "^10.4.21",
    "babel-plugin-react-compiler": "1.0.0",
    "baseline-browser-mapping": "^2.8.32",
    "eslint": "^9",
    "eslint-config-next": "16.0.1",
    "postcss": "^8.5.6",
    "stylelint": "^16.26.1",
    "stylelint-config-standard": "^39.0.1",
    "tailwindcss": "^3.4.18",
    "tailwindcss-animate": "^1.0.7",
    "typescript": "^5"
  }
}
```

### postcss.config.js

```
module.exports = {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
}
```

### tailwind.config.js

```
/** @type {import('tailwindcss').Config} */
module.exports = {
  darkMode: ['class'],
  content: [
    './pages/**/*.{ts,tsx}',
    './components/**/*.{ts,tsx}',
    './app/**/*.{ts,tsx}',
    './src/**/*.{ts,tsx}',
  ],
  theme: {
    container: {
      center: true,
      padding: '1rem',
      screens: {
        '2xl': '1200px',
      },
    },
    extend: {
      colors: {
        background: '#020617',
        foreground: '#E5E7EB',

        primary: {
          DEFAULT: '#22C55E',
          foreground: '#0B1120',
        },

        secondary: {
          DEFAULT: '#0F172A',
          foreground: '#E5E7EB',
        },

        muted: {
          DEFAULT: '#020617',
          foreground: '#9CA3AF',
        },

        accent: {
          DEFAULT: '#F97316',
          foreground: '#0B1120',
        },

        border: '#1F2933',
        input: '#111827',
        ring: '#22C55E',

        destructive: {
          DEFAULT: '#EF4444',
          foreground: '#F9FAFB',
        },
        success: {
          DEFAULT: '#22C55E',
          foreground: '#052e16',
        },
        warning: {
          DEFAULT: '#F97316',
          foreground: '#7c2d12',
        },
      },

      fontFamily: {
        sans: ['system-ui', 'ui-sans-serif', 'sans-serif'],
        mono: ['ui-monospace', 'SFMono-Regular', 'monospace'],
      },

      borderRadius: {
        lg: '1rem',
        md: '0.75rem',
        sm: '0.5rem',
      },

      boxShadow: {
        soft: '0 10px 30px rgba(15, 23, 42, 0.45)',
        elevated: '0 18px 45px rgba(15, 23, 42, 0.65)',
      },

      spacing: {
        '18': '4.5rem',
      },
    },
  },
  plugins: [
    require('@tailwindcss/forms'),
    require('tailwindcss-animate'),
  ],
}




```

### tsconfig.json

```
{
  "compilerOptions": {
    "target": "ES2017",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "react-jsx",
    "incremental": true,
    "plugins": [
      {
        "name": "next"
      }
    ],
    "paths": {
      "@/*": ["./*"]
    }
  },
  "include": [
    "next-env.d.ts",
    "**/*.ts",
    "**/*.tsx",
    ".next/types/**/*.ts",
    ".next/dev/types/**/*.ts",
    "**/*.mts"
  ],
  "exclude": ["node_modules"]
}
```

